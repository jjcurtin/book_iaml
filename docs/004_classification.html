<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Applied Machine Learning - 4&nbsp; Introduction to Classification Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./005_resampling.html" rel="next">
<link href="./003_regression.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="book.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Applied Machine Learning</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/jjcurtin/book_iaml" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Course Syllabus</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./001_overview.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002_exploratory_data_analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./003_regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./004_classification.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005_resampling.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resampling Methods for Model Selection and Evaluation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_regularization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regularization and Penalized Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./007_midterm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Midterm Exam</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./008_advanced_performance_metrics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Performance Metrics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./009_model_comparisons.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Model Comparisons and Other Explanatory Goals</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010_random_forest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Models: Decision Trees, Bagging Trees, and Random Forest</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011_neural_networks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Advanced Models: Neural Networks</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./012_nlp.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Natural Language Processing: Text Processing and Feature Engineering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./013_applications.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Applications for Machine Learning: Synthesis and Concept Generalization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./014_ethics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ethical Issues in Machine Learning Research and Applications</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./015_final.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Final Exam and Project</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_terminology.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Key Terminology and Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_dummy_coding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Novel Levels in Held-Out Set(s)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_model_performance_simulations.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Appendix 2: Simulations of Model Performance Bias and Variance by Resampling Techniques</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_shap.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Appendix 3: Understanding Shapley Values from SHAP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_bootstrapping.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Appendix 4: Bootstrapping Standard Errors &amp; Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_test.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Test</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#unit-overview" id="toc-unit-overview" class="nav-link active" data-scroll-target="#unit-overview"><span class="toc-section-number">4.1</span>  Unit Overview</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="toc-section-number">4.1.1</span>  Learning Objectives</a></li>
  <li><a href="#readings" id="toc-readings" class="nav-link" data-scroll-target="#readings"><span class="toc-section-number">4.1.2</span>  Readings</a></li>
  <li><a href="#lecture-videos" id="toc-lecture-videos" class="nav-link" data-scroll-target="#lecture-videos"><span class="toc-section-number">4.1.3</span>  Lecture Videos</a></li>
  <li><a href="#application-assignment-and-quiz" id="toc-application-assignment-and-quiz" class="nav-link" data-scroll-target="#application-assignment-and-quiz"><span class="toc-section-number">4.1.4</span>  Application Assignment and Quiz</a></li>
  </ul></li>
  <li><a href="#bayes-classifier" id="toc-bayes-classifier" class="nav-link" data-scroll-target="#bayes-classifier"><span class="toc-section-number">4.2</span>  Bayes Classifier</a></li>
  <li><a href="#logistic-regression-a-conceptual-review" id="toc-logistic-regression-a-conceptual-review" class="nav-link" data-scroll-target="#logistic-regression-a-conceptual-review"><span class="toc-section-number">4.3</span>  Logistic Regression: A Conceptual Review</a></li>
  <li><a href="#the-cars-dataset" id="toc-the-cars-dataset" class="nav-link" data-scroll-target="#the-cars-dataset"><span class="toc-section-number">4.4</span>  The Cars Dataset</a>
  <ul class="collapse">
  <li><a href="#cleaning-eda" id="toc-cleaning-eda" class="nav-link" data-scroll-target="#cleaning-eda"><span class="toc-section-number">4.4.1</span>  Cleaning EDA</a></li>
  <li><a href="#modeling-eda" id="toc-modeling-eda" class="nav-link" data-scroll-target="#modeling-eda"><span class="toc-section-number">4.4.2</span>  Modeling EDA</a></li>
  </ul></li>
  <li><a href="#logistic-regression---model-building" id="toc-logistic-regression---model-building" class="nav-link" data-scroll-target="#logistic-regression---model-building"><span class="toc-section-number">4.5</span>  Logistic Regression - Model Building</a></li>
  <li><a href="#k-nearest-neighbors---a-conceptual-overview" id="toc-k-nearest-neighbors---a-conceptual-overview" class="nav-link" data-scroll-target="#k-nearest-neighbors---a-conceptual-overview"><span class="toc-section-number">4.6</span>  K Nearest Neighbors - A Conceptual Overview</a></li>
  <li><a href="#a-return-to-cars---now-with-knn" id="toc-a-return-to-cars---now-with-knn" class="nav-link" data-scroll-target="#a-return-to-cars---now-with-knn"><span class="toc-section-number">4.7</span>  A Return to Cars - Now with KNN</a></li>
  <li><a href="#linear-discriminant-analysis" id="toc-linear-discriminant-analysis" class="nav-link" data-scroll-target="#linear-discriminant-analysis"><span class="toc-section-number">4.8</span>  Linear Discriminant Analysis</a></li>
  <li><a href="#quadratic-discriminant-analysis" id="toc-quadratic-discriminant-analysis" class="nav-link" data-scroll-target="#quadratic-discriminant-analysis"><span class="toc-section-number">4.9</span>  Quadratic Discriminant Analysis</a></li>
  <li><a href="#comparisons-between-these-four-classifiers" id="toc-comparisons-between-these-four-classifiers" class="nav-link" data-scroll-target="#comparisons-between-these-four-classifiers"><span class="toc-section-number">4.10</span>  Comparisons between these four classifiers</a></li>
  <li><a href="#a-quick-tour-of-many-classifiers" id="toc-a-quick-tour-of-many-classifiers" class="nav-link" data-scroll-target="#a-quick-tour-of-many-classifiers"><span class="toc-section-number">4.11</span>  A quick tour of many classifiers</a>
  <ul class="collapse">
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="toc-section-number">4.11.1</span>  Logistic Regression</a></li>
  <li><a href="#knn-with-k-5-somewhat-arbitrary-default" id="toc-knn-with-k-5-somewhat-arbitrary-default" class="nav-link" data-scroll-target="#knn-with-k-5-somewhat-arbitrary-default"><span class="toc-section-number">4.11.2</span>  KNN with K = 5 (somewhat arbitrary default)</a></li>
  <li><a href="#linear-discriminant-analysis-1" id="toc-linear-discriminant-analysis-1" class="nav-link" data-scroll-target="#linear-discriminant-analysis-1"><span class="toc-section-number">4.11.3</span>  Linear Discriminant Analysis</a></li>
  <li><a href="#regularized-discriminant-analysis" id="toc-regularized-discriminant-analysis" class="nav-link" data-scroll-target="#regularized-discriminant-analysis"><span class="toc-section-number">4.11.4</span>  Regularized Discriminant Analysis</a></li>
  <li><a href="#naive-bayes-classifier" id="toc-naive-bayes-classifier" class="nav-link" data-scroll-target="#naive-bayes-classifier"><span class="toc-section-number">4.11.5</span>  Naive Bayes Classifier</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="toc-section-number">4.11.6</span>  Random Forest</a></li>
  <li><a href="#neural-networks" id="toc-neural-networks" class="nav-link" data-scroll-target="#neural-networks"><span class="toc-section-number">4.11.7</span>  Neural networks</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="toc-section-number">4.12</span>  Discussion</a>
  <ul class="collapse">
  <li><a href="#anouncements" id="toc-anouncements" class="nav-link" data-scroll-target="#anouncements"><span class="toc-section-number">4.12.1</span>  Anouncements</a></li>
  <li><a href="#probability-odds-and-log-odds" id="toc-probability-odds-and-log-odds" class="nav-link" data-scroll-target="#probability-odds-and-log-odds"><span class="toc-section-number">4.12.2</span>  Probability, odds, and log-odds</a></li>
  <li><a href="#comparisons-across-algorithms" id="toc-comparisons-across-algorithms" class="nav-link" data-scroll-target="#comparisons-across-algorithms"><span class="toc-section-number">4.12.3</span>  Comparisons across algorithms</a></li>
  </ul></li>
  <li><a href="#categorical-predictors" id="toc-categorical-predictors" class="nav-link" data-scroll-target="#categorical-predictors"><span class="toc-section-number">4.13</span>  Categorical predictors</a>
  <ul class="collapse">
  <li><a href="#interactions-in-lda-and-qda" id="toc-interactions-in-lda-and-qda" class="nav-link" data-scroll-target="#interactions-in-lda-and-qda"><span class="toc-section-number">4.13.1</span>  Interactions in LDA and QDA</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jjcurtin/book_iaml/edit/main/004_classification.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="unit-overview" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="unit-overview"><span class="header-section-number">4.1</span> Unit Overview</h2>
<section id="learning-objectives" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">4.1.1</span> Learning Objectives</h3>
<ul>
<li>Bayes classifier</li>
<li>Logistic regression
<ul>
<li>probability, odds, and logit models</li>
<li>definitions of odds and odds ratios</li>
</ul></li>
<li>K nearest neighbors for classification</li>
<li>Linear discriminant analysis</li>
<li>Quadratic discriminant analysis</li>
<li>Regularized discriminant analysis</li>
<li>Decision boundaries in the two feature space</li>
<li>Relative costs and benefits of these different statistical algorithms</li>
</ul>
<hr>
</section>
<section id="readings" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="readings"><span class="header-section-number">4.1.2</span> Readings</h3>
<ul>
<li><span class="citation" data-cites="ISL">James et al. (<a href="#ref-ISL" role="doc-biblioref">2023</a>)</span> <a href="pdfs/isl_2.pdf">Chapter 4, pp 129 - 164</a></li>
</ul>
</section>
<section id="lecture-videos" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="lecture-videos"><span class="header-section-number">4.1.3</span> Lecture Videos</h3>
<ul>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-1/1_5xvs5z3f">Lecture 1: The Bayes Classifier</a> ~ 9 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-2/1_ut2up1mo">Lecture 2: Conceptual Overview of Logistic Regression</a> ~ 19 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-3/1_vydb2j8t">Lecture 3: EDA with the Cars Dataset</a> ~ 12 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-4/1_dzqnsnf0">Lecture 4: Logistic Regression with Cars Dataset</a> ~ 32 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-5/1_mj1cyhhj">Lecture 5: KNN with Cars Dataset</a> ~ 19 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-6/1_t7mnafsp">Lecture 6: LDA, DQA, RDA with Cars Dataset</a> ~ 16 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-7/1_tw44we5w">Lecture 7: Comparisons among Classifiers</a> ~ 11 mins</li>
</ul>
<p>Post questions or discuss readings or lectures on the appropriate Slack channel</p>
<hr>
</section>
<section id="application-assignment-and-quiz" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="application-assignment-and-quiz"><span class="header-section-number">4.1.4</span> Application Assignment and Quiz</h3>
<ul>
<li>data: <a href="application_assignments/unit_04/titanic_raw.csv">raw</a>; <a href="application_assignments/unit_04/titanic_test_cln.csv">test</a></li>
<li><a href="application_assignments/unit_04/titanic_data_dictionary.png">data dictionary</a></li>
<li><a href="https://raw.githubusercontent.com/jjcurtin/book_iaml/main/application_assignments/unit_04/hw_unit_04_eda_cleaning.qmd">cleaning EDA qmd</a></li>
<li><a href="https://raw.githubusercontent.com/jjcurtin/book_iaml/main/application_assignments/unit_04/hw_unit_04_fit_rda.qmd">rda qmd</a></li>
<li><a href="https://raw.githubusercontent.com/jjcurtin/book_iaml/main/application_assignments/unit_04/hw_unit_04_fit_knn.qmd">knn qmd</a></li>
<li>solution: <a href="https://dionysus.psych.wisc.edu/iaml/key_unit_04_eda_modeling.html">modeling EDA</a> <a href="https://dionysus.psych.wisc.edu/iaml/key_unit_04_fit_rda.html">rda</a>; <a href="https://dionysus.psych.wisc.edu/iaml/key_unit_04_fit_knn.html">knn</a></li>
</ul>
<p>Post questions to application_assignments</p>
<p>Submit the application assignment <a href="https://canvas.wisc.edu/courses/395546/assignments/2187689">here</a> and complete the <a href="https://canvas.wisc.edu/courses/395546/quizzes/514051">unit quiz</a> by 8 pm on Wednesday, February 14th</p>
<hr>
<p>Our eventual goal in this unit is for you to build a machine learning classification model that can accurately predict who lived vs.&nbsp;died on the titanic.<br>
<br>
<br>
Prior to that, we will work with an example where we classify a car as high or low fuel efficient (i.e., a dichtomous outcome based on miles per gallon) using features engineered from its characteristics</p>
<hr>
</section>
</section>
<section id="bayes-classifier" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="bayes-classifier"><span class="header-section-number">4.2</span> Bayes Classifier</h2>
<p>First, lets introduce the Bayes classifier, which is the classifier that will have the lowest error rate of all classifiers using the same set of features.<br>
<br>
The figure below displays simulated data for a classification problem for K = 2 classes as a function of <code>X1</code> and <code>X2</code></p>
<p><img src="figs/unit4_two_class_decision_boundry.png" style="height:4in"></p>
<p>The Bayes classifier assigns each observation its most likely class given its conditional probabilities for the values for <code>X1</code> and <code>X2</code></p>
<ul>
<li><span class="math inline">\(Pr(Y = k | X = x_0) for\:k = 1:K\)</span></li>
<li>For K = 2, this means assigning to the class with Pr &gt; .50</li>
<li>This decision boundary for the two class problem is displayed in the figure</li>
</ul>
<hr>
<p>The Bayes classifier provides the minimum error rate for test data</p>
<ul>
<li>Error rate for any <span class="math inline">\(x_0\)</span> will be <span class="math inline">\(1 - max (Pr( Y = k | X = x_0))\)</span></li>
<li>Overall error rate will be the average of this across all possible X</li>
<li>This is the irreducible error for classification problems</li>
<li>This is a theoretical model b/c (except for simulated data), we don’t know the conditional probabilities based on X</li>
<li>Many classification models try to estimate these conditionals</li>
</ul>
<p>Let’s talk now about some of these classification models</p>
<hr>
</section>
<section id="logistic-regression-a-conceptual-review" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="logistic-regression-a-conceptual-review"><span class="header-section-number">4.3</span> Logistic Regression: A Conceptual Review</h2>
<p>Logistic regression (a special case of the <strong>generalized</strong> linear model) estimates the conditional probability for each class given X (a specific set of values for our features)</p>
<ul>
<li>In the binary outcome case, we will often refer to the two outcomes as the positive class and the negative class</li>
<li>This makes most sense in some applied settings where we are most interested in predicting if one of the two classes is likely, e.g.,
<ul>
<li>Presence of heart disease</li>
<li>Positive for some psychiatric diagnoses</li>
<li>Lapse back to alcohol use in people with alcohol use disorder</li>
</ul></li>
</ul>
<hr>
<p>Logistic regression is used frequently for binary and multi-level outcomes because</p>
<ul>
<li>The general linear model makes predictions that are not bounded by [0, 1] and do not represent true estimates of conditional probability for each class</li>
<li>Logistic regression approaches can be modified to accommodate multi-class outcomes (i.e., more than two levels) even when they are not ordered</li>
<li>Nonetheless, the general linear model is still used at times to predict binary outcomes (see <a href="https://en.wikipedia.org/wiki/Linear_probability_model">Linear Probability Model</a>) so you should be aware of it. We won’t discuss it further here.</li>
</ul>
<p><img src="figs/unit4_lm_vs_logistic.png" style="height:4in"></p>
<hr>
<p>Logistic regression provides predicted conditional probabilities for one class (positive class) for any specific set of values for our features (X)</p>
<ul>
<li><p><span class="math inline">\(Pr(positive\:class | X) = \frac{e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}{1 + e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}\)</span></p></li>
<li><p>These conditional probabilities are bounded by [0, 1]</p></li>
<li><p>To maximize accuracy (as per Bayes classifier),</p>
<ul>
<li>we predict the positive case if <span class="math inline">\(Pr(positive class | X) &gt; .5\)</span> for any specific X</li>
<li>otherwise we predict the negative class</li>
</ul></li>
</ul>
<hr>
<p>As a simple parametric model, logistic regression is commonly used for explanatory purposes as well as prediction<br>
<br>
For these reasons, it is worthwhile to fully understand how to work with the logistic function to quantify and describe the effects of your features/predictors in terms of</p>
<ul>
<li>Probability</li>
<li>Odds</li>
<li>[Log-odds or logit]</li>
<li>Odds ratio</li>
</ul>
<hr>
<p>The logistic function yields the probability of the positive class given X</p>
<ul>
<li>However, in some instances (e.g., horse racing, poker), it may make more sense to describe the odds of the positive case occurring rather than probability<br>
<br>
</li>
</ul>
<p>Odds are defined with respect to probabilities as follows:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|X)} {1 - Pr(positive\:class|X)}\)</span></li>
</ul>
<hr>
<p>For example, if the UW Badgers have a .5 probability of winning some upcoming game based on X, their odds of winning are 1 (to 1)</p>
<ul>
<li><span class="math inline">\(\frac{0.5} {1 - 0.5}\)</span><br>
<br>
</li>
</ul>
<p>If the UW Badgers have a .75 probability of winning some upcoming game based on X, their odds of winning are 3 (:1; ‘3 to 1’)</p>
<ul>
<li><span class="math inline">\(\frac{0.75} {1 - 0.75}\)</span></li>
</ul>
<hr>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question: If the UW Badgers have a .25 probability of winning some upcoming game based on X, what are their odds of winning?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>.25 / (1 - .25) = 0.33 or 1:3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<hr>
<p>The logistic function can be modified to provide odds directly:<br>
<br>
<strong>Logistic function</strong>:</p>
<ul>
<li><span class="math inline">\(Pr(positive\:class | X) = \frac{e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}{1 + e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}\)</span><br>
<br>
</li>
</ul>
<p><strong>Definition of odds</strong>:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|X)} {1 - Pr(positive\:class|X)}\)</span><br>
<br>
</li>
</ul>
<p>Substitute logistic function for <span class="math inline">\(Pr(positive\:class|X)\)</span> on top and bottom and simplify to get:</p>
<ul>
<li><span class="math inline">\(odds(positive\:class|X) = e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}\)</span></li>
<li>Odds are bounded by [0, <span class="math inline">\(\infty\)</span>]</li>
</ul>
<hr>
<p>The logistic function can be modified further such that the outcome (log-odds/logit) is a linear function of your features<br>
<br>
If we take the natural log (base e) of both sides of the odds equation, we get:</p>
<ul>
<li><span class="math inline">\(log(odds(positive\:class|X)) = \beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p\)</span></li>
<li>Log-odds are unbounded <span class="math inline">\([-\infty, \infty]\)</span><br>
<br>
</li>
</ul>
<p>Use of logit transformation:</p>
<ul>
<li>provides the connection between the general linear model and generalized linear models (in this case with link = logit, family = binomial).<br>
</li>
<li>Notice that the logit/log-odds is a linear combination of the features (just like in the general linear model)</li>
</ul>
<hr>
<p><strong>Odds</strong> and <strong>probability</strong> are descriptive but they are not linear functions of X</p>
<ul>
<li>Therefore, parameter estimates from these models aren’t very useful to describe the effect of features</li>
<li>This is because unit change in Y per unit change in any specific feature is not the same for all values of the feature</li>
</ul>
<hr>
<p><strong>Log-odds</strong> are a linear function of X</p>
<ul>
<li>Therefore, you can say that log-odds of positive class increases by <span class="math inline">\(b_1\)</span> (our estimate of <span class="math inline">\(\beta_1\)</span>) for every one unit increase in <span class="math inline">\(x_1\)</span></li>
<li>However, log-odds are NOT very descriptive/intuitive so they are not that useful for explanatory purposes</li>
</ul>
<hr>
<p>The <strong>odds ratio</strong> addresses these problems<br>
<br>
Odds are defined at a specific set of values across the features in your model. For example, with one feature:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|x_1)} {1 - Pr(positive\:class|x_1)}\)</span><br>
<br>
</li>
</ul>
<p>The odds ratio describes the change in odds for a change of c units in your feature. With some manipulation:</p>
<ul>
<li><span class="math inline">\(Odds\:ratio = \frac{odds(x+c)}{odds(x)}\)</span></li>
<li><span class="math inline">\(Odds\:ratio = \frac{e^{\beta_0 + \beta_1*(x_1 + c)}}{e^{\beta_0 + \beta_1*x_1}}\)</span></li>
<li><span class="math inline">\(Odds\:ratio = e^{c*\beta_1}\)</span></li>
</ul>
<hr>
<p>As an example, if we fit a logistic regression model to predict the probability of the Badgers winning a home football game given the attendance (measured in individual spectators at the game), we might find <span class="math inline">\(b_1\)</span> (our estimate of <span class="math inline">\(\beta_1\)</span>) = .000075.<br>
<br>
Given this, the odds ratio associated with every increase in 10,000 spectators:</p>
<ul>
<li><span class="math inline">\(= e^{c * \b_1}\)</span></li>
<li><span class="math inline">\(= e^{10000 * .000075}\)</span></li>
<li><span class="math inline">\(= 2.1\)</span></li>
<li>For every increase of 10,000 spectators, the odds of the Badgers winning doubles</li>
</ul>
<hr>
</section>
<section id="the-cars-dataset" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="the-cars-dataset"><span class="header-section-number">4.4</span> The Cars Dataset</h2>
<p>Now, let’s put this all of this together in the Cars dataset from Carnegie Mellon’s <a href="http://lib.stat.cmu.edu/datasets/">StatLib Dataset Archive</a><br>
<br>
<br>
Our goal is to build a classifier (machine learning model for a categorical outcome) that classifies cars as either high or low mpg.</p>
<hr>
<section id="cleaning-eda" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="cleaning-eda"><span class="header-section-number">4.4.1</span> Cleaning EDA</h3>
<p>Let’s start with some cleaning EDA</p>
<ul>
<li>Open and “skim” it RE variable names, classes &amp; missing data</li>
<li>Variable names are already tidy</li>
<li>no missing data</li>
<li>mins (p0) and maxes(p100) for numeric look good</li>
<li>there are two character variables (<code>mpq</code> and <code>name</code>) that will need to be re-classed</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_all.csv"</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_types =</span> <span class="fu">cols</span>()) </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data_all <span class="sc">|&gt;</span> <span class="fu">skim_some</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data_all</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">392</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mpg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">name</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">301</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cylinders</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">displacement</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">455.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">horsepower</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">230.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">weight</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1613</td>
<td style="text-align: right;">5140.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acceleration</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">24.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">82.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">origin</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<ul>
<li><code>mpg</code> is ordinal, so lets set the levels to indicate the order.</li>
<li>After reviewing the <a href="data/auto_data_dictionary.pdf">data dictionary</a>, we see that <code>origin</code> is a nominal predictor that is coded numeric (where 1 = American, 2 = European, and 3 = Japanese). Let’s recode as character with meaningful labels and then class as a factor</li>
<li>and lets not forget to re-class <code>name</code> too</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mpg =</span> <span class="fu">factor</span>(mpg, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"high"</span>)),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">factor</span>(name), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">origin =</span> <span class="fu">factor</span> (origin),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">origin =</span> <span class="fu">fct_recode</span>(<span class="fu">as.character</span>(origin), <span class="co">#&lt;1&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"american"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"european"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"japanese"</span> <span class="ot">=</span> <span class="st">"3"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><code>fct_recode()</code> works on levels stored as characters, so convert 1, 2, 3, to character first.</li>
</ol>
<hr>
<p>Now, we can explore responses for categorical variables</p>
<ul>
<li>Other than <code>name</code>, responses for all other variables are tidy</li>
<li><code>name</code> has many different responses</li>
<li>We won’t know how to handle this until we get to later units in the class on natural language processing!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor)) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk</span>(\(column) <span class="fu">print</span>(<span class="fu">levels</span>(column)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "low"  "high"
[1] "american" "european" "japanese"
  [1] "amc ambassador brougham"             
  [2] "amc ambassador dpl"                  
  [3] "amc ambassador sst"                  
  [4] "amc concord"                         
  [5] "amc concord d/l"                     
  [6] "amc concord dl 6"                    
  [7] "amc gremlin"                         
  [8] "amc hornet"                          
  [9] "amc hornet sportabout (sw)"          
 [10] "amc matador"                         
 [11] "amc matador (sw)"                    
 [12] "amc pacer"                           
 [13] "amc pacer d/l"                       
 [14] "amc rebel sst"                       
 [15] "amc spirit dl"                       
 [16] "audi 100 ls"                         
 [17] "audi 100ls"                          
 [18] "audi 4000"                           
 [19] "audi 5000"                           
 [20] "audi 5000s (diesel)"                 
 [21] "audi fox"                            
 [22] "bmw 2002"                            
 [23] "bmw 320i"                            
 [24] "buick century"                       
 [25] "buick century 350"                   
 [26] "buick century limited"               
 [27] "buick century luxus (sw)"            
 [28] "buick century special"               
 [29] "buick electra 225 custom"            
 [30] "buick estate wagon (sw)"             
 [31] "buick lesabre custom"                
 [32] "buick opel isuzu deluxe"             
 [33] "buick regal sport coupe (turbo)"     
 [34] "buick skyhawk"                       
 [35] "buick skylark"                       
 [36] "buick skylark 320"                   
 [37] "buick skylark limited"               
 [38] "cadillac eldorado"                   
 [39] "cadillac seville"                    
 [40] "capri ii"                            
 [41] "chevroelt chevelle malibu"           
 [42] "chevrolet bel air"                   
 [43] "chevrolet camaro"                    
 [44] "chevrolet caprice classic"           
 [45] "chevrolet cavalier"                  
 [46] "chevrolet cavalier 2-door"           
 [47] "chevrolet cavalier wagon"            
 [48] "chevrolet chevelle concours (sw)"    
 [49] "chevrolet chevelle malibu"           
 [50] "chevrolet chevelle malibu classic"   
 [51] "chevrolet chevette"                  
 [52] "chevrolet citation"                  
 [53] "chevrolet concours"                  
 [54] "chevrolet impala"                    
 [55] "chevrolet malibu"                    
 [56] "chevrolet malibu classic (sw)"       
 [57] "chevrolet monte carlo"               
 [58] "chevrolet monte carlo landau"        
 [59] "chevrolet monte carlo s"             
 [60] "chevrolet monza 2+2"                 
 [61] "chevrolet nova"                      
 [62] "chevrolet nova custom"               
 [63] "chevrolet vega"                      
 [64] "chevrolet vega (sw)"                 
 [65] "chevrolet vega 2300"                 
 [66] "chevrolet woody"                     
 [67] "chevy c10"                           
 [68] "chevy c20"                           
 [69] "chevy s-10"                          
 [70] "chrysler cordoba"                    
 [71] "chrysler lebaron medallion"          
 [72] "chrysler lebaron salon"              
 [73] "chrysler lebaron town @ country (sw)"
 [74] "chrysler new yorker brougham"        
 [75] "chrysler newport royal"              
 [76] "datsun 1200"                         
 [77] "datsun 200-sx"                       
 [78] "datsun 200sx"                        
 [79] "datsun 210"                          
 [80] "datsun 210 mpg"                      
 [81] "datsun 280-zx"                       
 [82] "datsun 310"                          
 [83] "datsun 310 gx"                       
 [84] "datsun 510"                          
 [85] "datsun 510 (sw)"                     
 [86] "datsun 510 hatchback"                
 [87] "datsun 610"                          
 [88] "datsun 710"                          
 [89] "datsun 810"                          
 [90] "datsun 810 maxima"                   
 [91] "datsun b-210"                        
 [92] "datsun b210"                         
 [93] "datsun b210 gx"                      
 [94] "datsun f-10 hatchback"               
 [95] "datsun pl510"                        
 [96] "dodge aries se"                      
 [97] "dodge aries wagon (sw)"              
 [98] "dodge aspen"                         
 [99] "dodge aspen 6"                       
[100] "dodge aspen se"                      
[101] "dodge challenger se"                 
[102] "dodge charger 2.2"                   
[103] "dodge colt"                          
[104] "dodge colt (sw)"                     
[105] "dodge colt hardtop"                  
[106] "dodge colt hatchback custom"         
[107] "dodge colt m/m"                      
[108] "dodge coronet brougham"              
[109] "dodge coronet custom"                
[110] "dodge coronet custom (sw)"           
[111] "dodge d100"                          
[112] "dodge d200"                          
[113] "dodge dart custom"                   
[114] "dodge diplomat"                      
[115] "dodge magnum xe"                     
[116] "dodge monaco (sw)"                   
[117] "dodge monaco brougham"               
[118] "dodge omni"                          
[119] "dodge rampage"                       
[120] "dodge st. regis"                     
[121] "fiat 124 sport coupe"                
[122] "fiat 124 tc"                         
[123] "fiat 124b"                           
[124] "fiat 128"                            
[125] "fiat 131"                            
[126] "fiat strada custom"                  
[127] "fiat x1.9"                           
[128] "ford country"                        
[129] "ford country squire (sw)"            
[130] "ford escort 2h"                      
[131] "ford escort 4w"                      
[132] "ford f108"                           
[133] "ford f250"                           
[134] "ford fairmont"                       
[135] "ford fairmont (auto)"                
[136] "ford fairmont (man)"                 
[137] "ford fairmont 4"                     
[138] "ford fairmont futura"                
[139] "ford fiesta"                         
[140] "ford futura"                         
[141] "ford galaxie 500"                    
[142] "ford gran torino"                    
[143] "ford gran torino (sw)"               
[144] "ford granada"                        
[145] "ford granada ghia"                   
[146] "ford granada gl"                     
[147] "ford granada l"                      
[148] "ford ltd"                            
[149] "ford ltd landau"                     
[150] "ford maverick"                       
[151] "ford mustang"                        
[152] "ford mustang gl"                     
[153] "ford mustang ii"                     
[154] "ford mustang ii 2+2"                 
[155] "ford pinto"                          
[156] "ford pinto (sw)"                     
[157] "ford pinto runabout"                 
[158] "ford ranger"                         
[159] "ford thunderbird"                    
[160] "ford torino"                         
[161] "ford torino 500"                     
[162] "hi 1200d"                            
[163] "honda accord"                        
[164] "honda accord cvcc"                   
[165] "honda accord lx"                     
[166] "honda civic"                         
[167] "honda civic (auto)"                  
[168] "honda civic 1300"                    
[169] "honda civic 1500 gl"                 
[170] "honda civic cvcc"                    
[171] "honda prelude"                       
[172] "maxda glc deluxe"                    
[173] "maxda rx3"                           
[174] "mazda 626"                           
[175] "mazda glc"                           
[176] "mazda glc 4"                         
[177] "mazda glc custom"                    
[178] "mazda glc custom l"                  
[179] "mazda glc deluxe"                    
[180] "mazda rx-4"                          
[181] "mazda rx-7 gs"                       
[182] "mazda rx2 coupe"                     
[183] "mercedes-benz 240d"                  
[184] "mercedes-benz 280s"                  
[185] "mercedes benz 300d"                  
[186] "mercury capri 2000"                  
[187] "mercury capri v6"                    
[188] "mercury cougar brougham"             
[189] "mercury grand marquis"               
[190] "mercury lynx l"                      
[191] "mercury marquis"                     
[192] "mercury marquis brougham"            
[193] "mercury monarch"                     
[194] "mercury monarch ghia"                
[195] "mercury zephyr"                      
[196] "mercury zephyr 6"                    
[197] "nissan stanza xe"                    
[198] "oldsmobile cutlass ciera (diesel)"   
[199] "oldsmobile cutlass ls"               
[200] "oldsmobile cutlass salon brougham"   
[201] "oldsmobile cutlass supreme"          
[202] "oldsmobile delta 88 royale"          
[203] "oldsmobile omega"                    
[204] "oldsmobile omega brougham"           
[205] "oldsmobile starfire sx"              
[206] "oldsmobile vista cruiser"            
[207] "opel 1900"                           
[208] "opel manta"                          
[209] "peugeot 304"                         
[210] "peugeot 504"                         
[211] "peugeot 504 (sw)"                    
[212] "peugeot 505s turbo diesel"           
[213] "peugeot 604sl"                       
[214] "plymouth 'cuda 340"                  
[215] "plymouth arrow gs"                   
[216] "plymouth champ"                      
[217] "plymouth cricket"                    
[218] "plymouth custom suburb"              
[219] "plymouth duster"                     
[220] "plymouth fury"                       
[221] "plymouth fury gran sedan"            
[222] "plymouth fury iii"                   
[223] "plymouth grand fury"                 
[224] "plymouth horizon"                    
[225] "plymouth horizon 4"                  
[226] "plymouth horizon miser"              
[227] "plymouth horizon tc3"                
[228] "plymouth reliant"                    
[229] "plymouth sapporo"                    
[230] "plymouth satellite"                  
[231] "plymouth satellite custom"           
[232] "plymouth satellite custom (sw)"      
[233] "plymouth satellite sebring"          
[234] "plymouth valiant"                    
[235] "plymouth valiant custom"             
[236] "plymouth volare"                     
[237] "plymouth volare custom"              
[238] "plymouth volare premier v8"          
[239] "pontiac astro"                       
[240] "pontiac catalina"                    
[241] "pontiac catalina brougham"           
[242] "pontiac firebird"                    
[243] "pontiac grand prix"                  
[244] "pontiac grand prix lj"               
[245] "pontiac j2000 se hatchback"          
[246] "pontiac lemans v6"                   
[247] "pontiac phoenix"                     
[248] "pontiac phoenix lj"                  
[249] "pontiac safari (sw)"                 
[250] "pontiac sunbird coupe"               
[251] "pontiac ventura sj"                  
[252] "renault 12 (sw)"                     
[253] "renault 12tl"                        
[254] "renault 5 gtl"                       
[255] "saab 99e"                            
[256] "saab 99gle"                          
[257] "saab 99le"                           
[258] "subaru"                              
[259] "subaru dl"                           
[260] "toyota carina"                       
[261] "toyota celica gt"                    
[262] "toyota celica gt liftback"           
[263] "toyota corolla"                      
[264] "toyota corolla 1200"                 
[265] "toyota corolla 1600 (sw)"            
[266] "toyota corolla liftback"             
[267] "toyota corolla tercel"               
[268] "toyota corona"                       
[269] "toyota corona hardtop"               
[270] "toyota corona liftback"              
[271] "toyota corona mark ii"               
[272] "toyota cressida"                     
[273] "toyota mark ii"                      
[274] "toyota starlet"                      
[275] "toyota tercel"                       
[276] "toyouta corona mark ii (sw)"         
[277] "triumph tr7 coupe"                   
[278] "vokswagen rabbit"                    
[279] "volkswagen 1131 deluxe sedan"        
[280] "volkswagen 411 (sw)"                 
[281] "volkswagen dasher"                   
[282] "volkswagen jetta"                    
[283] "volkswagen model 111"                
[284] "volkswagen rabbit"                   
[285] "volkswagen rabbit custom"            
[286] "volkswagen rabbit custom diesel"     
[287] "volkswagen rabbit l"                 
[288] "volkswagen scirocco"                 
[289] "volkswagen super beetle"             
[290] "volkswagen type 3"                   
[291] "volvo 144ea"                         
[292] "volvo 145e (sw)"                     
[293] "volvo 244dl"                         
[294] "volvo 245"                           
[295] "volvo 264gl"                         
[296] "volvo diesel"                        
[297] "vw dasher (diesel)"                  
[298] "vw pickup"                           
[299] "vw rabbit"                           
[300] "vw rabbit c (diesel)"                
[301] "vw rabbit custom"                    </code></pre>
</div>
</div>
<ul>
<li>Remove <code>name</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Finally, let’s make and save our training and validation sets. If we were doing model building for prediction we would also need a test set but we will focus this unit on just selecting the best model but not rigorously evaluating it.</p>
<ul>
<li>Let’s use a 75/25 split, stratified on <code>mpg</code></li>
<li>Don’t forget to set a seed in case you need to re-split again in the future!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20110522</span>) </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initial_split</span>(<span class="at">prop =</span> .<span class="dv">75</span>, <span class="at">strata =</span> <span class="st">"mpg"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>splits <span class="sc">|&gt;</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">analysis</span>() <span class="sc">|&gt;</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>() <span class="sc">|&gt;</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_trn.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 294
Columns: 8
$ mpg          &lt;fct&gt; high, high, high, high, high, high, high, high, high, hig…
$ cylinders    &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, …
$ displacement &lt;dbl&gt; 113.0, 97.0, 97.0, 110.0, 107.0, 104.0, 121.0, 97.0, 140.…
$ horsepower   &lt;dbl&gt; 95, 88, 46, 87, 90, 95, 113, 88, 90, 95, 86, 90, 70, 76, …
$ weight       &lt;dbl&gt; 2372, 2130, 1835, 2672, 2430, 2375, 2234, 2130, 2264, 222…
$ acceleration &lt;dbl&gt; 15.0, 14.5, 20.5, 17.5, 14.5, 17.5, 12.5, 14.5, 15.5, 14.…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 7…
$ origin       &lt;fct&gt; japanese, japanese, european, european, european, europea…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>splits <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assessment</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_val.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 98
Columns: 8
$ mpg          &lt;fct&gt; low, low, low, low, low, low, low, low, low, low, low, lo…
$ cylinders    &lt;dbl&gt; 8, 8, 8, 8, 8, 6, 6, 6, 6, 8, 8, 4, 4, 4, 8, 8, 8, 4, 8, …
$ displacement &lt;dbl&gt; 350, 304, 302, 440, 455, 198, 200, 225, 250, 400, 318, 14…
$ horsepower   &lt;dbl&gt; 165, 150, 140, 215, 225, 95, 85, 105, 100, 175, 150, 72, …
$ weight       &lt;dbl&gt; 3693, 3433, 3449, 4312, 4425, 2833, 2587, 3439, 3329, 446…
$ acceleration &lt;dbl&gt; 11.5, 12.0, 10.5, 8.5, 10.0, 15.5, 16.0, 15.5, 15.5, 11.5…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 72, 7…
$ origin       &lt;fct&gt; american, american, american, american, american, america…</code></pre>
</div>
</div>
<hr>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question: Any concerns about using this training-validation split?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>These sample sizes are starting to get a little small.  Fitted models will have </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>higher variance with only 75% (N = 294) observations and performance in validation </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>(with only N = 98 observations) may not be a very precise estimate of true validation </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>error.  We will learn more robust methods in the unit on resampling.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="modeling-eda" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="modeling-eda"><span class="header-section-number">4.4.2</span> Modeling EDA</h3>
<p>Let’s do some quick modeling EDA to get a sense of the data.</p>
<ul>
<li>We will keep it quick and dirty.</li>
<li>First, we should make a function to class Cars since we may open it frequently</li>
<li>Even though its simple, still better this way (e.g., what if we decide to change how to handle classing - will only need to make that change in one place!)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>class_cars <span class="ot">&lt;-</span> <span class="cf">function</span>(d) { </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mpg =</span> <span class="fu">factor</span>(mpg, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"high"</span>)),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">origin =</span> <span class="fu">factor</span> (origin))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Open train (we don’t need validate for modeling EDA)</li>
<li>[We are pretending this is a new script….]</li>
<li>Class the predictors</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_trn.csv"</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_type =</span> <span class="fu">cols</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class_cars</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 294
Columns: 8
$ mpg          &lt;fct&gt; high, high, high, high, high, high, high, high, high, hig…
$ cylinders    &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, …
$ displacement &lt;dbl&gt; 113.0, 97.0, 97.0, 110.0, 107.0, 104.0, 121.0, 97.0, 140.…
$ horsepower   &lt;dbl&gt; 95, 88, 46, 87, 90, 95, 113, 88, 90, 95, 86, 90, 70, 76, …
$ weight       &lt;dbl&gt; 2372, 2130, 1835, 2672, 2430, 2375, 2234, 2130, 2264, 222…
$ acceleration &lt;dbl&gt; 15.0, 14.5, 20.5, 17.5, 14.5, 17.5, 12.5, 14.5, 15.5, 14.…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 7…
$ origin       &lt;fct&gt; japanese, japanese, european, european, european, europea…</code></pre>
</div>
</div>
<hr>
<ul>
<li>Bar plot for outcome
<ul>
<li>Outcome is balanced</li>
<li>Unbalanced outcomes can be more complicated (more on this later)</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">plot_bar</span>(<span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-cars-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<ul>
<li>Grouped (by <code>mpg</code>) box/violin plots for numeric predictors</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(name) <span class="fu">plot_grouped_box_violin</span>(<span class="at">df =</span> data_trn, <span class="at">x =</span> <span class="st">"mpg"</span>, <span class="at">y =</span> name)) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> _, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-cars-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<ul>
<li>Grouped barplot for origin</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grouped_barplot_percent</span>(<span class="at">x =</span> <span class="st">"origin"</span>, <span class="at">y =</span> <span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-cars-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grouped_barplot_percent</span>(<span class="at">x =</span> <span class="st">"mpg"</span>, <span class="at">y =</span> <span class="st">"origin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-cars-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<ul>
<li>Correlation plots for numeric</li>
<li>Can dummy code categorical predictors to examine correlations (point biserial, phi) including them</li>
<li>We will do this manually using tidyverse here.</li>
<li>Set american to be reference level (its the first level)</li>
<li><code>cylinders</code>, <code>displacement</code>, <code>horsepower</code>, and <code>weight</code> are all essentially the same construct (big, beefy car!)</li>
<li>All are strongly correlated with <code>mpg</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mpg_high =</span> <span class="fu">if_else</span>(mpg <span class="sc">==</span> <span class="st">"high"</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co">#&lt;1&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">origin_japan =</span> <span class="fu">if_else</span>(origin <span class="sc">==</span> <span class="st">"japanese"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">origin_europe =</span> <span class="fu">if_else</span>(origin <span class="sc">==</span> <span class="st">"european"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>origin, <span class="sc">-</span>mpg) <span class="sc">|&gt;</span>  <span class="co">#&lt;2&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  corrplot<span class="sc">::</span><span class="fu">corrplot.mixed</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-cars-13-1.png" style="height:3in" width="672"></p>
</div>
</div>
<ol type="1">
<li>If manually coding a binary outcome variable, best practice is to set the positive class to be 1</li>
<li>Remove <code>origin</code> and <code>mpg</code> after converting to dummy-coded features</li>
</ol>
<hr>
</section>
</section>
<section id="logistic-regression---model-building" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="logistic-regression---model-building"><span class="header-section-number">4.5</span> Logistic Regression - Model Building</h2>
<p>Now that we understand our data a little better, let’s build some models<br>
<br>
Let’s also try to simultaneously pretend that we:</p>
<ol type="1">
<li>Are building and selecting a best prediction model that will be evaluated with some additional held out test data (how bad would it have been to split into three sets??!!)</li>
<li>Have an explanatory question about production <code>year</code> - Are we more likely to have efficient cars more recently because of improvements in “technology”, above and beyond broad car characteristics (e.g., the easy stuff like <code>weight</code>, <code>displacement</code>, etc.)<br>
<br>
</li>
</ol>
<p>To be clear, prediction and explanation goals are often separate (though prediction is an important foundation explanation)</p>
<hr>
<p>Either way, we need a validation set</p>
<ul>
<li>Open it and class variables</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_val.csv"</span>),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_type =</span> <span class="fu">cols</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class_cars</span>() <span class="sc">|&gt;</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 98
Columns: 8
$ mpg          &lt;fct&gt; low, low, low, low, low, low, low, low, low, low, low, lo…
$ cylinders    &lt;dbl&gt; 8, 8, 8, 8, 8, 6, 6, 6, 6, 8, 8, 4, 4, 4, 8, 8, 8, 4, 8, …
$ displacement &lt;dbl&gt; 350, 304, 302, 440, 455, 198, 200, 225, 250, 400, 318, 14…
$ horsepower   &lt;dbl&gt; 165, 150, 140, 215, 225, 95, 85, 105, 100, 175, 150, 72, …
$ weight       &lt;dbl&gt; 3693, 3433, 3449, 4312, 4425, 2833, 2587, 3439, 3329, 446…
$ acceleration &lt;dbl&gt; 11.5, 12.0, 10.5, 8.5, 10.0, 15.5, 16.0, 15.5, 15.5, 11.5…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 72, 7…
$ origin       &lt;fct&gt; american, american, american, american, american, america…</code></pre>
</div>
</div>
<hr>
<p>Let’s predict high <code>mpg</code> from car beefiness and <code>year</code><br>
<br>
We likely want to combine the beefy variables into one construct/factor (<code>beef</code>)</p>
<ul>
<li>We can use PCA to extract one factor</li>
<li>Input variables should be centered and scaled for PCA. Easy peasy</li>
<li>PCA will be calculated with <code>data_trn</code> during <code>prep()</code>. These statistics from <code>data_trn</code> will be used to <code>bake()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> <span class="co">#&lt;1&gt; </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prefix =</span> <span class="st">"beef_"</span>) <span class="co">#&lt;2&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Using <code>.</code> now in the recipe to leave all variables in the feature matrix. We can later select the ones we want use for prediction</li>
<li>We will have one PCA component, it will be called <code>beef_1</code></li>
</ol>
<hr>
<p>Now, <code>prep()</code> the recipe and <code>bake()</code> some feature for training and validation sets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Lets skim our training features</li>
<li>We can see there are features in there we won’t use</li>
<li><code>mpg</code>, <code>year</code>, and <code>beef_1</code> look good</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">feat_trn</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">294</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">origin</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">ame: 187, jap: 56, eur: 51</td>
</tr>
<tr class="even">
<td style="text-align: left;">mpg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">low: 147, hig: 147</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: right;">skew</th>
<th style="text-align: right;">kurtosis</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">acceleration</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15.54</td>
<td style="text-align: right;">2.64</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">14.00</td>
<td style="text-align: right;">15.50</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">24.80</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.58</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">75.94</td>
<td style="text-align: right;">3.68</td>
<td style="text-align: right;">70.00</td>
<td style="text-align: right;">73.00</td>
<td style="text-align: right;">76.00</td>
<td style="text-align: right;">79.0</td>
<td style="text-align: right;">82.00</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-1.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beef_1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.92</td>
<td style="text-align: right;">-2.36</td>
<td style="text-align: right;">-1.64</td>
<td style="text-align: right;">-0.85</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">4.36</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">-0.96</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<ul>
<li>Fit the model configuration in train</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fit_lr_2 <span class="ot">&lt;-</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> <span class="co">#&lt;1&gt; </span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> <span class="co">#&lt;2&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn) <span class="co">#&lt;3&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>category of algorithm is logistic regression</li>
<li>Set engine to be generalized linear model. No need to `set_mode(“classification”) because logistic regression glm is only used for classification</li>
<li>Notice that we explicitly indicate which features to use because our feature matrix has more than just these two in it because we used <code>.</code> in our recipe and our datasets have more columns.</li>
</ol>
<hr>
<p>Let’s look at the logistic model and its parameter estimates from train</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fit_lr_2 <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -23.4      5.55       -4.23 2.38e- 5
2 beef_1        -2.49     0.316      -7.87 3.49e-15
3 year           0.292    0.0718      4.07 4.71e- 5</code></pre>
</div>
</div>
<p><br>
<br>
</p>
<p><span class="math inline">\(Pr(high|(beef, year)) = \frac{e^{b0 + b1*beef + b2*year}}{1 + e^{b0 + b1*beef + b2*year}}\)</span></p>
<hr>
<p>Use <code>predict()</code> to get <span class="math inline">\(Pr(high|year)\)</span> (<strong>or predicted class</strong>, more on that later) directly from the model for any data</p>
<ul>
<li>First make a dataframe for feature values for prediction</li>
<li>We will use this for a plot</li>
<li>Get probabilities for a range of years (incrementing by .1 year)</li>
<li>Hold beef constant at its mean</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="fu">min</span>(feat_val<span class="sc">$</span>year), <span class="fu">max</span>(feat_val<span class="sc">$</span>year), .<span class="dv">1</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">beef_1 =</span> <span class="fu">mean</span>(feat_val<span class="sc">$</span>beef_1)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><code>predict()</code> will:</p>
<ul>
<li>Give us probabilities for high and low (<code>type = "prob"</code>). We will select out the low columns</li>
<li>Also provides the 95% conf int around these probabilities (<code>type = "conf_int"</code>)</li>
<li>Ambiguity is removed by their choice to label by the actual outcome labels (Nice!)</li>
<li>We will bind these predictions to the dataframe we made above</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lr_2, <span class="at">new_data =</span> p_high, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lr_2, <span class="at">new_data =</span> p_high, <span class="at">type =</span> <span class="st">"conf_int"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.pred_low, <span class="sc">-</span>.pred_lower_low, <span class="sc">-</span>.pred_upper_low) <span class="sc">|&gt;</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 121
Columns: 5
$ year             &lt;dbl&gt; 70.0, 70.1, 70.2, 70.3, 70.4, 70.5, 70.6, 70.7, 70.8,…
$ beef_1           &lt;dbl&gt; 0.008438869, 0.008438869, 0.008438869, 0.008438869, 0…
$ .pred_high       &lt;dbl&gt; 0.04733721, 0.04867270, 0.05004389, 0.05145161, 0.052…
$ .pred_lower_high &lt;dbl&gt; 0.01495325, 0.01557265, 0.01621651, 0.01688572, 0.017…
$ .pred_upper_high &lt;dbl&gt; 0.1398943, 0.1419807, 0.1440989, 0.1462495, 0.1484331…</code></pre>
</div>
</div>
<hr>
<p>Here is a quick look at the head</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   year  beef_1 .pred_high .pred_lower_high .pred_upper_high
  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
1  70   0.00844     0.0473           0.0150            0.140
2  70.1 0.00844     0.0487           0.0156            0.142
3  70.2 0.00844     0.0500           0.0162            0.144
4  70.3 0.00844     0.0515           0.0169            0.146
5  70.4 0.00844     0.0529           0.0176            0.148
6  70.5 0.00844     0.0544           0.0183            0.151</code></pre>
</div>
</div>
<hr>
<p>Can plot this relationship using the predicted probabilities</p>
<ul>
<li>plot both prediction line</li>
<li>and observed Y (with a little jitter)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> feat_val, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="fu">as.numeric</span>(mpg) <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> p_high, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .pred_high)) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> p_high, </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">ymin =</span> .pred_lower_high, <span class="at">ymax =</span> .pred_upper_high), </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">70</span>,<span class="dv">82</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pr(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-lr-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Can plot odds instead of probabilities using odds equation and coefficients from the model</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|x_1)} {1 - Pr(positive\:class|x_1)}\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.odds_high =</span> .pred_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_high),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">.odds_lower_high =</span> .pred_lower_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_lower_high),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.odds_upper_high =</span> .pred_upper_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_upper_high))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>NOTE: Harder to also plot raw data as scatter plot when plotting odds vs.&nbsp;probabilities. Maybe use second Y axis?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .odds_high)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">ymin =</span> .odds_lower_high, <span class="at">ymax =</span> .odds_upper_high), </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">70</span>, <span class="dv">82</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Odds(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Odds ratio for year:</p>
<ul>
<li><span class="math inline">\(Odds\:ratio = e^{c*\beta_1}\)</span><br>
<br>
</li>
</ul>
<p>Get the parameter estimate/coefficient from the model</p>
<ul>
<li>For every one year increase (holding beef constant), the odds of a car being categorized as high mpg increase by a factor of 1.3394301</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">get_estimate</span>(fit_lr_2, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.33943</code></pre>
</div>
</div>
<hr>
<p>You can do this for other values of c as well (not really needed here because a 1 year unit makes sense)</p>
<ul>
<li><span class="math inline">\(Odds\:ratio = e^{c*\beta_1}\)</span></li>
<li>For every 10 year increase (holding beef constant), the odds of a car being categorized as high mpg increase by a factor of 18.5866278</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">10</span> <span class="sc">*</span> <span class="fu">get_estimate</span>(fit_lr_2, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18.58663</code></pre>
</div>
</div>
<hr>
<p>Testing parameter estimates</p>
<ul>
<li><code>tidy()</code> provides z-tests for the parameter estimates</li>
<li>This is NOT the recommended statistical test from 610</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fit_lr_2 <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -23.4      5.55       -4.23 2.38e- 5
2 beef_1        -2.49     0.316      -7.87 3.49e-15
3 year           0.292    0.0718      4.07 4.71e- 5</code></pre>
</div>
</div>
<hr>
<p>The preferred test for parameter estimates from logistic regression is the likelihood ratio test</p>
<ul>
<li>You can get this using <code>Anova()</code> from the <code>car</code> package (as you learn in 610/710)</li>
<li>The glm object is returned using $fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_2<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
       LR Chisq Df Pr(&gt;Chisq)    
beef_1  239.721  1  &lt; 2.2e-16 ***
year     20.317  1  6.562e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<hr>
<p>Accuracy is a very common performance metric for classification models<br>
<br>
How accurate is our two feature model?</p>
<ul>
<li>Note the use of <code>type = "class"</code><br>
<br>
</li>
</ul>
<p>We can calculate accuracy in the training set. This may be somewhat overfit and optimistic!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_trn, <span class="at">type =</span> <span class="st">"class"</span>)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9217687</code></pre>
</div>
</div>
<hr>
<p>And in the validation set (better estimate of performance in new data. Though if we use this set multiple times to select a best configuration, it will become overfit eventually too!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_val, <span class="at">type =</span> <span class="st">"class"</span>)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<p><br>
<br>
You can see some evidence of over-fitting to the training set in that model performance is a bit lower in validation</p>
<hr>
<p>Let’s take a look at the decision boundary for this model in the validation set<br>
<br>
We need a function to plot the decision boundary <strong>because we will use it repeatedly</strong> to compare decision boundaries across statistical models</p>
<ul>
<li>Displayed here as another example of a function that uses quoted variable names</li>
<li>This function is useful for book examples with two features.<br>
</li>
<li>Only can be used with two features, so not that useful in real life!</li>
<li>Not included in my function scripts (just here to helpy you understand the material)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plot_decision_boundary <span class="ot">&lt;-</span> <span class="cf">function</span>(data, model, x_names, y_name, <span class="at">n_points =</span> <span class="dv">100</span>) {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  preds <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data[[x_names[<span class="dv">1</span>]]]), </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">max</span>(data[[x_names[<span class="dv">1</span>]]]), </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">length =</span> n_points),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data[[x_names[<span class="dv">2</span>]]]), </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">max</span>(data[[x_names[<span class="dv">2</span>]]]), </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">length =</span> n_points))</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(preds) <span class="ot">&lt;-</span> x_names</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  preds[[y_name]] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, preds)<span class="sc">$</span>.pred_class</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  preds[[y_name]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(preds[[y_name]])<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, </span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> .data[[x_names[<span class="dv">1</span>]]], </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> .data[[x_names[<span class="dv">2</span>]]], </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> .data[[y_name]])) <span class="sc">+</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_contour</span>(<span class="at">data =</span> preds, </span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> .data[[x_names[<span class="dv">1</span>]]], </span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> .data[[x_names[<span class="dv">2</span>]]], </span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">z =</span> .data[[y_name]]), </span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">breaks =</span> .<span class="dv">5</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> x_names[<span class="dv">1</span>], <span class="at">y =</span> x_names[<span class="dv">2</span>], <span class="at">color =</span> y_name) <span class="sc">+</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_obs_pred</span>()</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Logistic regression produces a linear decision boundary when you consider a scatter plot of the points by the two features.</p>
<ul>
<li>Points on one side of the line are assigned to one class and points on the other side of the line are assigned to the other class.<br>
</li>
<li>This decision boundary would be a plane if there were three features Harder to visualize in higher dimensional space.</li>
<li>We will contrast this decision boundary from logistic regression with other statistical algorithms in a bit.<br>
<br>
</li>
</ul>
<p>Here is the decision boundary for this model in both train and validation sets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-lr-14-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
<p>What if you wanted to try to improve our predictions?</p>
<ul>
<li>You could find the best set of covariates to test the effect of year. [Assuming the best covariates are those that account for the most variance in mpg]?</li>
<li>For either prediction or explanation, you need to find this best model<br>
<br>
</li>
</ul>
<p>We can compare model performance in validation set to find this best model</p>
<ul>
<li>We can use that one for our prediction goal</li>
<li>We can test the effect of year in that model for our explanation goal
<ul>
<li>This is a principled way to decide on the best model for our explanatory goal (vs.&nbsp;p-hacking)</li>
<li>We get to explore and we end up with the best model to provide our focal test</li>
</ul></li>
</ul>
<hr>
<p>Let’s quickly fit another model we might have considered.</p>
<ul>
<li>This model will contain the 4 variables from our PCA but as individual features rather than one PCA component score (<code>beef</code>)</li>
<li>Make features for this model
<ul>
<li>No feature engineering needed because raw variables are all numeric already)</li>
<li>We will give the features dfs new names to retain the old features that included <code>beef_1</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>rec_raw <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>rec_raw_prep <span class="ot">&lt;-</span> rec_raw <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>feat_raw_trn <span class="ot">&lt;-</span> rec_raw_prep <span class="sc">|&gt;</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>feat_raw_val <span class="ot">&lt;-</span> rec_raw_prep <span class="sc">|&gt;</span> </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Fit PCA features individually + year</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fit_lr_raw <span class="ot">&lt;-</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> cylinders <span class="sc">+</span> displacement <span class="sc">+</span> horsepower <span class="sc">+</span> weight <span class="sc">+</span> year, </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> feat_raw_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Which is the best prediction model?</p>
<ul>
<li>Beef PCA</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<ul>
<li>Individual raw features from PCA</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_raw_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_raw, feat_raw_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8673469</code></pre>
</div>
</div>
<p><br>
<br>
The PCA beef model fits best. The model with individual features likely increases overfitting a bit but doesn’t yield a reduction in bias because all the other variables are so highly correlated.</p>
<hr>
<p><code>fit_lr_2</code> is your choice for best model for prediction (at least it is descriptively better)<br>
<br>
If you had an explanatory question about <code>year</code>, how would you have chosen between these two tests of <code>year</code> in these two different but all reasonable models</p>
<ul>
<li>You might have chose the model with individual features because the effect of year is stronger.<br>
</li>
<li>That is NOT the model that comes closes to the DGP.<br>
</li>
<li>We believe the appropriate model is the beef model that has higher overall accuracy!</li>
<li>This is a start for us to start to consider the use of resampling methods to make decisions about how to best pursue explanatory goals.</li>
<li>Could you now test your <code>year</code> effect in the full sample? Let’s discuss.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_2<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
       LR Chisq Df Pr(&gt;Chisq)    
beef_1  239.721  1  &lt; 2.2e-16 ***
year     20.317  1  6.562e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_raw<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
             LR Chisq Df Pr(&gt;Chisq)    
cylinders      0.4199  1    0.51697    
displacement   1.3239  1    0.24990    
horsepower     6.4414  1    0.01115 *  
weight        15.6669  1  7.553e-05 ***
year          27.0895  1  1.942e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<hr>
</section>
<section id="k-nearest-neighbors---a-conceptual-overview" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="k-nearest-neighbors---a-conceptual-overview"><span class="header-section-number">4.6</span> K Nearest Neighbors - A Conceptual Overview</h2>
<p>Let’s switch gears to a non-parametric method we already know - KNN.</p>
<ul>
<li><p>KNN can be used as a classifier as well as for regression problems</p></li>
<li><p>KNN tries to determine conditional class possibilities for any set of features by looking at observed classes for similar values of for these features in the training set</p></li>
</ul>
<hr>
<p>This figure illustrates the application of 3-NN to a small sample training set (N = 12) with 2 predictors</p>
<ul>
<li>For test observation X in the left panel, we would predict class = blue because blue is the majority class (highest probability) among the 3 nearest training observations</li>
<li>If we calculated these probabilities for all possible combinations of the two predictors in the training set, it would yield the decision boundaries depicted in the right panel</li>
</ul>
<p><img src="figs/unit4_knn_example.png" style="height:4in"></p>
<hr>
<p>KNN can produce complex decision boundaries</p>
<ul>
<li>This makes it flexible (can reduce bias)</li>
<li>This makes it susceptible to variance/overfitting problems</li>
</ul>
<p><br>
<br>
Remember that we can control this bias-variance trade-off with K.</p>
<ul>
<li>As K increases, variance reduces (but bias may increase).<br>
</li>
<li>As K decreases, bias may be reduced but variance increases.</li>
<li>Choose a K that produces good performance in new (validation) data</li>
</ul>
<hr>
<p>These figures depict the KNN (and Bayes classifier) decision boundaries for the earlier simulated 2 class problem with <code>X1</code> and <code>X2</code></p>
<ul>
<li>K = 10 appears to provide the sweet spot b/c it closely approximates the Bayes decision boundary</li>
<li>Of course, you wouldn’t know the true Bayes decision boundary if the data were real (not simulated)</li>
<li>But K = 10 would also yield the lowest test error (which is how it should be chosen)
<ul>
<li>Bayes classifier test error: .1304</li>
<li>K = 10 test error: .1363</li>
<li>K = 1 test error: .1695</li>
<li>K = 100 test err: .1925</li>
</ul></li>
</ul>
<p><img src="figs/unit4_knn_k.png" style="height:4in"></p>
<p><img src="figs/unit4_knn_k_2.png" style="height:4in"></p>
<hr>
<p>You can NOT make the decision about K based on training error<br>
<br>
This figure depicts training and test error for simulated data example as function of 1/K</p>
<ul>
<li><p>Training error decreases as 1/K increases. At 1 (K=1) training error is 0</p></li>
<li><p>Test error shows expected inverted U</p>
<ul>
<li>For high K (left side), error is high because of high variance</li>
<li>As move right (lower K), variance is reduced rapidly with little increase in bias. Error is reduced.</li>
<li>Eventually, there is diminishing return from reducing variance but bias starts to increase rapidly. Error increases again.</li>
</ul></li>
</ul>
<p><img src="figs/unit4_knn_error.png" style="height:4in"></p>
<hr>
</section>
<section id="a-return-to-cars---now-with-knn" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="a-return-to-cars---now-with-knn"><span class="header-section-number">4.7</span> A Return to Cars - Now with KNN</h2>
<p>Let’s demonstrate KNN using the Cars dataset</p>
<ul>
<li>Calculate <code>beef_1</code> PCA component</li>
<li>Scale both features</li>
<li>Make train and validation feature matrices</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, <span class="at">prefix =</span> <span class="st">"beef_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(year, beef_1)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(<span class="at">data =</span> data_trn)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Fit models with varying K.</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fit_1nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>  <span class="co">#&lt;1&gt;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Notice that we now use <code>set_mode("classification")</code></li>
</ol>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fit_5nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>K = 10</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fit_10nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fit_20nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Of course, training accuracy goes down with decreasing flexibility as k increases</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_1nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_5nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9489796</code></pre>
</div>
</div>
<ul>
<li>K = 10</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_10nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9455782</code></pre>
</div>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_20nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9285714</code></pre>
</div>
</div>
<hr>
<p>In contrast, validation accuracy first increases and then eventually decreases as k increase.</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_1nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8163265</code></pre>
</div>
</div>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_5nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.877551</code></pre>
</div>
</div>
<ul>
<li>K = 10 (preferred based on validation accuracy)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_10nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_20nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8673469</code></pre>
</div>
</div>
<hr>
<p>Let’s look at the decision boundaries for 10-NN in training and validation sets</p>
<ul>
<li>A very complex decision boundary</li>
<li>Clearly trying hard to segregate the points</li>
<li>In Ames, the relationships were non-linear and therefore KNN did much better than the linear model</li>
<li>Here, the decision boundary is pretty linear so the added flexibility of KNN doesn’t get us much.
<ul>
<li>Maybe we gain a little in bias reduction but lose a little in overfitting</li>
<li>Ends up performing comparable to logistic regression (a generalized linear model)</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_10nn_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_10nn_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-knn-9-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
<div class="callout-important callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question: How do you think the parametric logistic regression compares to the non-parametric KNN with respect to explanatory goals? Consider our (somewhat artificial) question about the effect of <code>year</code>.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>The logistic regression provides coefficients (parameter estimates) that can be </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>used to describe changes in probability, odds and odds ratio associated with </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>change in year.  These parameter estimates can be tested via inferential procedures.  </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>KNN does not provide any parameter estimates.  With KNN, we can visualize decision boundary </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>(only in 2 or three dimensions) or the predicted outcome by any feature, controlling for </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>other features but these relationships may be complex in shape.  </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>Of course, if the relationships are complex, we might not want to hide that.  </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>We will learn more about feature importance for explanation in a later unit.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<hr>
<p>Plot of probability of high_mpg by year, holding <code>beef_1</code> constant at its mean based on 10-NN</p>
<ul>
<li>Get <span class="math inline">\(Pr(high|year)\)</span> holding beef constant at its mean</li>
<li><code>predict()</code> returns probabilities for high and low.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="fu">min</span>(feat_val<span class="sc">$</span>year), <span class="fu">max</span>(feat_val<span class="sc">$</span>year), .<span class="dv">1</span>),</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">beef_1 =</span> <span class="fu">mean</span>(feat_val<span class="sc">$</span>beef_1)) </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_10nn_2, p_high, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33
Columns: 4
$ year       &lt;dbl&gt; 18.99759, 19.09759, 19.19759, 19.29759, 19.39759, 19.49759,…
$ beef_1     &lt;dbl&gt; 0.004400185, 0.004400185, 0.004400185, 0.004400185, 0.00440…
$ .pred_low  &lt;dbl&gt; 0.96, 0.99, 0.99, 0.99, 0.97, 0.87, 0.81, 0.81, 0.81, 0.81,…
$ .pred_high &lt;dbl&gt; 0.04, 0.01, 0.01, 0.01, 0.03, 0.13, 0.19, 0.19, 0.19, 0.19,…</code></pre>
</div>
</div>
<hr>
<ul>
<li>Plot it</li>
<li>In a later unit, we will learn about feature ablation that we can combine with model comparisons to potentially test predictor effects in non-parametric models</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> feat_val, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="fu">as.numeric</span>(mpg) <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> p_high, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .pred_high)) <span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">7</span>), </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">seq</span>(<span class="dv">70</span>, <span class="dv">82</span>, <span class="at">length.out =</span> <span class="dv">7</span>))) <span class="sc">+</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pr(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-knn-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="linear-discriminant-analysis" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="linear-discriminant-analysis"><span class="header-section-number">4.8</span> Linear Discriminant Analysis</h2>
<p>LDA models the distributions of the Xs separately for each class<br>
<br>
Then uses Bayes theorem to estimate <span class="math inline">\(Pr(Y = k | X)\)</span> for each k and assigns the observation to the class with the highest probability</p>
<p><span class="math inline">\(Pr(Y = k|X) = \frac{\pi_k * f_k(X)}{\sum_{l = 1}^{K} f_l(X)}\)</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\pi_k\)</span> is the prior probability that an observation comes from class k (estimated from frequencies of k in training)</li>
<li><span class="math inline">\(f_k(X)\)</span> is the density function of X for an observation from class k
<ul>
<li><span class="math inline">\(f_k(X)\)</span> is large if there is a high probability that an observation in class k has that set of values for X and small if that probability is low</li>
<li><span class="math inline">\(f_k(X)\)</span> is difficult to estimate unless we make some simplifying assumptions (i.e., X is multivariate normal and common covariance matrix (<span class="math inline">\(\sum\)</span>) across K classes)</li>
<li>With these assumptions, we can estimate <span class="math inline">\(\pi_k\)</span>, <span class="math inline">\(\mu_k\)</span>, and <span class="math inline">\(\sigma^2\)</span> from the training set and calculate <span class="math inline">\(Pr(Y = k|X)\)</span> for each k</li>
</ul></li>
</ul>
<hr>
<p>With a single feature, the probability of any class k, given X is:</p>
<ul>
<li><p><span class="math inline">\(Pr(Y = k|X) = \frac{\pi_k \frac{1}{\sqrt{2\pi\sigma}}\exp(-\frac{1}{2\sigma^2}(x-\mu_k)^2)}{\sum_{l=1}^{K}\pi_l\frac{1}{2\sigma^2}\exp(-\frac{1}{2\sigma^2}(x-\mu_l)^2)}\)</span></p></li>
<li><p>LDA is a parametric model, but is it interpretable?</p></li>
</ul>
<hr>
<p>Application of LDA to Cars data set with two predictors<br>
<br>
Notice that LDA produces linear decision boundary (see <span class="citation" data-cites="ISL">James et al. (<a href="#ref-ISL" role="doc-biblioref">2023</a>)</span> for formula for discriminant function derived from the probability function on last slide)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prefix =</span> <span class="st">"beef_"</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Need to load the <code>discrm</code> package</li>
<li>Lets look at how the function is called</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discrim, <span class="at">exclude =</span> <span class="st">"smoothness"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'discrim' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Discriminant Model Specification (classification)

Computational engine: MASS 

Model fit template:
MASS::lda(formula = missing_arg(), data = missing_arg())</code></pre>
</div>
</div>
<hr>
<p>Fit the LDA in train</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>fit_lda_2 <span class="ot">&lt;-</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Accuracy and decision boundary</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lda_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8469388</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-da-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="quadratic-discriminant-analysis" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="quadratic-discriminant-analysis"><span class="header-section-number">4.9</span> Quadratic Discriminant Analysis</h2>
<p>QDA relaxes one restrictive assumption of LDA</p>
<ul>
<li>Still required multivariate normal X</li>
<li><strong>But it allows each class to have its own <span class="math inline">\(\sum\)</span></strong></li>
<li>This makes it:
<ul>
<li>More flexible</li>
<li>Able to model non-linear decision boundaries (see formula for discriminant in <span class="citation" data-cites="ISL">James et al. (<a href="#ref-ISL" role="doc-biblioref">2023</a>)</span>)</li>
<li>But requires substantial increase in parameter estimation (more potential to overfit)</li>
</ul></li>
</ul>
<hr>
<p>Application of RDA (Regularized Discriminant Analysis) algorithm to Car data set with two features</p>
<ul>
<li>The algorithm that is available in tidymodels is actually a regularized discriminant analysis, <code>rda()</code> from the <code>klaR</code> package</li>
<li>There are two hyperparameters, <code>frac_common_cov</code> and <code>frac_identity</code>, that can each vary between 0 - 1
<ul>
<li>When <code>frac_common_cov = 1</code> and <code>frac_identity = 0</code>, this is an LDA</li>
<li>When <code>frac_common_cov = 0</code> and <code>frac_identity = 0</code>, this is a QDA</li>
<li>These hyperparameters can be tuned to different values to improve the fit dependent on the true DGP</li>
<li>More on hyperparameter tuning in unit 5</li>
<li>This is a flexible algorithm that likely replaces the need to fit separate LDA and QDA models</li>
</ul></li>
<li>see https://discrim.tidymodels.org/reference/discrim_regularized.html</li>
</ul>
<hr>
<p>Here is a true QDA using <code>frac_common_cov = 1</code> and <code>frac_identity = 0</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Regularized Discriminant Model Specification (classification)

Main Arguments:
  frac_common_cov = 0
  frac_identity = 0

Computational engine: klaR 

Model fit template:
klaR::rda(formula = missing_arg(), data = missing_arg(), lambda = 0, 
    gamma = 0)</code></pre>
</div>
</div>
<hr>
<ul>
<li>Now fit it</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>fit_qda_2 <span class="ot">&lt;-</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Accuracy and decision boundary</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_qda_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.877551</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/u4-da-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="comparisons-between-these-four-classifiers" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="comparisons-between-these-four-classifiers"><span class="header-section-number">4.10</span> Comparisons between these four classifiers</h2>
<ul>
<li><p>Both logistic and LDA are linear functions of X and therefore produce linear decision boundaries</p></li>
<li><p>LDA makes additional assumptions about X (multivariate normal and common <span class="math inline">\(\sum\)</span>) beyond logistic regression. Relative performance is based on the quality of this assumption</p></li>
<li><p>QDA relaxes the LDA assumption about common <span class="math inline">\(\sum\)</span> (and RDA can relax it partially)</p>
<ul>
<li>This also allows for nonlinear decision boundaries including 2-way interactions among features</li>
<li>QDA is therefore more flexible, which means possibly less bias but more potential for overfitting</li>
</ul></li>
<li><p>Both QDA and LDA assume multivariate normal X so <em>may</em> not accommodate categorical predictors very well. Logistic and KNN do accommodate categorical predictors</p></li>
<li><p>KNN is non-parametric and therefore the most flexible</p>
<ul>
<li>Can also handle interactions and non-linear effects natively (with feature engineering)</li>
<li>Increased overfitting, decreased bias?</li>
<li>Not very interpretable. But LDA/QDA, although parametric, aren’t as interpretable as logistic regression</li>
</ul></li>
<li><p>Logistic regression fails when classes are perfectly separated (but does that ever happen?) and is less stable when classes are well separated</p></li>
<li><p>LDA, KNN, and QDA naturally accommodate more than two classes</p>
<ul>
<li>Logistic requires additional tweak (<strong>Briefly describe: multiple one vs other classes models approach</strong>)</li>
</ul></li>
<li><p>Logistic regression requires relatively large sample sizes. LDA may perform better with smaller sample sizes if assumptions are met</p></li>
</ul>
<hr>
</section>
<section id="a-quick-tour-of-many-classifiers" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="a-quick-tour-of-many-classifiers"><span class="header-section-number">4.11</span> A quick tour of many classifiers</h2>
<p>The Cars dataset had strong predictors and a mostly linear decision boundary for the two predictors we considered</p>
<ul>
<li>This will not be true in many cases</li>
<li>Let’s consider a more complex two predictor decision boundary in the <strong>circle</strong> dataset from the <code>mlbench</code> package (lots of cool datasets for ML)</li>
<li>This will hopefully demonstrate that the key is to have a algorithm that can model the DGP</li>
<li>There is NO best algorithm</li>
<li>The best algorithm depends on
<ul>
<li>The DGP</li>
<li>The goal (prediction vs.&nbsp;explanation)</li>
</ul></li>
</ul>
<hr>
<p>This will also demonstrate the power of tidymodels to allow us to fit many different statistical algorithms which all have their own syntax using a common syntax provided by tidymodels.</p>
<ul>
<li>This example has been adapted to tidymodels from a demonstration by <a href="https://michael.hahsler.net/SMU/EMIS7332/R/viz_classifier.html">Michael Hahsler</a></li>
<li>Simulate train and test data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlbench, <span class="at">include.only =</span> <span class="st">"mlbench.circle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'mlbench' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20140102</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">mlbench.circle</span>(<span class="dv">200</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x_1 =</span> x<span class="fl">.1</span>, <span class="at">x_2 =</span> x<span class="fl">.2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 200
Columns: 3
$ x_1     &lt;dbl&gt; -0.514721263, 0.763312056, 0.312073042, 0.162981535, -0.320294…
$ x_2     &lt;dbl&gt; 0.47513532, 0.65803777, -0.89824011, 0.38680494, -0.47313964, …
$ classes &lt;fct&gt; 1, 2, 2, 1, 1, 1, 1, 2, 2, 1, 2, 2, 1, 1, 1, 2, 2, 2, 2, 2, 2,…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">mlbench.circle</span>(<span class="dv">200</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x_1 =</span> x<span class="fl">.1</span>, <span class="at">x_2 =</span> x<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Plot train data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_1, <span class="at">y =</span> x_2, <span class="at">color =</span> classes)) <span class="sc">+</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<section id="logistic-regression" class="level3" data-number="4.11.1">
<h3 data-number="4.11.1" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">4.11.1</span> Logistic Regression</h3>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fit_lr_bench <span class="ot">&lt;-</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_lr_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.62</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-29-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="knn-with-k-5-somewhat-arbitrary-default" class="level3" data-number="4.11.2">
<h3 data-number="4.11.2" class="anchored" data-anchor-id="knn-with-k-5-somewhat-arbitrary-default"><span class="header-section-number">4.11.2</span> KNN with K = 5 (somewhat arbitrary default)</h3>
<ul>
<li>Fit</li>
<li>Note same syntax as logistic regression (and for all others!)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>fit_knn_bench <span class="ot">&lt;-</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
<li>Note same syntax as logistic regression (and for all others!)</li>
<li>See what KNN can do relative to LR when the boundaries are non-linear!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_knn_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_knn_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_knn_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-30-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="linear-discriminant-analysis-1" class="level3" data-number="4.11.3">
<h3 data-number="4.11.3" class="anchored" data-anchor-id="linear-discriminant-analysis-1"><span class="header-section-number">4.11.3</span> Linear Discriminant Analysis</h3>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>fit_lda_bench <span class="ot">&lt;-</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_lda_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.62</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-31-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="regularized-discriminant-analysis" class="level3" data-number="4.11.4">
<h3 data-number="4.11.4" class="anchored" data-anchor-id="regularized-discriminant-analysis"><span class="header-section-number">4.11.4</span> Regularized Discriminant Analysis</h3>
<ul>
<li>Fit</li>
<li>Letting <code>rda()</code> select optimal hyperparameter values</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>fit_rda_bench <span class="ot">&lt;-</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_regularized</span>() <span class="sc">|&gt;</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
<li>Less overfitting?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_rda_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_rda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_rda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-32-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="naive-bayes-classifier" class="level3" data-number="4.11.5">
<h3 data-number="4.11.5" class="anchored" data-anchor-id="naive-bayes-classifier"><span class="header-section-number">4.11.5</span> Naive Bayes Classifier</h3>
<p>The Naïve Bayes classifier is a simple probabilistic classifier which is based on Bayes theorem</p>
<ul>
<li><p>But, we assume that the predictor variables are conditionally independent of one another given the response value</p></li>
<li><p>This algorithm can be fit with either <code>klaR</code> or <code>naivebayes</code> engines</p></li>
<li><p>There are many <a href="https://uc-r.github.io/naive_bayes">tutorials</a> available on this classifier</p></li>
<li><p>Fit it</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>fit_bayes_bench <span class="ot">&lt;-</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">naive_Bayes</span>() <span class="sc">|&gt;</span> </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"naivebayes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_bayes_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.99</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_bayes_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_bayes_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-33-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="random-forest" class="level3" data-number="4.11.6">
<h3 data-number="4.11.6" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">4.11.6</span> Random Forest</h3>
<p>Random Forest is a variant of decision trees</p>
<ul>
<li><p>It uses <strong>bagging</strong> which involves resampling the data to produce many trees and then aggregating across trees for the final classification</p></li>
<li><p>We will discuss Random Forest in a later unit</p></li>
<li><p>Here we fit it with defaults for its hyperparameters</p></li>
<li><p>Fit it</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>fit_rf_bench <span class="ot">&lt;-</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_rf_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_rf_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_rf_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-34-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="neural-networks" class="level3" data-number="4.11.7">
<h3 data-number="4.11.7" class="anchored" data-anchor-id="neural-networks"><span class="header-section-number">4.11.7</span> Neural networks</h3>
<p>It is easy to fit a <a href="https://parsnip.tidymodels.org/reference/mlp.html">single layer neural network</a></p>
<ul>
<li>We do this below with varying number of hidden units and all other hyperparameters set to defaults</li>
<li>We will have a unit on this later in the semester</li>
</ul>
<hr>
<section id="single-layer-nn-with-1-hidden-unit" class="level4" data-number="4.11.7.1">
<h4 data-number="4.11.7.1" class="anchored" data-anchor-id="single-layer-nn-with-1-hidden-unit"><span class="header-section-number">4.11.7.1</span> Single Layer NN with 1 hidden unit:</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>fit_nn1_bench <span class="ot">&lt;-</span> </span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_nn1_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.66</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn1_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn1_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-35-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="single-layer-nn-with-2-hidden-units" class="level4" data-number="4.11.7.2">
<h4 data-number="4.11.7.2" class="anchored" data-anchor-id="single-layer-nn-with-2-hidden-units"><span class="header-section-number">4.11.7.2</span> Single Layer NN with 2 hidden units</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>fit_nn2_bench <span class="ot">&lt;-</span> </span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_nn2_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.765</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn2_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn2_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-36-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="single-layer-nn-with-5-hidden-units" class="level4" data-number="4.11.7.3">
<h4 data-number="4.11.7.3" class="anchored" data-anchor-id="single-layer-nn-with-5-hidden-units"><span class="header-section-number">4.11.7.3</span> Single Layer NN with 5 hidden units</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>fit_nn5_bench <span class="ot">&lt;-</span> </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_nn5_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.96</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn5_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn5_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Coordinate system already present. Adding new coordinate system, which will
replace the existing one.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-37-1.png" style="height:3in" width="672"></p>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="discussion" class="level2" data-number="4.12">
<h2 data-number="4.12" class="anchored" data-anchor-id="discussion"><span class="header-section-number">4.12</span> Discussion</h2>
<section id="anouncements" class="level3" data-number="4.12.1">
<h3 data-number="4.12.1" class="anchored" data-anchor-id="anouncements"><span class="header-section-number">4.12.1</span> Anouncements</h3>
<ul>
<li>Quiz performance - 95%</li>
<li>Please meet with TA or me if you can’t generate predictions from your models</li>
<li>Room 121 again in two weeks</li>
<li>And the winner is…..</li>
</ul>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"lunch_004.csv"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 23 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): name
dbl (1): acc_test

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output-display">

<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; "><table class="table table-striped table-condensed" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> name </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> acc_test </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> rf </td>
   <td style="text-align:right;"> 0.80 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> wang </td>
   <td style="text-align:right;"> 0.80 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Phipps </td>
   <td style="text-align:right;"> 0.80 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> dong </td>
   <td style="text-align:right;"> 0.79 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> li </td>
   <td style="text-align:right;"> 0.79 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> jiang </td>
   <td style="text-align:right;"> 0.78 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Shea </td>
   <td style="text-align:right;"> 0.77 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> simental </td>
   <td style="text-align:right;"> 0.77 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> cherry </td>
   <td style="text-align:right;"> 0.77 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> crosby </td>
   <td style="text-align:right;"> 0.77 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.77 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.76 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.73 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.73 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.72 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.71 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.71 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.69 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.68 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.68 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.68 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.66 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
  </tr>
</tbody>
</table></div>

</div>
</div>
<hr>
</section>
<section id="probability-odds-and-log-odds" class="level3" data-number="4.12.2">
<h3 data-number="4.12.2" class="anchored" data-anchor-id="probability-odds-and-log-odds"><span class="header-section-number">4.12.2</span> Probability, odds, and log-odds</h3>
<ul>
<li>DGP on probability</li>
<li>what is irreducible error for classification?</li>
<li>DGP on X1 - draw it with varying degrees of error</li>
</ul>
<hr>
<ul>
<li>DGP and error on two features</li>
</ul>
<p><img src="figs/unit4_two_class_decision_boundry.png" style="height:4in"></p>
<hr>
<ul>
<li>Probability vs.&nbsp;odds vs.&nbsp;log-odds</li>
<li>How to interpret parameter estimates (effects of X)</li>
</ul>
<hr>
</section>
<section id="comparisons-across-algorithms" class="level3" data-number="4.12.3">
<h3 data-number="4.12.3" class="anchored" data-anchor-id="comparisons-across-algorithms"><span class="header-section-number">4.12.3</span> Comparisons across algorithms</h3>
<p>Logistic regression models DGP condition probabilities using logistic function</p>
<ul>
<li>Get parameter estimates for effects of X</li>
<li>Makes strong assumptions shape of DGP - linear on log-odds(Y)</li>
<li>Yields linear decision boundary</li>
<li>Better for binary outcomes but can do more than two levels</li>
<li>Needs numeric features but can dummy code categorical variables (as with lm)</li>
<li>Problems when classes are fully separable (or even mostly separable)</li>
</ul>
<hr>
<p>LDA uses Bayes theorem to estimate condition probability</p>
<ul>
<li>LDA models the distributions of the Xs separately for each class</li>
<li>Then uses Bayes theorem to estimate <span class="math inline">\(Pr(Y = k | X)\)</span> for each k and assigns the observation to the class with the highest probability</li>
</ul>
<p><span class="math inline">\(Pr(Y = k|X) = \frac{\pi_k * f_k(X)}{\sum_{l = 1}^{K} f_l(X)}\)</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\pi_k\)</span> is the prior probability that an observation comes from class k (estimated from frequencies of k in training)</li>
<li><span class="math inline">\(f_k(X)\)</span> is the density function of X for an observation from class k
<ul>
<li><span class="math inline">\(f_k(X)\)</span> is large if there is a high probability that an observation in class k has that set of values for X and small if that probability is low</li>
<li><span class="math inline">\(f_k(X)\)</span> is difficult to estimate unless we make some simplifying assumptions</li>
<li>X is multivariate normal</li>
<li>Common covariance matrix (<span class="math inline">\(\sum\)</span>) across K classesj</li>
<li>With these assumptions, we can estimate <span class="math inline">\(\pi_k\)</span>, <span class="math inline">\(\mu_k\)</span>, and <span class="math inline">\(\sigma^2\)</span> from the training set and calculate <span class="math inline">\(Pr(Y = k|X)\)</span> for each k</li>
</ul></li>
</ul>
<hr>
<ul>
<li>Parametric model but parameters not useful for interpretation of effects of X</li>
<li>Linear decision boundary<br>
</li>
<li>Assumptions about multivariate normal X and common <span class="math inline">\(\sum\)</span></li>
<li>Dummy features may not work well given assumption?</li>
<li>May require smaller sample sizes to fit than logistic regression if assumptions met</li>
<li>Can natively handle more than two level for outcome</li>
</ul>
<hr>
<p>QDA relaxes one restrictive assumption of LDA</p>
<ul>
<li>Still required multivariate normal X</li>
<li><strong>But it allows each class to have its own <span class="math inline">\(\sum\)</span></strong></li>
<li>This makes it:
<ul>
<li>More flexible</li>
<li>Able to model non-linear decision boundaries including 2-way intearctions (see formula for discriminant in <span class="citation" data-cites="ISL">James et al. (<a href="#ref-ISL" role="doc-biblioref">2023</a>)</span>)</li>
<li>how handle interactions by relaxing common <span class="math inline">\(\sum\)</span>?</li>
<li>But requires substantial increase in parameter estimation (more potential to overfit)</li>
</ul></li>
<li>Still problems with dummy features</li>
<li>Can natively handle more than 2 levels of outcome like LDA</li>
<li>Compare to LDA and Logisitic Regression on bias-variance trade off?<br>
<br>
RDA may be better than both LDA and QDA? More on idea of blending after elastic net</li>
</ul>
<hr>
<p>KNN works similar to regression</p>
<ul>
<li>But now looks at percentage of observations for each class among nearest neighbours to estimate conditional probabilities</li>
<li>Doesn’t make assumptions about Xs or <span class="math inline">\(\sum\)</span> for LDA and/or QDA</li>
<li>Doesn’t not limited to linear decision boundaries like logistic and LDA</li>
<li>Very flexible - low bias but high variance?</li>
<li>K can be adjusted to impact bias-variance trade-off</li>
<li>KNN can handle more than two level outcomes natively</li>
</ul>
<hr>
</section>
</section>
<section id="categorical-predictors" class="level2" data-number="4.13">
<h2 data-number="4.13" class="anchored" data-anchor-id="categorical-predictors"><span class="header-section-number">4.13</span> Categorical predictors</h2>
<ul>
<li>All algorithms so far require numeric features</li>
<li>Ordinal can be made numeric sometimes by just substituting ordered vector (i.e.&nbsp;1, 2, 3, etc)</li>
<li>Nominal needs something more</li>
<li>Our go to method is Dummy features
<ul>
<li>What is big problem with dummy features?</li>
<li>Collapsing levels?</li>
<li>Also issue of binary scores for LDA/QDA</li>
</ul></li>
<li>Target encoding example
<ul>
<li>Country of origin for car example (but maybe think of many countries?)</li>
<li>Why not data leakage?</li>
<li>Problems with step_mutate()</li>
<li>Can manually do it with our current resampling</li>
<li>See <a href="https://embed.tidymodels.org/">embed package</a></li>
</ul></li>
</ul>
<hr>
<section id="interactions-in-lda-and-qda" class="level3" data-number="4.13.1">
<h3 data-number="4.13.1" class="anchored" data-anchor-id="interactions-in-lda-and-qda"><span class="header-section-number">4.13.1</span> Interactions in LDA and QDA</h3>
<ul>
<li>Simulate multivariate normal distribution for X (<code>x1</code> and <code>x2</code>) using MASS package</li>
<li>Separately for trn and val</li>
<li>NOTE: I first did this with uniform distributions on X and the models fit more poorly. Why?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5433</span>)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">300</span>, <span class="at">mu =</span> means, <span class="at">Sigma =</span> sigma) <span class="sc">|&gt;</span>  </span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">str_c</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(means))) <span class="sc">|&gt;</span>  </span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>data_val <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">mu =</span> means, <span class="at">Sigma =</span> sigma) <span class="sc">|&gt;</span>  </span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">str_c</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(means))) <span class="sc">|&gt;</span>  </span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Write function for interactive DGP based on <code>x1</code> and <code>x2</code></li>
<li>Will map this over rows of d</li>
<li>Can specify any values for b</li>
<li>b[4] will be interaction parameter estimate</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, .<span class="dv">5</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>calc_p <span class="ot">&lt;-</span> <span class="cf">function</span>(x, b){</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">exp</span>(b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>]<span class="sc">*</span>x<span class="sc">$</span>x1 <span class="sc">+</span> b[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">$</span>x2 <span class="sc">+</span> b[<span class="dv">4</span>]<span class="sc">*</span>x<span class="sc">$</span>x1<span class="sc">*</span>x<span class="sc">$</span>x2) <span class="sc">/</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>     (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>]<span class="sc">*</span>x<span class="sc">$</span>x1 <span class="sc">+</span> b[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">$</span>x2 <span class="sc">+</span> b[<span class="dv">4</span>]<span class="sc">*</span>x<span class="sc">$</span>x1<span class="sc">*</span>x<span class="sc">$</span>x2))</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Add p and then observed classes to trn and val</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">calc_p</span>(data_trn, b)) <span class="sc">|&gt;</span> </span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(data_trn), <span class="dv">1</span>, p),</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">factor</span>(y, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"neg"</span>, <span class="st">"pos"</span>)))</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_trn, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
        x1     x2        p y    
     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;
 1   9.85   -5.53 1.52e-12 neg  
 2  -2.48    5.64 9.21e- 4 neg  
 3  -4.74  -13.7  1.00e+ 0 pos  
 4  -7.02   12.6  6.09e-20 neg  
 5   0.942  -3.48 1.63e- 1 pos  
 6   0.151   2.78 5.52e- 1 neg  
 7   7.74   -6.84 3.24e-12 neg  
 8  -4.85  -10.1  1.00e+ 0 pos  
 9  -0.937   2.03 2.78e- 1 neg  
10 -16.5     6.08 1.83e-22 neg  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="ot">&lt;-</span> data_val <span class="sc">|&gt;</span> </span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">calc_p</span>(data_val, b)) <span class="sc">|&gt;</span> </span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(data_val), <span class="dv">1</span>, p),</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">factor</span>(y, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"neg"</span>, <span class="st">"pos"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Lets look at what an interactive DGP looks like for two features and a binary outcome</li>
<li>Parameter estimates set up a “cross-over” interaction</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">color =</span> y)) <span class="sc">+</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<ul>
<li>Fit models in trn</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>fit_lda <span class="ot">&lt;-</span> </span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> data_trn)</span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>fit_lda_int <span class="ot">&lt;-</span> </span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x1<span class="sc">*</span>x2, <span class="at">data =</span> data_trn)</span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>fit_qda <span class="ot">&lt;-</span> </span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> data_trn)</span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>fit_qda_int <span class="ot">&lt;-</span> </span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x1<span class="sc">*</span>x2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Additive LDA model decision boundary and performance in val</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">y_name =</span> <span class="st">"y"</span>,</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">n_points =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<ul>
<li>Interactive LDA model decision boundary and performance in val</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_int, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">y_name =</span> <span class="st">"y"</span>,</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">n_points =</span> <span class="dv">400</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<ul>
<li>Additive QDA model decision boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">y_name =</span> <span class="st">"y"</span>,</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">n_points =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Interactive QDA model decision boundary</li>
</ul>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda_int, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">y_name =</span> <span class="st">"y"</span>,</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">n_points =</span> <span class="dv">400</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="004_classification_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Costs for QDA vs.&nbsp;LDA intearctive in this example and more generally with more features?</li>
<li>What if you were using RDA, which can model the full range of models between linear and quadratic?</li>
</ul>
<hr>
<p>PCA</p>
<ul>
<li>https://setosa.io/ev/principal-component-analysis/:w</li>
<li>https://www.cs.cmu.edu/~elaw/papers/pca.pdf</li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-ISL" class="csl-entry" role="doc-biblioentry">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2023. <em>An <span>Introduction</span> to <span>Statistical Learning</span>: With <span>Applications</span> in <span>R</span></em>. 2nd ed. Springer <span>Texts</span> in <span>Statistics</span>. <span>New York</span>: <span>Springer-Verlag</span>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./003_regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./005_resampling.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resampling Methods for Model Selection and Evaluation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>