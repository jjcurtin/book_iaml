<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Applied Machine Learning - 3&nbsp; Introduction to Regression Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./004_classification.html" rel="next">
<link href="./002_exploratory_data_analysis.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./003_regression.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Applied Machine Learning</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jjcurtin/book_iaml" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./001_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002_exploratory_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./003_regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./004_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005_resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resampling Methods for Model Selection and Evaluation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regularization and Penalized Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./007_midterm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Midterm Exam</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./008_advanced_performance_metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Performance Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./009_model_comparisons.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Model Comparisons and Other Explanatory Goals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010_random_forest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Models: Decision Trees, Bagging Trees, and Random Forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011_neural_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Advanced Models: Neural Networks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./012_nlp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Natural Language Processing: Text Processing and Feature Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./013_applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Applications for Machine Learning: Synthesis and Concept Generalization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./014_ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ethical Issues in Machine Learning Research and Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./015_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Final Exam and Project</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./101_novel_levels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Handling Novel Values in Held Out Sets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./101_recipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Appendix 1: Feature Engineering with Recipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./102_model_performance_simulations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Appendix 2: Simulations of Model Performance Bias and Variance by Resampling Techniques</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./103_shap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Appendix 3: Understanding Shapley Values from SHAP</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./104_bootstrapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Appendix 4: Bootstrapping Standard Errors &amp; Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Test</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview-of-unit" id="toc-overview-of-unit" class="nav-link active" data-scroll-target="#overview-of-unit"><span class="header-section-number">3.1</span> Overview of Unit</a></li>
  <li><a href="#the-simple-general-linear-model-lm" id="toc-the-simple-general-linear-model-lm" class="nav-link" data-scroll-target="#the-simple-general-linear-model-lm"><span class="header-section-number">3.2</span> The Simple (General) Linear Model (LM)</a></li>
  <li><a href="#extension-of-lm-to-multiple-predictors" id="toc-extension-of-lm-to-multiple-predictors" class="nav-link" data-scroll-target="#extension-of-lm-to-multiple-predictors"><span class="header-section-number">3.3</span> Extension of LM to Multiple Predictors</a></li>
  <li><a href="#extension-to-categorical-predictors" id="toc-extension-to-categorical-predictors" class="nav-link" data-scroll-target="#extension-to-categorical-predictors"><span class="header-section-number">3.4</span> Extension to Categorical Predictors</a>
  <ul class="collapse">
  <li><a href="#dummy-coding" id="toc-dummy-coding" class="nav-link" data-scroll-target="#dummy-coding"><span class="header-section-number">3.4.1</span> Dummy Coding</a></li>
  <li><a href="#unordered-categorical-predictors" id="toc-unordered-categorical-predictors" class="nav-link" data-scroll-target="#unordered-categorical-predictors"><span class="header-section-number">3.5.1</span> Unordered Categorical Predictors</a></li>
  <li><a href="#ordered-categorical-predictors" id="toc-ordered-categorical-predictors" class="nav-link" data-scroll-target="#ordered-categorical-predictors"><span class="header-section-number">3.5.2</span> Ordered Categorical Predictors</a></li>
  </ul></li>
  <li><a href="#extensions-to-interactive-models-and-non-linear-models" id="toc-extensions-to-interactive-models-and-non-linear-models" class="nav-link" data-scroll-target="#extensions-to-interactive-models-and-non-linear-models"><span class="header-section-number">3.6</span> Extensions to Interactive Models and Non-linear Models</a>
  <ul class="collapse">
  <li><a href="#interactions" id="toc-interactions" class="nav-link" data-scroll-target="#interactions"><span class="header-section-number">3.6.1</span> Interactions</a></li>
  <li><a href="#non-linear-models" id="toc-non-linear-models" class="nav-link" data-scroll-target="#non-linear-models"><span class="header-section-number">3.6.2</span> Non-linear Models</a></li>
  </ul></li>
  <li><a href="#knn-regression" id="toc-knn-regression" class="nav-link" data-scroll-target="#knn-regression"><span class="header-section-number">3.7</span> KNN Regression</a>
  <ul class="collapse">
  <li><a href="#the-hyperparameter-k" id="toc-the-hyperparameter-k" class="nav-link" data-scroll-target="#the-hyperparameter-k"><span class="header-section-number">3.7.1</span> The hyperparameter k</a></li>
  <li><a href="#defining-nearest" id="toc-defining-nearest" class="nav-link" data-scroll-target="#defining-nearest"><span class="header-section-number">3.7.2</span> Defining “Nearest”</a></li>
  <li><a href="#scaling-x" id="toc-scaling-x" class="nav-link" data-scroll-target="#scaling-x"><span class="header-section-number">3.7.3</span> Scaling X</a></li>
  <li><a href="#categorical-predictors" id="toc-categorical-predictors" class="nav-link" data-scroll-target="#categorical-predictors"><span class="header-section-number">3.7.4</span> Categorical Predictors</a></li>
  <li><a href="#knn-with-ames-housing-prices" id="toc-knn-with-ames-housing-prices" class="nav-link" data-scroll-target="#knn-with-ames-housing-prices"><span class="header-section-number">3.7.5</span> KNN with Ames Housing Prices</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">3.8</span> Discussion</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jjcurtin/book_iaml/edit/main/003_regression.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview-of-unit" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="overview-of-unit"><span class="header-section-number">3.1</span> Overview of Unit</h2>
<p><strong>Learning Objectives:</strong></p>
<ul>
<li><p>Use of root mean square error (RMSE) in training and validation sets for model performance evaluation</p></li>
<li><p>The General Linear Model as a machine learning model</p>
<ul>
<li>Extensions to categorical variables (Dummy coding features)</li>
<li>Extensions to interactive and non-linear effects of features</li>
</ul></li>
<li><p>K Nearest Neighbor (KNN)</p>
<ul>
<li>Hyperparameter <span class="math inline">\(k\)</span></li>
<li>Scaling predictors</li>
<li>Extensions to categorical variables</li>
</ul></li>
</ul>
<p><strong>Readings</strong></p>
<ul>
<li><span class="citation" data-cites="ISL">James et al. (<a href="#ref-ISL" role="doc-biblioref">2023</a>)</span> <a href="https://dionysus.psych.wisc.edu/iaml/pdfs/ISLRv2.pdf">Chapter 3, pp 59 - 109</a></li>
</ul>
<p><strong>Lecture Videos</strong></p>
<ul>
<li><a href="https://www.loom.com/share/f199cbb3a2ba4055861d5af8073c5b9e">Lecture 1: Overview</a>; ~ 10 mins</li>
<li><a href="https://www.loom.com/share/502e895153e643eeb3c95cf4dba81750">Lecture 2: The Simple Linear Model</a>; ~ 25 mins</li>
<li><a href="https://www.loom.com/share/0ab80943ac75488db866ab0884ef2a36">Lecture 3: Extension to Multiple Predictors</a>; ~ 15 mins</li>
<li><a href="https://www.loom.com/share/0bd1664f12044cce98cd6013d054bb40">Lecture 4: Extension to Categorical Predictors</a>; ~ 20 mins</li>
<li><a href="https://www.loom.com/share/6fced9ba33c5481f818949f7fd356837">Lecture 5: Extension to Interactions and Non-Linear Effects</a>; ~ 12 mins</li>
<li><a href="https://www.loom.com/share/025888d65a6a4c0b9479d8263dde4076">Lecture 6: Introduction to KNN</a>; ~ 19 mins</li>
<li><a href="https://www.loom.com/share/eaa39314f59d437e85b6a5e49c2a2959">Lecture 7: Distance and Scaling in KNN</a>; ~8 mins</li>
<li><a href="https://www.loom.com/share/1ba103e128a54a9f9ab681b2b9029a71">Lecture 8: KNN with Ames</a>; ~ 12 mins</li>
<li><a href="https://dionysus.psych.wisc.edu/iaml/videos/discussion_unit3_2023.mp4">Discussion</a></li>
</ul>
<p><strong>Application Assignment</strong></p>
<ul>
<li>clean data: <a href="https://dionysus.psych.wisc.edu/iaml/homework/unit_3/ames_train_cln.csv">train</a>; <a href="https://dionysus.psych.wisc.edu/iaml/homework/unit_3/ames_val_cln.csv">validate</a>; <a href="https://dionysus.psych.wisc.edu/iaml/homework/unit_3/ames_test_cln.csv">test</a></li>
<li><a href="https://dionysus.psych.wisc.edu/iaml/homework/unit_3/ames_data_dictionary.pdf">data dictionary</a></li>
<li><a href="https://dionysus.psych.wisc.edu/iaml/homework/unit_3/hw_unit_3_glm.Rmd">glm rmd</a></li>
<li><a href="https://dionysus.psych.wisc.edu/iaml/homework/unit_3/hw_unit_3_knn.Rmd">knn rmd</a></li>
<li>solution: <a href="homework/unit_3/key_unit_3_glm.html">lm</a>; <a href="homework/unit_3/key_unit_3_knn.html">knn</a></li>
</ul>
<p>Post questions to the Slack channel for application assignments.</p>
<p>Submit the application assignment <a href="https://canvas.wisc.edu/courses/345486/assignments/1827995">here</a> and complete the <a href="https://canvas.wisc.edu/courses/345486/quizzes/424945">unit quiz</a> by 5 pm on Wednesday, February 8th</p>
<hr>
<p>Our goal in this unit is to build a machine learning regression model that can accurately (we hope) predict the <code>sale_price</code> for future sales of houses (in Iowa? more generally?)</p>
<p>To begin this project we need to:</p>
<ul>
<li>Set up conflicts policies</li>
<li>We will hide this in future units</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">conflicts.policy =</span> <span class="st">"depends.ok"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">source_url</span>(<span class="st">"https://github.com/jjcurtin/lab_support/blob/main/fun_ml.R?raw=true"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ SHA-1 hash of file is "175d942e14f108d74912bfb2593b77637328ecb1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_conflictRules</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Load the packages we will need</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor, <span class="at">include.only =</span> <span class="st">"clean_names"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot, <span class="at">include.only =</span> <span class="st">"plot_grid"</span>) <span class="co"># for plot_grid()</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra, <span class="at">exclude =</span> <span class="st">"group_rows"</span>) <span class="co"># exclude dplyr conflict</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># for general data wrangling</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels) <span class="co"># for modeling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>source additional class functions libraries</li>
<li>We will hide this in future units</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">source_url</span>(<span class="st">"https://github.com/jjcurtin/lab_support/blob/main/fun_eda.R?raw=true"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ SHA-1 hash of file is "c045eee2655a18dc85e715b78182f176327358a7"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">source_url</span>(<span class="st">"https://github.com/jjcurtin/lab_support/blob/main/fun_plots.R?raw=true"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ SHA-1 hash of file is "def6ce26ed7b2493931fde811adff9287ee8d874"</code></pre>
</div>
</div>
<ul>
<li>set display options</li>
<li>We will hide this in future units</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_classic</span>())</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tibble.width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>handle paths</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>path_data <span class="ot">&lt;-</span> <span class="st">"./data"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ul>
<li>Set up function to class ames data (copied with one improvement from last unit)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-8"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-8-1"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a>class_ames <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="annotated-cell-8-2"><a href="#annotated-cell-8-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">|&gt;</span></span>
<span id="annotated-cell-8-3"><a href="#annotated-cell-8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), factor)) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-8-4"><a href="#annotated-cell-8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">overall_qual =</span> <span class="fu">factor</span>(overall_qual), </span>
<span id="annotated-cell-8-5"><a href="#annotated-cell-8-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">overall_qual =</span> <span class="fu">fct_relevel</span>(overall_qual, <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)), </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-8-6" class="code-annotation-target"><a href="#annotated-cell-8-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">garage_qual =</span> <span class="fu">suppressWarnings</span>(<span class="fu">fct_relevel</span>(garage_qual,</span>
<span id="annotated-cell-8-7"><a href="#annotated-cell-8-7" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fu">c</span>(<span class="st">"no_garage"</span>, <span class="st">"po"</span>, <span class="st">"fa"</span>, </span>
<span id="annotated-cell-8-8"><a href="#annotated-cell-8-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"ta"</span>, <span class="st">"gd"</span>, <span class="st">"ex"</span>))))</span>
<span id="annotated-cell-8-9"><a href="#annotated-cell-8-9" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-annotation="1" data-code-lines="6">Warnings should be considered errors until investigated. Once investigated, they can be ignored. To explicitly ignore, use <code>suppressWarnings()</code></span>
</dd>
</dl>
</div>
</div>
<hr>
<ul>
<li>Open the cleaned training set</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"ames_clean_class_trn.csv"</span>), </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">|&gt;</span>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class_ames</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,465
Columns: 10
$ sale_price   &lt;dbl&gt; 105000, 126000, 115000, 120000, 99500, 112000, 122000, 12…
$ gr_liv_area  &lt;dbl&gt; 896, 882, 864, 836, 918, 1902, 900, 1225, 1728, 858, 1306…
$ lot_area     &lt;dbl&gt; 11622, 8400, 10500, 2280, 7892, 8930, 9819, 9320, 13260, …
$ year_built   &lt;dbl&gt; 1961, 1970, 1971, 1975, 1979, 1978, 1967, 1959, 1962, 195…
$ overall_qual &lt;fct&gt; 5, 4, 4, 7, 6, 6, 5, 4, 5, 5, 3, 5, 4, 5, 3, 5, 2, 6, 5, …
$ garage_cars  &lt;dbl&gt; 1, 2, 0, 1, 1, 2, 1, 0, 0, 0, 0, 1, 2, 2, 1, 1, 2, 2, 1, …
$ garage_qual  &lt;fct&gt; ta, ta, no_garage, ta, ta, ta, ta, no_garage, no_garage, …
$ ms_zoning    &lt;fct&gt; res_high, res_low, res_low, res_low, res_low, res_med, re…
$ lot_config   &lt;fct&gt; inside, corner, fr2, fr2, inside, inside, inside, inside,…
$ bldg_type    &lt;fct&gt; one_fam, one_fam, one_fam, town_inside, town_end, duplex,…</code></pre>
</div>
</div>
<hr>
<ul>
<li>Open the cleaned validation set</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"ames_clean_class_val.csv"</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class_ames</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 490
Columns: 10
$ sale_price   &lt;dbl&gt; 215000, 189900, 189000, 171500, 212000, 164000, 394432, 1…
$ gr_liv_area  &lt;dbl&gt; 1656, 1629, 1804, 1341, 1502, 1752, 1856, 1004, 1092, 106…
$ lot_area     &lt;dbl&gt; 31770, 13830, 7500, 10176, 6820, 12134, 11394, 11241, 168…
$ year_built   &lt;dbl&gt; 1960, 1997, 1999, 1990, 1985, 1988, 2010, 1970, 1971, 197…
$ overall_qual &lt;fct&gt; 6, 5, 7, 7, 8, 8, 9, 6, 5, 6, 7, 9, 8, 8, 7, 8, 6, 5, 5, …
$ garage_cars  &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 3, 2, 1, 2, 2, 2, 2, 3, 2, 3, 1, 1, 2, …
$ garage_qual  &lt;fct&gt; ta, ta, ta, ta, ta, ta, ta, ta, ta, ta, ta, ta, ta, ta, t…
$ ms_zoning    &lt;fct&gt; res_low, res_low, res_low, res_low, res_low, res_low, res…
$ lot_config   &lt;fct&gt; corner, inside, inside, inside, corner, inside, corner, c…
$ bldg_type    &lt;fct&gt; one_fam, one_fam, one_fam, one_fam, town_end, one_fam, on…</code></pre>
</div>
</div>
<p><strong>NOTE</strong>: Remember, I have held back an additional test set that we will use only once to evaluate the final model that we each develop in this unit.</p>
<hr>
<p>We will also make a dataframe to track validation error across the models we fit</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">character</span>(), <span class="at">rmse_val =</span> <span class="fu">numeric</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 0
Columns: 2
$ model    &lt;chr&gt; 
$ rmse_val &lt;dbl&gt; </code></pre>
</div>
</div>
<hr>
<p>We will fit regression models with various model configurations.</p>
<p>These configurations will differ with respect to statistical algorithm:</p>
<ul>
<li>A General Linear Model (lm) - a parametric approach</li>
<li>K Nearest Neighbor (KNN) - a non-parametric approach</li>
</ul>
<p>These configurations will differ with respect to the features</p>
<ul>
<li>Single feature (i.e., simple regression)</li>
<li>Various sets of multiple features that vary by:
<ul>
<li>Raw predictors used</li>
<li>Transformations applied to those predictors as part of feature engineering</li>
<li>Inclusion (or not) of interactions among features</li>
</ul></li>
<li>The KNN model configurations will also differ with respect to its hyperparameter- <span class="math inline">\(k\)</span></li>
</ul>
<hr>
<p>To build models that will work well in new data (e.g., the data that I have held back from you so far):</p>
<ul>
<li><p>We have split the remaining data into a training and validation set for our own use during model building</p></li>
<li><p>We will fit models in train</p></li>
<li><p>We will evaluate them in validation</p></li>
</ul>
<p>Remember that we:</p>
<ul>
<li>Used a 75/25 stratified (on <code>sale_price</code>) split of the data at the end of cleaning EDA</li>
<li>Are only using a subset of the available predictors. The same ones I used for the EDA unit</li>
</ul>
<p>You will work with all of my predictors and all the predictors you used for your EDA when you do the application assignment for this unit</p>
<hr>
<p>Pause for a moment to answer this question: [Why do we need independent validation data to select the best model configuration? In other words, why cant we just fit and evaluate all of the models in our one training set?].{red} <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<hr>
<p>Let’s take a quick look at the available raw predictors in the training set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
data_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: factor</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:left;">
top_counts
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
overall_qual
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
5: 424, 6: 350, 7: 304, 8: 176
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_qual
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
ta: 1312, no_: 81, fa: 57, gd: 13
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
res: 1157, res: 217, flo: 66, com: 13
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_config
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
ins: 1095, cor: 248, cul: 81, fr2: 39
</td>
</tr>
<tr>
<td style="text-align:left;">
bldg_type
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
one: 1216, tow: 108, dup: 63, tow: 46
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789
</td>
<td style="text-align:right;">
129500
</td>
<td style="text-align:right;">
160000
</td>
<td style="text-align:right;">
213500
</td>
<td style="text-align:right;">
745000
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1506.84
</td>
<td style="text-align:right;">
511.44
</td>
<td style="text-align:right;">
438
</td>
<td style="text-align:right;">
1128
</td>
<td style="text-align:right;">
1450
</td>
<td style="text-align:right;">
1759
</td>
<td style="text-align:right;">
5642
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.19
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10144.16
</td>
<td style="text-align:right;">
8177.55
</td>
<td style="text-align:right;">
1476
</td>
<td style="text-align:right;">
7500
</td>
<td style="text-align:right;">
9375
</td>
<td style="text-align:right;">
11362
</td>
<td style="text-align:right;">
164660
</td>
<td style="text-align:right;">
11.20
</td>
<td style="text-align:right;">
182.91
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.35
</td>
<td style="text-align:right;">
29.65
</td>
<td style="text-align:right;">
1880
</td>
<td style="text-align:right;">
1953
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
-0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.78
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>Remember from our modeling EDA that we have some issues to address as part of our feature engineering:</p>
<ul>
<li>Missing values</li>
<li>Possible transformation of <code>sale_price</code></li>
<li>Possible transformation of other numeric predictors</li>
<li>We will need to use some feature engineering techniques to handle categorical variables</li>
<li>We may need to consider interactions among features</li>
</ul>
<p>All of this will be accomplished with a recipe</p>
<p>But first, let’s consider our first statistical algorithm</p>
<hr>
</section>
<section id="the-simple-general-linear-model-lm" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="the-simple-general-linear-model-lm"><span class="header-section-number">3.2</span> The Simple (General) Linear Model (LM)</h2>
<p>We will start with a review of the use of the simple (one feature) linear model (LM) as a machine learning model because you should be very familiar with this statistical model at this point</p>
<p><span class="math inline">\(Y = \beta_0 + \beta_1*X_1 + \epsilon\)</span></p>
<p>Applied to our regression problem, we might fit a model such as:</p>
<p><span class="math inline">\(sale\_price = \beta_0 + \beta_1*gr\_liv\_area + \epsilon\)</span></p>
<p>The GLM is a parametric model. We need to estimate two parameters, <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>, using our training dataset.</p>
<p>You already know how to do this using <code>lm()</code> in base R. However, we will use the <code>tidymodels</code> modeling approach.</p>
<hr>
<p>We use <code>tidymodels</code> because:</p>
<ul>
<li>It provides a consistent interface to many (and growing numbers) of statistical algorithms</li>
<li>It provides very strong and easy feature engineering routines (e.g., missing data, scaling, transformations, near-zero variance, collinearity)</li>
<li>It simplifies model performance evaluation using resampling approaches (that you don’t know yet!)</li>
<li>It supports numerous performance metrics</li>
<li>It is (mostly) tightly integrated within the tidyverse</li>
<li>It is under active development and support</li>
<li>You can see documentation for all of the packages at the <a href="https://www.tidymodels.org/">tidymodels website</a>. It is worth a quick review now to get a sense of what is available</li>
</ul>
<hr>
<p>To fit a model with a specific configuration, we need to:</p>
<ul>
<li>Set up a feature engineering recipe</li>
<li>Use the recipe to make a feature matrix
<ul>
<li><code>prep()</code> it with training data</li>
<li><code>bake()</code> it with data you want to use to calculate feature matrix</li>
</ul></li>
<li>Select and define the statistical algorithm</li>
<li>Fit the algorithm in the feature matrix</li>
</ul>
<p>These steps are accomplished with functions from the <a href="https://recipes.tidymodels.org/">recipes</a> and <a href="https://parsnip.tidymodels.org/reference/index.html">parsnip</a> packages.</p>
<p>We will start with a simple model configuration</p>
<ul>
<li>General linear model</li>
<li>One feature (raw <code>gr_liv_area</code>)</li>
<li>Fit in training data</li>
</ul>
<hr>
<p>Set up a VERY SIMPLE feature engineering recipe</p>
<ul>
<li>Include outcome on the left size of <code>~</code></li>
<li>Include raw predictors (not yet features) on the right side of <code>~</code>.<br>
</li>
<li>Indicate the training data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span> gr_liv_area, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We can see a summary of it to verify it is doing what you expect</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  variable    type      role      source  
  &lt;chr&gt;       &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   
1 gr_liv_area &lt;chr [2]&gt; predictor original
2 sale_price  &lt;chr [2]&gt; outcome   original</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 1</code></pre>
</div>
</div>
<hr>
<p>We can then prep the recipe and bake the data to make our feature matrix from the training dataset</p>
<ul>
<li>Again, remember we always prep a recipe with training data but use the prepped recipe to bake any data</li>
<li>In this instance we will prep with <code>data_trn</code> and then bake <code>data_trn</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(<span class="at">training =</span> data_trn)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should always review the feature matrix to make sure it looks as you expect</p>
<ul>
<li>includes outcome (<code>sale_price</code>)</li>
<li>includes expected feature (<code>gr_liv_area</code>)</li>
<li>Sample size is as expected</li>
<li>No missing data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1506.84
</td>
<td style="text-align:right;">
511.44
</td>
<td style="text-align:right;">
438
</td>
<td style="text-align:right;">
1128
</td>
<td style="text-align:right;">
1450
</td>
<td style="text-align:right;">
1759
</td>
<td style="text-align:right;">
5642
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.19
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789
</td>
<td style="text-align:right;">
129500
</td>
<td style="text-align:right;">
160000
</td>
<td style="text-align:right;">
213500
</td>
<td style="text-align:right;">
745000
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
</tbody>

</table>
</div>
</div>
<hr>
<p>Now let’s consider the statistical algorithm</p>
<ul>
<li><code>tidymodels</code> breaks this apart into two pieces for clarity</li>
<li>First, you specify the broad category of algorithm
<ul>
<li>e.g., <code>linear_reg()</code>, <code>nearest_neighbor()</code>, <code>logistic_reg()</code></li>
</ul></li>
<li>Then you select a function from a specific R package (or base R) that will implement the algorithm
<ul>
<li><code>tidymodels</code> calls this setting the engine</li>
<li>e.g., <code>lm</code>, <code>kknn</code>, <code>glm</code>, <code>glmnet</code></li>
</ul></li>
</ul>
<hr>
<p>You can see the available engines (and modes: regression vs.&nbsp;classification) for the broad classes of algorithms</p>
<p>We will work with many of these algorithms later in the course</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"linear_reg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  engine mode      
  &lt;chr&gt;  &lt;chr&gt;     
1 lm     regression
2 glm    regression
3 glmnet regression
4 stan   regression
5 spark  regression
6 keras  regression
7 brulee regression</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"nearest_neighbor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  engine mode          
  &lt;chr&gt;  &lt;chr&gt;         
1 kknn   classification
2 kknn   regression    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"logistic_reg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  engine    mode          
  &lt;chr&gt;     &lt;chr&gt;         
1 glm       classification
2 glmnet    classification
3 LiblineaR classification
4 spark     classification
5 keras     classification
6 stan      classification
7 brulee    classification</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"decision_tree"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  engine mode          
  &lt;chr&gt;  &lt;chr&gt;         
1 rpart  classification
2 rpart  regression    
3 C5.0   classification
4 spark  classification
5 spark  regression    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"rand_forest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  engine       mode          
  &lt;chr&gt;        &lt;chr&gt;         
1 ranger       classification
2 ranger       regression    
3 randomForest classification
4 randomForest regression    
5 spark        classification
6 spark        regression    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"mlp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  engine mode          
  &lt;chr&gt;  &lt;chr&gt;         
1 keras  classification
2 keras  regression    
3 nnet   classification
4 nnet   regression    
5 brulee classification
6 brulee regression    </code></pre>
</div>
</div>
<p>There are some additional engines we will use in the course in the <code>discrim</code> package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discrim, <span class="at">exclude =</span> <span class="st">"smoothness"</span>) </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"discrim_linear"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  engine        mode          
  &lt;chr&gt;         &lt;chr&gt;         
1 MASS          classification
2 mda           classification
3 sda           classification
4 sparsediscrim classification</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"discrim_regularized"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  engine mode          
  &lt;chr&gt;  &lt;chr&gt;         
1 klaR   classification</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_engines</span>(<span class="st">"naive_Bayes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  engine     mode          
  &lt;chr&gt;      &lt;chr&gt;         
1 klaR       classification
2 naivebayes classification</code></pre>
</div>
</div>
<hr>
<p>You can also better understand how the engine will be called using <code>translate()</code></p>
<p>Not useful here but will be with more complicated algorithms</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression Model Specification (regression)

Computational engine: lm 

Model fit template:
stats::lm(formula = missing_arg(), data = missing_arg(), weights = missing_arg())</code></pre>
</div>
</div>
<hr>
<p>Let’s combine our feature matrix with an algorithm to fit a model in our training set features using only raw <code>gr_liv_area</code> as a feature</p>
<p>Note the specification of</p>
<ul>
<li>The category of algorithm</li>
<li>The engine (no need to set mode of engine b/c <code>lm</code> are only for the regression mode)</li>
<li>The use of the <code>.</code> to indicate all features in the matrix.
<ul>
<li>no needed here because there is only one feature: <code>gr_liv_area</code></li>
<li>will be useful when we have <strong>many</strong> features in the matrix</li>
</ul></li>
<li>We use the the feature matrix (rather than raw data) from the training set to fit the model.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-28"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-28-1"><a href="#annotated-cell-28-1" aria-hidden="true" tabindex="-1"></a>fit_lm_1 <span class="ot">&lt;-</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-28-2" class="code-annotation-target"><a href="#annotated-cell-28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-28-3" class="code-annotation-target"><a href="#annotated-cell-28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-28-4" class="code-annotation-target"><a href="#annotated-cell-28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-28" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-annotation="1" data-code-lines="2">category of algorithm</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-annotation="2" data-code-lines="3">engine</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-annotation="3" data-code-lines="4">use of <code>.</code> for all features and use of feature matrix from training set</span>
</dd>
</dl>
</div>
</div>
<hr>
<p>We can get the parameter estimates, standard errors, and statistical tests for each <span class="math inline">\(\beta\)</span> = 0 for this model using <code>tidy()</code> from the <code>broom</code> package (loaded as part of the <code>tidyverse</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fit_lm_1 <span class="sc">|&gt;</span>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   16561.   4537.        3.65 2.72e-  4
2 gr_liv_area     109.      2.85     38.2  4.78e-222</code></pre>
</div>
</div>
<hr>
<p>There are a variety of ways to pull out the estimates for each feature (and intercept)</p>
<p>Option 1: Pull all estimates from the tidy object</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fit_lm_1 <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16560.9991   108.9268</code></pre>
</div>
</div>
<p>Option 2: Extract a single estimate using $ and row number. Be careful that order of features won’t change! This assumes the feature coefficient for the relevant feature is <strong>always</strong> the second coefficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_lm_1)<span class="sc">$</span>estimate[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 108.9268</code></pre>
</div>
</div>
<p>Option 3: Extract a single estimate using $ and match to term. Safer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fit_lm_1 <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"gr_liv_area"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 108.9268</code></pre>
</div>
</div>
<hr>
<p>Best to write a function if we plan to do this a lot. This function in included in <code>fun_ml.R</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>get_estimate <span class="ot">&lt;-</span> <span class="cf">function</span>(the_fit, the_term){</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  the_fit <span class="sc">|&gt;</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> the_term) <span class="sc">|&gt;</span> </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(estimate)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can use this function whenever we need a coefficient</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_estimate</span>(fit_lm_1, <span class="st">"gr_liv_area"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 108.9268</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_estimate</span>(fit_lm_1, <span class="st">"(Intercept)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16561</code></pre>
</div>
</div>
<p>Regardless of the method, we now have a simple parametric model for <code>sale_price</code></p>
<p><span class="math inline">\(\hat{sale\_price} = 1.6561\times 10^{4} + 108.9 * gr\_liv\_area\)</span></p>
<hr>
<p>We can get the predicted values for <code>sale_price</code> (i.e., <span class="math inline">\(\hat{sale\_price}\)</span>) in our validation set using <code>predict()</code></p>
<p>However, we first need to make a feature matrix from our validation set</p>
<ul>
<li>We the recipe that we previously prepped with our training set</li>
<li>We bake the training data (<code>data_val</code>) to create features for the training set (<code>feat_val</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>As always, we should skim these new features</p>
<ul>
<li>Sample size matches what we expect for validation set</li>
<li>No missing data</li>
<li>Includes expected outcome and features</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>feat_val <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_val
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
490
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1493.0
</td>
<td style="text-align:right;">
483.78
</td>
<td style="text-align:right;">
480
</td>
<td style="text-align:right;">
1143.5
</td>
<td style="text-align:right;">
1436
</td>
<td style="text-align:right;">
1729.5
</td>
<td style="text-align:right;">
3608
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
1.16
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
178512.8
</td>
<td style="text-align:right;">
75493.59
</td>
<td style="text-align:right;">
35311
</td>
<td style="text-align:right;">
129125.0
</td>
<td style="text-align:right;">
160000
</td>
<td style="text-align:right;">
213000.0
</td>
<td style="text-align:right;">
556581
</td>
<td style="text-align:right;">
1.42
</td>
<td style="text-align:right;">
2.97
</td>
</tr>
</tbody>

</table>
</div>
</div>
<hr>
<p>Now we can get predictions using our model with validation features</p>
<p><code>predict()</code> returns a dataframe with one column named <code>.pred</code> and one row for every observation in dataframe (e.g., validation feature set)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit_lm_1, feat_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 490 × 1
     .pred
     &lt;dbl&gt;
 1 196944.
 2 194003.
 3 213065.
 4 162632.
 5 180169.
 6 207401.
 7 218729.
 8 125923.
 9 135509.
10 133004.
# ℹ 480 more rows</code></pre>
</div>
</div>
<hr>
<p>We can visualize how well this model performs in the validation set by plotting predicted <code>sale_price</code> (<span class="math inline">\(\hat{sale\_price}\)</span>) vs.&nbsp;<code>sale_price</code> (<strong>ground truth</strong> in machine learning terminology) for these data</p>
<p>We might do this a lot so let’s write a function (We have included this function in <code>fun_ml.R</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>plot_truth <span class="ot">&lt;-</span> <span class="cf">function</span>(truth, estimate) {</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> truth, <span class="at">y =</span> estimate)) <span class="sc">+</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"predicted outcome"</span>, <span class="at">x =</span> <span class="st">"outcome"</span>) <span class="sc">+</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_obs_pred</span>()   <span class="co"># scale axes uniformly</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Now make the plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_1, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-simple-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Perfect performance would have all the points right on the dotted line (same value for actual and predicted outcome)</p>
<ul>
<li>Our model doesn’t do that well yet. Not surprising</li>
<li>Pattern also has some indication of fanning of residuals with higher outcome scores that suggests need for a power transformation of outcome (e.g., log)</li>
<li>This is consistent with our earlier modeling EDA</li>
<li>Perhaps not that bad here b/c both <code>sale_price</code> and <code>gr_liv_area</code> were positively skewed</li>
<li>We will need consider this eventually</li>
</ul>
<hr>
<p>We can quantify model performance by selecting a performance metric</p>
<ul>
<li>The <code>yardstick</code> package within the <code>tidymodels</code> framework supports calculation of many performance metrics for regression and classification models</li>
<li>See the <a href="https://yardstick.tidymodels.org/reference/index.html">list</a> of all currently available metrics</li>
</ul>
<p>Root mean square error (RMSE) is a common performance metric for regression models</p>
<ul>
<li>You focused on a related metric, sum of squared error (SSE), in PSY 610/710</li>
<li>RMSE simply divides SSE by N (to get mean squared error; MSE) and then takes the square root to return the metric to the original units for the outcome variable</li>
<li>It is easy to calculate using <code>rmse_vec()</code> from the <code>yardstick</code> package</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_1, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 51375.08</code></pre>
</div>
</div>
<hr>
<p>Let’s record how well this model performed in validation so we can compare it to subsequent models</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(error_val,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"simple linear model"</span>,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_1, feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  model               rmse_val
  &lt;chr&gt;                  &lt;dbl&gt;
1 simple linear model   51375.</code></pre>
</div>
</div>
<hr>
<p>For explanatory purposes, we might want to visualize the relationship between a raw predictor and the outcome (in addition to examining the parameter estimates and the associated statistical tests)</p>
<ul>
<li>Here is a plot of <span class="math inline">\(\hat{sale\_price}\)</span> by <code>gr_liv_area</code> superimposed over a scatterplot of the raw data from the validation set</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>feat_val <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gr_liv_area)) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> sale_price), <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">predict</span>(fit_lm_1, data_val)<span class="sc">$</span>.pred), </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="fl">1.25</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Validation Set"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-simple-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>As expected, there is a moderately strong positive relationship between <code>gr_liv_area</code> and <code>sale_price</code>.<br>
</li>
<li>We can also again see the heteroscadasticity in the errors that might be corrected by a power transformation of <code>sale_price</code> (and possibly <code>gr_liv_area</code>)</li>
</ul>
<hr>
</section>
<section id="extension-of-lm-to-multiple-predictors" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="extension-of-lm-to-multiple-predictors"><span class="header-section-number">3.3</span> Extension of LM to Multiple Predictors</h2>
<p>We can improve model performance by moving from simple linear model to a linear model with multiple features derived from multiple predictors</p>
<p>We have many other numeric variables available to use, even in this pared down version of the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span>  <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
data_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: factor</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:left;">
top_counts
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
overall_qual
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
5: 424, 6: 350, 7: 304, 8: 176
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_qual
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
ta: 1312, no_: 81, fa: 57, gd: 13
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
res: 1157, res: 217, flo: 66, com: 13
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_config
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
ins: 1095, cor: 248, cul: 81, fr2: 39
</td>
</tr>
<tr>
<td style="text-align:left;">
bldg_type
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
one: 1216, tow: 108, dup: 63, tow: 46
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789
</td>
<td style="text-align:right;">
129500
</td>
<td style="text-align:right;">
160000
</td>
<td style="text-align:right;">
213500
</td>
<td style="text-align:right;">
745000
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1506.84
</td>
<td style="text-align:right;">
511.44
</td>
<td style="text-align:right;">
438
</td>
<td style="text-align:right;">
1128
</td>
<td style="text-align:right;">
1450
</td>
<td style="text-align:right;">
1759
</td>
<td style="text-align:right;">
5642
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.19
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10144.16
</td>
<td style="text-align:right;">
8177.55
</td>
<td style="text-align:right;">
1476
</td>
<td style="text-align:right;">
7500
</td>
<td style="text-align:right;">
9375
</td>
<td style="text-align:right;">
11362
</td>
<td style="text-align:right;">
164660
</td>
<td style="text-align:right;">
11.20
</td>
<td style="text-align:right;">
182.91
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.35
</td>
<td style="text-align:right;">
29.65
</td>
<td style="text-align:right;">
1880
</td>
<td style="text-align:right;">
1953
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
-0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.78
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
</tbody>

</table>
</div>
</div>
<hr>
<p>Let’s expand our model to also include <code>lot_area</code>, <code>year_built</code>, and <code>garage_cars</code></p>
<p>Again, we need:</p>
<ul>
<li>A feature engineering recipe</li>
<li>Training (and eventually validation) feature matrices</li>
<li>An algorithm to fit in training feature matrix</li>
</ul>
<hr>
<p>With the addition of new predictors, we now have a feature engineering task</p>
<ul>
<li>We have missing data on <code>garage_cars</code> in the training set</li>
<li>We need to decide how we will handle it</li>
</ul>
<p>A simple solution is to do median imputation - substitute the median of the non-missing scores for any missing score.</p>
<ul>
<li>This is fast and easy to understand</li>
<li>It works OK (but there are certainly better options that we will consider later in the course)
<ul>
<li>see other options in <a href="https://recipes.tidymodels.org/reference/index.html">Step Functions - Imputation</a> section on <code>tidymodels</code> website</li>
</ul></li>
<li>There is only one missing value so it likely doesn’t matter much anyway</li>
</ul>
<p>Let’s add this to our recipe. All of the defaults are appropriate but you should see <code>?step_impute_median()</code> to review them</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-45"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-45-1"><a href="#annotated-cell-45-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-45" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-45-2" class="code-annotation-target"><a href="#annotated-cell-45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span> gr_liv_area <span class="sc">+</span> lot_area <span class="sc">+</span> year_built <span class="sc">+</span> garage_cars,</span>
<span id="annotated-cell-45-3"><a href="#annotated-cell-45-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-45-4"><a href="#annotated-cell-45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(garage_cars)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-45" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-45" data-code-annotation="1" data-code-lines="2">Notice we now list four predictors for our recipe using <code>+</code> between them</span>
</dd>
</dl>
</div>
</div>
<hr>
<p>We can review this recipe to see what it will do</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  variable    type      role      source  
  &lt;chr&gt;       &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   
1 gr_liv_area &lt;chr [2]&gt; predictor original
2 lot_area    &lt;chr [2]&gt; predictor original
3 year_built  &lt;chr [2]&gt; predictor original
4 garage_cars &lt;chr [2]&gt; predictor original
5 sale_price  &lt;chr [2]&gt; outcome   original</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Median imputation for: garage_cars</code></pre>
</div>
</div>
<hr>
<p>Now we need to</p>
<ul>
<li>Prep the recipe in training set</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-48"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-48-1"><a href="#annotated-cell-48-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-48" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-48-2" class="code-annotation-target"><a href="#annotated-cell-48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-48" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-48" data-code-annotation="1" data-code-lines="2">We will no longer list <code>training =</code> to save some typing</span>
</dd>
</dl>
</div>
</div>
<ul>
<li>Bake (and skim) the training set to make training features</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-49"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-49-1"><a href="#annotated-cell-49-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-49" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-49-2" class="code-annotation-target"><a href="#annotated-cell-49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="annotated-cell-49-3"><a href="#annotated-cell-49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-49-4"><a href="#annotated-cell-49-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-49" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-49" data-code-annotation="1" data-code-lines="2">We will no longer list <code>new_data =</code> to save some typing</span>
</dd>
</dl>
</div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1506.84
</td>
<td style="text-align:right;">
511.44
</td>
<td style="text-align:right;">
438
</td>
<td style="text-align:right;">
1128
</td>
<td style="text-align:right;">
1450
</td>
<td style="text-align:right;">
1759
</td>
<td style="text-align:right;">
5642
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.19
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10144.16
</td>
<td style="text-align:right;">
8177.55
</td>
<td style="text-align:right;">
1476
</td>
<td style="text-align:right;">
7500
</td>
<td style="text-align:right;">
9375
</td>
<td style="text-align:right;">
11362
</td>
<td style="text-align:right;">
164660
</td>
<td style="text-align:right;">
11.20
</td>
<td style="text-align:right;">
182.91
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.35
</td>
<td style="text-align:right;">
29.65
</td>
<td style="text-align:right;">
1880
</td>
<td style="text-align:right;">
1953
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
-0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.78
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789
</td>
<td style="text-align:right;">
129500
</td>
<td style="text-align:right;">
160000
</td>
<td style="text-align:right;">
213500
</td>
<td style="text-align:right;">
745000
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
</tbody>

</table>
</div>
</div>
<ul>
<li>Bake (and skim) the validation set to make validation features</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Now let’s combine our algorithm and training features to fit this model configuration with 4 features</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-51"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-51-1"><a href="#annotated-cell-51-1" aria-hidden="true" tabindex="-1"></a>fit_lm_4 <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-51-2"><a href="#annotated-cell-51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-51-3"><a href="#annotated-cell-51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-51" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-51-4" class="code-annotation-target"><a href="#annotated-cell-51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-51" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-51" data-code-annotation="1" data-code-lines="4">the <code>.</code> is a bit more useful now</span>
</dd>
</dl>
</div>
</div>
<hr>
<p>This yields these parameter estimates (which as we know from 610/710 were selected to minimize SSE in the training set):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>fit_lm_4 <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  term            estimate std.error statistic   p.value
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept) -1665041.    89370.       -18.6  1.14e- 69
2 gr_liv_area       76.8       2.62      29.3  3.56e-149
3 lot_area           0.514     0.146      3.51 4.60e-  4
4 year_built       854.       46.2       18.5  7.66e- 69
5 garage_cars    22901.     1964.        11.7  4.09e- 30</code></pre>
</div>
</div>
<hr>
<p>Here is our parametric model</p>
<p><span class="math inline">\(\hat{sale\_price} = -1.6650409\times 10^{6} + 76.8 * gr\_liv\_area + 0.5 * lot\_area + 854.3 * year\_built + 2.29008\times 10^{4} * garage\_cars\)</span></p>
<p>Compared with our previous simple regression model:</p>
<p><span class="math inline">\(\hat{sale\_price} = 1.6561\times 10^{4} + 108.9 * gr\_liv\_area\)</span></p>
<hr>
<p>Of course, these four features are correlated both with <code>sale_price</code> but also with each other</p>
<p>Let’s look at correlations in the training set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  corrplot<span class="sc">::</span><span class="fu">corrplot.mixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-simple-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>[What are the implications of the correlations among many of these predictors?].{red} <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<hr>
<p>How well does this more complex model perform in validation? Let’s compare the previous and current visualizations of <code>sale_price</code> vs.&nbsp;<span class="math inline">\(\hat{sale\_price}\)</span></p>
<ul>
<li>Looks like the errors are smaller (closer to the diagonal line that would represent prefect prediction)</li>
<li>Clear signs of non-linearity are now present as well. Time for more Modeling EDA!!</li>
<li>And two outliers perhaps?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>plot_1 <span class="ot">&lt;-</span> <span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_1, feat_val)<span class="sc">$</span>.pred)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>plot_4 <span class="ot">&lt;-</span> <span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_4, feat_val)<span class="sc">$</span>.pred)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_1, plot_4, </span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"1 feature"</span>, <span class="st">"4 features"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-simple-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Coding sidebar</strong>: Notice the use of <code>plot_grid()</code> from the <code>cowplot</code> package to make side by side plots. This also required returning the individual plots as objects (just assign to a object name, e.g., plot_1)</p>
<hr>
<p>Let’s compare model performance for the two models using RMSE in the validation set</p>
<ul>
<li>The one feature simple linear model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_lm_1, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 51375.08</code></pre>
</div>
</div>
<ul>
<li>The four feature linear model. A clear improvement!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_lm_4, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 39903.25</code></pre>
</div>
</div>
<p>Let’s bind it to our results table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(error_val, </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"4 feature linear model"</span>, </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, <span class="fu">predict</span>(fit_lm_4, feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  model                  rmse_val
  &lt;chr&gt;                     &lt;dbl&gt;
1 simple linear model      51375.
2 4 feature linear model   39903.</code></pre>
</div>
</div>
<hr>
<p>Given the non-linearity suggested by the truth vs.&nbsp;estimate plots, we might wonder if we could improve the fit if we transformed our features to be closer to normal</p>
<p>There are a number of recipe functions that do transformations (see <a href="https://recipes.tidymodels.org/reference/index.html">Step Functions - Individual Transformations</a>)</p>
<p>We will apply <code>step_YeoJohnson()</code>, which is similar to a Box-Cox transformation but can be more broadly applied because the scores don’t need to be strictly positive</p>
<p>Let’s do it all again!</p>
<ul>
<li>Define the feature engineering recipe</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span> gr_liv_area <span class="sc">+</span> lot_area <span class="sc">+</span> year_built <span class="sc">+</span> garage_cars, </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(garage_cars) <span class="sc">|&gt;</span> </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_YeoJohnson</span>(lot_area, gr_liv_area, year_built, garage_cars)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Median imputation for: garage_cars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Yeo-Johnson transformation on: lot_area, gr_liv_area, year_built, ...</code></pre>
</div>
</div>
<ul>
<li>Prep the recipe with training set</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use prepped recipe to bake the training set into features</p>
<ul>
<li>Notice the features are now less skewed</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5.22
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
4.60
</td>
<td style="text-align:right;">
5.11
</td>
<td style="text-align:right;">
5.23
</td>
<td style="text-align:right;">
5.33
</td>
<td style="text-align:right;">
5.86
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.12
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14.10
</td>
<td style="text-align:right;">
1.14
</td>
<td style="text-align:right;">
10.32
</td>
<td style="text-align:right;">
13.69
</td>
<td style="text-align:right;">
14.20
</td>
<td style="text-align:right;">
14.64
</td>
<td style="text-align:right;">
21.65
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
5.46
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.35
</td>
<td style="text-align:right;">
29.65
</td>
<td style="text-align:right;">
1880.00
</td>
<td style="text-align:right;">
1953.00
</td>
<td style="text-align:right;">
1972.00
</td>
<td style="text-align:right;">
2000.00
</td>
<td style="text-align:right;">
2010.00
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
-0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.12
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.11
</td>
<td style="text-align:right;">
2.37
</td>
<td style="text-align:right;">
2.37
</td>
<td style="text-align:right;">
5.23
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;">
0.04
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789.00
</td>
<td style="text-align:right;">
129500.00
</td>
<td style="text-align:right;">
160000.00
</td>
<td style="text-align:right;">
213500.00
</td>
<td style="text-align:right;">
745000.00
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>Use same prepped recipe to bake the validation set into features</p>
<ul>
<li>Again, features are less skewed</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>feat_val <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_val
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
490
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5.22
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
4.65
</td>
<td style="text-align:right;">
5.11
</td>
<td style="text-align:right;">
5.23
</td>
<td style="text-align:right;">
5.32
</td>
<td style="text-align:right;">
5.66
</td>
<td style="text-align:right;">
-0.17
</td>
<td style="text-align:right;">
0.19
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14.14
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
10.57
</td>
<td style="text-align:right;">
13.69
</td>
<td style="text-align:right;">
14.24
</td>
<td style="text-align:right;">
14.72
</td>
<td style="text-align:right;">
22.44
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
6.12
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.08
</td>
<td style="text-align:right;">
30.96
</td>
<td style="text-align:right;">
1875.00
</td>
<td style="text-align:right;">
1954.00
</td>
<td style="text-align:right;">
1975.00
</td>
<td style="text-align:right;">
2000.00
</td>
<td style="text-align:right;">
2010.00
</td>
<td style="text-align:right;">
-0.66
</td>
<td style="text-align:right;">
-0.41
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.06
</td>
<td style="text-align:right;">
0.96
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.11
</td>
<td style="text-align:right;">
2.37
</td>
<td style="text-align:right;">
2.37
</td>
<td style="text-align:right;">
5.23
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.24
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
178512.82
</td>
<td style="text-align:right;">
75493.59
</td>
<td style="text-align:right;">
35311.00
</td>
<td style="text-align:right;">
129125.00
</td>
<td style="text-align:right;">
160000.00
</td>
<td style="text-align:right;">
213000.00
</td>
<td style="text-align:right;">
556581.00
</td>
<td style="text-align:right;">
1.42
</td>
<td style="text-align:right;">
2.97
</td>
</tr>
</tbody>

</table>
</div>
</div>
<ul>
<li>Fit model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>fit_lm_4yj <span class="ot">&lt;-</span> </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>View truth vs.&nbsp;estimate plot</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price,</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_4yj, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>and look at the error</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(error_val, </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"4 feature linear model with YJ"</span>, </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                                                   <span class="fu">predict</span>(fit_lm_4yj, feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  model                          rmse_val
  &lt;chr&gt;                             &lt;dbl&gt;
1 simple linear model              51375.
2 4 feature linear model           39903.
3 4 feature linear model with YJ   41660.</code></pre>
</div>
</div>
<p>That didn’t help at all.</p>
<p>We may need to consider</p>
<ul>
<li>a transformation of <code>sale_price</code> (We will leave that to you for the application assignment!)</li>
<li>or a different algorithm that can handle non-linear relationships better</li>
</ul>
</section>
<section id="extension-to-categorical-predictors" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="extension-to-categorical-predictors"><span class="header-section-number">3.4</span> Extension to Categorical Predictors</h2>
<p>Many important predictors in our models may be categorical (ordered and unordered)</p>
<ul>
<li>Some statistical algorithms (e.g., random forest) can accept even unordered categorical predictors as features without any further feature engineering</li>
<li>But many cannot. Linear models cannot.</li>
<li>The type of feature engineering may differ for unordered vs.&nbsp;ordered categorical predictors</li>
<li>For <strong>unordered categorical predictors</strong>:
<ul>
<li>We need to learn a common approach to transform them to numeric features - dummy coding. We will learn the concept in general AND how to accomplish within a feature engineering recipe.</li>
</ul></li>
<li>For <strong>ordered categorical predictors</strong>:
<ul>
<li>We can treat them like numeric predictors</li>
<li>We can treat them like unordered categorical predictors</li>
</ul></li>
<li>See article on <a href="https://recipes.tidymodels.org/articles/Dummies.html">Categorical Predictors</a> on the <code>tidymodels</code> website for more details</li>
</ul>
<section id="dummy-coding" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored"><span class="header-section-number">3.4.1</span> Dummy Coding</h3>
<p>For many algorithms, we will need to use feature engineering to convert a categorical predictor to numeric features. One common technique is to use dummy coding. When dummy coding a predictor, we transform the original categorical predictor with m levels into m-1 dummy coded features.</p>
<p>To better understand how and why we do this, lets consider a version of <code>ms_zoning</code> in the Ames dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(ms_zoning) <span class="sc">|&gt;</span> </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    agri   commer    float    indus res_high  res_low  res_med 
       2       13       66        1        9     1157      217 </code></pre>
</div>
</div>
<p>We will recode <code>ms_zoning</code> to have only 3 levels to make our example simple (though dummy codes can be used for predictors with any number of levels)</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-66"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-66-1"><a href="#annotated-cell-66-1" aria-hidden="true" tabindex="-1"></a>data_dummy <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-66" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-66-2" class="code-annotation-target"><a href="#annotated-cell-66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sale_price, ms_zoning)  <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-66" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-66-3" class="code-annotation-target"><a href="#annotated-cell-66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ms_zoning3 =</span> <span class="fu">fct_collapse</span>(ms_zoning,</span>
<span id="annotated-cell-66-4"><a href="#annotated-cell-66-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"residential"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"res_high"</span>, <span class="st">"res_med"</span>, <span class="st">"res_low"</span>),</span>
<span id="annotated-cell-66-5"><a href="#annotated-cell-66-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"commercial"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"agri"</span>, <span class="st">"commer"</span>, <span class="st">"indus"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-66" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-66-6" class="code-annotation-target"><a href="#annotated-cell-66-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"floating"</span> <span class="ot">=</span> <span class="st">"float"</span>)) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-66" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-66-7" class="code-annotation-target"><a href="#annotated-cell-66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ms_zoning)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-66" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-66" data-code-annotation="1" data-code-lines="2">Make a df (dataframe) with only <code>sale_price</code> and <code>ms_zoning</code></span>
</dd>
<dt data-target-cell="annotated-cell-66" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-66" data-code-annotation="2" data-code-lines="3"><code>fct_collapse()</code> from the <code>forcats</code> package is our preferred way to collapse levels of a factor. See <code>fct_recode()</code> for more generic recoding of levels.</span>
</dd>
<dt data-target-cell="annotated-cell-66" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-66" data-code-annotation="3" data-code-lines="6">We could have left this line out and float would have stayed as a level named float</span>
</dd>
<dt data-target-cell="annotated-cell-66" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-66" data-code-annotation="4" data-code-lines="7">Remove original <code>ms_zoning</code> predictor</span>
</dd>
</dl>
</div>
</div>
<p>Take a look at the new predictor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>data_dummy <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(ms_zoning3) <span class="sc">|&gt;</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 commercial    floating residential 
         16          66        1383 </code></pre>
</div>
</div>
<hr>
<p>We need to convert this three-level, unordered categorical predictor (currently classed as a factor) to numeric features to allow us to use it in statistical algorithms like the general linear model.</p>
<p>[Why can’t we simply recode each level with a different consecutive value (e.g., commercial = 1, floating =2 , residential = 3)?].{red} <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<hr>
<p>Imagine fitting a straight line to predict <code>sale_price</code> from <code>ms_zoning3</code> using these three different ways to arbitrarily assign numbers to levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>data_dummy <span class="sc">|&gt;</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ms_zoning3 =</span> <span class="fu">case_when</span>(ms_zoning3 <span class="sc">==</span> <span class="st">"residential"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>                                ms_zoning3 <span class="sc">==</span> <span class="st">"commercial"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>                                ms_zoning3 <span class="sc">==</span> <span class="st">"floating"</span> <span class="sc">~</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ms_zoning3, <span class="at">y =</span> sale_price)) <span class="sc">+</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>data_dummy <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ms_zoning3 =</span> <span class="fu">case_when</span>(ms_zoning3 <span class="sc">==</span> <span class="st">"residential"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>                                ms_zoning3 <span class="sc">==</span> <span class="st">"commercial"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>                                ms_zoning3 <span class="sc">==</span> <span class="st">"floating"</span> <span class="sc">~</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ms_zoning3, <span class="at">y =</span> sale_price)) <span class="sc">+</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>data_dummy <span class="sc">|&gt;</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ms_zoning3 =</span> <span class="fu">case_when</span>(ms_zoning3 <span class="sc">==</span> <span class="st">"residential"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>                                ms_zoning3 <span class="sc">==</span> <span class="st">"commercial"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>                                ms_zoning3 <span class="sc">==</span> <span class="st">"floating"</span> <span class="sc">~</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ms_zoning3, <span class="at">y =</span> sale_price)) <span class="sc">+</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Dummy coding resolves this issue.</p>
<hr>
<p>When using dummy codes, we transform (i.e., feature engineer) our original m-level categorical predictor to m-1 dummy features.</p>
<ul>
<li>Each of these m-1 features represents a contrast between a specific level of the categorical variable and a <strong>reference level</strong></li>
<li>The full set of m-1 features represents the overall effect of the categorical predictor variable.</li>
<li>We assign values of 0 or 1 to each observation on each feature in a meaningful pattern (see below)</li>
</ul>
<hr>
<p>For example, with our three-level predictor: <code>ms_zoning3</code></p>
<ul>
<li><p>We need 2 features (f1, f2) to represent this 3-level categorical predictor</p></li>
<li><p>Feature 1 is coded 1 for residential and 0 for all other levels</p></li>
<li><p>Feature 2 is coded 1 for floating and 0 for all other levels</p></li>
</ul>
<p>Here is this coding scheme displayed in a table</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  ms_zoning3     f1    f2
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 commercial      0     0
2 residential     1     0
3 floating        0     1</code></pre>
</div>
</div>
<hr>
<p>With this coding:</p>
<ul>
<li>Commercial properties are coded 0 for both f1 and f2.<br>
</li>
<li>This means that commercial properties will become the reference level against which both residential and floating village are compared.</li>
<li>Because we are focused on prediction, the choice of reference level is mostly arbitrary. For explanatory goals, you might consider which level is best suited to be the reference.</li>
<li><h2 id="there-is-much-deeper-coverage-of-dummy-and-other-contrast-coding-in-610710" data-number="3.5" class="anchored" data-anchor-id="dummy-coding"><span class="header-section-number">3.5</span> There is much deeper coverage of dummy and other contrast coding in 610/710</h2></li>
</ul>
<p>We can add these two features manually to the data frame and view a handful of observations to make this coding scheme more concrete</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
  sale_price ms_zoning3     f1    f2
       &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt;
1     105000 residential     1     0
2     126000 residential     1     0
3      13100 commercial      0     0
4     115000 residential     1     0
5     149500 floating        0     1
6      40000 commercial      0     0
7     120000 residential     1     0
8     151000 floating        0     1</code></pre>
</div>
</div>
<hr>
<p>If we now fit a model where we predict <code>sale_price</code> from these two dummy coded features, each feature would represent the contrast of the mean <code>sale_price</code> for the level coded 1 vs.&nbsp;the mean <code>sale_price</code> for the level that is coded 0 for all features (i.e., commercial)</p>
<ul>
<li>f1 is the contrast of mean <code>sale_price</code> for residential vs.&nbsp;commercial</li>
<li>f2 is the contrast of mean <code>sale_price</code> for floating vs.&nbsp;commercial</li>
<li>The combined effect of these two features represents the overall effect of <code>ms_zoning3</code> on <code>sale_price</code></li>
</ul>
<hr>
<p>Lets do this quickly in base r using <code>lm()</code> as you have done previously in 610.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(sale_price <span class="sc">~</span> f1 <span class="sc">+</span> f2, <span class="at">data =</span> data_dummy) </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sale_price ~ f1 + f2, data = data_dummy)

Residuals:
    Min      1Q  Median      3Q     Max 
-166952  -50241  -20241   31254  565259 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    81523      19409   4.200 2.83e-05 ***
f1             98219      19521   5.031 5.47e-07 ***
f2            143223      21634   6.620 5.03e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 77640 on 1462 degrees of freedom
Multiple R-squared:  0.03151,   Adjusted R-squared:  0.03018 
F-statistic: 23.78 on 2 and 1462 DF,  p-value: 6.858e-11</code></pre>
</div>
</div>
<p>The mean sale price of residential properties is 9.8219^{4} dollars higher than commercial properties.</p>
<p>The mean sale price of floating villages is 1.43223^{5} dollars higher than commercial properties.</p>
<hr>
<p>To understand this conceptually, it is easiest to visualize the linear model that would predict <code>sale_price</code> with these two dichotomous features.</p>
<ul>
<li>There are only three columns of <code>sale_price</code> because the only possible values for <code>f1</code> and <code>f2</code> (which are both dichotomous) are
<ul>
<li>0,0 (commercial)</li>
<li>1,0 (residential)</li>
<li>0,1 (floating village)</li>
</ul></li>
<li>This regression with two features yields a prediction plane (displayed)</li>
<li>The left/right tilt of the plane will be the parameter estimate for f1 and it is the contrast of residential vs.&nbsp;commercial</li>
<li>The front/back tilt of the plane will be the parameter estimate for f2 and it is the contrast of floating village vs.&nbsp;commercial</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><strong>Statistical sidebar</strong>:</p>
<ul>
<li>Any full rank (# levels - 1) set of features regardless of coding system predicts exactly the same (e.g., dummy, helmert, contrast coding)</li>
<li>Preference among coding systems is simply to get single df contrasts of theoretical importance (i.e., for explanation rather than prediction)</li>
<li>Final (m<sup>th</sup>) dummy feature is not included b/c its is completely redundant (perfectly multicollinear) with other dummy features. This would also prevent a linear model from fitting (‘<strong>dummy variable trap</strong>’).</li>
<li>However, some statistical algorithms do not have problems with perfect multicollinearity (e.g., LASSO, ridge regression).
<ul>
<li>For these algorithms, you will sometimes see modified version of dummy coding called <a href="https://machinelearningmastery.com/why-one-hot-encode-data-in-machine-learning/">one-hot coding</a>.<br>
</li>
<li>This approach uses one additional dummy coded feature for the final category.<br>
</li>
<li>We won’t spend time on this but you should be familiar with the term b/c it is often confused with dummy coding.</li>
</ul></li>
</ul>
<hr>
<p><strong>Coding Sidebar</strong></p>
<p>When creating dummy coded features from factors that have levels with infrequent observations, you may occasionally end up with novel levels in your validation or test sets that were not present in your training set.</p>
<ul>
<li>This will cause you issues.<br>
</li>
<li>These issues are mostly resolved if you make sure to explicitly list all possible levels for a factor when classing that factor in the training data, even if the level doesn’t exist in the training data.<br>
</li>
<li>We provide more detail on this issue in an <a href="">appendix</a>.</li>
</ul>
</section>
<section id="unordered-categorical-predictors" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="unordered-categorical-predictors"><span class="header-section-number">3.5.1</span> Unordered Categorical Predictors</h3>
<p>Now that we understand how to use dummy coding to feature engineer unordered categorical predictors, let’s consider some potentially important ones that are available to us. Are any promising?</p>
<p>Lets return first to <code>ms_zoning</code></p>
<p>Data dictionary entry: Identifies the general zoning classification of the sale.</p>
<ul>
<li>agri: Agriculture</li>
<li>commer: Commercial</li>
<li>float: Floating Village Residential</li>
<li>indus: Industrial</li>
<li>res_high: Residential High Density</li>
<li>res_med: Residential Medium Density</li>
<li>res_low: Residential Low Density</li>
</ul>
<p>We might:</p>
<ul>
<li>Represent it with 6 dummy features (because there are 7 raw levels) but many of the categories are very low n - won’t account for much variance?</li>
<li>Combine all the commercial categories (agri, commer, indus), which would take care of most of the low n groups. They also all tend to have the lower prices.</li>
<li>Combine all the residential to get a better feature to variance accounted ratio. They all tend to have similar prices on average and res_high is also pretty low n.&nbsp;</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_categorical</span>(<span class="st">"ms_zoning"</span>, <span class="st">"sale_price"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> _, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-categorical-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><code>lot_config</code></p>
<ul>
<li>Most are inside lots, some of the lot categories are low n</li>
<li>Median <code>sale_price</code> is not very different between configurations</li>
<li>Not very promising but could help some (particularly given the large sample size)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_categorical</span>(<span class="st">"lot_config"</span>, <span class="st">"sale_price"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> _, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-categorical-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Data dictionary entry: Lot configuration</p>
<ul>
<li>inside: Inside lot</li>
<li>corner: Corner lot</li>
<li>culdsac: Cul-de-sac</li>
<li>fr2: Frontage on 2 sides of property</li>
<li>fr3: Frontage on 3 sides of property</li>
</ul>
<hr>
<p><code>bldg_type</code></p>
<ul>
<li>Most of the houses are in one category - one_fam</li>
<li>There is not much difference in median <code>sale_price</code> among categories</li>
<li>Not very promising</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_categorical</span>(<span class="st">"bldg_type"</span>, <span class="st">"sale_price"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> _, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-categorical-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Data dictionary entry: Type of dwelling</p>
<ul>
<li>one_fam: Single-family Detached<br>
</li>
<li>two_fam: Two-family Conversion; originally built as one-family dwelling</li>
<li>duplex: Duplex</li>
<li>town_end: Townhouse End Unit</li>
<li>town_inside: Townhouse Inside Unit</li>
</ul>
<hr>
<p>Let’s do some feature engineering with <code>ms_zoning</code>. We can now do this formally in a recipe so that it can be used in our modeling workflow.</p>
<p>First, if you noticed earlier, there are some levels for <code>ms_zoning</code> that are pretty infrequent. Lets make sure both <code>data_trn</code> and <code>data_val</code> have all levels set for this factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">pull</span>(ms_zoning) <span class="sc">|&gt;</span> <span class="fu">levels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "agri"     "commer"   "float"    "indus"    "res_high" "res_low"  "res_med" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="sc">|&gt;</span> <span class="fu">pull</span>(ms_zoning) <span class="sc">|&gt;</span> <span class="fu">levels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "commer"   "float"    "indus"    "res_high" "res_low"  "res_med" </code></pre>
</div>
</div>
<p>As expected, we are missing a level (<code>agri</code>) in <code>data_val</code>. Lets fix that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="ot">&lt;-</span> data_val <span class="sc">|&gt;</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ms_zoning =</span> <span class="fu">factor</span>(ms_zoning, </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"agri"</span>, <span class="st">"commer"</span>, <span class="st">"float"</span>, <span class="st">"indus"</span>, <span class="st">"res_high"</span>, <span class="st">"res_low"</span>, <span class="st">"res_med"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>With that fixed, let’s proceed:</p>
<ul>
<li>We will collapse categories down to three levels (commercial, residential, floating village) as before but now using <code>step_mutate()</code> combined with <code>fct_collapse()</code> to do this inside of our recipe.<br>
</li>
<li>We will convert to dummy features using <code>step_dummy()</code>. The first level of the factor will be set to the reference level when we call <code>step_dummy()</code>.</li>
<li><code>step_dummy()</code> is a poor choice for function name. It actually uses whatever contrast coding we have set up in R. However, the default is are dummy coded contrasts (R calls this treatment contrasts). See <code>?contrasts</code> and <code>options("contrasts")</code> for more info.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span> gr_liv_area <span class="sc">+</span> lot_area <span class="sc">+</span> year_built <span class="sc">+</span> garage_cars <span class="sc">+</span> ms_zoning, </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(garage_cars) <span class="sc">|&gt;</span> </span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">ms_zoning =</span> <span class="fu">fct_collapse</span>(ms_zoning,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"residential"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"res_high"</span>, <span class="st">"res_med"</span>, <span class="st">"res_low"</span>),</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"commercial"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"agri"</span>, <span class="st">"commer"</span>, <span class="st">"indus"</span>),</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"floating"</span> <span class="ot">=</span> <span class="st">"float"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(ms_zoning)</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Median imputation for: garage_cars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: fct_collapse(ms_zoning, residential = c("res_high",
  "res_med", "res_low"), commercial = c("agri", "commer", "indus"), floating =
  "float")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: ms_zoning</code></pre>
</div>
</div>
<hr>
<p><strong>Coding Sidebar</strong></p>
<p>You should also read more about some other <code>step_()</code> functions that you might use for categorical predictors: - <code>step_other()</code> to combine all low frequency categories into a single “other” category. - <code>step_unknown()</code> to assign missing values their own category - You can use selector functions. For example, you could make dummy variables out of all of your factors using <code>step_dummy(all_nominal_predictors())</code>.</p>
<p>See the <a href="https://recipes.tidymodels.org/reference/index.html">Step Functions - Dummy Variables and Encoding section</a> on the <code>tidymodels</code> website for additional useful functions.</p>
<p>We have also described these in the section on factor steps in Appendix 1</p>
<hr>
<p>Let’s see if the addition of <code>ms_zoning</code> helped</p>
<ul>
<li>Notice the addition of the dummy coded features to the feature matrix</li>
<li>Notice the removal of the factor <code>ms_zoning</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1506.84
</td>
<td style="text-align:right;">
511.44
</td>
<td style="text-align:right;">
438
</td>
<td style="text-align:right;">
1128
</td>
<td style="text-align:right;">
1450
</td>
<td style="text-align:right;">
1759
</td>
<td style="text-align:right;">
5642
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.19
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10144.16
</td>
<td style="text-align:right;">
8177.55
</td>
<td style="text-align:right;">
1476
</td>
<td style="text-align:right;">
7500
</td>
<td style="text-align:right;">
9375
</td>
<td style="text-align:right;">
11362
</td>
<td style="text-align:right;">
164660
</td>
<td style="text-align:right;">
11.20
</td>
<td style="text-align:right;">
182.91
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.35
</td>
<td style="text-align:right;">
29.65
</td>
<td style="text-align:right;">
1880
</td>
<td style="text-align:right;">
1953
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
-0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.78
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789
</td>
<td style="text-align:right;">
129500
</td>
<td style="text-align:right;">
160000
</td>
<td style="text-align:right;">
213500
</td>
<td style="text-align:right;">
745000
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_floating
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.38
</td>
<td style="text-align:right;">
17.22
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_residential
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-3.86
</td>
<td style="text-align:right;">
12.90
</td>
</tr>
</tbody>

</table>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>feat_val <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_val
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
490
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1493.00
</td>
<td style="text-align:right;">
483.78
</td>
<td style="text-align:right;">
480
</td>
<td style="text-align:right;">
1143.5
</td>
<td style="text-align:right;">
1436.0
</td>
<td style="text-align:right;">
1729.50
</td>
<td style="text-align:right;">
3608
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
1.16
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10462.08
</td>
<td style="text-align:right;">
10422.55
</td>
<td style="text-align:right;">
1680
</td>
<td style="text-align:right;">
7500.0
</td>
<td style="text-align:right;">
9563.5
</td>
<td style="text-align:right;">
11780.75
</td>
<td style="text-align:right;">
215245
</td>
<td style="text-align:right;">
15.64
</td>
<td style="text-align:right;">
301.66
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.08
</td>
<td style="text-align:right;">
30.96
</td>
<td style="text-align:right;">
1875
</td>
<td style="text-align:right;">
1954.0
</td>
<td style="text-align:right;">
1975.0
</td>
<td style="text-align:right;">
2000.00
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
-0.66
</td>
<td style="text-align:right;">
-0.41
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.74
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.24
</td>
<td style="text-align:right;">
0.22
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
178512.82
</td>
<td style="text-align:right;">
75493.59
</td>
<td style="text-align:right;">
35311
</td>
<td style="text-align:right;">
129125.0
</td>
<td style="text-align:right;">
160000.0
</td>
<td style="text-align:right;">
213000.00
</td>
<td style="text-align:right;">
556581
</td>
<td style="text-align:right;">
1.42
</td>
<td style="text-align:right;">
2.97
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_floating
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.22
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.07
</td>
<td style="text-align:right;">
14.58
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_residential
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.93
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-3.51
</td>
<td style="text-align:right;">
10.33
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>Now lets fit a model with these features</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>fit_lm_6 <span class="ot">&lt;-</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_6, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> error_val <span class="sc">|&gt;</span> </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"6 feature linear model w/ms_zoning"</span>, </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">predict</span>(fit_lm_6,</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>                                               feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  model                              rmse_val
  &lt;chr&gt;                                 &lt;dbl&gt;
1 simple linear model                  51375.
2 4 feature linear model               39903.
3 4 feature linear model with YJ       41660.
4 6 feature linear model w/ms_zoning   39846.</code></pre>
</div>
</div>
<p>Removing Yeo Johnson transformation but adding dummy coded <code>ms_zoning</code> may have helped a little</p>
<p>[Will the addition of new predictors/features to a model always reduce RMSE in train? in validation?].{red} <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
</section>
<section id="ordered-categorical-predictors" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="ordered-categorical-predictors"><span class="header-section-number">3.5.2</span> Ordered Categorical Predictors</h3>
<p>We have two paths to pursue for ordered categorical predictors</p>
<ul>
<li>We can treat them like unordered categorical predictors (e.g., dummy code)</li>
<li>We can treat them like numeric predictors (either raw or with an added transformation if needed)</li>
</ul>
<hr>
<p>Let’s consider <code>overall_qual</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_categorical</span>(<span class="st">"overall_qual"</span>, <span class="st">"sale_price"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(<span class="at">plotlist =</span> _, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-categorical-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Observations:</p>
<ul>
<li>Low frequency for low and to some degree high quality response options. If dummy coding, may want to collapse some (1-2)</li>
<li>There is a monotonic relationship (mostly linear) with <code>sale_price</code>. Treat as numeric?</li>
<li>Not skewed so doesn’t likely need to be transformed if treated as numeric</li>
<li>Numeric will take one feature vs.&nbsp;many (9?) features for dummy codes.<br>
</li>
<li>Dummy codes are more flexible but we may not need this flexibility (and unnecessary flexibility increases overfitting)</li>
</ul>
<hr>
<p>Let’s add <code>overall_qual</code> to our model as numeric</p>
<p>Remember that this predictor was ordinal so we paid special attention to the order of the levels when we classed this factor. Lets confirm they are in order</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">pull</span>(overall_qual) <span class="sc">|&gt;</span> <span class="fu">levels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10"</code></pre>
</div>
</div>
<p>To convert this to numeric (with levels in this order), we can use another simple mutate inside our recipe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span>  <span class="er">~</span> gr_liv_area <span class="sc">+</span> lot_area <span class="sc">+</span> year_built <span class="sc">+</span> garage_cars <span class="sc">+</span> </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>           ms_zoning <span class="sc">+</span> overall_qual, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(garage_cars) <span class="sc">|&gt;</span> </span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">ms_zoning =</span> <span class="fu">fct_collapse</span>(ms_zoning,</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"residential"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"res_high"</span>, <span class="st">"res_med"</span>, <span class="st">"res_low"</span>),</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"commercial"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"agri"</span>, <span class="st">"commer"</span>, <span class="st">"indus"</span>),</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"floating"</span> <span class="ot">=</span> <span class="st">"float"</span>),</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">overall_qual =</span> <span class="fu">as.numeric</span>(overall_qual)) <span class="sc">|&gt;</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(ms_zoning)</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Median imputation for: garage_cars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: fct_collapse(ms_zoning, residential = c("res_high",
  "res_med", "res_low"), commercial = c("agri", "commer", "indus"), floating =
  "float"), as.numeric(overall_qual)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: ms_zoning</code></pre>
</div>
</div>
<p><strong>Coding Sidebar</strong></p>
<p>There is a step function called <code>step_ordinalscore()</code> but it requires that the factor is classed as an ordered factor. It is also more complicated than needed in our opinion. Just use <code>as.numeric()</code></p>
<hr>
<p>Let’s evaluate this model</p>
<ul>
<li>Making features</li>
<li>Skipping the skim to save space (we promised we checked it previously!)</li>
<li>Fitting model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>fit_lm_7 <span class="ot">&lt;-</span> </span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Plotting results</li>
<li>Quantifying held out error</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_7, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(error_val, </span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"7 feature linear model"</span>, </span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, <span class="fu">predict</span>(fit_lm_7, feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  model                              rmse_val
  &lt;chr&gt;                                 &lt;dbl&gt;
1 simple linear model                  51375.
2 4 feature linear model               39903.
3 4 feature linear model with YJ       41660.
4 6 feature linear model w/ms_zoning   39846.
5 7 feature linear model               34080.</code></pre>
</div>
</div>
<p>That helped!</p>
</section>
</section>
<section id="extensions-to-interactive-models-and-non-linear-models" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="extensions-to-interactive-models-and-non-linear-models"><span class="header-section-number">3.6</span> Extensions to Interactive Models and Non-linear Models</h2>
<section id="interactions" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="interactions"><span class="header-section-number">3.6.1</span> Interactions</h3>
<p>There may be interactive effects among our predictors</p>
<ul>
<li>Some statistical algorithms (e.g., KNN) can naturally accommodate interactive effects without any feature engineering</li>
<li>Linear models cannot</li>
<li>Nothing to fear, tidymodels makes it easy to feature engineer interactions</li>
<li>[BUT - as we will learn, we generally think that if you expect lots of interactions, the linear model may not be the best model to use]</li>
</ul>
<hr>
<p>For example, it may be that the relationship between <code>year_built</code> and <code>sale_price</code> depends on <code>overall_qual</code>.</p>
<ul>
<li>Old houses are expensive if they are in good condition</li>
<li>but old houses are very cheap if they are in poor condition</li>
</ul>
<p>In the <code>tidymodels</code> framework</p>
<ul>
<li>Coding interactions is done by feature engineering, not by formula (Note that formula does not change below in recipe)</li>
<li>This seems appropriate to us as we are making new features to represent interactions</li>
<li>We still use an R formula like interface to specify the interaction term features that will be created</li>
<li>see <a href="https://recipes.tidymodels.org/reference/step_interact.html">more details</a> on the <code>tidymodels</code> website</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span>  <span class="er">~</span> gr_liv_area <span class="sc">+</span> lot_area <span class="sc">+</span> year_built <span class="sc">+</span> garage_cars <span class="sc">+</span> </span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>           ms_zoning <span class="sc">+</span> overall_qual, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(garage_cars) <span class="sc">|&gt;</span> </span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">ms_zoning =</span> <span class="fu">fct_collapse</span>(ms_zoning,</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"residential"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"res_high"</span>, <span class="st">"res_med"</span>, <span class="st">"res_low"</span>),</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"commercial"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"agri"</span>, <span class="st">"commer"</span>, <span class="st">"indus"</span>),</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"floating"</span> <span class="ot">=</span> <span class="st">"float"</span>),</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">overall_qual =</span> <span class="fu">as.numeric</span>(overall_qual)) <span class="sc">|&gt;</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(ms_zoning) <span class="sc">|&gt;</span> </span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="sc">~</span> overall_qual<span class="sc">:</span>year_built)</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Median imputation for: garage_cars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: fct_collapse(ms_zoning, residential = c("res_high",
  "res_med", "res_low"), commercial = c("agri", "commer", "indus"), floating =
  "float"), as.numeric(overall_qual)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: ms_zoning</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: overall_qual:year_built</code></pre>
</div>
</div>
<hr>
<p>Let’s prep, bake, fit, and evaluate!</p>
<ul>
<li>Note the new interaction term (we just skim <code>feat_trn</code> here)</li>
<li>Named using “<em>x</em>” to specify the interaction</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1506.84
</td>
<td style="text-align:right;">
511.44
</td>
<td style="text-align:right;">
438
</td>
<td style="text-align:right;">
1128
</td>
<td style="text-align:right;">
1450
</td>
<td style="text-align:right;">
1759
</td>
<td style="text-align:right;">
5642
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.19
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10144.16
</td>
<td style="text-align:right;">
8177.55
</td>
<td style="text-align:right;">
1476
</td>
<td style="text-align:right;">
7500
</td>
<td style="text-align:right;">
9375
</td>
<td style="text-align:right;">
11362
</td>
<td style="text-align:right;">
164660
</td>
<td style="text-align:right;">
11.20
</td>
<td style="text-align:right;">
182.91
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.35
</td>
<td style="text-align:right;">
29.65
</td>
<td style="text-align:right;">
1880
</td>
<td style="text-align:right;">
1953
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
-0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.78
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
overall_qual
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.08
</td>
<td style="text-align:right;">
1.41
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
-0.03
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789
</td>
<td style="text-align:right;">
129500
</td>
<td style="text-align:right;">
160000
</td>
<td style="text-align:right;">
213500
</td>
<td style="text-align:right;">
745000
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_floating
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.38
</td>
<td style="text-align:right;">
17.22
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_residential
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-3.86
</td>
<td style="text-align:right;">
12.90
</td>
</tr>
<tr>
<td style="text-align:left;">
overall_qual_x_year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12015.69
</td>
<td style="text-align:right;">
2907.93
</td>
<td style="text-align:right;">
1951
</td>
<td style="text-align:right;">
9800
</td>
<td style="text-align:right;">
11808
</td>
<td style="text-align:right;">
14021
</td>
<td style="text-align:right;">
20090
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
-0.11
</td>
</tr>
</tbody>

</table>
</div>
</div>
<ul>
<li>fix model</li>
<li>plot</li>
<li>calculate held out error</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>fit_lm_8 <span class="ot">&lt;-</span> </span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span>., </span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> feat_trn)</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_8, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(error_val, </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">tibble</span>(<span class="at">model =</span> </span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"8 feature linear model w/interaction"</span>, </span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price,</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>                                                 <span class="fu">predict</span>(fit_lm_8,</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>                                                         feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  model                                rmse_val
  &lt;chr&gt;                                   &lt;dbl&gt;
1 simple linear model                    51375.
2 4 feature linear model                 39903.
3 4 feature linear model with YJ         41660.
4 6 feature linear model w/ms_zoning     39846.
5 7 feature linear model                 34080.
6 8 feature linear model w/interaction   32720.</code></pre>
</div>
</div>
<ul>
<li>That helped!</li>
</ul>
<hr>
<p>You can also feature engineer interactions with categorical predictors</p>
<ul>
<li>The categorical predictors should first be converted to dummy code features</li>
<li>You will indicate the interactions using the variable names that will be assigned to these dummy code features</li>
<li>Use <code>starts_with()</code> or <code>matches()</code> to make it easy if there are many features associated with a categorical predictor</li>
<li>Can use “~ .^2” to include all two way interactions (be careful if you have dummy coded features!)</li>
</ul>
<p>Let’s code an interaction between <code>ms_zoning</code> &amp; <code>year_built</code>.</p>
<ul>
<li>Old homes are cool</li>
<li>Old commercial spaces are never cool</li>
<li>Maybe this is why the main effect of <code>ms_zoning</code> wasn’t useful</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span>  <span class="er">~</span> gr_liv_area <span class="sc">+</span> lot_area <span class="sc">+</span> year_built <span class="sc">+</span> garage_cars <span class="sc">+</span> </span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>           ms_zoning <span class="sc">+</span> overall_qual, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(garage_cars) <span class="sc">|&gt;</span> </span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">ms_zoning =</span> <span class="fu">fct_collapse</span>(ms_zoning,</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"residential"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"res_high"</span>, <span class="st">"res_med"</span>, <span class="st">"res_low"</span>),</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"commercial"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"agri"</span>, <span class="st">"commer"</span>, <span class="st">"indus"</span>),</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"floating"</span> <span class="ot">=</span> <span class="st">"float"</span>),</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">overall_qual =</span> <span class="fu">as.numeric</span>(overall_qual)) <span class="sc">|&gt;</span></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(ms_zoning) <span class="sc">|&gt;</span> </span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="sc">~</span> overall_qual<span class="sc">:</span>year_built) <span class="sc">|&gt;</span> </span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="sc">~</span> <span class="fu">starts_with</span>(<span class="st">"ms_zoning_"</span>)<span class="sc">:</span>year_built)  </span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a>rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Median imputation for: garage_cars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: fct_collapse(ms_zoning, residential = c("res_high",
  "res_med", "res_low"), commercial = c("agri", "commer", "indus"), floating =
  "float"), as.numeric(overall_qual)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: ms_zoning</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: overall_qual:year_built</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: starts_with("ms_zoning_"):year_built</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Yup, we have two new interaction features as expected</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1506.84
</td>
<td style="text-align:right;">
511.44
</td>
<td style="text-align:right;">
438
</td>
<td style="text-align:right;">
1128
</td>
<td style="text-align:right;">
1450
</td>
<td style="text-align:right;">
1759
</td>
<td style="text-align:right;">
5642
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.19
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10144.16
</td>
<td style="text-align:right;">
8177.55
</td>
<td style="text-align:right;">
1476
</td>
<td style="text-align:right;">
7500
</td>
<td style="text-align:right;">
9375
</td>
<td style="text-align:right;">
11362
</td>
<td style="text-align:right;">
164660
</td>
<td style="text-align:right;">
11.20
</td>
<td style="text-align:right;">
182.91
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1971.35
</td>
<td style="text-align:right;">
29.65
</td>
<td style="text-align:right;">
1880
</td>
<td style="text-align:right;">
1953
</td>
<td style="text-align:right;">
1972
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
-0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.78
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
overall_qual
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.08
</td>
<td style="text-align:right;">
1.41
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
-0.03
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789
</td>
<td style="text-align:right;">
129500
</td>
<td style="text-align:right;">
160000
</td>
<td style="text-align:right;">
213500
</td>
<td style="text-align:right;">
745000
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_floating
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.38
</td>
<td style="text-align:right;">
17.22
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_residential
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
0.23
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-3.86
</td>
<td style="text-align:right;">
12.90
</td>
</tr>
<tr>
<td style="text-align:left;">
overall_qual_x_year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12015.69
</td>
<td style="text-align:right;">
2907.93
</td>
<td style="text-align:right;">
1951
</td>
<td style="text-align:right;">
9800
</td>
<td style="text-align:right;">
11808
</td>
<td style="text-align:right;">
14021
</td>
<td style="text-align:right;">
20090
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
-0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_floating_x_year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
90.29
</td>
<td style="text-align:right;">
415.84
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2009
</td>
<td style="text-align:right;">
4.38
</td>
<td style="text-align:right;">
17.22
</td>
</tr>
<tr>
<td style="text-align:left;">
ms_zoning_residential_x_year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1860.03
</td>
<td style="text-align:right;">
453.95
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1948
</td>
<td style="text-align:right;">
1968
</td>
<td style="text-align:right;">
1997
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
-3.83
</td>
<td style="text-align:right;">
12.78
</td>
</tr>
</tbody>

</table>
</div>
</div>
<ul>
<li>Fit model</li>
<li>Plot</li>
<li>Quantify held out error</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>fit_lm_10 <span class="ot">&lt;-</span> </span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_10, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> error_val <span class="sc">|&gt;</span> </span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"10 feature linear model w/interactions"</span>, </span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price,</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">predict</span>(fit_lm_10,</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>                                               feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  model                                  rmse_val
  &lt;chr&gt;                                     &lt;dbl&gt;
1 simple linear model                      51375.
2 4 feature linear model                   39903.
3 4 feature linear model with YJ           41660.
4 6 feature linear model w/ms_zoning       39846.
5 7 feature linear model                   34080.
6 8 feature linear model w/interaction     32720.
7 10 feature linear model w/interactions   32708.</code></pre>
</div>
</div>
<ul>
<li>Not really any better</li>
<li>Shouldn’t just include all interactions without reason
<ul>
<li>Either you have done EDA to support them or</li>
<li>You have substantive interest in them (explanatory question)</li>
<li>If you want all interactions, use a statistical algorithm that supports those relationships without feature engineering (e.g., KNN, random forest and other decision trees)</li>
</ul></li>
</ul>
<hr>
</section>
<section id="non-linear-models" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="non-linear-models"><span class="header-section-number">3.6.2</span> Non-linear Models</h3>
<p>We may also want to model non-linear effects of our predictors</p>
<ul>
<li>Some non-parametric models can accommodate non-linear effects without feature engineering (e.g., KNN, Random Forest).</li>
<li>Non-linear effects can be accommodated in a linear model with feature engineering
<ul>
<li>Transformations of Y or X. See <a href="https://recipes.tidymodels.org/reference/index.html">Step Functions - Individual Transformations</a> on <code>tidymodels</code> website</li>
<li>Ordinal predictors can be coded with dummy variables</li>
<li>Quantitative variables can be split at threshold</li>
<li>Polynomial contrasts for quantitative or categorical predictors (see <code>step_poly()</code>)</li>
</ul></li>
<li>We will continue to explore these options throughout the course</li>
</ul>
<hr>
</section>
</section>
<section id="knn-regression" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="knn-regression"><span class="header-section-number">3.7</span> KNN Regression</h2>
<p>K Nearest Neighbor</p>
<ul>
<li>Is a non-parametric regression and classification statistical algorithm
<ul>
<li>It does not yield specific parameter estimates for features/predictors (or statistical tests for those parameter estimates)</li>
<li>There are still ways to use it to address explanatory questions (visualizations, model comparisons, feature importance)</li>
</ul></li>
<li>Very simple but also powerful (listed commonly among top 10 algorithms)
<ul>
<li>By powerful, it is quite flexible and can accommodate many varied DGPs without the need for much feature engineering with its predictors</li>
<li>May not need most transformations of X or Y</li>
<li>May not need to model interactions</li>
<li>Still need to handle missing data, outliers, and categorical predictors</li>
</ul></li>
<li>Algorithm “memorizes” the training set (<strong>lazy learning</strong>)
<ul>
<li>Lazy learning is most useful for large, continuously changing datasets with few attributes (features) that are commonly queried (e.g., online recommendation systems)</li>
</ul></li>
<li>Prediction for any new observation is based on <span class="math inline">\(k\)</span> most similar observations from the dataset
<ul>
<li><span class="math inline">\(k\)</span> provides direct control over the bias-variance trade-off for this algorithm</li>
</ul></li>
</ul>
<hr>
<p>To better understand KNN let’s simulate training data for three different DGPs (linear - y, polynomial - y2, and step - y3)</p>
<hr>
<p>Let’s start with a simple example where the DGP for Y is linear on one predictor (X)</p>
<p>This figure displays:</p>
<ul>
<li>DGP</li>
<li>Prediction line from a simple linear model</li>
<li>Red lines to represent three new observations (X = 10, 50, 90) we want to make predictions for via a standard KNN</li>
</ul>
<p>[What would 5-NN predictions look like for each of these three new values of X?].{red} <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>DGP: <span class="math inline">\(y = rnorm(150, x, 10)\)</span></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>KNN can easily accommodate non-linear relationships between numeric predictors and outcomes without any feature engineering for predictors</p>
<p>In fact, it can flexibly handle <strong>any</strong> shape of relationship</p>
<p>DGP: <span class="math inline">\(y2 = rnorm(150, x^4 / 800000, 8)\)</span></p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>DGP: <span class="math inline">\(y3 = if\_else(x &lt; 40, rnorm(150, 25, 10), rnorm(150, 75, 10))\)</span></p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_vline(xintercept = 90, color = "red", linewith = 1.5): Ignoring
unknown parameters: `linewith`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<section id="the-hyperparameter-k" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="the-hyperparameter-k"><span class="header-section-number">3.7.1</span> The hyperparameter k</h3>
<p>KNN is our first example of a statistical algorithm that includes a <strong>hyperparameter</strong>, in this case <span class="math inline">\(k\)</span></p>
<ul>
<li><p>Algorithm hyperparameters differ from parameters in that they cannot be estimated while fitting the algorithm to the training set</p></li>
<li><p>They must be set in advance</p></li>
<li><p><code>k = 5</code> is the default for <code>kknn()</code>, the engine from the <code>kknn</code> package that we will use to fit a KNN within <code>tidymodels</code>.</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/kknn/kknn.pdf"><span class="math inline">\(kknn()\)</span></a> weights observations (neighbors) based on distance.<br>
</li>
<li>An option exists for unweighted as well but not likely used much (default is optimal weighting, use it!).</li>
</ul></li>
</ul>
<hr>
<p>Using the polynomial DGP above, let’s look at a 5-NN yields</p>
<ul>
<li>Note the new category of algorithm, new engine, and the need to set a mode (because KNN can be used for regression and classification)</li>
<li>We can look in the package documentation to better understand what is being done (<code>?kknn::train.kknn</code>).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nearest_neighbor</span>() <span class="sc">|&gt;</span>   </span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>K-Nearest Neighbor Model Specification (regression)

Computational engine: kknn 

Model fit template:
kknn::train.kknn(formula = missing_arg(), data = missing_arg(), 
    ks = min_rows(5, data, 5))</code></pre>
</div>
</div>
<p>Set up simple feature engineering recipe and get training features (nothing happening but let’s follow normal routine anyway)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(y2 <span class="sc">~</span> x, <span class="at">data =</span> data_trn_demo)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn_demo)</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>feat_trn_demo <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn_demo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Fit 5NN</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>fit_5nn_demo <span class="ot">&lt;-</span> </span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>() <span class="sc">|&gt;</span>   </span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y2 <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_demo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Get a validation set (a new sample using same polynomial DGP)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>data_val_demo <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">200</span>, <span class="dv">1</span>, <span class="dv">100</span>),</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, x, <span class="dv">10</span>),</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">y_dgp =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, x ,<span class="dv">0</span>),</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">y2 =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, x<span class="sc">^</span><span class="dv">4</span> <span class="sc">/</span> <span class="dv">800000</span>, <span class="dv">8</span>),</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">y2_dgp =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, x<span class="sc">^</span><span class="dv">4</span> <span class="sc">/</span> <span class="dv">800000</span> ,<span class="dv">0</span>),</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">y3 =</span> <span class="fu">if_else</span>(x <span class="sc">&lt;</span> <span class="dv">40</span>, <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="dv">25</span>, <span class="dv">10</span>),  <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="dv">75</span>, <span class="dv">10</span>)),</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">y3_dgp =</span> <span class="fu">if_else</span>(x <span class="sc">&lt;</span> <span class="dv">40</span>, <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="dv">25</span>, <span class="dv">0</span>),  <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="dv">75</span>, <span class="dv">0</span>)))</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>feat_val_demo <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val_demo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Display 5NN predictions in validation</p>
<ul>
<li>KNN (with <code>k = 5</code>) does a pretty good job of representing the shape of the DGP (low bias)</li>
<li>KNN displays some (but minimal) evidence of overfitting</li>
<li>Simple linear model does not perform well (clear/high bias)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>feat_val_demo <span class="sc">|&gt;</span> </span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_val_demo <span class="sc">|&gt;</span> <span class="fu">select</span>(y, y2_dgp)) <span class="sc">|&gt;</span> <span class="co"># add in other outcomes from data</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y2)) <span class="sc">+</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y2_dgp, <span class="at">color =</span> <span class="st">"blue"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"green"</span>), <span class="at">method =</span> <span class="st">'lm'</span>, <span class="at">formula =</span> y <span class="sc">~</span> x,  <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(fit_5nn_demo, feat_val_demo)<span class="sc">$</span>.pred, <span class="at">color =</span> <span class="st">"red"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y2), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(<span class="at">name =</span> <span class="st">"Model"</span>,</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>),</span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"DGP"</span>, <span class="st">"linear model"</span>, <span class="st">"k = 5"</span>),</span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">guide =</span> <span class="st">"legend"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Let’s pause and consider our conceptual understanding of the impact of <span class="math inline">\(k\)</span> on the bias-variance trade-off</p>
<p>[How will the size of <span class="math inline">\(k\)</span> influence model performance (e.g., bias, overfitting/variance)?].{red} <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>[How will k = 1 perform in training and validation sets?].{red} <a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<hr>
<p><code>k = 1</code></p>
<p>Fit new model</p>
<p>Recipe and features have not changed</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-105"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-105-1"><a href="#annotated-cell-105-1" aria-hidden="true" tabindex="-1"></a>fit_1nn_demo <span class="ot">&lt;-</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-105" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-105-2" class="code-annotation-target"><a href="#annotated-cell-105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-105-3"><a href="#annotated-cell-105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="annotated-cell-105-4"><a href="#annotated-cell-105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-105-5"><a href="#annotated-cell-105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y2 <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_demo)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-105" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-105" data-code-annotation="1" data-code-lines="2">Set k with <code>neighbors =</code></span>
</dd>
</dl>
</div>
</div>
<hr>
<p>Visualize prediction models in Train and Validation</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Calculate RMSE in validation for two KNN models</p>
<p><code>k = 1</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val_demo<span class="sc">$</span>y2, </span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_1nn_demo, feat_val_demo)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.91586</code></pre>
</div>
</div>
<p><code>k = 5</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val_demo<span class="sc">$</span>y2, </span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_5nn_demo, feat_val_demo)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.387035</code></pre>
</div>
</div>
<hr>
<p>What if we go the other way and increase <span class="math inline">\(k\)</span> to 75</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>fit_75nn_demo <span class="ot">&lt;-</span> </span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">75</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y2 <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_demo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Visualize prediction models in Train and Validation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: false</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>plot_train <span class="ot">&lt;-</span> feat_trn_demo <span class="sc">|&gt;</span> </span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_trn_demo <span class="sc">|&gt;</span> <span class="fu">select</span>(y, y2_dgp)) <span class="sc">|&gt;</span> <span class="co"># add in other outcomes for fig</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y2)) <span class="sc">+</span></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y2_dgp, <span class="at">color =</span> <span class="st">"blue"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(fit_5nn_demo, feat_trn_demo)<span class="sc">$</span>.pred, <span class="at">color =</span> <span class="st">"red"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(fit_1nn_demo, feat_trn_demo)<span class="sc">$</span>.pred, <span class="at">color =</span> <span class="st">"green"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(fit_75nn_demo, feat_trn_demo)<span class="sc">$</span>.pred, <span class="at">color =</span> <span class="st">"yellow"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y2), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_identity</span>(<span class="at">name =</span> <span class="st">"Model"</span>,</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span>),</span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"DGP"</span>, <span class="st">"k = 5"</span>, <span class="st">"k = 1"</span>, <span class="st">"k = 75"</span>),</span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">guide =</span> <span class="st">"legend"</span>)</span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a>plot_val <span class="ot">&lt;-</span> feat_val_demo <span class="sc">|&gt;</span> </span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_val_demo <span class="sc">|&gt;</span> <span class="fu">select</span>(y, y2_dgp)) <span class="sc">|&gt;</span> <span class="co"># add in other outcomes for fig</span></span>
<span id="cb222-17"><a href="#cb222-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y2)) <span class="sc">+</span></span>
<span id="cb222-18"><a href="#cb222-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y2_dgp, <span class="at">color =</span> <span class="st">"blue"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb222-19"><a href="#cb222-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(fit_5nn_demo, feat_val_demo)<span class="sc">$</span>.pred, <span class="at">color =</span> <span class="st">"red"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb222-20"><a href="#cb222-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(fit_1nn_demo, feat_val_demo)<span class="sc">$</span>.pred, <span class="at">color =</span> <span class="st">"green"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb222-21"><a href="#cb222-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(fit_75nn_demo, feat_val_demo)<span class="sc">$</span>.pred, <span class="at">color =</span> <span class="st">"yellow"</span>), <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb222-22"><a href="#cb222-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y2), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb222-23"><a href="#cb222-23" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_color_identity</span>(<span class="at">name =</span> <span class="st">"Model"</span>,</span>
<span id="cb222-24"><a href="#cb222-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span>),</span>
<span id="cb222-25"><a href="#cb222-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"DGP"</span>, <span class="st">"k = 5"</span>, <span class="st">"k = 1"</span>, <span class="st">"k = 75"</span>),</span>
<span id="cb222-26"><a href="#cb222-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">guide =</span> <span class="st">"legend"</span>)</span>
<span id="cb222-27"><a href="#cb222-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-28"><a href="#cb222-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_train, plot_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Training Set"</span>, <span class="st">"Validation Set"</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Calculate RMSE in validation for three KNN models</p>
<p><strong>This is the bias-variance trade-off in action</strong></p>
<p><code>k = 1</code></p>
<p>high variance</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val_demo<span class="sc">$</span>y2, </span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_1nn_demo, feat_val_demo)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.91586</code></pre>
</div>
</div>
<p><code>k = 5</code></p>
<p>just right (well better at least)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val_demo<span class="sc">$</span>y2, </span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_5nn_demo, feat_val_demo)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.387035</code></pre>
</div>
</div>
<p><code>k = 75</code></p>
<p>high bias</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val_demo<span class="sc">$</span>y2, </span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_75nn_demo, feat_val_demo)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.34998</code></pre>
</div>
</div>
<hr>
</section>
<section id="defining-nearest" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="defining-nearest"><span class="header-section-number">3.7.2</span> Defining “Nearest”</h3>
<p>To make a prediction for some new observation, we need to identify the observations from the training set that are nearest to it</p>
<ul>
<li><p>Need a distance measure to define “nearest”</p></li>
<li><p>There are a number of different distance measures available (e.g., Euclidean, Manhattan, Chebyshev, Cosine, Minkowski)</p></li>
<li><p>Euclidean is most commonly used in KNN</p></li>
<li><p>IMPORTANT: We care only about:</p>
<ul>
<li>Distance between a validation observation and all the training observations</li>
<li>Need to find the <span class="math inline">\(k\)</span> observations in training that are nearest to the validation observation (i.e., its neighbors)</li>
<li>Distance is defined based on these observations’ features, not their outcomes</li>
</ul></li>
</ul>
<hr>
<p>Euclidean distance between any two points is an n-dimensional extension of the Pythagorean formula (which applies explicitly with 2 features/2 dimensional space).</p>
<p><span class="math inline">\(C^2 = A^2 + B^2\)</span></p>
<p><span class="math inline">\(C = \sqrt{A^2 + B^2}\)</span></p>
<p>…where C is the distance between two points</p>
<hr>
<p>The Euclidean distance between 2 points (p and q) in two dimensions (2 predictors, x1 = A, x2 = B)</p>
<p><span class="math inline">\(Distance = \sqrt{A^2 + B^2}\)</span></p>
<p><span class="math inline">\(Distance = \sqrt{(q1 - p1)^2 + (q2 - p2)^2}\)</span></p>
<p><span class="math inline">\(Distance = \sqrt{(2 - 1)^2 + (5 - 2)^2}\)</span></p>
<p><span class="math inline">\(Distance = 3.2\)</span></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>One dimensional (one feature) is simply the subtraction of scores on that feature (x1) between p and q</p>
<p><span class="math inline">\(Distance = \sqrt{(q1 - p1)^2}\)</span></p>
<p><span class="math inline">\(Distance = \sqrt{(2 - 1)^2}\)</span></p>
<p><span class="math inline">\(Distance = 1\)</span></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>N-dimensional generalization for n features:</p>
<p><span class="math inline">\(Distance = \sqrt{(q1 - p1)^2 + (q2 - p2)^2 + ... + (qn - pn)^2}\)</span></p>
<hr>
<p>Manhattan distance is also referred to as city block distance</p>
<ul>
<li>Travel down the “A” street for 1 unit</li>
<li>Travel down the “B” street for 3 units</li>
<li>Total distance = 4 units</li>
</ul>
<p>For two features/dimensions</p>
<p><span class="math inline">\(Distance = |A + B|\)</span></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p><code>kknn()</code> uses Minkowski distance (see <a href="https://en.wikipedia.org/wiki/Minkowski_distance">Wikipedia</a> or <a href="https://www.mikulskibartosz.name/minkowski-distance-explained/">less mathematical description</a>)</p>
<ul>
<li>It is a more complex parameterized distance formula
<ul>
<li>This parameter is called <code>p</code>, referred to as <code>distance</code> in <code>kknn()</code></li>
</ul></li>
<li>Euclidean and Manhattan distances are special cases where <code>p</code> = 2 and 1, respectively</li>
<li><strong>The default p in kknn() = 2 (Euclidean distance)</strong><br>
</li>
<li>This default (like all defaults) can be changed when you define the algorithm using <code>nearest_neighbor()</code></li>
</ul>
</section>
<section id="scaling-x" class="level3" data-number="3.7.3">
<h3 data-number="3.7.3" class="anchored" data-anchor-id="scaling-x"><span class="header-section-number">3.7.3</span> Scaling X</h3>
<p>Distance is dependent on scales of all the features. We need to put all features on the same scale</p>
<ul>
<li>Scale all features to SD = 1 (using <code>step_scale(all_numeric_predictors())</code>)</li>
<li>Range correct [0, 1] all features (using <code>step_range(all_numeric_predictors())</code>)</li>
</ul>
</section>
<section id="categorical-predictors" class="level3" data-number="3.7.4">
<h3 data-number="3.7.4" class="anchored" data-anchor-id="categorical-predictors"><span class="header-section-number">3.7.4</span> Categorical Predictors</h3>
<p>KNN requires numeric features (for distance calculation).</p>
<ul>
<li>For categorical predictors, you will need to use dummy coding or other feature engineering that results in numeric features.</li>
<li>e.g., <code>step_dummy(all_factor_predictors())</code></li>
</ul>
<hr>
</section>
<section id="knn-with-ames-housing-prices" class="level3" data-number="3.7.5">
<h3 data-number="3.7.5" class="anchored" data-anchor-id="knn-with-ames-housing-prices"><span class="header-section-number">3.7.5</span> KNN with Ames Housing Prices</h3>
<p>Let’s use KNN with Ames</p>
<ul>
<li>Train a model using only numeric predictors and <code>overall_qual</code> as numeric</li>
<li>Use the default <code>k = 5</code> algorithm</li>
<li>range correct all features</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-113"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-113-1"><a href="#annotated-cell-113-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-113-2"><a href="#annotated-cell-113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span> gr_liv_area <span class="sc">+</span> lot_area <span class="sc">+</span> year_built <span class="sc">+</span> garage_cars <span class="sc">+</span> overall_qual, </span>
<span id="annotated-cell-113-3"><a href="#annotated-cell-113-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-113-4"><a href="#annotated-cell-113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(garage_cars) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-113-5"><a href="#annotated-cell-113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">overall_qual =</span> <span class="fu">as.numeric</span>(overall_qual)) <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-113" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-113-6" class="code-annotation-target"><a href="#annotated-cell-113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="annotated-cell-113-7"><a href="#annotated-cell-113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-113-8"><a href="#annotated-cell-113-8" aria-hidden="true" tabindex="-1"></a>rec</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-113" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-113" data-code-annotation="1" data-code-lines="6">Remember to take advantage of these selectors for easier code! See <code>?has_role</code> for more details</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Median imputation for: garage_cars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: as.numeric(overall_qual)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Scaling for: all_numeric_predictors()</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(feat_trn)</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Skim training features. Note all SD = 1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_trn
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1465
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.95
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
2.21
</td>
<td style="text-align:right;">
2.84e+00
</td>
<td style="text-align:right;">
3.44
</td>
<td style="text-align:right;">
11.03
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.19
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.24
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
1.15e+00
</td>
<td style="text-align:right;">
1.39
</td>
<td style="text-align:right;">
20.14
</td>
<td style="text-align:right;">
11.20
</td>
<td style="text-align:right;">
182.91
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
66.48
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
63.40
</td>
<td style="text-align:right;">
65.86
</td>
<td style="text-align:right;">
6.65e+01
</td>
<td style="text-align:right;">
67.45
</td>
<td style="text-align:right;">
67.79
</td>
<td style="text-align:right;">
-0.54
</td>
<td style="text-align:right;">
-0.62
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.33
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.31
</td>
<td style="text-align:right;">
2.62e+00
</td>
<td style="text-align:right;">
2.62
</td>
<td style="text-align:right;">
5.23
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
overall_qual
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.30
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
3.54
</td>
<td style="text-align:right;">
4.24e+00
</td>
<td style="text-align:right;">
4.95
</td>
<td style="text-align:right;">
7.07
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
-0.03
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
180696.15
</td>
<td style="text-align:right;">
78836.41
</td>
<td style="text-align:right;">
12789.00
</td>
<td style="text-align:right;">
129500.00
</td>
<td style="text-align:right;">
1.60e+05
</td>
<td style="text-align:right;">
213500.00
</td>
<td style="text-align:right;">
745000.00
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
4.60
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>Skim validation features. Note SD. [Why not exactly 1?].{red}</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>feat_val <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
feat_val
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
490
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>

</table>
<p><strong>Variable type: numeric</strong></p>

<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:right;">
skew
</th>
<th style="text-align:right;">
kurtosis
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gr_liv_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.92
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
2.24
</td>
<td style="text-align:right;">
2.81
</td>
<td style="text-align:right;">
3.38
</td>
<td style="text-align:right;">
7.05
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
1.16
</td>
</tr>
<tr>
<td style="text-align:left;">
lot_area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.28
</td>
<td style="text-align:right;">
1.27
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
1.44
</td>
<td style="text-align:right;">
26.32
</td>
<td style="text-align:right;">
15.64
</td>
<td style="text-align:right;">
301.66
</td>
</tr>
<tr>
<td style="text-align:left;">
year_built
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
66.47
</td>
<td style="text-align:right;">
1.04
</td>
<td style="text-align:right;">
63.23
</td>
<td style="text-align:right;">
65.90
</td>
<td style="text-align:right;">
66.61
</td>
<td style="text-align:right;">
67.45
</td>
<td style="text-align:right;">
67.79
</td>
<td style="text-align:right;">
-0.66
</td>
<td style="text-align:right;">
-0.41
</td>
</tr>
<tr>
<td style="text-align:left;">
garage_cars
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.27
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.31
</td>
<td style="text-align:right;">
2.62
</td>
<td style="text-align:right;">
2.62
</td>
<td style="text-align:right;">
5.23
</td>
<td style="text-align:right;">
-0.24
</td>
<td style="text-align:right;">
0.22
</td>
</tr>
<tr>
<td style="text-align:left;">
overall_qual
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.28
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
3.54
</td>
<td style="text-align:right;">
4.24
</td>
<td style="text-align:right;">
4.95
</td>
<td style="text-align:right;">
7.07
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.35
</td>
</tr>
<tr>
<td style="text-align:left;">
sale_price
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
178512.82
</td>
<td style="text-align:right;">
75493.59
</td>
<td style="text-align:right;">
35311.00
</td>
<td style="text-align:right;">
129125.00
</td>
<td style="text-align:right;">
160000.00
</td>
<td style="text-align:right;">
213000.00
</td>
<td style="text-align:right;">
556581.00
</td>
<td style="text-align:right;">
1.42
</td>
<td style="text-align:right;">
2.97
</td>
</tr>
</tbody>

</table>
</div>
</div>
<hr>
<p>Fit 5NN</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>fit_5nn_5num <span class="ot">&lt;-</span> </span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>() <span class="sc">|&gt;</span>   </span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(error_val, </span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"5 numeric predictor 5nn"</span>, </span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, <span class="fu">predict</span>(fit_5nn_5num, feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
  model                                  rmse_val
  &lt;chr&gt;                                     &lt;dbl&gt;
1 simple linear model                      51375.
2 4 feature linear model                   39903.
3 4 feature linear model with YJ           41660.
4 6 feature linear model w/ms_zoning       39846.
5 7 feature linear model                   34080.
6 8 feature linear model w/interaction     32720.
7 10 feature linear model w/interactions   32708.
8 5 numeric predictor 5nn                  32837.</code></pre>
</div>
</div>
<ul>
<li>Not bad!</li>
</ul>
<hr>
<p>KNN also mostly solved the linearity problem</p>
<ul>
<li>We might be able to improve the linear models with better transformations of X and Y</li>
<li>However, this wasn’t needed for KNN!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_truth</span>(<span class="at">truth =</span> feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate =</span> <span class="fu">predict</span>(fit_5nn_5num, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/u3-knn-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>But 5NN may be overfit. <code>k = 5</code> is pretty low</p>
<p>Again with <code>k = 20</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>fit_20nn_5num <span class="ot">&lt;-</span> </span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> error_val <span class="sc">|&gt;</span> </span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"5 numeric predictor 20nn"</span>, </span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">predict</span>(fit_20nn_5num, </span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>                                               feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  model                                  rmse_val
  &lt;chr&gt;                                     &lt;dbl&gt;
1 simple linear model                      51375.
2 4 feature linear model                   39903.
3 4 feature linear model with YJ           41660.
4 6 feature linear model w/ms_zoning       39846.
5 7 feature linear model                   34080.
6 8 feature linear model w/interaction     32720.
7 10 feature linear model w/interactions   32708.
8 5 numeric predictor 5nn                  32837.
9 5 numeric predictor 20nn                 30535.</code></pre>
</div>
</div>
<ul>
<li>That helped some</li>
</ul>
<hr>
<p>One more time with <code>k = 50</code> to see where we are in the bias-variance function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>fit_50nn_5num <span class="ot">&lt;-</span> </span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> error_val <span class="sc">|&gt;</span> </span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"5 numeric predictor 50nn"</span>, </span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">predict</span>(fit_50nn_5num, </span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>                                               feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   model                                  rmse_val
   &lt;chr&gt;                                     &lt;dbl&gt;
 1 simple linear model                      51375.
 2 4 feature linear model                   39903.
 3 4 feature linear model with YJ           41660.
 4 6 feature linear model w/ms_zoning       39846.
 5 7 feature linear model                   34080.
 6 8 feature linear model w/interaction     32720.
 7 10 feature linear model w/interactions   32708.
 8 5 numeric predictor 5nn                  32837.
 9 5 numeric predictor 20nn                 30535.
10 5 numeric predictor 50nn                 31055.</code></pre>
</div>
</div>
<ul>
<li>Too high, now we have bias……</li>
<li>We will learn a more rigorous method for selecting the optimal value for <span class="math inline">\(k\)</span> (i.e., <strong>tuning</strong> this hyperparameter) in unit 5</li>
</ul>
<hr>
<p>To better understand bias-variance trade-off, let’s look at error across these three values of <span class="math inline">\(k\)</span> in train and validation for Ames</p>
<p>Training</p>
<ul>
<li>Remember that training error would be 0 for <code>k = 1</code></li>
<li>Training error is increasing as <span class="math inline">\(k\)</span> increases b/c it KNN is overfitting less (so its not fitting the noise in train as well)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_trn<span class="sc">$</span>sale_price, </span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_5nn_5num, feat_trn)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19012.94</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_trn<span class="sc">$</span>sale_price, </span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_20nn_5num, feat_trn)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27662.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_trn<span class="sc">$</span>sale_price, </span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_50nn_5num, feat_trn)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31069.12</code></pre>
</div>
</div>
<p>Validation</p>
<ul>
<li>Validation error is first going down as <span class="math inline">\(k\)</span> increases (and it would have been very high for <code>k = 1</code>)</li>
<li>Bias is likely increasing a bit</li>
<li>But this is compensated by big decreases in overfitting variance</li>
<li>The trade-off is good for <code>k = 20</code> relative to 5 and 1</li>
<li>At some point, as <span class="math inline">\(k\)</span> increases the increase in bias outweighed the decrease in variance and validation error increased too.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_5nn_5num, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32837.37</code></pre>
</div>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_20nn_5num, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30535.04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(fit_50nn_5num, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31054.6</code></pre>
</div>
</div>
<hr>
<p>Let’s do one final example and add one of our unordered categorical variables into the model: <code>ms_zoning</code></p>
<ul>
<li>Need to collapse levels and then dummy</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> </span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sale_price <span class="sc">~</span> gr_liv_area <span class="sc">+</span> lot_area <span class="sc">+</span> year_built <span class="sc">+</span> garage_cars <span class="sc">+</span> </span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>           overall_qual <span class="sc">+</span> ms_zoning, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(garage_cars) <span class="sc">|&gt;</span> </span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">overall_qual =</span> <span class="fu">as.numeric</span>(overall_qual)) <span class="sc">|&gt;</span> </span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">ms_zoning =</span> <span class="fu">fct_collapse</span>(ms_zoning,</span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"residential"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"res_high"</span>, <span class="st">"res_med"</span>, <span class="st">"res_low"</span>),</span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"commercial"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"agri"</span>, <span class="st">"commer"</span>, <span class="st">"indus"</span>),</span>
<span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"floating"</span> <span class="ot">=</span> <span class="st">"float"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb265-10"><a href="#cb265-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(ms_zoning) <span class="sc">|&gt;</span> </span>
<span id="cb265-11"><a href="#cb265-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb265-12"><a href="#cb265-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-13"><a href="#cb265-13" aria-hidden="true" tabindex="-1"></a>rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Median imputation for: garage_cars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: as.numeric(overall_qual)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: fct_collapse(ms_zoning, residential = c("res_high",
  "res_med", "res_low"), commercial = c("agri", "commer", "indus"), floating =
  "float")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: ms_zoning</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Scaling for: all_numeric_predictors()</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Fit and evaluate</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>fit_20nn_5num_mszone <span class="ot">&lt;-</span> </span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sale_price <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>error_val <span class="ot">&lt;-</span> error_val <span class="sc">|&gt;</span> </span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"5 numeric predictor 20nn with ms_zoning"</span>, </span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_val =</span> <span class="fu">rmse_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">predict</span>(fit_20nn_5num_mszone, </span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>                                               feat_val)<span class="sc">$</span>.pred)))</span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a>error_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   model                                   rmse_val
   &lt;chr&gt;                                      &lt;dbl&gt;
 1 simple linear model                       51375.
 2 4 feature linear model                    39903.
 3 4 feature linear model with YJ            41660.
 4 6 feature linear model w/ms_zoning        39846.
 5 7 feature linear model                    34080.
 6 8 feature linear model w/interaction      32720.
 7 10 feature linear model w/interactions    32708.
 8 5 numeric predictor 5nn                   32837.
 9 5 numeric predictor 20nn                  30535.
10 5 numeric predictor 50nn                  31055.
11 5 numeric predictor 20nn with ms_zoning   30172.</code></pre>
</div>
</div>
<ul>
<li>Now it helps.<br>
</li>
<li>Might have to do with interactions with other predictors that we didn’t model in the linear model</li>
<li>KNN automatically accommodates interactions. Why?</li>
<li>This model is a bit more complex and might benefit further from higher <span class="math inline">\(k\)</span></li>
</ul>
<p>As a teaser, here is another performance metric for this model - <span class="math inline">\(R^2\)</span>. Not too shabby! Remember, there is certainly some irreducible error in <code>sale_price</code> that will put a ceiling on <span class="math inline">\(R^2\)</span> and a floor on RMSE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsq_vec</span>(feat_val<span class="sc">$</span>sale_price, </span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">predict</span>(fit_20nn_5num_mszone, feat_val)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8404044</code></pre>
</div>
</div>
<p>Overall, we now have a model that predicts housing prices with about 30K of RMSE and accounting for 84% of the variance. I am sure you can improve on this!</p>
</section>
</section>
<section id="discussion" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="discussion"><span class="header-section-number">3.8</span> Discussion</h2>
<ol start="0" type="1">
<li>Announcements</li>
</ol>
<ul>
<li>Bug in print method for recipes
<ul>
<li>For <a href="https://github.com/tidymodels/recipes/issues/1083">bug report</a> with (long) reprex:</li>
<li>For now use: <code>remotes::install_github("tidymodels/recipes#1084")</code></li>
</ul></li>
<li>Reprex
<ul>
<li>Read <a href="http://dionysus.psych.wisc.edu/iaml/appendix_3.html">new appendix</a></li>
<li>We now expect reprex for help on application assignments</li>
<li>Will review in lab next week</li>
</ul></li>
<li>Homework is basically same for unit 4
<ul>
<li>New dataset - titanic</li>
<li>Do EDA but we don’t need to see it</li>
<li>Fit KNN and RDA models (will learn about LDA, QDA and RDA in unit)</li>
<li>Submit predictions. Free lunch!</li>
<li>Will know about first free lunch by next Thursday</li>
</ul></li>
<li>Course feedback in quiz as trial</li>
</ul>
<ol type="1">
<li>Questions</li>
</ol>
<ul>
<li>What are two broad sources of error?</li>
<li>What are two broad sources of reducible error?</li>
<li>Why do we need independent validation data to select the best model configuration?</li>
<li>What factors make the need for a validation set even greater?</li>
<li>What is RMSE? Connect it to metric you already know? How is it being used in lm (two ways)?; in knn (one way)?</li>
<li>How does bias and variance manifest when you look at your performance metric (RMSE) in training and validation sets?</li>
<li>Will the addition of new predictors/features to a (lm?) model always reduce RMSE in train? in validation? Connect to concepts of bias and variance</li>
</ul>
<ol type="1">
<li>k</li>
</ol>
<ul>
<li>What is it and how does it get used when making predictions?</li>
<li>What is the impact of k on bias and variance/overfitting?</li>
<li>k=1 - performance in train? in val?</li>
</ul>
<ol start="2" type="1">
<li>Interaction in KNN - Consider bias first (but also variance) in this example</li>
</ol>
<ul>
<li>Simulate data</li>
<li>Fit models for lm and knn with and without interaction</li>
<li>Took some shortcuts (no recipe, predict back into train)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5433</span>)</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate data as linear model</span></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x1 =</span> <span class="fu">runif</span>(n, <span class="dv">0</span>,<span class="dv">100</span>), <span class="co"># uniform</span></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">x2 =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), n<span class="sc">/</span><span class="dv">2</span>), <span class="co"># dichotomous</span></span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">x1_x2 =</span> x1<span class="sc">*</span>x2, <span class="co"># interaction</span></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">*</span>x1 <span class="sc">+</span> <span class="dv">10</span><span class="sc">*</span>x2 <span class="sc">+</span> <span class="dv">10</span><span class="sc">*</span> x1_x2, <span class="dv">20</span>)) <span class="co">#DGP + noise</span></span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> </span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span>   </span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb285-12"><a href="#cb285-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> data)</span>
<span id="cb285-13"><a href="#cb285-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-14"><a href="#cb285-14" aria-hidden="true" tabindex="-1"></a>fit_lm_int <span class="ot">&lt;-</span> </span>
<span id="cb285-15"><a href="#cb285-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span>   </span>
<span id="cb285-16"><a href="#cb285-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb285-17"><a href="#cb285-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x1_x2, <span class="at">data =</span> data)</span>
<span id="cb285-18"><a href="#cb285-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-19"><a href="#cb285-19" aria-hidden="true" tabindex="-1"></a>fit_knn <span class="ot">&lt;-</span> </span>
<span id="cb285-20"><a href="#cb285-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb285-21"><a href="#cb285-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb285-22"><a href="#cb285-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb285-23"><a href="#cb285-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> data)</span>
<span id="cb285-24"><a href="#cb285-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-25"><a href="#cb285-25" aria-hidden="true" tabindex="-1"></a>fit_knn_int <span class="ot">&lt;-</span> </span>
<span id="cb285-26"><a href="#cb285-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb285-27"><a href="#cb285-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb285-28"><a href="#cb285-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb285-29"><a href="#cb285-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x1_x2, <span class="at">data =</span> data)</span>
<span id="cb285-30"><a href="#cb285-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-31"><a href="#cb285-31" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb285-32"><a href="#cb285-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_lm =</span> <span class="fu">predict</span>(fit_lm, data)<span class="sc">$</span>.pred,</span>
<span id="cb285-33"><a href="#cb285-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_lm_int =</span> <span class="fu">predict</span>(fit_lm_int, data)<span class="sc">$</span>.pred,</span>
<span id="cb285-34"><a href="#cb285-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_knn =</span> <span class="fu">predict</span>(fit_knn, data)<span class="sc">$</span>.pred,</span>
<span id="cb285-35"><a href="#cb285-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">pred_knn_int =</span> <span class="fu">predict</span>(fit_knn_int, data)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Predictions from linear model with and without interaction</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">group =</span> <span class="fu">factor</span>(x2), <span class="at">color =</span> <span class="fu">factor</span>(x2))) <span class="sc">+</span></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_lm)) <span class="sc">+</span></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"lm without interaction"</span>) <span class="sc">+</span></span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"x2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">group =</span> <span class="fu">factor</span>(x2), <span class="at">color =</span> <span class="fu">factor</span>(x2))) <span class="sc">+</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_lm_int)) <span class="sc">+</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"lm with interaction"</span>) <span class="sc">+</span></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"x2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-40-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Predictions from linear model with and without interaction</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">group =</span> <span class="fu">factor</span>(x2), <span class="at">color =</span> <span class="fu">factor</span>(x2))) <span class="sc">+</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_knn)) <span class="sc">+</span></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"KNN without interaction"</span>) <span class="sc">+</span></span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"x2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">group =</span> <span class="fu">factor</span>(x2), <span class="at">color =</span> <span class="fu">factor</span>(x2))) <span class="sc">+</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_knn_int)) <span class="sc">+</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"KNN with interaction"</span>) <span class="sc">+</span></span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"x2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="003_regression_files/figure-html/unnamed-chunk-41-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>What are implications of this for when to use flexible algorithm like knn vs.&nbsp;lm?
<ul>
<li>if data are high dimensional?</li>
<li>routine use?</li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>Transformations of numeric predictors</li>
</ol>
<ul>
<li><p>Use of <code>plot_truth()</code> [predicted vs.&nbsp;observed]</p></li>
<li><p>Residuals do not have mean of 0 for every <span class="math inline">\(\hat{y}\)</span></p>
<ul>
<li>Consequence: biased parameter estimates. Linear is bad DGP</li>
<li>Also bad test of questions RE the predictor (underestimate? misinform)</li>
</ul></li>
<li><p>Non-normal residuals</p>
<ul>
<li>Consequence: lm parameter estimates still unbiased (for linear DGP) but more “efficient” solutions exist</li>
<li>Bad for prediction b/c higher variance than other solutions</li>
<li>May suggest omission of variables</li>
</ul></li>
<li><p>Heteroscasticity</p>
<ul>
<li>Consequence: Inefficient and inaccurate standard errors.</li>
<li>Statistical tests wrong</li>
<li>Poor prediction for some (where larger variance of resituals) <span class="math inline">\(\hat{y}\)</span></li>
<li>higher variance overall than other solutions - bad again for prediction</li>
</ul></li>
<li><p>Transformation of outcome?</p>
<ul>
<li>metric</li>
<li>back to raw predictions</li>
</ul></li>
</ul>
<ol start="4" type="1">
<li>KNN (black box) for explanatory purposes</li>
</ol>
<ul>
<li>Visualizations (think of interaction plot above) make clear the effect</li>
<li>Will learn more (better visualizations, variable importance, model comparisons) in later unit</li>
</ul>
<ol start="5" type="1">
<li>Exploration</li>
</ol>
<ul>
<li>“I feel that I can come up with models that decrease the RMSE, but I don’t have good priors on whether adding any particular variable or observation will result in an improved model. I still feel a little weird just adding and dropping variables into a KNN and seeing what gets the validation RMSE the lowest (even though because we’re using validation techniques it’s a fine technique)”
<ul>
<li>Exploration is learning. This is research. If you knew the answer you wouldn’t be doing the study</li>
<li>Domain knowledge is still VERY important</li>
<li>Some algorithms (LASSO, glmnet) will help with feature selection</li>
<li>staying organized
<ul>
<li>Script structure</li>
<li>Good documentation - RMD as analysis notebook</li>
</ul></li>
<li>Some overfitting to validation will occur? Consequence? Solutions?</li>
</ul></li>
</ul>
<ol start="6" type="1">
<li>LM vs.&nbsp;KNN better with predictors or overall</li>
</ol>
<ul>
<li>“Why do some features seem to improve performance more in linear models or only in KNNs?”</li>
<li>“What are some contexts where KNN doesn’t work well? In other words, what are the advantages/disadvantages of using KNN?”
<ul>
<li>Always comes down to bias vs.&nbsp;variance</li>
<li>Flexibility and N are key moderators of these two key factors.<br>
</li>
<li>k? - impact on bias, variance?</li>
</ul></li>
</ul>
<ol start="7" type="1">
<li><p>“In GLM, why correlation/collinearity among predictors will cause larger variance? Is it because of overfitting?”</p></li>
<li><p>“Curse of dimensionality” - Bias vs.&nbsp;variance</p></li>
</ol>
<ul>
<li>Missing features produce biased models.</li>
<li>Unnecessary features or even many features relative to N produce variance</li>
<li>Does your available N in your algorithm support the features you need to have low bias.
<ul>
<li>Mostly an empirical question - can’t really tell otherwise outside of simulated data. Validation set is critical!</li>
<li>Flexible models often need more N holding predictors constant</li>
<li>Regularization (unit 6) will work well when lots of predictors</li>
</ul></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-ISL" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2023. <em>An <span>Introduction</span> to <span>Statistical Learning</span>: With <span>Applications</span> in <span>R</span></em>. 2nd ed. Springer <span>Texts</span> in <span>Statistics</span>. <span>New York</span>: <span>Springer-Verlag</span>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>These models will all overfit the dataset within which they are fit to some degree (in other words, they will predict both systematic variance and some noise in the training set). However, they will differ in how much they overfit the training set. As the models get more flexible they will have the potential to overfit to a greater degree. Models with a larger number of features (e.g., more predictors, features based on interactions as well as raw predictors) will overfit to a greater degree. All other things equal, the non-parametric KNN will also be more flexible than the general linear model so it may overfit to a greater degree as well if the true DGP is linear on the features. Therefore, just because a model fits the training set well does not mean it will work well in new data because the noise will be different in every new dataset.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>“The multiple regression model coefficients represent unique effects, controlling for all other variables in the model. You can see how the unique effect of <code>gr_liv_area</code> is smaller than its overall effect from the simple regression. This also means that the overall predictive strength of the model won’t be a sum of the effects of each predictor considered in isolation - it will likely be less. Also, if the correlations are high, problems with multicollinearity will emerge. This will yield large standard errors which means that the models will start to have more variance when fit in different training datasets! We will soon learn about other regularized versions of the GLM that don’t have these issues with correlated predictors.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>There is no meaningful way to order the numbers that we assign to the levels of this unordered categorical predictor. The shape and strength of the relationship between it and <code>sale_price</code> will completely change based on arbitrary ordering of the levels.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>As you know, the estimation procedure in linear models is OLS. Parameter estimates are derived to minimize the SSE in the data set in which they are derived. For this reason, adding a predictor will never increase RMSE in the training set and it will usually lower it even when it is not part of the DGP. However, this is not true in validation. A predictor will only meaningfully lower RMSE in validation if it is part of the DGP. Also, a bad predictor could even increase RMSE in validation due to overfitting.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>For x = 10, find the five observations that have X values closest to 10. Average the Y values for those 5 observations and that is your prediction (<span class="math inline">\(\hat{Y}\)</span>) associated with that new value of X. Repeat to make predictions for <span class="math inline">\(\hat{Y}\)</span> for any other value of X, e.g., 50, 90, or any other value<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Smaller values of <span class="math inline">\(k\)</span> will tend to increase overfitting (and therefore variance across training samples) but decrease bias. Larger values of k will tend to decrease overfitting but increase bias. We need to find the Goldilocks “sweet spot”<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p><span class="math inline">\(k\)</span> = 1 will perfectly fit the training set. Therefore it is very dependent on the training set (high variance). It will fit both the DGP and the noise in the training set. Clearly it will likely not do as well in validation (it will be overfit to training). <span class="math inline">\(k\)</span> needs to be larger if there is more noise (to average over more cases). <span class="math inline">\(k\)</span> needs to be smaller if the relationships are complex. (More on choosing <span class="math inline">\(k\)</span> by resampling in unit 5.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./002_exploratory_data_analysis.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./004_classification.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>