<!DOCTYPE html>
<html lang="en"><head>
<script src="005_resampling_files/libs/clipboard/clipboard.min.js"></script>
<script src="005_resampling_files/libs/quarto-html/tabby.min.js"></script>
<script src="005_resampling_files/libs/quarto-html/popper.min.js"></script>
<script src="005_resampling_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="005_resampling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="005_resampling_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="005_resampling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.2.269">

  <title>resampling</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="005_resampling_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="005_resampling_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
  <link rel="stylesheet" href="005_resampling_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link rel="stylesheet" href="slides_wide.css">
  <link href="005_resampling_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="005_resampling_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="005_resampling_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="005_resampling_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="005_resampling_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="005_resampling_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  
  <script src="005_resampling_files/libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="005_resampling_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">


<section>
<section id="resampling-methods-for-model-selection-and-evaluation" class="title-slide slide level1 center">
<h1>Resampling Methods for Model Selection and Evaluation</h1>

</section>
<section id="overview-of-unit" class="slide level2">
<h2>Overview of Unit</h2>
<h3 id="learning-objectives">Learning Objectives</h3>
<ul>
<li>Bias vs.&nbsp;variance wrt model performance estimates
<ul>
<li>How is this different from bias vs.&nbsp;variable of model itself</li>
</ul></li>
<li>Methods for computationally intense calculations
<ul>
<li>Parallel processing</li>
<li>Cache</li>
</ul></li>
<li>Types of resampling
<ul>
<li>Validation set approach</li>
<li>Leave One Out CV</li>
<li>K-Fold and Repeated K-Fold</li>
<li>Grouped K-Fold</li>
<li>Bootstrap resampling</li>
</ul></li>
<li>Use of resampling for tuning hyperparameters<br>
</li>
<li>Combining these resampling approaches with a Test set
<ul>
<li>Used for simultaneous model selection and evaluation</li>
<li>Single independent test set</li>
<li>Advanced topic: Nested resampling</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="readings">Readings</h3>
<ul>
<li><p><span class="citation" data-cites="APM">Kuhn and Johnson (<a href="#/discussion" role="doc-biblioref" onclick="">2018</a>)</span> <a href="https://vuquangnguyen2016.files.wordpress.com/2018/03/applied-predictive-modeling-max-kuhn-kjell-johnson_1518.pdf">Chapter 4, pp 61 - 80</a></p></li>
<li><p><strong>Supplemental:</strong> <span class="citation" data-cites="ISL">James et al. (<a href="#/discussion" role="doc-biblioref" onclick="">2023</a>)</span> <a href="pdfs/isl_2.pdf">Chapter 5, pp 197 - 208 186</a></p></li>
</ul>
<h3 id="lecture-videos">Lecture Videos</h3>
<ul>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-1/1_sv29qmvz">Lecture 1: Overview &amp; Parallel Processing</a> ~ 16 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-2/1_pyr647gu">Lecture 2: Introduction to Resampling</a> ~ 11 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-3/1_21l94nvt">Lecture 3: Single Validation/Test Set Approach</a> ~ 26 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-4/1_uuaa5nj1">Lecture 4: Leave One Out Cross Validation</a> ~ 9 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-5/1_f60kfk66">Lecture 5: K-fold Cross Validation Approaches</a> ~ 21 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-6/1_a6yo0euq">Lecture 6: Repeated and Grouped K-fold Approaches</a> ~ 11 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-7/1_zijywf6b">Lecture 7: Bootstrap Resampling</a> ~ 11 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-8/1_0sxcqnj4">Lecture 8: Using Resampling to Select Best Model Configurations</a> ~ 17 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+5-9/1_b8abgszd">Lecture 9: Resampling for Both Model Selection and Evaluation</a> ~ 11 mins</li>
<li><a href="">Lecture 10: Nested Resampling</a></li>
</ul>
<p>Post questions or discuss readings or lectures on Slack</p>
</section>
<section class="slide level2">

<h3 id="application-assignment-and-quiz">Application Assignment and Quiz</h3>
<ul>
<li><a href="application_assignments/unit_05/smoking_ema.csv">data</a></li>
<li><a href="application_assignments/unit_05/data_dictionary.csv">data dictionary</a></li>
<li><a href="https://raw.githubusercontent.com/jjcurtin/book_iaml/main/application_assignments/unit_05/hw_unit_05_resampling.qmd">qmd shell</a></li>
<li><a href="">solution</a></li>
</ul>
<p>Post questions to application_assignments Slack channel</p>
<p>Submit the application assignment <a href="https://canvas.wisc.edu/courses/395546/assignments/2187690">here</a> and complete the <a href="https://canvas.wisc.edu/courses/395546/quizzes/514059">unit quiz</a> by 8 pm on Wednesday, February 21st</p>
</section>
<section id="some-technical-details-for-costly-computations" class="slide level2">
<h2>Some Technical Details for Costly Computations</h2>
<p>Before we dive into resampling, we need to introduce two coding techniques that can save us a lot of time when implementing resampling methods</p>
<ul>
<li>Parallel processing</li>
<li>Caching time-consuming computations</li>
</ul>
</section>
<section class="slide level2">

<h3 id="parallel-processing">Parallel Processing</h3>
<p>When using resampling, we often end up fitting many, many model configurations</p>
<ul>
<li>This can be the same model configuration in many different training sets</li>
<li>Or many different model configurations in many different training sets (even more computationally demanding)<br>
<br>
</li>
</ul>
<p>Critically</p>
<ul>
<li>The fitting process for each of these configurations is independent for the others</li>
<li>The order that the configurations are fit doesn’t matter either</li>
<li>When these two criteria are met, the processes can be run in parallel with an often big time savings</li>
</ul>
</section>
<section class="slide level2">

<p>To do this in R, we need to set up a parallel processing backend</p>
<ul>
<li>Lots of <a href="https://tune.tidymodels.org/articles/extras/optimizations.html">options and details</a> depending on the code you intend to run in parallel to do it really well</li>
<li>We can discuss some of these issues/details and other solutions (i.e., High Throughput Computing at CHTC)</li>
<li>Some options are OS specific</li>
<li>Provide more details <a href="https://jjcurtin.github.io/book_dwvt/parallel_processing.html">elsewhere</a></li>
</ul>
</section>
<section class="slide level2">

<p>TLDR - copy the following code chunk into your scripts after you load your other libraries (e.g., tidyverse and tidymodels)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>cl <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">makePSOCKcluster</span>(parallel<span class="sc">::</span><span class="fu">detectCores</span>(<span class="at">logical =</span> <span class="cn">FALSE</span>))</span>
<span id="cb1-2"><a href="#cb1-2"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(cl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<h3 id="using-cache">Using Cache</h3>
<p>Even with parallel processing, resampling procedures can STILL take a lot of time, particularly on notebook computers that don’t have a lot of cores available<br>
<br>
In these instances, you may also want to consider caching the result</p>
<ul>
<li>When you cache some set of calculations, you are essentially saving the results of the calculations</li>
<li>If you need to run the script again, you simply load the saved calculations again from disk, rather than re-calculating them (its much quicker to just read them from a file)<br>
<br>
</li>
</ul>
<p>But…</p>
<ul>
<li>You need to redo the calculations if you change anything in your script that could affect them</li>
<li>This is called “invalidating the cache”</li>
<li>You need to be very careful to reuse the cache when you can but also to invalidate it when the calculations have changed</li>
</ul>
</section>
<section class="slide level2">

<p>In other notes, we describe <a href="https://jjcurtin.github.io/book_dwvt/cache.html">three options</a> to cache calculations that are available in R.</p>
<ul>
<li>You should read more about those options if you plan to use one</li>
<li>Our preferred solution is to use <code>xfun::cache_rds()</code></li>
<li>Read the help for this function (<code>?xfun::cache_rds</code>) if you plan to use it</li>
<li>Cache is complicated and can lead to errors.<br>
</li>
<li>But cache can also save you a lot of time during development!</li>
</ul>
</section>
<section class="slide level2">

<p>Start by loading only that function for the <code>xfun</code> package. You can add this line of code after your other libraries (e.g., tidyverse, tidymodels)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(xfun, <span class="at">include.only =</span> <span class="st">"cache_rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>To use the function</p>
<ul>
<li>You will pass the code for the calculations you want to cache as the first argument (<code>expr</code>) to the function inside a set of curly brackets <code>{}</code></li>
<li>You need to list the path (<code>dir =</code>) and filename (<code>file =</code>) for the rds file that will save the cached calculations.
<ul>
<li>The <code>/</code> at the end of the path is needed.<br>
</li>
<li>You should use a meaningful (and distinct) filename.</li>
</ul></li>
<li>Provide <code>rerun = FALSE</code> as a third argument.
<ul>
<li>You can set this to true temporarily if you need to invalidate the cache to redo the calculations</li>
<li>We like to set it up as an environment variable (see <code>rerun_setting</code> below)</li>
<li>Keep it as FALSE during development</li>
<li>Set it to TRUE at the end of our development so that we make sure we didn’t make any cache invalidation errors</li>
</ul></li>
<li>You may also provide a list of globals to <code>hash =</code>. See more details at previous link</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">cache_rds</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="at">expr =</span> {</span>
<span id="cb3-3"><a href="#cb3-3"></a> },</span>
<span id="cb3-4"><a href="#cb3-4"></a> <span class="at">dir =</span> <span class="st">"cache/"</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a> <span class="at">file =</span> <span class="st">"filename"</span>, </span>
<span id="cb3-6"><a href="#cb3-6"></a> <span class="at">rerun =</span> rerun_setting </span>
<span id="cb3-7"><a href="#cb3-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br>
<br>
We will demonstrate the use of this function throughout the book. BUT you do not need to use it if you find it confusing.</p>
</section>
<section id="introduction-to-resampling" class="slide level2">
<h2>Introduction to Resampling</h2>
<p>We will use resampling for two goals:</p>
<ul>
<li>To <strong>select</strong> among model configurations based on relative performance estimates of these configurations in new data</li>
<li>To <strong>evaluate</strong> the performance of our best/final model configuration in new data</li>
</ul>
<p>For both of these goals we are using new data to <strong>estimate performance</strong> of model configuration(s)</p>
</section>
<section class="slide level2">

<p>There are two kinds of problems that can emerge from using a sub-optimal resampling approach</p>
<ul>
<li>We can get a <strong>biased estimate</strong> of model performance (i.e., we can systematically under or over-estimate its performance)</li>
<li>We can get an <strong>imprecise estimate</strong> of model performance (i.e., high variance in our model performance metric if it was repeatedly calculated in different samples of held-out data)</li>
</ul>
</section>
<section class="slide level2">

<p>Essentially, this is the bias and variance problem again, but now not with respect to the model’s actual performance but instead with <strong>our estimate of how the model will perform</strong></p>
<p>This is a very important distinction to keep in mind or you will be confused as we discuss bias and variance into the future. We have:</p>
<ul>
<li>bias and variance of model performance (i.e., the predictions the model makes)</li>
<li>bias and variance of our estimate of how well the model will perform in new data</li>
<li>different factors affect each</li>
</ul>
</section>
<section class="slide level2">

<p>Let’s get a dataset for this unit. We will use the <a href="https://archive.ics.uci.edu/ml/datasets/Heart+Disease">heart disease dataset</a> from the UCI Machine Learning Repository. We will focus on the Cleveland data subset, whose variable are defined in this <a href="data/cleveland_variables.pdf">data dictionary</a></p>
<p>These data are less well prepared</p>
<ul>
<li>No variable/column names exist</li>
<li>NA is coded with <code>?</code></li>
<li>Use <code>rename()</code> to add tidy variable names</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>data_all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"cleveland.csv"</span>), </span>
<span id="cb4-2"><a href="#cb4-2"></a>                     <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="co"># &lt;1&gt; </span></span>
<span id="cb4-3"><a href="#cb4-3"></a>                     <span class="at">na =</span> <span class="st">"?"</span>) <span class="sc">|&gt;</span> <span class="co"># &lt;2&gt; </span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">rename</span>(<span class="at">age =</span> X1,</span>
<span id="cb4-5"><a href="#cb4-5"></a>         <span class="at">sex =</span> X2,</span>
<span id="cb4-6"><a href="#cb4-6"></a>         <span class="at">cp =</span> X3,</span>
<span id="cb4-7"><a href="#cb4-7"></a>         <span class="at">rest_bp =</span> X4,</span>
<span id="cb4-8"><a href="#cb4-8"></a>         <span class="at">chol =</span> X5,</span>
<span id="cb4-9"><a href="#cb4-9"></a>         <span class="at">fbs =</span> X6,</span>
<span id="cb4-10"><a href="#cb4-10"></a>         <span class="at">rest_ecg =</span> X7,</span>
<span id="cb4-11"><a href="#cb4-11"></a>         <span class="at">max_hr =</span> X8,</span>
<span id="cb4-12"><a href="#cb4-12"></a>         <span class="at">exer_ang =</span> X9,</span>
<span id="cb4-13"><a href="#cb4-13"></a>         <span class="at">exer_st_depress =</span> X10,</span>
<span id="cb4-14"><a href="#cb4-14"></a>         <span class="at">exer_st_slope =</span> X11,</span>
<span id="cb4-15"><a href="#cb4-15"></a>         <span class="at">ca =</span> X12,</span>
<span id="cb4-16"><a href="#cb4-16"></a>         <span class="at">thal =</span> X13,</span>
<span id="cb4-17"><a href="#cb4-17"></a>         <span class="at">disease =</span> X14)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Indicating that column names are NOT on the first row. First row begins with data</li>
<li>Specifying a non-standard value for NA</li>
</ol>
</section>
<section class="slide level2">

<p>Code categorical variables as factors with meaningful text labels (and no spaces)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>data_all <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">mutate</span>(<span class="at">disease =</span> <span class="fu">factor</span>(disease, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb5-3"><a href="#cb5-3"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>, <span class="st">"yes"</span>, <span class="st">"yes"</span>, <span class="st">"yes"</span>)),</span>
<span id="cb5-4"><a href="#cb5-4"></a>         <span class="at">sex =</span> <span class="fu">factor</span>(sex,  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>)),</span>
<span id="cb5-5"><a href="#cb5-5"></a>         <span class="at">fbs =</span> <span class="fu">factor</span>(fbs, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>)),</span>
<span id="cb5-6"><a href="#cb5-6"></a>         <span class="at">exer_ang =</span> <span class="fu">factor</span>(exer_ang, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>)),</span>
<span id="cb5-7"><a href="#cb5-7"></a>         <span class="at">exer_st_slope =</span> <span class="fu">factor</span>(exer_st_slope, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, </span>
<span id="cb5-8"><a href="#cb5-8"></a>                                <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"upslope"</span>, <span class="st">"flat"</span>, <span class="st">"downslope"</span>)),</span>
<span id="cb5-9"><a href="#cb5-9"></a>         <span class="at">cp =</span> <span class="fu">factor</span>(cp, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb5-10"><a href="#cb5-10"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"typ_ang"</span>, <span class="st">"atyp_ang"</span>, <span class="st">"non_anginal"</span>, <span class="st">"non_anginal"</span>)),</span>
<span id="cb5-11"><a href="#cb5-11"></a>         <span class="at">rest_ecg =</span> <span class="fu">factor</span>(rest_ecg, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, </span>
<span id="cb5-12"><a href="#cb5-12"></a>                           <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"normal"</span>, <span class="st">"abnormal1"</span>, <span class="st">"abnormal2"</span>)),</span>
<span id="cb5-13"><a href="#cb5-13"></a>         <span class="at">rest_ecg =</span> <span class="fu">fct_collapse</span>(rest_ecg, </span>
<span id="cb5-14"><a href="#cb5-14"></a>                                <span class="at">abnormal =</span> <span class="fu">c</span>(<span class="st">"abnormal1"</span>, <span class="st">"abnormal2"</span>)),</span>
<span id="cb5-15"><a href="#cb5-15"></a>         <span class="at">thal =</span> <span class="fu">factor</span>(thal, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">7</span>), </span>
<span id="cb5-16"><a href="#cb5-16"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"normal"</span>, <span class="st">"fixeddefect"</span>, <span class="st">"reversabledefect"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb5-17"><a href="#cb5-17"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 303
Columns: 14
$ age             &lt;dbl&gt; 63, 67, 67, 37, 41, 56, 62, 57, 63, 53, 57, 56, 56, 44…
$ sex             &lt;fct&gt; male, male, male, male, female, male, female, female, …
$ cp              &lt;fct&gt; typ_ang, non_anginal, non_anginal, non_anginal, atyp_a…
$ rest_bp         &lt;dbl&gt; 145, 160, 120, 130, 130, 120, 140, 120, 130, 140, 140,…
$ chol            &lt;dbl&gt; 233, 286, 229, 250, 204, 236, 268, 354, 254, 203, 192,…
$ fbs             &lt;fct&gt; yes, no, no, no, no, no, no, no, no, yes, no, no, yes,…
$ rest_ecg        &lt;fct&gt; abnormal, abnormal, abnormal, normal, abnormal, normal…
$ max_hr          &lt;dbl&gt; 150, 108, 129, 187, 172, 178, 160, 163, 147, 155, 148,…
$ exer_ang        &lt;fct&gt; no, yes, yes, no, no, no, no, yes, no, yes, no, no, ye…
$ exer_st_depress &lt;dbl&gt; 2.3, 1.5, 2.6, 3.5, 1.4, 0.8, 3.6, 0.6, 1.4, 3.1, 0.4,…
$ exer_st_slope   &lt;fct&gt; downslope, flat, flat, downslope, upslope, upslope, do…
$ ca              &lt;dbl&gt; 0, 3, 2, 0, 0, 0, 2, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, …
$ thal            &lt;fct&gt; fixeddefect, normal, reversabledefect, normal, normal,…
$ disease         &lt;fct&gt; no, yes, yes, no, no, no, yes, no, yes, yes, no, no, y…</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>We won’t do EDA in this unit but lets at least do a quick skim to inform ourselves</p>
<ul>
<li>303 cases</li>
<li>a dichotomous outcome, disease (yes or no for heart disease)</li>
<li>7 other categorical predictors</li>
<li>6 numeric predictors</li>
<li>2 missing values for <code>thal</code>, which is categorical</li>
<li>4 missing values for ca, which is numeric</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>data_all <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data_all</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">303</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">mal: 206, fem: 97</td>
</tr>
<tr class="even">
<td style="text-align: left;">cp</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">non: 230, aty: 50, typ: 23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fbs</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">no: 258, yes: 45</td>
</tr>
<tr class="even">
<td style="text-align: left;">rest_ecg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">abn: 152, nor: 151</td>
</tr>
<tr class="odd">
<td style="text-align: left;">exer_ang</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">no: 204, yes: 99</td>
</tr>
<tr class="even">
<td style="text-align: left;">exer_st_slope</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">ups: 142, fla: 140, dow: 21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">thal</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">nor: 166, rev: 117, fix: 18</td>
</tr>
<tr class="even">
<td style="text-align: left;">disease</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">no: 164, yes: 139</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table style="width:100%;">
<colgroup>
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: right;">skew</th>
<th style="text-align: right;">kurtosis</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">54.44</td>
<td style="text-align: right;">9.04</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">48.0</td>
<td style="text-align: right;">56.0</td>
<td style="text-align: right;">61.0</td>
<td style="text-align: right;">77.0</td>
<td style="text-align: right;">-0.21</td>
<td style="text-align: right;">-0.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">rest_bp</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">131.69</td>
<td style="text-align: right;">17.60</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">120.0</td>
<td style="text-align: right;">130.0</td>
<td style="text-align: right;">140.0</td>
<td style="text-align: right;">200.0</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chol</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">246.69</td>
<td style="text-align: right;">51.78</td>
<td style="text-align: right;">126</td>
<td style="text-align: right;">211.0</td>
<td style="text-align: right;">241.0</td>
<td style="text-align: right;">275.0</td>
<td style="text-align: right;">564.0</td>
<td style="text-align: right;">1.12</td>
<td style="text-align: right;">4.35</td>
</tr>
<tr class="even">
<td style="text-align: left;">max_hr</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">149.61</td>
<td style="text-align: right;">22.88</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">133.5</td>
<td style="text-align: right;">153.0</td>
<td style="text-align: right;">166.0</td>
<td style="text-align: right;">202.0</td>
<td style="text-align: right;">-0.53</td>
<td style="text-align: right;">-0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">exer_st_depress</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.04</td>
<td style="text-align: right;">1.16</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">6.2</td>
<td style="text-align: right;">1.26</td>
<td style="text-align: right;">1.50</td>
</tr>
<tr class="even">
<td style="text-align: left;">ca</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.18</td>
<td style="text-align: right;">0.21</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section class="slide level2">

<p>We will be fitting a logistic regression with all of the predictors for the first half of this unit<br>
<br>
Lets set up a recipe for feature engineering with this statistical algorithm</p>
<ul>
<li>Impute missing data for all numeric predictors using median imputation</li>
<li>Impute missing data for all nominal predictors using the modal value</li>
<li>Dummy code all nominal predictors</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>rec_lr <span class="ot">&lt;-</span> <span class="fu">recipe</span>(disease <span class="sc">~</span> ., <span class="at">data =</span> data_all) <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">|&gt;</span>   </span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>The order of steps in a recipe matter<br>
<br>
While your project’s needs may vary, here is a suggested order of potential steps that should work for most problems <a href="https://recipes.tidymodels.org/articles/Ordering.html">according to tidy models folks</a>:</p>
<ul>
<li>[Convert character to factor] (we do this outside our recipe as part of cleaning)</li>
<li>Impute</li>
<li>Individual transformations for skewness and other issues</li>
<li>Discretize (if needed and if you have no other choice)</li>
<li>Create dummy variables</li>
<li>Create interactions</li>
<li>Normalization steps (center, scale, range, etc)</li>
<li>Multivariate transformation (e.g.&nbsp;PCA, spatial sign, etc)</li>
</ul>
</section>
<section id="the-single-validation-test-set-approach" class="slide level2">
<h2>The single validation (test) set approach</h2>
<p>To date, you have essentially learned how to do the single validation set approach (although we haven’t called it that)<br>
<br>
With this approach, we would take our full n = 303 and:</p>
<ul>
<li>Split into one training set and one held-out set</li>
<li>Fit a model in our training set</li>
<li>Use this trained model to predict scores in held-out set</li>
<li>Calculate a performance metric (e.g., accuracy, rmse) based on predicted and observed scores in the held-out set</li>
</ul>
</section>
<section class="slide level2">

<p>If our goal was to evaluate the expected performance of a single model configuration in new data</p>
<ul>
<li>We called this held-out set a test set</li>
<li>We would report this performance metric from the held-out test set as our estimate of the performance of our model in new data</li>
</ul>
</section>
<section class="slide level2">

<p>If our goal was to select the best model configuration among many candidate configurations</p>
<ul>
<li>We called this held-out set a validation set</li>
<li>We would use this performance metric from the held-out validation set to select the best model configuration</li>
</ul>
</section>
<section class="slide level2">

<p>We call this the single validation set approach but that single held-out set can be either a validation or test set depending on our goals<br>
<br>
If you need to BOTH select a best model configuration AND evaluate that best model configuration, you would need both a validation and a test set.</p>
</section>
<section class="slide level2">

<p>We have been doing the single validation set approach all along but we will provide one more example now (with a 50/50 split) to transition the code we are using to a more general workflow that will accommodate our more complicated resampling approaches<br>
<br>
In the first half of this unit, we will focus on assessing the performance of a single model configuration</p>
<ul>
<li>Logistic regression algorithm</li>
<li>No hyperparameters</li>
<li>Features based on all available predictors</li>
</ul>
<p>We will call the held-out set a test set and use it to evaluate the expected future performance of this single configuration</p>
</section>
<section class="slide level2">

<p>Previously:</p>
<ul>
<li>We would fit the model configuration in training and then made predictions for observations in the held-out test set in separate steps</li>
<li>We did this in separate steps so you could better understand the process</li>
<li>I will show you that first again as a baseline</li>
</ul>
<p>Then:</p>
<ul>
<li>We will now do these tasks in one step using <span class="math inline">\(validation\_split()\)</span></li>
<li>I will show you this combined approach second</li>
<li>This latter approach will be an example for how we code this for our more complicated resampling approaches</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Let’s do a 50/50 split, stratified on our outcome, disease</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">set.seed</span>(<span class="dv">19690127</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>splits <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">initial_split</span>(<span class="at">prop =</span> <span class="fl">0.5</span>, <span class="at">strata =</span> <span class="st">"disease"</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">analysis</span>(splits)</span>
<span id="cb9-7"><a href="#cb9-7"></a>data_trn <span class="sc">|&gt;</span>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 151</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>data_test <span class="ot">&lt;-</span> <span class="fu">assessment</span>(splits)</span>
<span id="cb11-2"><a href="#cb11-2"></a>data_test <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 152</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Make features for train and test (skim them on your own time!)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>rec_prep <span class="ot">&lt;-</span> rec_lr <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a>feat_test <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">bake</span>(data_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Fit model in train</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>fit_lr <span class="ot">&lt;-</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">fit</span>(disease <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Evaluate model in test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">accuracy_vec</span>(feat_test<span class="sc">$</span>disease, <span class="fu">predict</span>(fit_lr, feat_test, <span class="at">type =</span> <span class="st">"class"</span>)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8355263</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Now lets do this in a new and more efficient workflow</p>
<ul>
<li>We still start by settting up a splits object</li>
<li>Note use of <code>splits_validate()</code> rather than <code>initial_split()</code></li>
<li>We will use a variety of functions at this step depending on how we decide to handle resampling</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">set.seed</span>(<span class="dv">19690127</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a>splits_validate <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">validation_split</span>(<span class="at">prop =</span> <span class="fl">0.5</span>, <span class="at">strata =</span> <span class="st">"disease"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Now we can fit our model configuration in our training set(s) and calculate performance metric(s) in the held-out sets using <code>fit_resamples()</code></p>
<ul>
<li>You can and should <a href="https://tune.tidymodels.org/reference/fit_resamples.html">read more</a> about this function</li>
<li>Takes algorithm (broad category, engine, and mode if needed), recipe, and splits as inputs</li>
<li>Specify the (set of) metrics we want to use to estimate for our model configuration</li>
<li>Don’t need to explicitly create feature matrices for held-in and held-out sets.
<ul>
<li>But also don’t see these feature matrices</li>
<li>May still want to create and skim them as a check?</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>fits_lr <span class="ot">&lt;-</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">fit_resamples</span>(<span class="at">preprocessor =</span> rec_lr, <span class="at">resamples =</span> splits_validate, </span>
<span id="cb18-5"><a href="#cb18-5"></a>                 <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>The object (we will call it <code>fits_</code>) that is returned in NOT a model using our model figuration (what we got using <code>fit()</code>, which we called <code>fit_</code>)<br>
<br>
Instead, it contains the performance metrics for the configuration, estimated by</p>
<ul>
<li>Fitting the model configuration in the held in set(s) and then</li>
<li>Predicting into the held-out sets</li>
</ul>
</section>
<section class="slide level2">

<p>We pull these performance estimates out of the fits object using <code>collect_metrics()</code></p>
<ul>
<li>There is one performance estimate</li>
<li>It is for our model configurations performance in test set</li>
<li>It is an estimate of how well our model configuration will work with new data</li>
<li>It matches what we got previously when doing this manually</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>fits_lr <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
  id         .metric  .estimator .estimate .config             
  &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 validation accuracy binary         0.836 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: How many participants were used to fit the model that we used to estimate the performance of our model configuration?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb21-1"><a href="#cb21-1"></a>The model configuration was fit in the training set. The training set had N = 151 participants.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: If we planned to implement this model (i.e., really use it in practice to predict heart disease in new patients) is this the best model we can develop or can we improve it?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb22-1"><a href="#cb22-1"></a>This model was trained with N = 151 but we have 303 participants.  If we trained</span>
<span id="cb22-2"><a href="#cb22-2"></a>the same model configuration with all of our data, that model would be expected</span>
<span id="cb22-3"><a href="#cb22-3"></a>to performance better than the N-151 model.  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: Why will the N = 303 model always be better (or at worst equivalent) to the model trained with N = 151.</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb23-1"><a href="#cb23-1"></a>Increasing the sample size used to fit our model configuration will decrease</span>
<span id="cb23-2"><a href="#cb23-2"></a>model variance but not change model bias. This will produce overall lower </span>
<span id="cb23-3"><a href="#cb23-3"></a>error.</span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a>This might not be true if the additional data were not similar quality to our</span>
<span id="cb23-6"><a href="#cb23-6"></a>training data but we know our validation/test set is similar because we did a</span>
<span id="cb23-7"><a href="#cb23-7"></a>random resample.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: So why did we not just fit this model configuration using N = 303 to start?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb24-1"><a href="#cb24-1"></a>Because then we would not have had any new data left to get an estimate of its performance in new data!</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>If you plan to actually use your model in the real world for prediction, you should always re-fit the best configuration using all available data!</p>
<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: But what does this mean about our estimate of the performance of this final model (fit with all available data) data when we get that estimate using a model that as fit with a smaller sample size (the sample size in our training set)?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb25-1"><a href="#cb25-1"></a>Our estimate will likely be biased.  It will underestimate the true expected </span>
<span id="cb25-2"><a href="#cb25-2"></a>peformance of our final model.  We can think of it as a lower bound on that expected</span>
<span id="cb25-3"><a href="#cb25-3"></a>performance.  The amount of bias will be a function of the difference between the </span>
<span id="cb25-4"><a href="#cb25-4"></a>sample size of the training set and the size the of full dataset.   If we want less </span>
<span id="cb25-5"><a href="#cb25-5"></a>biased estimates, we want to allocate as much data as possible to the training set </span>
<span id="cb25-6"><a href="#cb25-6"></a>when estimating the performance of our final model configuration (but this will come </span>
<span id="cb25-7"><a href="#cb25-7"></a>with other costs!)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: Contrast the costs/benefits of a 50/50 vs.&nbsp;80/20 split for train and test</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb26-1"><a href="#cb26-1"></a>Using a training set with 80% of the sample will yield a less biased (under)</span>
<span id="cb26-2"><a href="#cb26-2"></a>estimate of the final (using all data) model performance than a training set with</span>
<span id="cb26-3"><a href="#cb26-3"></a>50% of the sample.  </span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a>However, using a test set of 20% of the data will produce a </span>
<span id="cb26-6"><a href="#cb26-6"></a>more variable (less precise) estimate of performance than the 50% test set.  </span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a>This  is another bias-variance trade off but now instead of talking about model</span>
<span id="cb26-9"><a href="#cb26-9"></a>performance, we are seeing that we have to trade off bias and variance in our</span>
<span id="cb26-10"><a href="#cb26-10"></a>estimate of the model performance too!</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>This recognition of a bias-variance trade-off in our performance estimates is what motivates the more complicated resampling approaches we will now consider.</p>
</section>
<section class="slide level2">

<p>In our example, we plan to use this model for future predictions, so now lets fit it a final time using the full dataset</p>
<ul>
<li>We do this manually</li>
<li>NOTE: tidymodels has routines to do all of this including fitting final models (read more about “workflows”)</li>
<li>We do not use them in the course because they hide steps that are important for conceptual understanding</li>
<li>We do not use them in our lab because we break apart all of these steps to train models using high throughput computing</li>
</ul>
</section>
<section class="slide level2">

<p>Make a feature matrix for the full dataset<br>
<br>
We are now using the full data set as our new training set so we prep and bake with the full dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>rec_prep <span class="ot">&lt;-</span> rec_lr <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">prep</span>(data_all)</span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a>feat_all <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">bake</span>(data_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>And then fit your model configuration</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>fit_lr <span class="ot">&lt;-</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">fit</span>(disease <span class="sc">~</span> ., <span class="at">data =</span> feat_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>fit_lr <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 5
   term                    estimate std.error statistic     p.value
   &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
 1 (Intercept)             -5.06      2.79       -1.81  0.0704     
 2 age                     -0.0185    0.0235     -0.787 0.431      
 3 rest_bp                  0.0240    0.0109      2.20  0.0279     
 4 chol                     0.00414   0.00376     1.10  0.271      
 5 max_hr                  -0.0204    0.0104     -1.96  0.0497     
 6 exer_st_depress          0.275     0.212       1.30  0.195      
 7 ca                       1.32      0.263       5.00  0.000000566
 8 sex_male                 1.43      0.489       2.92  0.00345    
 9 cp_atyp_ang              1.05      0.752       1.40  0.162      
10 cp_non_anginal           1.24      0.602       2.06  0.0396     
11 fbs_yes                 -0.812     0.522      -1.55  0.120      
12 rest_ecg_abnormal        0.469     0.364       1.29  0.197      
13 exer_ang_yes             1.24      0.401       3.10  0.00195    
14 exer_st_slope_flat       1.08      0.442       2.43  0.0150     
15 exer_st_slope_downslope  0.468     0.819       0.572 0.568      
16 thal_fixeddefect         0.262     0.759       0.345 0.730      
17 thal_reversabledefect    1.41      0.397       3.54  0.000396   </code></pre>
</div>
</div>
<p>If we need to predict disease in the future, this is the model we would use (with these parameter estimates)<br>
<br>
Our estimate of its future accuracy is based on our previous assessment using the <strong>held-in</strong> training set to fit the model configuration and the <strong>held-out</strong> test set to estimate its performance<br>
<br>
This estimate should be considered a lower bound on its expected performance</p>
</section>
<section id="leave-one-out-cross-validation" class="slide level2">
<h2>Leave One Out Cross Validation</h2>
<p>Let’s turn to a new resampling technique and start with some questions to motivate it</p>
<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: How could you use this single validation set approach to get the least biased estimate of model performance with your n = 303 dataset that would still allow you to estimate its performance in a held out test set?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>show answer</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb31-1"><a href="#cb31-1"></a>Put all but one case into the training set (i.e., leave only one case out in the</span>
<span id="cb31-2"><a href="#cb31-2"></a>test set).  In our example, you would fit a model with n = 302  this model will </span>
<span id="cb31-3"><a href="#cb31-3"></a>have essentially equivalent overfitting as n = 303 so it will not yield much bias </span>
<span id="cb31-4"><a href="#cb31-4"></a>when we use it to estimate the performance of the n = 303 model.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: What will be the biggest problem with this approach?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb32-1"><a href="#cb32-1"></a>You will estimate performance with only n = 1 in the test set.  This means there </span>
<span id="cb32-2"><a href="#cb32-2"></a>will be high variance in your performance estimate.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: How might you reduce this problem?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb33-1"><a href="#cb33-1"></a>Repeat this split between training and test n times so that there are n different</span>
<span id="cb33-2"><a href="#cb33-2"></a>sets of n = 1 test sets.  Then average the performance across all n of these test </span>
<span id="cb33-3"><a href="#cb33-3"></a>sets to get a more stable estimate of performance. Averaging is a good way to reduce </span>
<span id="cb33-4"><a href="#cb33-4"></a>the variance of any estimate.  </span>
<span id="cb33-5"><a href="#cb33-5"></a></span>
<span id="cb33-6"><a href="#cb33-6"></a>This is leave one out cross-validation!</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Comparisons across LOOCV and single validation set approaches</p>
<ul>
<li><p>The performance estimate from LOOCV has less bias than the single validation set method (because the models that are used to estimate performance were fit with close to the full n of the final model that will be fit to all the data)</p></li>
<li><p>LOOCV uses all observations in the held-out set at some point. This may yield less variance than single 20% or 50% validation set?</p></li>
</ul>
<p>but…</p>
<ul>
<li>LOOCV can be computationally expensive (need to fit and evaluate the same model configuration n times).<br>
</li>
<li>This is a real problem when you are also working with a high number of model configurations (i.e., number fits = n * number of model configurations).</li>
</ul>
</section>
<section class="slide level2">

<p>LOOCV eventually uses all the data in the held-out set across the ‘n’ held-out sets.</p>
<ul>
<li>Averaging also helps reduce variance in the performance metric.</li>
<li>However, averaging reduces variance to a greater degree when the performance measures being averaged are less related/more independent.</li>
<li>The n fitted models are very similar in LOOCV b/c they are each fit on almost the same data (each with n-1 observations)<br>
<br>
</li>
</ul>
<p>K-fold cross validation (next method) improves the variance of the average performance metric by averaging across more independent (less overlapping) training sets</p>
<ul>
<li>For this reason, it is superior and (always?) preferred over LOOCV</li>
<li>We are not demonstrating LOOCV b/c we strongly prefer other methods (k-fold)</li>
<li>Still important to understand it conceptually and its strengths/weaknesses</li>
<li>If you wanted to use this resampling approach, simply substitute <code>loo_cv()</code> for <code>vfold_cv()</code> in the next example</li>
</ul>
</section>
<section id="k-fold-cross-validation" class="slide level2">
<h2>K-fold Cross Validation</h2>
<p>K-fold cross validation</p>
<ol type="1">
<li>Divide the observations into K equal size independent “folds” (each observation appears in only one fold)</li>
<li>Hold out 1 of these folds (1/Kth of the dataset) to use as a held-out set</li>
<li>Fit a model in the remaining K-1 folds</li>
<li>Repeat until each of the folds has been held out once</li>
<li>Performance estimate is the average performance across the K held-out folds<br>
<br>
</li>
</ol>
<p>Common values of K are 5 and 10<br>
<br>
Note that K is sometimes referred to as V in some fields/literatures (Don’t blame me!)</p>
</section>
<section class="slide level2">

<p>Visualization of K-fold</p>
<p><img data-src="figs/unit5_kfold.png" style="height:5in"></p>
</section>
<section class="slide level2">

<p>Let’s demonstrate the code for K-fold Cross-validation</p>
<ul>
<li>First, we split into 10 folds (default)
<ul>
<li>repeats = 1 (default; more on this in a bit)</li>
<li>stratify on <code>disease</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>splits_kfold <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">vfold_cv</span>(<span class="at">v =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">1</span>, <span class="at">strata =</span> <span class="st">"disease"</span>)</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a>splits_kfold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  10-fold cross-validation using stratification 
# A tibble: 10 × 2
   splits           id    
   &lt;list&gt;           &lt;chr&gt; 
 1 &lt;split [272/31]&gt; Fold01
 2 &lt;split [272/31]&gt; Fold02
 3 &lt;split [272/31]&gt; Fold03
 4 &lt;split [272/31]&gt; Fold04
 5 &lt;split [273/30]&gt; Fold05
 6 &lt;split [273/30]&gt; Fold06
 7 &lt;split [273/30]&gt; Fold07
 8 &lt;split [273/30]&gt; Fold08
 9 &lt;split [273/30]&gt; Fold09
10 &lt;split [274/29]&gt; Fold10</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Fit model configuration in first 9 folds, evaluate in 10th fold. Repeat 9 more times for each additional held-out fold
<ul>
<li>Use <code>fit_resamples()</code> as before</li>
<li>Still no need to continue to remake features for held-in and held-out sets. Just provide <code>splits</code> and <code>rec</code></li>
<li>Set performance metrics with <code>metric_set()</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>fits_lr_kfold <span class="ot">&lt;-</span> </span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">fit_resamples</span>(<span class="at">preprocessor =</span> rec_lr, </span>
<span id="cb36-5"><a href="#cb36-5"></a>                <span class="at">resamples =</span> splits_kfold, </span>
<span id="cb36-6"><a href="#cb36-6"></a>                <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li><p>Then, we review performance estimates in held out folds using <code>collect_metrics()</code></p>
<ul>
<li>Can see performance in all folds using <code>summarize = FALSE</code></li>
<li>The performance estimates are not all the same. This is what we mean when we talk about the variance in our performance estimates. You couldn’t see it before with only one held-out set but now that we have 10, it becomes more concrete. Ideally this variance is as low as possible.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>metrics_kfold <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(fits_lr_kfold, <span class="at">summarize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a>metrics_kfold <span class="sc">|&gt;</span> <span class="fu">print_kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; "><table class="table table-striped table-condensed" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> id </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .metric </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .estimator </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .estimate </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .config </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.71 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.70 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
</tbody>
</table></div>

</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Could plot this as a histogram to visualize this variance (i.e., the sampling distribution of performance estimates)</li>
<li>Would be better if we had more folds (see repeats in a bit)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>metrics_kfold <span class="sc">|&gt;</span> <span class="fu">plot_hist</span>(<span class="st">".estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="005_resampling_files/figure-revealjs/unnamed-chunk-31-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<ul>
<li>Can see the average performance over folds along with its standard error using <code>summarize = TRUE</code></li>
<li>This average will have lower variance (which is estimated by the standard error. Still not zero!)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">collect_metrics</span>(fits_lr_kfold, <span class="at">summarize =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  .metric  .estimator  mean     n std_err .config             
  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 accuracy binary     0.809    10  0.0242 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>As a last step, we still fit the final model as before using the full dataset</p>
<ul>
<li>We already have the feature matrix for the full dataset (<code>feat_all</code>) from earlier</li>
<li>Otherwise, remake it</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>fit_lr <span class="ot">&lt;-</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">fit</span>(disease <span class="sc">~</span> ., <span class="at">data =</span> feat_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>fit_lr <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 5
   term                    estimate std.error statistic     p.value
   &lt;chr&gt;                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
 1 (Intercept)             -5.06      2.79       -1.81  0.0704     
 2 age                     -0.0185    0.0235     -0.787 0.431      
 3 rest_bp                  0.0240    0.0109      2.20  0.0279     
 4 chol                     0.00414   0.00376     1.10  0.271      
 5 max_hr                  -0.0204    0.0104     -1.96  0.0497     
 6 exer_st_depress          0.275     0.212       1.30  0.195      
 7 ca                       1.32      0.263       5.00  0.000000566
 8 sex_male                 1.43      0.489       2.92  0.00345    
 9 cp_atyp_ang              1.05      0.752       1.40  0.162      
10 cp_non_anginal           1.24      0.602       2.06  0.0396     
11 fbs_yes                 -0.812     0.522      -1.55  0.120      
12 rest_ecg_abnormal        0.469     0.364       1.29  0.197      
13 exer_ang_yes             1.24      0.401       3.10  0.00195    
14 exer_st_slope_flat       1.08      0.442       2.43  0.0150     
15 exer_st_slope_downslope  0.468     0.819       0.572 0.568      
16 thal_fixeddefect         0.262     0.759       0.345 0.730      
17 thal_reversabledefect    1.41      0.397       3.54  0.000396   </code></pre>
</div>
</div>
<p><br>
<br>
If we need to predict disease in the future, this is the fitted model we would use (with these parameter estimates)<br>
<br>
Our estimate of its future accuracy is 0.8090026 with a standard error of 0.0241847</p>
</section>
<section class="slide level2">

<p>Comparisons between K-fold vs.&nbsp;LOOCV and Single Validation set<br>
<br>
For Bias:</p>
<ul>
<li>K-fold typically has less bias than the single validation set method
<ul>
<li>E.g. 10-fold fits models with 9/10th of the data vs.&nbsp;50% or 80%, etc</li>
</ul></li>
<li>K Fold has somewhat more bias than LOOCV because LOOCV uses n - 1 observations for fitting models</li>
</ul>
</section>
<section class="slide level2">

<p>For Variance:</p>
<ul>
<li><p>K-fold has less variance than LOOCV</p>
<ul>
<li>Like LOOCV, it uses all observations in test at some point</li>
<li>The averaged models are more independent b/c models are fitted on less overlapping training sets</li>
</ul></li>
<li><p>K-fold has less variance than single validation set b/c it uses all data as test at some point (vs.&nbsp;a subset of held-out test data)</p></li>
<li><p>K-fold is less computationally expensive than LOOCV (though more expensive than single validation set)</p></li>
<li><p>K-fold is generally preferred over both of these other approaches</p></li>
</ul>
</section>
<section class="slide level2">

<p>K-fold is less computationally intensive BUT still can be costly. Particularly when you are getting performance estimates for multiple model configurations (more on that when we learn how to tune hyperparameters)<br>
<br>
So you may want to start caching the <code>fits_</code> object so you don’t have to recalculate it.</p>
</section>
<section class="slide level2">

<p>Here is a demonstration</p>
<ul>
<li>First we set up an environment variable that we can flip between true/false to invalidate all our cached calculations</li>
<li>Put this near the top of your code with other environment settings so its easy to find</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>rerun_setting <span class="ot">&lt;-</span> <span class="cn">TRUE</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Now use the <code>cache_rds()</code> function</li>
<li>Put the resampling code inside of <code>{}</code></li>
<li>Cached file will be saved in <code>cached/</code> folder with filename <code>fits_lr_kfold_HASH</code></li>
<li>If you change any code in the function, it will invalidate the cache and re-run the code</li>
<li>However, it will not invalidate the cache if you change objects or data that affect this function but are outside it, e.g.,
<ul>
<li>Fix errors in data</li>
<li>Update <code>rec_lr</code></li>
<li>Update <code>splits_kfold</code></li>
<li>Be VERY careful!</li>
</ul></li>
<li>You can manually invalidate just the cache for just this code chunk by setting <code>rerun = TRUE</code> temporarily or you can change <code>rerun_setting &lt;- TRUE</code> at the top of your script to do fresh calculations for all of your cached code chunks</li>
<li>You can set <code>rerun_settings &lt;- TRUE</code> when you are done with your development to make sure everything is accurate (review output carefully for any changes!)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>fits_lr_kfold <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="at">expr =</span> {</span>
<span id="cb45-3"><a href="#cb45-3"></a>    <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb45-4"><a href="#cb45-4"></a>    <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-5"><a href="#cb45-5"></a>    <span class="fu">fit_resamples</span>(<span class="at">preprocessor =</span> rec_lr, </span>
<span id="cb45-6"><a href="#cb45-6"></a>                  <span class="at">resamples =</span> splits_kfold, </span>
<span id="cb45-7"><a href="#cb45-7"></a>                  <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb45-8"><a href="#cb45-8"></a>  }, </span>
<span id="cb45-9"><a href="#cb45-9"></a>  <span class="at">dir =</span> <span class="st">"cache/"</span>,</span>
<span id="cb45-10"><a href="#cb45-10"></a>  <span class="at">file =</span> <span class="st">"fits_lr_kfold"</span>,</span>
<span id="cb45-11"><a href="#cb45-11"></a>  <span class="at">rerun =</span> rerun_setting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="repeated-k-fold-cross-validation" class="slide level2">
<h2>Repeated K-fold Cross Validation</h2>
<p>You can repeat the K-fold procedure multiple times with new splits for a different mix of K folds each time<br>
<br>
Two benefits:</p>
<ul>
<li>More stable performance estimate (because averaged over more folds: repeats * K)</li>
<li>Many more estimates of performance to characterize (SE; plot) of your performance estimate<br>
<br>
</li>
</ul>
<p>But it is computationally expensive (depending on number of repeats)</p>
</section>
<section class="slide level2">

<p>An example of Repeated K-fold Cross-validation</p>
<ul>
<li>Splits with repeats = 10 (will do 10 different splits of 10-fold)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">set.seed</span>(<span class="dv">19690127</span>)</span>
<span id="cb46-2"><a href="#cb46-2"></a>splits_kfold10x <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="fu">vfold_cv</span>(<span class="at">v =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">10</span>, <span class="at">strata =</span> <span class="st">"disease"</span>)</span>
<span id="cb46-4"><a href="#cb46-4"></a></span>
<span id="cb46-5"><a href="#cb46-5"></a>splits_kfold10x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  10-fold cross-validation repeated 10 times using stratification 
# A tibble: 100 × 3
   splits           id       id2   
   &lt;list&gt;           &lt;chr&gt;    &lt;chr&gt; 
 1 &lt;split [272/31]&gt; Repeat01 Fold01
 2 &lt;split [272/31]&gt; Repeat01 Fold02
 3 &lt;split [272/31]&gt; Repeat01 Fold03
 4 &lt;split [272/31]&gt; Repeat01 Fold04
 5 &lt;split [273/30]&gt; Repeat01 Fold05
 6 &lt;split [273/30]&gt; Repeat01 Fold06
 7 &lt;split [273/30]&gt; Repeat01 Fold07
 8 &lt;split [273/30]&gt; Repeat01 Fold08
 9 &lt;split [273/30]&gt; Repeat01 Fold09
10 &lt;split [274/29]&gt; Repeat01 Fold10
# … with 90 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Everything else is the same!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>fits_lr_kfold10x <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb48-2"><a href="#cb48-2"></a>  <span class="at">expr =</span> {</span>
<span id="cb48-3"><a href="#cb48-3"></a>    <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4"></a>      <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-5"><a href="#cb48-5"></a>      <span class="fu">fit_resamples</span>(<span class="at">preprocessor =</span> rec_lr, </span>
<span id="cb48-6"><a href="#cb48-6"></a>                    <span class="at">resamples =</span> splits_kfold10x, </span>
<span id="cb48-7"><a href="#cb48-7"></a>                    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb48-8"><a href="#cb48-8"></a>  }, </span>
<span id="cb48-9"><a href="#cb48-9"></a>  <span class="at">dir =</span> <span class="st">"cache/"</span>,</span>
<span id="cb48-10"><a href="#cb48-10"></a>  <span class="at">file =</span> <span class="st">"fits_lr_kfold10x"</span>,</span>
<span id="cb48-11"><a href="#cb48-11"></a>  <span class="at">rerun =</span> rerun_setting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Individual estimates across 100 held-out folds</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>metrics_kfold10x <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(fits_lr_kfold10x, <span class="at">summarize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-2"><a href="#cb49-2"></a></span>
<span id="cb49-3"><a href="#cb49-3"></a>metrics_kfold10x <span class="sc">|&gt;</span> <span class="fu">print_kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; "><table class="table table-striped table-condensed" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> id </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> id2 </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .metric </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .estimator </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .estimate </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .config </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat01 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat02 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.94 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.70 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat03 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.67 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat04 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat05 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.94 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat06 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat07 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.69 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.67 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat08 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat09 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.72 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold01 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold02 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold03 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold04 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold05 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold06 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold07 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold08 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold09 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Repeat10 </td>
   <td style="text-align:right;"> Fold10 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
</tbody>
</table></div>

</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Histogram of those 100 individual estimates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>metrics_kfold10x <span class="sc">|&gt;</span> <span class="fu">plot_hist</span>(<span class="st">".estimate"</span>, <span class="at">bins =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="005_resampling_files/figure-revealjs/unnamed-chunk-38-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Average performance estimated (and its SE) across the 100 held-out folds</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="fu">collect_metrics</span>(fits_lr_kfold10x, <span class="at">summarize =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  .metric  .estimator  mean     n std_err .config             
  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 accuracy binary     0.824   100 0.00604 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>You should also refit a final model in the full data at the end as before</li>
<li>We wont demonstrate that here</li>
</ul>
</section>
<section class="slide level2">

<p>Comparisons between repeated K-fold and K-fold<br>
<br>
Repeated K-fold:</p>
<ul>
<li>Has same bias as K-fold (still fitting models with K-1 folds)</li>
<li>Has all the benefits of single K-fold</li>
<li>Has even more stable estimate of performance (mean over more folds/repeats)</li>
<li>Provides more info about distribution for the performance estimate</li>
<li><strong>But</strong> is more computationally expensive<br>
<br>
</li>
</ul>
<p>Repeated K-fold is preferred over K-fold to the degree possible based on computational limitations (parallel, N, p, statistical algorithm, # of model configurations)</p>
</section>
<section id="grouped-k-fold" class="slide level2">
<h2>Grouped K-fold</h2>
<p>We have to be particularly careful with resampling methods when we have repeated observations for the same participant (or unit of analysis more generally)</p>
<ul>
<li>We can often predict an individual’s own data better using some of their own data.<br>
</li>
<li>If our model will not ever encounter that individual again, this will optimistically bias our estimate of our models performance with new/future observations.<br>
</li>
<li>We can remove that bias by making sure that all observations from an individual are grouped together so that they always either held-in or held-out but never split across both.<br>
</li>
<li>Easy to do a grouped K-fold by making splits using <a href="https://rsample.tidymodels.org/reference/group_vfold_cv.html"><code>group_vfold_cv()</code></a> and then proceeding as before with all other analyses/code
<ul>
<li>set the <code>group</code> argument to the name of the variable that codes for subid or unit of analysis that is repeated.</li>
</ul></li>
</ul>
</section>
<section id="bootstrap-resampling" class="slide level2">
<h2>Bootstrap Resampling</h2>
<p>A bootstrap sample is a random sample taken with replacement (i.e., same observations can be sampled multiple times within one bootstrap sample)<br>
<br>
If you bootstrap a new sample of size n from a dataset with sample size n, approximately 63.2% of the original observations end up in the bootstrap sample<br>
<br>
The remaining 36.8% of the observations are often called the “out of bag” (OOB) samples</p>
</section>
<section class="slide level2">

<p>Bootstrap Resampling</p>
<ul>
<li>Creates B bootstrap samples of size n = n from the original dataset</li>
<li>For any specific bootstrap (b)
<ul>
<li>Model(s) are fit to the bootstrap sample</li>
<li>Model performance is evaluated in the associated out of bag (held-out) samples</li>
</ul></li>
<li>This is repeated B times such that you have B assessments of model performance</li>
</ul>
</section>
<section class="slide level2">

<p>An example of Bootstrap resampling</p>
<ul>
<li>Again, all that changes is how you form the splits/resamples</li>
<li>You will use <a href="https://rsample.tidymodels.org/reference/bootstraps.html"><span class="math inline">\(bootstraps()\)</span></a> to form the splits</li>
<li>Here are 100 bootstraps stratified on <code>disease</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="fu">set.seed</span>(<span class="dv">19690127</span>)</span>
<span id="cb53-2"><a href="#cb53-2"></a>splits_boot <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">bootstraps</span>(<span class="at">times =</span> <span class="dv">100</span>, <span class="at">strata =</span> <span class="st">"disease"</span>) </span>
<span id="cb53-4"><a href="#cb53-4"></a></span>
<span id="cb53-5"><a href="#cb53-5"></a>splits_boot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Bootstrap sampling using stratification 
# A tibble: 100 × 2
   splits            id          
   &lt;list&gt;            &lt;chr&gt;       
 1 &lt;split [303/115]&gt; Bootstrap001
 2 &lt;split [303/123]&gt; Bootstrap002
 3 &lt;split [303/105]&gt; Bootstrap003
 4 &lt;split [303/115]&gt; Bootstrap004
 5 &lt;split [303/114]&gt; Bootstrap005
 6 &lt;split [303/115]&gt; Bootstrap006
 7 &lt;split [303/113]&gt; Bootstrap007
 8 &lt;split [303/95]&gt;  Bootstrap008
 9 &lt;split [303/101]&gt; Bootstrap009
10 &lt;split [303/115]&gt; Bootstrap010
# … with 90 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Everything else is the same!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>fits_lr_boot <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="at">expr =</span> {</span>
<span id="cb55-3"><a href="#cb55-3"></a>    <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4"></a>      <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-5"><a href="#cb55-5"></a>      <span class="fu">fit_resamples</span>(<span class="at">preprocessor =</span> rec_lr, </span>
<span id="cb55-6"><a href="#cb55-6"></a>                    <span class="at">resamples =</span> splits_boot, </span>
<span id="cb55-7"><a href="#cb55-7"></a>                    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb55-8"><a href="#cb55-8"></a></span>
<span id="cb55-9"><a href="#cb55-9"></a>  },</span>
<span id="cb55-10"><a href="#cb55-10"></a>  <span class="at">dir =</span> <span class="st">"cache/"</span>,</span>
<span id="cb55-11"><a href="#cb55-11"></a>  <span class="at">file =</span> <span class="st">"fits_lr_boot"</span>, </span>
<span id="cb55-12"><a href="#cb55-12"></a>  <span class="at">rerun =</span> rerun_setting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>100 individual performance estimates from the 100 OOB sets</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>metrics_boot <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(fits_lr_boot, <span class="at">summarize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-2"><a href="#cb56-2"></a></span>
<span id="cb56-3"><a href="#cb56-3"></a>metrics_boot <span class="sc">|&gt;</span> <span class="fu">print_kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; "><table class="table table-striped table-condensed" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> id </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .metric </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .estimator </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .estimate </th>
   <th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;"> .config </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> Bootstrap001 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap002 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap003 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap004 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap005 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap006 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap007 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap008 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap009 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap010 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap011 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap012 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap013 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap014 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap015 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap016 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap017 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap018 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.85 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap019 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap020 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap021 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.74 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap022 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap023 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.85 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap024 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap025 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap026 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap027 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap028 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap029 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap030 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap031 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap032 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.85 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap033 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap034 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap035 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.85 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap036 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap037 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap038 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap039 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap040 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.88 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap041 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap042 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap043 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap044 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap045 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.85 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap046 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap047 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap048 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap049 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap050 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap051 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap052 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap053 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap054 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap055 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap056 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap057 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap058 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap059 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap060 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.85 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap061 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.72 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap062 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap063 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap064 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap065 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap066 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap067 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap068 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.85 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap069 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap070 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap071 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap072 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap073 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap074 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap075 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap076 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.89 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap077 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap078 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap079 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap080 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap081 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.88 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap082 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap083 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap084 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap085 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap086 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap087 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap088 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap089 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap090 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap091 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.85 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap092 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap093 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.83 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap094 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap095 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.82 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap096 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.81 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap097 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap098 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap099 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> Bootstrap100 </td>
   <td style="text-align:right;"> accuracy </td>
   <td style="text-align:right;"> binary </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:right;"> Preprocessor1_Model1 </td>
  </tr>
</tbody>
</table></div>

</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Histogram of those 100 performance estimates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>metrics_boot <span class="sc">|&gt;</span> <span class="fu">plot_hist</span>(<span class="st">".estimate"</span>, <span class="at">bins =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="005_resampling_files/figure-revealjs/unnamed-chunk-42-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<ul>
<li>Average performance over those 100 estimates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="fu">collect_metrics</span>(fits_lr_boot, <span class="at">summarize =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  .metric  .estimator  mean     n std_err .config             
  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 accuracy binary     0.817   100 0.00338 Preprocessor1_Model1</code></pre>
</div>
</div>
<ul>
<li>You should also refit a final model in the full data at the end as before to get final single fitted model for later use</li>
</ul>
</section>
<section class="slide level2">

<p>Relevant comparisons, strengths/weaknesses for bootstrap for resampling</p>
<ul>
<li>The bootstrap resampling performance estimate will have higher bias than K-fold using typical K values (bias equivalent to about K = 2)</li>
<li>Although training sets have full n, they only include about 63% unique observations. These models under perform training sets with 80 - 90% unique observations</li>
<li>With smaller training set sizes, this bias is considered too high by some (Kuhn)</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>The bootstrap resampling performance estimate will have less variance than K-fold</li>
<li>Compare SE of accuracy for 100 resamples using k-fold with repeats: 0.0060406 vs.&nbsp;bootstrap: 0.0033803</li>
<li>With 1000 bootstraps (and test sets with ~ 37% of n) can get a very precise estimate of held-out error</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>Can also represent the variance of our held-out error (like repeated K-fold)</p></li>
<li><p>Used primarily for selecting among model configurations when you don’t care about bias and just want a precise selection metric</p></li>
<li><p>Useful in explanation scenarios where you just need the “best” model</p></li>
<li><p>“Inner loop” of nested cross validation (more on this later)</p></li>
</ul>
</section>
<section id="using-resampling-to-select-best-model-configurations" class="slide level2">
<h2>Using Resampling to Select Best Model Configurations</h2>
<p>In all of the previous examples, we have used various resampling methods only to evaluate the performance of a single model configuration in new data. In these instances, we were treating the held-out sets as test sets.<br>
<br>
Resampling is also used to get held out performance estimates to select best model configurations.<br>
<br>
<br>
<strong>Best</strong> means the model configuration that performs the best in new data and therefore is closest to the true DGP for the data</p>
</section>
<section class="slide level2">

<p>For example, we might want to select among model configurations in an explanatory scenario to have a principled approach to determine the model configuration that best matches the true DGP (and would be best to test your hypotheses). e.g.,</p>
<ul>
<li>Selecting covariates to include</li>
<li>Deciding on X transformations</li>
<li>Outlier identification approach</li>
<li>Statistical algorithm</li>
</ul>
</section>
<section class="slide level2">

<p>We can simply get performance estimates for each configuration using one of the previously described resampling methods</p>
<ul>
<li>We would call the held-out data (the single set, the folds, the OOB samples) a validation set</li>
<li>We select the model configuration with the best mean (or median?) across our resampled validation sets on the relevant performance metric.</li>
</ul>
</section>
<section class="slide level2">

<p>One additional common scenario where you will do model selection across many model configurations is when “tuning” (i.e., selecting) the best values for hyperparameters for a statistical algorithm (e.g., k in KNN).</p>
</section>
<section class="slide level2">

<p><code>tidymodels</code> makes this easy and it follows a very similar workflow as earlier with a few changes</p>
<ul>
<li>We will need to indicate which hyperparameters we plan to tune in the statistical algorithm</li>
<li>We need (or can) select values to consider for that hyperparameter (or we can let the <code>tune</code> package functions decide in some cases)</li>
<li>We will now use <a href="https://tune.tidymodels.org/reference/tune_grid.html"><code>tune_grid()</code></a> rather <code>fit_resamples()</code> to fit and evaluate the models configurations that differ with respect to their hyperparameters</li>
<li>This IS computationally costly. Now fitting and estimating performance for multiple configurations across multipe held-in/held-out sets</li>
</ul>
</section>
<section class="slide level2">

<p>Lets use bootstrap resampling to select the best K for KNN applied to our heart disease dataset<br>
<br>
We can use the same splits are established as before (<code>splits_boot</code>)<br>
<br>
We need a slightly different recipe for KNN vs.&nbsp;logistic regression</p>
<ul>
<li>We have to scale (lets range correct) the features</li>
<li>No need to do this to the dummy features. They are already range corrected</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>rec_knn <span class="ot">&lt;-</span> <span class="fu">recipe</span>(disease <span class="sc">~</span> ., <span class="at">data =</span> data_all) <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">|&gt;</span>   </span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="fu">step_range</span>(<span class="fu">all_numeric</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>The fitting process is what is different</p>
<ul>
<li>We set up a tibble with values of the hyperparameters to consider</li>
<li>We indicate which hyperparameters need to be tuned</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>hyper_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">neighbors =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">150</span>, <span class="at">by =</span> <span class="dv">3</span>))</span>
<span id="cb61-2"><a href="#cb61-2"></a>hyper_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   neighbors
1          1
2          4
3          7
4         10
5         13
6         16
7         19
8         22
9         25
10        28
11        31
12        34
13        37
14        40
15        43
16        46
17        49
18        52
19        55
20        58
21        61
22        64
23        67
24        70
25        73
26        76
27        79
28        82
29        85
30        88
31        91
32        94
33        97
34       100
35       103
36       106
37       109
38       112
39       115
40       118
41       121
42       124
43       127
44       130
45       133
46       136
47       139
48       142
49       145
50       148</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>When model configurations differ by features or statistical algorithms, we have to use <code>fit_resamples()</code> multiple times to estimate performance of those different configurations</li>
<li>Held out performance estimates for model configurations that differ by hyperparameter values are obtained in one step using <code>tune_grid()</code></li>
<li>We need to set <code>grid =</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>fits_knn_boot <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb63-2"><a href="#cb63-2"></a>  <span class="at">expr =</span> {</span>
<span id="cb63-3"><a href="#cb63-3"></a>    <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb63-4"><a href="#cb63-4"></a>      <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb63-5"><a href="#cb63-5"></a>      <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-6"><a href="#cb63-6"></a>      <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_knn, </span>
<span id="cb63-7"><a href="#cb63-7"></a>                <span class="at">resamples =</span> splits_boot, </span>
<span id="cb63-8"><a href="#cb63-8"></a>                <span class="at">grid =</span> hyper_grid,</span>
<span id="cb63-9"><a href="#cb63-9"></a>                <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb63-10"><a href="#cb63-10"></a></span>
<span id="cb63-11"><a href="#cb63-11"></a>  },</span>
<span id="cb63-12"><a href="#cb63-12"></a>  <span class="at">dir =</span> <span class="st">"cache/"</span>,</span>
<span id="cb63-13"><a href="#cb63-13"></a>  <span class="at">file =</span> <span class="st">"fits_knn_boot"</span>,</span>
<span id="cb63-14"><a href="#cb63-14"></a>  <span class="at">rerun =</span> rerun_setting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Reviewing performance of model configurations is similar to before but now with multiple configurations</p>
<ul>
<li>We can see the average performance over folds along with its standard error using <code>summarize = TRUE</code></li>
<li>We <em>could</em> see the performance of each configuration in EACH fold too, but there are lots of them (use <code>summarize = FALSE</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="fu">collect_metrics</span>(fits_knn_boot, <span class="at">summarize =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 7
   neighbors .metric  .estimator  mean     n std_err .config              
       &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1         1 accuracy binary     0.749   100 0.00362 Preprocessor1_Model01
 2         4 accuracy binary     0.749   100 0.00362 Preprocessor1_Model02
 3         7 accuracy binary     0.771   100 0.00367 Preprocessor1_Model03
 4        10 accuracy binary     0.782   100 0.00353 Preprocessor1_Model04
 5        13 accuracy binary     0.787   100 0.00345 Preprocessor1_Model05
 6        16 accuracy binary     0.794   100 0.00329 Preprocessor1_Model06
 7        19 accuracy binary     0.798   100 0.00314 Preprocessor1_Model07
 8        22 accuracy binary     0.800   100 0.00313 Preprocessor1_Model08
 9        25 accuracy binary     0.802   100 0.00311 Preprocessor1_Model09
10        28 accuracy binary     0.803   100 0.00306 Preprocessor1_Model10
# … with 40 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>We can plot average performance by the values of the hyperparameter</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">collect_metrics</span>(fits_knn_boot, <span class="at">summarize =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> neighbors, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>    <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="005_resampling_files/figure-revealjs/unnamed-chunk-47-1.png" width="960" class="r-stretch"><p>K (neighbors) is affecting the bias-variance trade-off. As K increases, model bias increases but model variance decreases. In most instances, model variance decreases faster than model bias increases. Therefore performance should increase and then peak at a good point along the bias-variance trade-off. Beyond this optimal value, performance should decrease again. You want to select a hyperparameter value that is associated with peak (or near peak) performance.</p>
</section>
<section class="slide level2">

<p>The simplest way to select among model configurations (e.g., hyperparameters) is to choose the model configuration with the best performance</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="fu">show_best</span>(fits_knn_boot, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
   neighbors .metric  .estimator  mean     n std_err .config              
       &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1       145 accuracy binary     0.819   100 0.00321 Preprocessor1_Model49
 2       148 accuracy binary     0.819   100 0.00323 Preprocessor1_Model50
 3       142 accuracy binary     0.819   100 0.00324 Preprocessor1_Model48
 4       124 accuracy binary     0.818   100 0.00310 Preprocessor1_Model42
 5       121 accuracy binary     0.818   100 0.00309 Preprocessor1_Model41
 6       136 accuracy binary     0.818   100 0.00323 Preprocessor1_Model46
 7       139 accuracy binary     0.818   100 0.00323 Preprocessor1_Model47
 8       133 accuracy binary     0.818   100 0.00319 Preprocessor1_Model45
 9       130 accuracy binary     0.818   100 0.00316 Preprocessor1_Model44
10       127 accuracy binary     0.818   100 0.00314 Preprocessor1_Model43</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="fu">select_best</span>(fits_knn_boot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  neighbors .config              
      &lt;dbl&gt; &lt;chr&gt;                
1       145 Preprocessor1_Model49</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>The next most common is to choose the simplest (least flexible) model that has performance within one SE of the best performing configuration.</p>
<ul>
<li>Use <code>select_by_one_std_err()</code></li>
<li>Sort performance results from least to most flexible (e.g., <code>desc(neighbors)</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">select_by_one_std_err</span>(fits_knn_boot, </span>
<span id="cb71-2"><a href="#cb71-2"></a>                      <span class="fu">desc</span>(neighbors))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 9
  neighbors .metric  .estimator  mean     n std_err .config               .best
      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt;
1       148 accuracy binary     0.819   100 0.00323 Preprocessor1_Model50 0.819
  .bound
   &lt;dbl&gt;
1  0.816</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>We should also refit a final model with the “best” hyperparameter using the full data as before</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>rec_prep <span class="ot">&lt;-</span> rec_knn <span class="sc">|&gt;</span>   </span>
<span id="cb73-2"><a href="#cb73-2"></a>  <span class="fu">prep</span>(data_all)</span>
<span id="cb73-3"><a href="#cb73-3"></a></span>
<span id="cb73-4"><a href="#cb73-4"></a>feat_all <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb73-5"><a href="#cb73-5"></a>  <span class="fu">bake</span>(data_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li><p>We can use the <code>select_*()</code> from above to use this best hyperparameter in our specification of the algorithm</p></li>
<li><p>Note that we now fit using all the data and switch to <code>fit()</code> rather than <code>tune_grid()</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>fit_knn_best <span class="ot">&lt;-</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="fu">select_best</span>(fits_knn_boot)<span class="sc">$</span>neighbors) <span class="sc">|&gt;</span> </span>
<span id="cb74-3"><a href="#cb74-3"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb74-4"><a href="#cb74-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-5"><a href="#cb74-5"></a>  <span class="fu">fit</span>(disease <span class="sc">~</span> ., <span class="at">data =</span> feat_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>However, we can’t use the previous bootstrap resampling to evaluate this final/best model because we already used it to select this the best configuration</li>
<li>We need new, held-out data to evaluate it (a new test set!)</li>
</ul>
</section>
<section id="resampling-for-both-model-selection-and-evaluation" class="slide level2">
<h2>Resampling for Both Model Selection and Evaluation</h2>
<p>Resampling methods can be used to get model performance estimates to <strong>select</strong> the best model configuration and/or <strong>evaluate</strong> that best model</p>
<ul>
<li><p>So far we have done EITHER selection OR evaluation but not both together</p></li>
<li><p>The concepts to both select the best configuration and evaluation it are similar but it requires different (slightly more complicated) resampling than what we have done so far</p></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li><p>If you use your held-out resamples to select the best model among a number of model configurations then the same held-out resamples cannot also be used to evaluate the performance of that same best model</p></li>
<li><p>If it is, the performance metric will have <strong>optimization bias</strong>. To the degree that there is any noise (i.e., variance) in the measurement of performance, selecting the best model configuration will capitalize on this noise.</p></li>
<li><p>You need to use one set of held out resamples (validation sets) to select the best model. Then you need a DIFFERENT set of held out resamples (test sets) to evaluate that best model.</p></li>
</ul>
</section>
<section class="slide level2">

<p>There are two strategies for this:</p>
<ul>
<li>Strategy 1:
<ul>
<li>First, hold out a test set for final/best model evaluation (using <code>initial_split()</code>).<br>
</li>
<li>Then use one of the above resampling methods (single validation set approach, k-fold, or bootstrap) to select the best model configuration.<br>
</li>
<li>Bootstrap is likely best option b/c it is typically more precise (though biased)</li>
</ul></li>
<li>Strategy 2: Nested resampling. More on this in a moment</li>
</ul>
</section>
<section class="slide level2">

<p>Other Observations about Common Practices:</p>
<ul>
<li>Simple resampling methods with the full sample (and no held-out test set) to both select AND evaluate are still common</li>
<li>Failure by some (even Kuhn) to appreciate the degree of optimization bias</li>
<li>Particular problem in Psychology because of small n (high variance in our performance metric)?</li>
<li>Can be fine if you just want to find the best model configuration but don’t need to evaluate its performance rigorously (i.e., you don’t really care that much about validity of your performance estimate of your final model and are fine with it being a bit optimistic)</li>
</ul>
</section>
<section class="slide level2">

<h3 id="bootstrap-with-test-set">Bootstrap with Test Set</h3>
<ul>
<li><p>First we divide our data into training and test using <code>inital_split()</code></p></li>
<li><p>Next, we use bootstrap resampling with the training set to split training into many held-in and held-out sets. We use these held-out (OOB) sets as validation sets to select the best model configuration based on mean/median performance across those sets.</p></li>
<li><p>After we select the best model configuration using bootstrap resampling of the training set</p>
<ul>
<li>We refit that model configuration in the FULL training set</li>
<li>And we use that model to predict into the test set to evaluate it</li>
</ul></li>
<li><p>Of course, in the end, if you plan to use the model, you will refit this final model configuration to the FULL dataset but the performance estimate for that model will come from test set on th previous step (there are no more data to estimate new performance)</p></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Use <code>initial_split()</code> for first train/test split</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb75-2"><a href="#cb75-2"></a>splits_test <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb75-3"><a href="#cb75-3"></a>  <span class="fu">initial_split</span>(<span class="at">prop =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">strata =</span> <span class="st">"disease"</span>)</span>
<span id="cb75-4"><a href="#cb75-4"></a></span>
<span id="cb75-5"><a href="#cb75-5"></a>data_trn <span class="ot">&lt;-</span> splits_test <span class="sc">|&gt;</span> </span>
<span id="cb75-6"><a href="#cb75-6"></a>  <span class="fu">analysis</span>()</span>
<span id="cb75-7"><a href="#cb75-7"></a></span>
<span id="cb75-8"><a href="#cb75-8"></a>data_test <span class="ot">&lt;-</span> splits_test <span class="sc">|&gt;</span> </span>
<span id="cb75-9"><a href="#cb75-9"></a>  <span class="fu">assessment</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Use training set for model selection via resampling (in this case bootstrap)</li>
<li>No need for another seed</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>splits_boot_trn <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2"></a>  <span class="fu">bootstraps</span>(<span class="at">times =</span> <span class="dv">100</span>, <span class="at">strata =</span> <span class="st">"disease"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Use the same grid of hyperparameters we set up earlier (<code>hyper_grid</code>)</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Fit model configurations that vary by K in all 100 bootstrap samples</li>
<li>Make predictions and calculate accuracy for these fitted models in 100 OOB (validation) sets</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>fits_knn_boot_trn <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb77-2"><a href="#cb77-2"></a>  <span class="at">expr =</span> {</span>
<span id="cb77-3"><a href="#cb77-3"></a>    <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb77-4"><a href="#cb77-4"></a>      <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-5"><a href="#cb77-5"></a>      <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-6"><a href="#cb77-6"></a>      <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_knn, </span>
<span id="cb77-7"><a href="#cb77-7"></a>                <span class="at">resamples =</span> splits_boot_trn, </span>
<span id="cb77-8"><a href="#cb77-8"></a>                <span class="at">grid =</span> hyper_grid, </span>
<span id="cb77-9"><a href="#cb77-9"></a>                <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb77-10"><a href="#cb77-10"></a>  },</span>
<span id="cb77-11"><a href="#cb77-11"></a>  <span class="at">dir =</span> <span class="st">"cache/"</span>,</span>
<span id="cb77-12"><a href="#cb77-12"></a>  <span class="at">file =</span> <span class="st">"fits_knn_boot_trn"</span>,</span>
<span id="cb77-13"><a href="#cb77-13"></a>  <span class="at">rerun =</span> rerun_setting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Select the best model configuration (best k)
<ul>
<li><p>K = 97 is the best model configuration determined by bootstrap resampling</p></li>
<li><p>BUT this is NOT the correct estimate of its performance in new data</p></li>
<li><p>We compared 50 model configurations (values of k). This performance estimate may have some optimization bias (though 50 model configurations is really not THAT many)</p></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="fu">show_best</span>(fits_knn_boot_trn, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
   neighbors .metric  .estimator  mean     n std_err .config              
       &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1        91 accuracy binary     0.815   100 0.00309 Preprocessor1_Model31
 2        97 accuracy binary     0.815   100 0.00305 Preprocessor1_Model33
 3       100 accuracy binary     0.815   100 0.00302 Preprocessor1_Model34
 4       124 accuracy binary     0.815   100 0.00299 Preprocessor1_Model42
 5       121 accuracy binary     0.815   100 0.00299 Preprocessor1_Model41
 6        88 accuracy binary     0.815   100 0.00306 Preprocessor1_Model30
 7        79 accuracy binary     0.815   100 0.00300 Preprocessor1_Model27
 8        94 accuracy binary     0.815   100 0.00302 Preprocessor1_Model32
 9        85 accuracy binary     0.814   100 0.00299 Preprocessor1_Model29
10        73 accuracy binary     0.814   100 0.00309 Preprocessor1_Model25</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>show exact means</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="fu">show_best</span>(fits_knn_boot_trn, <span class="at">n =</span> <span class="dv">10</span>)<span class="sc">$</span>mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.8149497 0.8148387 0.8147184 0.8147127 0.8146859 0.8146851 0.8145969
 [8] 0.8145515 0.8144602 0.8144509</code></pre>
</div>
</div>
<ul>
<li>select best</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">select_best</span>(fits_knn_boot_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  neighbors .config              
      &lt;dbl&gt; &lt;chr&gt;                
1        91 Preprocessor1_Model31</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Fit the k = 97 model configuration in the full training set</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>rec_prep <span class="ot">&lt;-</span> rec_knn <span class="sc">|&gt;</span> </span>
<span id="cb84-2"><a href="#cb84-2"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb84-3"><a href="#cb84-3"></a></span>
<span id="cb84-4"><a href="#cb84-4"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb84-5"><a href="#cb84-5"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb84-6"><a href="#cb84-6"></a></span>
<span id="cb84-7"><a href="#cb84-7"></a>feat_test <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb84-8"><a href="#cb84-8"></a>  <span class="fu">bake</span>(data_test)</span>
<span id="cb84-9"><a href="#cb84-9"></a></span>
<span id="cb84-10"><a href="#cb84-10"></a>fit_knn_best <span class="ot">&lt;-</span></span>
<span id="cb84-11"><a href="#cb84-11"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="fu">select_best</span>(fits_knn_boot_trn)<span class="sc">$</span>neighbors) <span class="sc">|&gt;</span> </span>
<span id="cb84-12"><a href="#cb84-12"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb84-13"><a href="#cb84-13"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb84-14"><a href="#cb84-14"></a>  <span class="fu">fit</span>(disease <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Use that fitted model to predict into test set</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="fu">accuracy_vec</span>(feat_test<span class="sc">$</span>disease, <span class="fu">predict</span>(fit_knn_best, feat_test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8333333</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Our best estimate of how accurate a model with k = 91 would be in new data is 0.8333333.</p>
<ul>
<li>However, it was only fit with n = 203 (the training set).<br>
</li>
<li>If we truly want the best model, we should now train once again with all of our data.<br>
</li>
<li>This model would likely perform even better b/c it has &gt; n.<br>
</li>
<li>However, we have no more new data to evaluate it!</li>
<li>There is no perfect performance estimate!</li>
</ul>
</section>
<section id="nested-resampling" class="slide level2">
<h2>Nested Resampling</h2>
<p>And now the final, mind-blowing extension!!!!!<br>
<br>
The bootstrap resampling + test set approach to simultaneously select and evaluate models is commonly used<br>
<br>
However, it suffers from the same problems as the single validation set approach</p>
<ul>
<li>It only uses a single small held out test set. In this case, 1/3 of the total sample size.
<ul>
<li>This will yield a high variance/imprecise estimate of model performance</li>
</ul></li>
<li>It also yields a biased estimate of model performance
<ul>
<li>The model we evaluated in test was fit to only the training data which was only 2/3 of total sample size</li>
<li>Yet our true final model is trained with the full dataset</li>
<li>We are likely underestimating its true performance</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<p>Nested resampling offers an improvement with respect to these two issues<br>
<br>
Nested resampling involves two loops</p>
<ul>
<li>The inner loop is used for model selection</li>
<li>The outer loop is used for model evaluation<br>
<br>
</li>
</ul>
<p>Nested resampling is VERY CONFUSING at first (like the first year you use it!)<br>
<br>
Nested resampling isn’t fully supported by tidymodels as of yet. You have to do some coding to iterate over the outer loop<br>
<br>
Application of nested resampling is outside the scope of this course but you should understand it conceptually. For further reading on the implementation of this method, see <a href="https://www.tidymodels.org/learn/work/nested-resampling/">an example</a> provided by the tidymodels folks.</p>
</section>
<section class="slide level2">

<p>A ‘simple’ example using bootstrap for inner loop and 10-fold CV for outer loop</p>
<ul>
<li>Divide the full sample into 10 folds</li>
<li>Iterate through those 10 folds as follows (this is the outer loop)
<ul>
<li>Hold out fold 1</li>
<li>Use folds 2-10 to do the inner loop bootstrap
<ul>
<li>Bootstrap these folds B times</li>
<li>Fit models in B bootstrap samples</li>
<li>Calculate <em>selection performance metrics</em> in B out-of-bag samples</li>
<li>Average the B bootstrapped <em>selection performance metrics</em> for each model configuration</li>
<li>Select the best model configuration using this average bootstrapped <em>selection performance metric</em></li>
</ul></li>
<li>Use best model configuration from folds 2-10 to make predictions for the held-out fold 1 to get the first (of ten) <em>evaluation performance metrics</em></li>
<li>Repeat for held out fold 2 - 10</li>
</ul></li>
<li>Average the 10 <em>evaluation performance metrics.</em> This is the expected performance of a best model configuration (selected by B bootstraps) in new data. [You still don’t know what configuration you should use because you have 10 ‘best’ model configurations]</li>
<li>Do B bootstraps with the full sample to select the best model configuration</li>
<li>Fit this best model configuration to the full data</li>
</ul>
</section>
<section class="slide level2">

<p>Nested resampling evaluates a fitting and selection process not a specific model configuration!</p>
<ul>
<li><p>You therefore need to select a final model configuration using same resampling with full data</p></li>
<li><p>You then need to fit that new model configuration to the full data</p></li>
<li><p>That was the last two steps on the previous page</p></li>
</ul>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<p><strong>Question: Why bootstrap on inner loop and k-fold on outer loop?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb87-1"><a href="#cb87-1"></a>The inner loop is used for selecting models.  Bootstrap yields low variance performance</span>
<span id="cb87-2"><a href="#cb87-2"></a>estimates (but they are biased).  We want low variance to select best model</span>
<span id="cb87-3"><a href="#cb87-3"></a>configuration.  K-fold is a good method for less biased performance estimates.  </span>
<span id="cb87-4"><a href="#cb87-4"></a>We want less bias in our final evaluation of our best model.  You can do repeated</span>
<span id="cb87-5"><a href="#cb87-5"></a>K-fold in the outer loop to both reduce its variance and give you a sense of the</span>
<span id="cb87-6"><a href="#cb87-6"></a>performance sampling distribution. BUT VERY COMPUTATIONALLY INTENSIVE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="data-exploration-in-a-nested-world." class="slide level2">
<h2>Data Exploration in a Nested World….</h2>
<p>Final words on resampling:</p>
<ul>
<li><p>Iterative methods (K-fold, bootstrap) are superior to single validation set approach wrt bias-variance trade-off in performance measurement</p></li>
<li><p>K-Fold resampling should be used if you looking for a performance estimate of a single model configuration</p></li>
<li><p>Bootstrap resampling should be used if you are looking only to choose among model configurations but don’t need an independent assessment of that final model</p></li>
<li><p>Bootstrap resampling + Test set or Nested Resampling should be used when you plan to both select among model configurations AND evaluate the best model</p></li>
<li><p>Nested resampling must be handled very carefully wrt modeling EDA b/c it uses all the data</p>
<ul>
<li>Can use eyeball sample (10-20% of data) without much affect on performance measurement</li>
<li>If you plan to do a lot of exploration (e.g., lots of feature engineering and feature selection), you should probably use Bootstrap resampling + Test set</li>
</ul></li>
</ul>
</section>
<section id="discussion" class="slide level2 smaller scrollable">
<h2>Discussion</h2>
<h3 id="and-the-winner-is..">and the winner is…..</h3>
<pre><code>student      n correct_predictions accuracy
   &lt;chr&gt;    &lt;int&gt;               &lt;dbl&gt;    &lt;dbl&gt;
 1 vachuska   327                 262    0.801 (Karl)
 2 hou        327                 257    0.786 (Lihao)
 3 dubree     327                 256    0.783 (Will)
 4 cheung     327                 253    0.774 (Alex)
 5 stein      327                 253    0.774 (Andrea)
 6 ma         327                 251    0.768 (Yuanxue)

0.758
0.755
0.755
0.734
0.731
0.716
0.688
0.676
0.676</code></pre>
<h3 id="other-announcements">Other announcements</h3>
<ul>
<li><p>Mid-term Exam</p></li>
<li><p>I understand if this isn’t possible, but I’ve noticed that for the most part, only TAs and John respond to errors in Slack, which is fine but creates more work for them. Maybe if there was more motivation (like extra credit) or something to answer people’s questions in the Slack, more people might do it?</p></li>
<li><p>Midnight deadlines? 8 pm?</p></li>
<li><p>It would be great if there was any easy way to download each section of the web book in a format that could be annotated</p></li>
<li><p>Can you upload previous videos (unit 1 - 3) to uw-madison site? As second language student, subtitles are really helpful.</p></li>
</ul>
<h3 id="questions">Questions</h3>
<ul>
<li><p>Resampling methods to EITHER select best model OR evaluate best model</p>
<ul>
<li><p>Single validation set</p></li>
<li><p>LOOCV</p></li>
<li><p>K-fold</p></li>
<li><p>Repeated k-fold</p></li>
<li><p>Bootstrap</p></li>
<li><p>ALSO: grouped k-fold</p></li>
</ul></li>
<li><p>What about when we need to do both selection and evaluation?</p>
<ul>
<li>What is optimization bias?</li>
<li>Combine above method with held out test set</li>
<li>Nested CV (see <a href="https://www.tidymodels.org/learn/work/nested-resampling/">tutorial</a>)</li>
</ul></li>
<li><p>Model selection by resampling to “tune” hyperparameters</p></li>
<li><p>Model selection by resampling for explanatory purposes</p></li>
<li><p>Data leakage</p></li>
<li><p>How does parallel processing work?</p></li>
</ul>
<div class="footer footer-default">

</div>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-ISL" class="csl-entry" role="doc-biblioentry">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2023. <em>An <span>Introduction</span> to <span>Statistical Learning</span>: With <span>Applications</span> in <span>R</span></em>. 2nd ed. Springer <span>Texts</span> in <span>Statistics</span>. <span>New York</span>: <span>Springer-Verlag</span>.
</div>
<div id="ref-APM" class="csl-entry" role="doc-biblioentry">
Kuhn, Max, and Kjell Johnson. 2018. <em>Applied <span>Predictive Modeling</span></em>. 1st ed. 2013, Corr. 2nd printing 2018 edition. <span>New York</span>: <span>Springer</span>.
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="005_resampling_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="005_resampling_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="005_resampling_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="005_resampling_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="005_resampling_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="005_resampling_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="005_resampling_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="005_resampling_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="005_resampling_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="005_resampling_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="005_resampling_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>