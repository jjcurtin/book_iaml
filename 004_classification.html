<!DOCTYPE html>
<html lang="en"><head>
<script src="004_classification_files/libs/clipboard/clipboard.min.js"></script>
<script src="004_classification_files/libs/quarto-html/tabby.min.js"></script>
<script src="004_classification_files/libs/quarto-html/popper.min.js"></script>
<script src="004_classification_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="004_classification_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="004_classification_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="004_classification_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="004_classification_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.433">

  <title>classification</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="004_classification_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="004_classification_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="004_classification_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="slides.css">
  <link href="004_classification_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="004_classification_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="004_classification_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="004_classification_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="004_classification_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="004_classification_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  
  <script src="004_classification_files/libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="004_classification_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">


<section>
<section id="introduction-to-classification-models" class="title-slide slide level1 center">
<h1>Introduction to Classification Models</h1>

</section>
<section id="unit-overview" class="slide level2">
<h2>Unit Overview</h2>
<h3 id="learning-objectives">Learning Objectives</h3>
<ul>
<li>Bayes classifier</li>
<li>Logistic regression
<ul>
<li>probability, odds, and logit models</li>
<li>definitions of odds and odds ratios</li>
</ul></li>
<li>K nearest neighbors for classification</li>
<li>Linear discriminant analysis</li>
<li>Quadratic discriminant analysis</li>
<li>Regularized discriminant analysis</li>
<li>Decision boundaries in the two feature space</li>
<li>Relative costs and benefits of these different statistical algorithms</li>
</ul>
</section>
<section class="slide level2">

<h3 id="readings">Readings</h3>
<ul>
<li><span class="citation" data-cites="ISL">James et al. (<a href="#/references" role="doc-biblioref" onclick="">2023</a>)</span> <a href="pdfs/isl_2.pdf">Chapter 4, pp 129 - 164</a></li>
</ul>
<h3 id="lecture-videos">Lecture Videos</h3>
<ul>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-1/1_5xvs5z3f">Lecture 1: The Bayes Classifier</a> ~ 9 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-2/1_ut2up1mo">Lecture 2: Conceptual Overview of Logistic Regression</a> ~ 19 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-3/1_vydb2j8t">Lecture 3: EDA with the Cars Dataset</a> ~ 12 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-4/1_dzqnsnf0">Lecture 4: Logistic Regression with Cars Dataset</a> ~ 32 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-5/1_mj1cyhhj">Lecture 5: KNN with Cars Dataset</a> ~ 19 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-6/1_t7mnafsp">Lecture 6: LDA, DQA, RDA with Cars Dataset</a> ~ 16 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+4-7/1_tw44we5w">Lecture 7: Comparisons among Classifiers</a> ~ 11 mins</li>
</ul>
<p>Post questions or discuss readings or lectures on the appropriate Slack channel</p>
</section>
<section class="slide level2">

<h3 id="application-assignment-and-quiz">Application Assignment and Quiz</h3>
<ul>
<li>data: <a href="application_assignments/unit_04/titanic_raw.csv">raw</a>; <a href="application_assignments/unit_04/titanic_test_cln.csv">test</a></li>
<li><a href="application_assignments/unit_04/titanic_data_dictionary.png">data dictionary</a></li>
<li><a href="https://raw.githubusercontent.com/jjcurtin/book_iaml/main/application_assignments/unit_04/hw_unit_04_eda_cleaning.qmd">cleaning EDA qmd</a></li>
<li><a href="https://raw.githubusercontent.com/jjcurtin/book_iaml/main/application_assignments/unit_04/hw_unit_04_fit_rda.qmd">rda qmd</a></li>
<li><a href="https://raw.githubusercontent.com/jjcurtin/book_iaml/main/application_assignments/unit_04/hw_unit_04_fit_knn.qmd">knn qmd</a></li>
<li>solution: <a href="">modeling EDA</a> <a href="">rda</a>; <a href="">knn</a></li>
</ul>
<p>Post questions to application_assignments</p>
<p>Submit the application assignment <a href="https://canvas.wisc.edu/courses/395546/assignments/2187689">here</a> and complete the <a href="https://canvas.wisc.edu/courses/395546/quizzes/514051">unit quiz</a> by 8 pm on Wednesday, February 14th</p>
</section>
<section class="slide level2">

<p>Our eventual goal in this unit is for you to build a machine learning classification model that can accurately predict who lived vs.&nbsp;died on the titanic.<br>
<br>
<br>
Prior to that, we will work with an example where we classify a car as high or low fuel efficient (i.e., a dichtomous outcome based on miles per gallon) using features engineered from its characteristics</p>
</section>
<section id="bayes-classifier" class="slide level2">
<h2>Bayes Classifier</h2>
<p>First, lets introduce the Bayes classifier, which is the classifier that will have the lowest error rate of all classifiers using the same set of features.<br>
<br>
The figure below displays simulated data for a classification problem for K = 2 classes as a function of <code>X1</code> and <code>X2</code></p>
<p><img data-src="figs/unit4_two_class_decision_boundry.png" style="height:4in"></p>
<p>The Bayes classifier assigns each observation its most likely class given its conditional probabilities for the values for <code>X1</code> and <code>X2</code></p>
<ul>
<li><span class="math inline">\(Pr(Y = k | X = x_0) for\:k = 1:K\)</span></li>
<li>For K = 2, this means assigning to the class with Pr &gt; .50</li>
<li>This decision boundary for the two class problem is displayed in the figure</li>
</ul>
</section>
<section class="slide level2">

<p>The Bayes classifier provides the minimum error rate for test data</p>
<ul>
<li>Error rate for any <span class="math inline">\(x_0\)</span> will be <span class="math inline">\(1 - max (Pr( Y = k | X = x_0))\)</span></li>
<li>Overall error rate will be the average of this across all possible X</li>
<li>This is the irreducible error for classification problems</li>
<li>This is a theoretical model b/c (except for simulated data), we don’t know the conditional probabilities based on X</li>
<li>Many classification models try to estimate these conditionals</li>
</ul>
<p>Let’s talk now about some of these classification models</p>
</section>
<section id="logistic-regression-a-conceptual-review" class="slide level2">
<h2>Logistic Regression: A Conceptual Review</h2>
<p>Logistic regression (a special case of the <strong>generalized</strong> linear model) estimates the conditional probability for each class given X (a specific set of values for our features)</p>
<ul>
<li>In the binary outcome case, we will often refer to the two outcomes as the positive class and the negative class</li>
<li>This makes most sense in some applied settings where we are most interested in predicting if one of the two classes is likely, e.g.,
<ul>
<li>Presence of heart disease</li>
<li>Positive for some psychiatric diagnoses</li>
<li>Lapse back to alcohol use in people with alcohol use disorder</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<p>Logistic regression is used frequently for binary and multi-level outcomes because</p>
<ul>
<li>The general linear model makes predictions that are not bounded by [0, 1] and do not represent true estimates of conditional probability for each class</li>
<li>Logistic regression approaches can be modified to accommodate multi-class outcomes (i.e., more than two levels) even when they are not ordered</li>
<li>Nonetheless, the general linear model is still used at times to predict binary outcomes (see <a href="https://en.wikipedia.org/wiki/Linear_probability_model">Linear Probability Model</a>) so you should be aware of it. We won’t discuss it further here.</li>
</ul>
<p><img data-src="figs/unit4_lm_vs_logistic.png" style="height:4in"></p>
</section>
<section class="slide level2">

<p>Logistic regression provides predicted conditional probabilities for one class (positive class) for any specific set of values for our features (X)</p>
<ul>
<li><p><span class="math inline">\(Pr(positive\:class | X) = \frac{e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}{1 + e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}\)</span></p></li>
<li><p>These conditional probabilities are bounded by [0, 1]</p></li>
<li><p>To maximize accuracy (as per Bayes classifier),</p>
<ul>
<li>we predict the positive case if <span class="math inline">\(Pr(positive class | X) &gt; .5\)</span> for any specific X</li>
<li>otherwise we predict the negative class</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<p>As a simple parametric model, logistic regression is commonly used for explanatory purposes as well as prediction<br>
<br>
For these reasons, it is worthwhile to fully understand how to work with the logistic function to quantify and describe the effects of your features/predictors in terms of</p>
<ul>
<li>Probability</li>
<li>Odds</li>
<li>[Log-odds or logit]</li>
<li>Odds ratio</li>
</ul>
</section>
<section class="slide level2">

<p>The logistic function yields the probability of the positive class given X</p>
<ul>
<li>However, in some instances (e.g., horse racing, poker), it may make more sense to describe the odds of the positive case occurring rather than probability<br>
<br>
</li>
</ul>
<p>Odds are defined with respect to probabilities as follows:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|X)} {1 - Pr(positive\:class|X)}\)</span></li>
</ul>
</section>
<section class="slide level2">

<p>For example, if the UW Badgers have a .5 probability of winning some upcoming game based on X, their odds of winning are 1 (to 1)</p>
<ul>
<li><span class="math inline">\(\frac{0.5} {1 - 0.5}\)</span><br>
<br>
</li>
</ul>
<p>If the UW Badgers have a .75 probability of winning some upcoming game based on X, their odds of winning are 3 (:1; ‘3 to 1’)</p>
<ul>
<li><span class="math inline">\(\frac{0.75} {1 - 0.75}\)</span></li>
</ul>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Question: If the UW Badgers have a .25 probability of winning some upcoming game based on X, what are their odds of winning?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1"></a>.25 / (1 - .25) = 0.33 or 1:3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>The logistic function can be modified to provide odds directly:<br>
<br>
<strong>Logistic function</strong>:</p>
<ul>
<li><span class="math inline">\(Pr(positive\:class | X) = \frac{e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}{1 + e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}\)</span><br>
<br>
</li>
</ul>
<p><strong>Definition of odds</strong>:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|X)} {1 - Pr(positive\:class|X)}\)</span><br>
<br>
</li>
</ul>
<p>Substitute logistic function for <span class="math inline">\(Pr(positive\:class|X)\)</span> on top and bottom and simplify to get:</p>
<ul>
<li><span class="math inline">\(odds(positive\:class|X) = e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}\)</span></li>
<li>Odds are bounded by [0, <span class="math inline">\(\infty\)</span>]</li>
</ul>
</section>
<section class="slide level2">

<p>The logistic function can be modified further such that the outcome (log-odds/logit) is a linear function of your features<br>
<br>
If we take the natural log (base e) of both sides of the odds equation, we get:</p>
<ul>
<li><span class="math inline">\(log(odds(positive\:class|X)) = \beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p\)</span></li>
<li>Log-odds are unbounded <span class="math inline">\([-\infty, \infty]\)</span><br>
<br>
</li>
</ul>
<p>Use of logit transformation:</p>
<ul>
<li>provides the connection between the general linear model and generalized linear models (in this case with link = logit, family = binomial).<br>
</li>
<li>Notice that the logit/log-odds is a linear combination of the features (just like in the general linear model)</li>
</ul>
</section>
<section class="slide level2">

<p><strong>Odds</strong> and <strong>probability</strong> are descriptive but they are not linear functions of X</p>
<ul>
<li>Therefore, parameter estimates from these models aren’t very useful to describe the effect of features</li>
<li>This is because unit change in Y per unit change in any specific feature is not the same for all values of the feature</li>
</ul>
</section>
<section class="slide level2">

<p><strong>Log-odds</strong> are a linear function of X</p>
<ul>
<li>Therefore, you can say that log-odds of positive class increases by <span class="math inline">\(b_1\)</span> (our estimate of <span class="math inline">\(\beta_1\)</span>) for every one unit increase in <span class="math inline">\(x_1\)</span></li>
<li>However, log-odds are NOT very descriptive/intuitive so they are not that useful for explanatory purposes</li>
</ul>
</section>
<section class="slide level2">

<p>The <strong>odds ratio</strong> addresses these problems<br>
<br>
Odds are defined at a specific set of values across the features in your model. For example, with one feature:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|x_1)} {1 - Pr(positive\:class|x_1)}\)</span><br>
<br>
</li>
</ul>
<p>The odds ratio describes the change in odds for a change of c units in your feature. With some manipulation:</p>
<ul>
<li><span class="math inline">\(Odds\:ratio = \frac{odds(x+c)}{odds(x)}\)</span></li>
<li><span class="math inline">\(Odds\:ratio = \frac{e^{\beta_0 + \beta_1*(x_1 + c)}}{e^{\beta_0 + \beta_1*x_1}}\)</span></li>
<li><span class="math inline">\(Odds\:ratio = e^{c*\beta_1}\)</span></li>
</ul>
</section>
<section class="slide level2">

<p>As an example, if we fit a logistic regression model to predict the probability of the Badgers winning a home football game given the attendance (measured in individual spectators at the game), we might find <span class="math inline">\(b_1\)</span> (our estimate of <span class="math inline">\(\beta_1\)</span>) = .000075.<br>
<br>
Given this, the odds ratio associated with every increase in 10,000 spectators:</p>
<ul>
<li><span class="math inline">\(= e^{c * \b_1}\)</span></li>
<li><span class="math inline">\(= e^{10000 * .000075}\)</span></li>
<li><span class="math inline">\(= 2.1\)</span></li>
<li>For every increase of 10,000 spectators, the odds of the Badgers winning doubles</li>
</ul>
</section>
<section id="the-cars-dataset" class="slide level2">
<h2>The Cars Dataset</h2>
<p>Now, let’s put this all of this together in the Cars dataset from Carnegie Mellon’s <a href="http://lib.stat.cmu.edu/datasets/">StatLib Dataset Archive</a><br>
<br>
<br>
Our goal is to build a classifier (machine learning model for a categorical outcome) that classifies cars as either high or low mpg.</p>
</section>
<section class="slide level2">

<h3 id="cleaning-eda">Cleaning EDA</h3>
<p>Let’s start with some cleaning EDA</p>
<ul>
<li>Open and “skim” it RE variable names, classes &amp; missing data</li>
<li>Variable names are already tidy</li>
<li>no missing data</li>
<li>mins (p0) and maxes(p100) for numeric look good</li>
<li>there are two character variables (<code>mpq</code> and <code>name</code>) that will need to be re-classed</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>data_all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_all.csv"</span>),</span>
<span id="cb2-2"><a href="#cb2-2"></a>                     <span class="at">col_types =</span> <span class="fu">cols</span>()) </span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>data_all <span class="sc">|&gt;</span> <span class="fu">skim_some</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data_all</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">392</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mpg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">name</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">301</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cylinders</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">displacement</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">455.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">horsepower</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">230.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">weight</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1613</td>
<td style="text-align: right;">5140.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acceleration</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">24.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">82.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">origin</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li><code>mpg</code> is ordinal, so lets set the levels to indicate the order.</li>
<li>After reviewing the <a href="data/auto_data_dictionary.pdf">data dictionary</a>, we see that <code>origin</code> is a nominal predictor that is coded numeric (where 1 = American, 2 = European, and 3 = Japanese). Let’s recode as character with meaningful labels and then class as a factor</li>
<li>and lets not forget to re-class <code>name</code> too</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-2-1"><a href="#annotated-cell-2-1"></a>data_all <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-2-2"><a href="#annotated-cell-2-2"></a>  <span class="fu">mutate</span>(<span class="at">mpg =</span> <span class="fu">factor</span>(mpg, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"high"</span>)),</span>
<span id="annotated-cell-2-3"><a href="#annotated-cell-2-3"></a>         <span class="at">name =</span> <span class="fu">factor</span>(name), </span>
<span id="annotated-cell-2-4"><a href="#annotated-cell-2-4"></a>         <span class="at">origin =</span> <span class="fu">factor</span> (origin),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-2-5" class="code-annotation-target"><a href="#annotated-cell-2-5"></a>         <span class="at">origin =</span> <span class="fu">fct_recode</span>(<span class="fu">as.character</span>(origin),</span>
<span id="annotated-cell-2-6"><a href="#annotated-cell-2-6"></a>                             <span class="st">"american"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="annotated-cell-2-7"><a href="#annotated-cell-2-7"></a>                            <span class="st">"european"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="annotated-cell-2-8"><a href="#annotated-cell-2-8"></a>                            <span class="st">"japanese"</span> <span class="ot">=</span> <span class="st">"3"</span>)) </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-2" data-code-annotation="1"><code>fct_recode()</code> works on levels stored as characters, so convert 1, 2, 3, to character first.</span>
</dd>
</dl>
</div>
</div>
</section>
<section class="slide level2">

<p>Now, we can explore responses for categorical variables</p>
<ul>
<li>Other than <code>name</code>, responses for all other variables are tidy</li>
<li><code>name</code> has many different responses</li>
<li>We won’t know how to handle this until we get to later units in the class on natural language processing!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>data_all <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor)) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">walk</span>(\(column) <span class="fu">print</span>(<span class="fu">levels</span>(column)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "low"  "high"
[1] "american" "european" "japanese"
  [1] "amc ambassador brougham"             
  [2] "amc ambassador dpl"                  
  [3] "amc ambassador sst"                  
  [4] "amc concord"                         
  [5] "amc concord d/l"                     
  [6] "amc concord dl 6"                    
  [7] "amc gremlin"                         
  [8] "amc hornet"                          
  [9] "amc hornet sportabout (sw)"          
 [10] "amc matador"                         
 [11] "amc matador (sw)"                    
 [12] "amc pacer"                           
 [13] "amc pacer d/l"                       
 [14] "amc rebel sst"                       
 [15] "amc spirit dl"                       
 [16] "audi 100 ls"                         
 [17] "audi 100ls"                          
 [18] "audi 4000"                           
 [19] "audi 5000"                           
 [20] "audi 5000s (diesel)"                 
 [21] "audi fox"                            
 [22] "bmw 2002"                            
 [23] "bmw 320i"                            
 [24] "buick century"                       
 [25] "buick century 350"                   
 [26] "buick century limited"               
 [27] "buick century luxus (sw)"            
 [28] "buick century special"               
 [29] "buick electra 225 custom"            
 [30] "buick estate wagon (sw)"             
 [31] "buick lesabre custom"                
 [32] "buick opel isuzu deluxe"             
 [33] "buick regal sport coupe (turbo)"     
 [34] "buick skyhawk"                       
 [35] "buick skylark"                       
 [36] "buick skylark 320"                   
 [37] "buick skylark limited"               
 [38] "cadillac eldorado"                   
 [39] "cadillac seville"                    
 [40] "capri ii"                            
 [41] "chevroelt chevelle malibu"           
 [42] "chevrolet bel air"                   
 [43] "chevrolet camaro"                    
 [44] "chevrolet caprice classic"           
 [45] "chevrolet cavalier"                  
 [46] "chevrolet cavalier 2-door"           
 [47] "chevrolet cavalier wagon"            
 [48] "chevrolet chevelle concours (sw)"    
 [49] "chevrolet chevelle malibu"           
 [50] "chevrolet chevelle malibu classic"   
 [51] "chevrolet chevette"                  
 [52] "chevrolet citation"                  
 [53] "chevrolet concours"                  
 [54] "chevrolet impala"                    
 [55] "chevrolet malibu"                    
 [56] "chevrolet malibu classic (sw)"       
 [57] "chevrolet monte carlo"               
 [58] "chevrolet monte carlo landau"        
 [59] "chevrolet monte carlo s"             
 [60] "chevrolet monza 2+2"                 
 [61] "chevrolet nova"                      
 [62] "chevrolet nova custom"               
 [63] "chevrolet vega"                      
 [64] "chevrolet vega (sw)"                 
 [65] "chevrolet vega 2300"                 
 [66] "chevrolet woody"                     
 [67] "chevy c10"                           
 [68] "chevy c20"                           
 [69] "chevy s-10"                          
 [70] "chrysler cordoba"                    
 [71] "chrysler lebaron medallion"          
 [72] "chrysler lebaron salon"              
 [73] "chrysler lebaron town @ country (sw)"
 [74] "chrysler new yorker brougham"        
 [75] "chrysler newport royal"              
 [76] "datsun 1200"                         
 [77] "datsun 200-sx"                       
 [78] "datsun 200sx"                        
 [79] "datsun 210"                          
 [80] "datsun 210 mpg"                      
 [81] "datsun 280-zx"                       
 [82] "datsun 310"                          
 [83] "datsun 310 gx"                       
 [84] "datsun 510"                          
 [85] "datsun 510 (sw)"                     
 [86] "datsun 510 hatchback"                
 [87] "datsun 610"                          
 [88] "datsun 710"                          
 [89] "datsun 810"                          
 [90] "datsun 810 maxima"                   
 [91] "datsun b-210"                        
 [92] "datsun b210"                         
 [93] "datsun b210 gx"                      
 [94] "datsun f-10 hatchback"               
 [95] "datsun pl510"                        
 [96] "dodge aries se"                      
 [97] "dodge aries wagon (sw)"              
 [98] "dodge aspen"                         
 [99] "dodge aspen 6"                       
[100] "dodge aspen se"                      
[101] "dodge challenger se"                 
[102] "dodge charger 2.2"                   
[103] "dodge colt"                          
[104] "dodge colt (sw)"                     
[105] "dodge colt hardtop"                  
[106] "dodge colt hatchback custom"         
[107] "dodge colt m/m"                      
[108] "dodge coronet brougham"              
[109] "dodge coronet custom"                
[110] "dodge coronet custom (sw)"           
[111] "dodge d100"                          
[112] "dodge d200"                          
[113] "dodge dart custom"                   
[114] "dodge diplomat"                      
[115] "dodge magnum xe"                     
[116] "dodge monaco (sw)"                   
[117] "dodge monaco brougham"               
[118] "dodge omni"                          
[119] "dodge rampage"                       
[120] "dodge st. regis"                     
[121] "fiat 124 sport coupe"                
[122] "fiat 124 tc"                         
[123] "fiat 124b"                           
[124] "fiat 128"                            
[125] "fiat 131"                            
[126] "fiat strada custom"                  
[127] "fiat x1.9"                           
[128] "ford country"                        
[129] "ford country squire (sw)"            
[130] "ford escort 2h"                      
[131] "ford escort 4w"                      
[132] "ford f108"                           
[133] "ford f250"                           
[134] "ford fairmont"                       
[135] "ford fairmont (auto)"                
[136] "ford fairmont (man)"                 
[137] "ford fairmont 4"                     
[138] "ford fairmont futura"                
[139] "ford fiesta"                         
[140] "ford futura"                         
[141] "ford galaxie 500"                    
[142] "ford gran torino"                    
[143] "ford gran torino (sw)"               
[144] "ford granada"                        
[145] "ford granada ghia"                   
[146] "ford granada gl"                     
[147] "ford granada l"                      
[148] "ford ltd"                            
[149] "ford ltd landau"                     
[150] "ford maverick"                       
[151] "ford mustang"                        
[152] "ford mustang gl"                     
[153] "ford mustang ii"                     
[154] "ford mustang ii 2+2"                 
[155] "ford pinto"                          
[156] "ford pinto (sw)"                     
[157] "ford pinto runabout"                 
[158] "ford ranger"                         
[159] "ford thunderbird"                    
[160] "ford torino"                         
[161] "ford torino 500"                     
[162] "hi 1200d"                            
[163] "honda accord"                        
[164] "honda accord cvcc"                   
[165] "honda accord lx"                     
[166] "honda civic"                         
[167] "honda civic (auto)"                  
[168] "honda civic 1300"                    
[169] "honda civic 1500 gl"                 
[170] "honda civic cvcc"                    
[171] "honda prelude"                       
[172] "maxda glc deluxe"                    
[173] "maxda rx3"                           
[174] "mazda 626"                           
[175] "mazda glc"                           
[176] "mazda glc 4"                         
[177] "mazda glc custom"                    
[178] "mazda glc custom l"                  
[179] "mazda glc deluxe"                    
[180] "mazda rx-4"                          
[181] "mazda rx-7 gs"                       
[182] "mazda rx2 coupe"                     
[183] "mercedes benz 300d"                  
[184] "mercedes-benz 240d"                  
[185] "mercedes-benz 280s"                  
[186] "mercury capri 2000"                  
[187] "mercury capri v6"                    
[188] "mercury cougar brougham"             
[189] "mercury grand marquis"               
[190] "mercury lynx l"                      
[191] "mercury marquis"                     
[192] "mercury marquis brougham"            
[193] "mercury monarch"                     
[194] "mercury monarch ghia"                
[195] "mercury zephyr"                      
[196] "mercury zephyr 6"                    
[197] "nissan stanza xe"                    
[198] "oldsmobile cutlass ciera (diesel)"   
[199] "oldsmobile cutlass ls"               
[200] "oldsmobile cutlass salon brougham"   
[201] "oldsmobile cutlass supreme"          
[202] "oldsmobile delta 88 royale"          
[203] "oldsmobile omega"                    
[204] "oldsmobile omega brougham"           
[205] "oldsmobile starfire sx"              
[206] "oldsmobile vista cruiser"            
[207] "opel 1900"                           
[208] "opel manta"                          
[209] "peugeot 304"                         
[210] "peugeot 504"                         
[211] "peugeot 504 (sw)"                    
[212] "peugeot 505s turbo diesel"           
[213] "peugeot 604sl"                       
[214] "plymouth 'cuda 340"                  
[215] "plymouth arrow gs"                   
[216] "plymouth champ"                      
[217] "plymouth cricket"                    
[218] "plymouth custom suburb"              
[219] "plymouth duster"                     
[220] "plymouth fury"                       
[221] "plymouth fury gran sedan"            
[222] "plymouth fury iii"                   
[223] "plymouth grand fury"                 
[224] "plymouth horizon"                    
[225] "plymouth horizon 4"                  
[226] "plymouth horizon miser"              
[227] "plymouth horizon tc3"                
[228] "plymouth reliant"                    
[229] "plymouth sapporo"                    
[230] "plymouth satellite"                  
[231] "plymouth satellite custom"           
[232] "plymouth satellite custom (sw)"      
[233] "plymouth satellite sebring"          
[234] "plymouth valiant"                    
[235] "plymouth valiant custom"             
[236] "plymouth volare"                     
[237] "plymouth volare custom"              
[238] "plymouth volare premier v8"          
[239] "pontiac astro"                       
[240] "pontiac catalina"                    
[241] "pontiac catalina brougham"           
[242] "pontiac firebird"                    
[243] "pontiac grand prix"                  
[244] "pontiac grand prix lj"               
[245] "pontiac j2000 se hatchback"          
[246] "pontiac lemans v6"                   
[247] "pontiac phoenix"                     
[248] "pontiac phoenix lj"                  
[249] "pontiac safari (sw)"                 
[250] "pontiac sunbird coupe"               
[251] "pontiac ventura sj"                  
[252] "renault 12 (sw)"                     
[253] "renault 12tl"                        
[254] "renault 5 gtl"                       
[255] "saab 99e"                            
[256] "saab 99gle"                          
[257] "saab 99le"                           
[258] "subaru"                              
[259] "subaru dl"                           
[260] "toyota carina"                       
[261] "toyota celica gt"                    
[262] "toyota celica gt liftback"           
[263] "toyota corolla"                      
[264] "toyota corolla 1200"                 
[265] "toyota corolla 1600 (sw)"            
[266] "toyota corolla liftback"             
[267] "toyota corolla tercel"               
[268] "toyota corona"                       
[269] "toyota corona hardtop"               
[270] "toyota corona liftback"              
[271] "toyota corona mark ii"               
[272] "toyota cressida"                     
[273] "toyota mark ii"                      
[274] "toyota starlet"                      
[275] "toyota tercel"                       
[276] "toyouta corona mark ii (sw)"         
[277] "triumph tr7 coupe"                   
[278] "vokswagen rabbit"                    
[279] "volkswagen 1131 deluxe sedan"        
[280] "volkswagen 411 (sw)"                 
[281] "volkswagen dasher"                   
[282] "volkswagen jetta"                    
[283] "volkswagen model 111"                
[284] "volkswagen rabbit"                   
[285] "volkswagen rabbit custom"            
[286] "volkswagen rabbit custom diesel"     
[287] "volkswagen rabbit l"                 
[288] "volkswagen scirocco"                 
[289] "volkswagen super beetle"             
[290] "volkswagen type 3"                   
[291] "volvo 144ea"                         
[292] "volvo 145e (sw)"                     
[293] "volvo 244dl"                         
[294] "volvo 245"                           
[295] "volvo 264gl"                         
[296] "volvo diesel"                        
[297] "vw dasher (diesel)"                  
[298] "vw pickup"                           
[299] "vw rabbit"                           
[300] "vw rabbit c (diesel)"                
[301] "vw rabbit custom"                    </code></pre>
</div>
</div>
<ul>
<li>Remove <code>name</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>data_all <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">select</span>(<span class="sc">-</span>name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Finally, let’s make and save our training and validation sets. If we were doing model building for prediction we would also need a test set but we will focus this unit on just selecting the best model but not rigorously evaluating it.</p>
<ul>
<li>Let’s use a 75/25 split, stratified on <code>mpg</code></li>
<li>Don’t forget to set a seed in case you need to re-split again in the future!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">set.seed</span>(<span class="dv">20110522</span>) </span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>splits <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">initial_split</span>(<span class="at">prop =</span> .<span class="dv">75</span>, <span class="at">strata =</span> <span class="st">"mpg"</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a>splits <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="fu">analysis</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="fu">glimpse</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_trn.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 294
Columns: 8
$ mpg          &lt;fct&gt; high, high, high, high, high, high, high, high, high, hig…
$ cylinders    &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, …
$ displacement &lt;dbl&gt; 113.0, 97.0, 97.0, 110.0, 107.0, 104.0, 121.0, 97.0, 140.…
$ horsepower   &lt;dbl&gt; 95, 88, 46, 87, 90, 95, 113, 88, 90, 95, 86, 90, 70, 76, …
$ weight       &lt;dbl&gt; 2372, 2130, 1835, 2672, 2430, 2375, 2234, 2130, 2264, 222…
$ acceleration &lt;dbl&gt; 15.0, 14.5, 20.5, 17.5, 14.5, 17.5, 12.5, 14.5, 15.5, 14.…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 7…
$ origin       &lt;fct&gt; japanese, japanese, european, european, european, europea…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>splits <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">assessment</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">glimpse</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_val.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 98
Columns: 8
$ mpg          &lt;fct&gt; low, low, low, low, low, low, low, low, low, low, low, lo…
$ cylinders    &lt;dbl&gt; 8, 8, 8, 8, 8, 6, 6, 6, 6, 8, 8, 4, 4, 4, 8, 8, 8, 4, 8, …
$ displacement &lt;dbl&gt; 350, 304, 302, 440, 455, 198, 200, 225, 250, 400, 318, 14…
$ horsepower   &lt;dbl&gt; 165, 150, 140, 215, 225, 95, 85, 105, 100, 175, 150, 72, …
$ weight       &lt;dbl&gt; 3693, 3433, 3449, 4312, 4425, 2833, 2587, 3439, 3329, 446…
$ acceleration &lt;dbl&gt; 11.5, 12.0, 10.5, 8.5, 10.0, 15.5, 16.0, 15.5, 15.5, 11.5…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 72, 7…
$ origin       &lt;fct&gt; american, american, american, american, american, america…</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Question: Any concerns about using this training-validation split?</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb10-1"><a href="#cb10-1"></a>These sample sizes are starting to get a little small.  Fitted models will have </span>
<span id="cb10-2"><a href="#cb10-2"></a>higher variance with only 75% (N = 294) observations and performance in validation </span>
<span id="cb10-3"><a href="#cb10-3"></a>(with only N = 98 observations) may not be a very precise estimate of true validation </span>
<span id="cb10-4"><a href="#cb10-4"></a>error.  We will learn more robust methods in the unit on resampling.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="modeling-eda">Modeling EDA</h3>
<p>Let’s do some quick modeling EDA to get a sense of the data.</p>
<ul>
<li>We will keep it quick and dirty.</li>
<li>First, we should make a function to class Cars since we may open it frequently</li>
<li>Even though its simple, still better this way (e.g., what if we decide to change how to handle classing - will only need to make that change in one place!)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>class_cars <span class="ot">&lt;-</span> <span class="cf">function</span>(d) { </span>
<span id="cb11-2"><a href="#cb11-2"></a>  d <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="fu">mutate</span>(<span class="at">mpg =</span> <span class="fu">factor</span>(mpg, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"high"</span>)),</span>
<span id="cb11-4"><a href="#cb11-4"></a>           <span class="at">origin =</span> <span class="fu">factor</span> (origin))</span>
<span id="cb11-5"><a href="#cb11-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Open train (we don’t need validate for modeling EDA)</li>
<li>[We are pretending this is a new script….]</li>
<li>Class the predictors</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_trn.csv"</span>),</span>
<span id="cb12-2"><a href="#cb12-2"></a>                     <span class="at">col_type =</span> <span class="fu">cols</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">class_cars</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 294
Columns: 8
$ mpg          &lt;fct&gt; high, high, high, high, high, high, high, high, high, hig…
$ cylinders    &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, …
$ displacement &lt;dbl&gt; 113.0, 97.0, 97.0, 110.0, 107.0, 104.0, 121.0, 97.0, 140.…
$ horsepower   &lt;dbl&gt; 95, 88, 46, 87, 90, 95, 113, 88, 90, 95, 86, 90, 70, 76, …
$ weight       &lt;dbl&gt; 2372, 2130, 1835, 2672, 2430, 2375, 2234, 2130, 2264, 222…
$ acceleration &lt;dbl&gt; 15.0, 14.5, 20.5, 17.5, 14.5, 17.5, 12.5, 14.5, 15.5, 14.…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 7…
$ origin       &lt;fct&gt; japanese, japanese, european, european, european, europea…</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Bar plot for outcome
<ul>
<li>Outcome is balanced</li>
<li>Unbalanced outcomes can be more complicated (more on this later)</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">plot_bar</span>(<span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/u4-cars-9-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<ul>
<li>Grouped (by <code>mpg</code>) box/violin plots for numeric predictors</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">map</span>(\(name) <span class="fu">plot_grouped_box_violin</span>(<span class="at">df =</span> data_trn, <span class="at">x =</span> <span class="st">"mpg"</span>, <span class="at">y =</span> name)) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5"></a>  cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> _, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/u4-cars-10-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<ul>
<li>Grouped barplot for origin</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">plot_grouped_barplot_percent</span>(<span class="at">x =</span> <span class="st">"origin"</span>, <span class="at">y =</span> <span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/u4-cars-11-1.png" width="960"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="fu">plot_grouped_barplot_percent</span>(<span class="at">x =</span> <span class="st">"mpg"</span>, <span class="at">y =</span> <span class="st">"origin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/u4-cars-12-1.png" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Correlation plots for numeric</li>
<li>Can dummy code categorical predictors to examine correlations (point biserial, phi) including them</li>
<li>We will do this manually using tidyverse here.</li>
<li>Set american to be reference level (its the first level)</li>
<li><code>cylinders</code>, <code>displacement</code>, <code>horsepower</code>, and <code>weight</code> are all essentially the same construct (big, beefy car!)</li>
<li>All are strongly correlated with <code>mpg</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-13-2" class="code-annotation-target"><a href="#annotated-cell-13-2"></a>  <span class="fu">mutate</span>(<span class="at">mpg_high =</span> <span class="fu">if_else</span>(mpg <span class="sc">==</span> <span class="st">"high"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="annotated-cell-13-3"><a href="#annotated-cell-13-3"></a>         <span class="at">origin_japan =</span> <span class="fu">if_else</span>(origin <span class="sc">==</span> <span class="st">"japanese"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="annotated-cell-13-4"><a href="#annotated-cell-13-4"></a>         <span class="at">origin_europe =</span> <span class="fu">if_else</span>(origin <span class="sc">==</span> <span class="st">"european"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-13-5" class="code-annotation-target"><a href="#annotated-cell-13-5"></a>  <span class="fu">select</span>(<span class="sc">-</span>origin, <span class="sc">-</span>mpg) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-13-6"><a href="#annotated-cell-13-6"></a>  <span class="fu">cor</span>() <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-13-7"><a href="#annotated-cell-13-7"></a>  corrplot<span class="sc">::</span><span class="fu">corrplot.mixed</span>() </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-13" data-code-annotation="1">If manually coding a binary outcome variable, best practice is to set the positive class to be 1</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-13" data-code-annotation="2">Remove <code>origin</code> and <code>mpg</code> after converting to dummy-coded features</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/u4-cars-13-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section id="logistic-regression---model-building" class="slide level2">
<h2>Logistic Regression - Model Building</h2>
<p>Now that we understand our data a little better, let’s build some models<br>
<br>
Let’s also try to simultaneously pretend that we:</p>
<ol type="1">
<li>Are building and selecting a best prediction model that will be evaluated with some additional held out test data (how bad would it have been to split into three sets??!!)</li>
<li>Have an explanatory question about production <code>year</code> - Are we more likely to have efficient cars more recently because of improvements in “technology”, above and beyond broad car characteristics (e.g., the easy stuff like <code>weight</code>, <code>displacement</code>, etc.)<br>
<br>
</li>
</ol>
<p>To be clear, prediction and explanation goals are often separate (though prediction is an important foundation explanation)</p>
</section>
<section class="slide level2">

<p>Either way, we need a validation set</p>
<ul>
<li>Open it and class variables</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>data_val <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_val.csv"</span>),</span>
<span id="cb18-2"><a href="#cb18-2"></a>                     <span class="at">col_type =</span> <span class="fu">cols</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">class_cars</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 98
Columns: 8
$ mpg          &lt;fct&gt; low, low, low, low, low, low, low, low, low, low, low, lo…
$ cylinders    &lt;dbl&gt; 8, 8, 8, 8, 8, 6, 6, 6, 6, 8, 8, 4, 4, 4, 8, 8, 8, 4, 8, …
$ displacement &lt;dbl&gt; 350, 304, 302, 440, 455, 198, 200, 225, 250, 400, 318, 14…
$ horsepower   &lt;dbl&gt; 165, 150, 140, 215, 225, 95, 85, 105, 100, 175, 150, 72, …
$ weight       &lt;dbl&gt; 3693, 3433, 3449, 4312, 4425, 2833, 2587, 3439, 3329, 446…
$ acceleration &lt;dbl&gt; 11.5, 12.0, 10.5, 8.5, 10.0, 15.5, 16.0, 15.5, 15.5, 11.5…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 72, 7…
$ origin       &lt;fct&gt; american, american, american, american, american, america…</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Let’s predict high <code>mpg</code> from car beefiness and <code>year</code><br>
<br>
We likely want to combine the beefy variables into one construct/factor (<code>beef</code>)</p>
<ul>
<li>We can use PCA to extract one factor</li>
<li>Input variables should be centered and scaled for PCA. Easy peasy</li>
<li>PCA will be calculated with <code>data_trn</code> during <code>prep()</code>. These statistics from <code>data_trn</code> will be used to <code>bake()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-15-1" class="code-annotation-target"><a href="#annotated-cell-15-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-15-2"><a href="#annotated-cell-15-2"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight, </span>
<span id="annotated-cell-15-3"><a href="#annotated-cell-15-3"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="annotated-cell-15-4"><a href="#annotated-cell-15-4"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-15-5" class="code-annotation-target"><a href="#annotated-cell-15-5"></a>           <span class="at">prefix =</span> <span class="st">"beef_"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-15" data-code-annotation="1">Using <code>.</code> now in the recipe to leave all variables in the feature matrix. We can later select the ones we want use for prediction</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-15" data-code-annotation="2">We will have one PCA component, it will be called <code>beef_1</code></span>
</dd>
</dl>
</div>
</div>
</section>
<section class="slide level2">

<p>Now, <code>prep()</code> the recipe and <code>bake()</code> some feature for training and validation sets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Lets skim our training features</li>
<li>We can see there are features in there we won’t use</li>
<li><code>mpg</code>, <code>year</code>, and <code>beef_1</code> look good</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">feat_trn</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">294</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">origin</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">ame: 187, jap: 56, eur: 51</td>
</tr>
<tr class="even">
<td style="text-align: left;">mpg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">low: 147, hig: 147</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table style="width:100%;">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: right;">skew</th>
<th style="text-align: right;">kurtosis</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">acceleration</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15.54</td>
<td style="text-align: right;">2.64</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">14.00</td>
<td style="text-align: right;">15.50</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">24.80</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.58</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">75.94</td>
<td style="text-align: right;">3.68</td>
<td style="text-align: right;">70.00</td>
<td style="text-align: right;">73.00</td>
<td style="text-align: right;">76.00</td>
<td style="text-align: right;">79.0</td>
<td style="text-align: right;">82.00</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-1.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beef_1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.92</td>
<td style="text-align: right;">-2.36</td>
<td style="text-align: right;">-1.64</td>
<td style="text-align: right;">-0.85</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">4.36</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">-0.96</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Fit the model configuration in train</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-18-1"><a href="#annotated-cell-18-1"></a>fit_lr_2 <span class="ot">&lt;-</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-18-2" class="code-annotation-target"><a href="#annotated-cell-18-2"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-18-3" class="code-annotation-target"><a href="#annotated-cell-18-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-18-4" class="code-annotation-target"><a href="#annotated-cell-18-4"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="2" data-code-cell="annotated-cell-18" data-code-annotation="1">category of algorithm is logistic regression</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="3" data-code-cell="annotated-cell-18" data-code-annotation="2">Set engine to be generalized linear model. No need to `set_mode(“classification”) because logistic regression glm is only used for classification</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-18" data-code-annotation="3">Notice that we explicitly indicate which features to use because our feature matrix has more than just these two in it because we used <code>.</code> in our recipe and our datasets have more columns.</span>
</dd>
</dl>
</div>
</div>
</section>
<section class="slide level2">

<p>Let’s look at the logistic model and its parameter estimates from train</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>fit_lr_2 <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -23.4      5.55       -4.23 2.38e- 5
2 beef_1        -2.49     0.316      -7.87 3.49e-15
3 year           0.292    0.0718      4.07 4.71e- 5</code></pre>
</div>
</div>
<p><br>
<br>
</p>
<p><span class="math inline">\(Pr(high|(beef, year)) = \frac{e^{b0 + b1*beef + b2*year}}{1 + e^{b0 + b1*beef + b2*year}}\)</span></p>
</section>
<section class="slide level2">

<p>Use <code>predict()</code> to get <span class="math inline">\(Pr(high|year)\)</span> (<strong>or predicted class</strong>, more on that later) directly from the model for any data</p>
<ul>
<li>First make a dataframe for feature values for prediction</li>
<li>We will use this for a plot</li>
<li>Get probabilities for a range of years (incrementing by .1 year)</li>
<li>Hold beef constant at its mean</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>p_high <span class="ot">&lt;-</span> </span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="fu">min</span>(feat_val<span class="sc">$</span>year), <span class="fu">max</span>(feat_val<span class="sc">$</span>year), .<span class="dv">1</span>),</span>
<span id="cb24-3"><a href="#cb24-3"></a>         <span class="at">beef_1 =</span> <span class="fu">mean</span>(feat_val<span class="sc">$</span>beef_1)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p><code>predict()</code> will:</p>
<ul>
<li>Give us probabilities for high and low (<code>type = "prob"</code>). We will select out the low columns</li>
<li>Also provides the 95% conf int around these probabilities (<code>type = "conf_int"</code>)</li>
<li>Ambiguity is removed by their choice to label by the actual outcome labels (Nice!)</li>
<li>We will bind these predictions to the dataframe we made above</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lr_2, <span class="at">new_data =</span> p_high, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lr_2, <span class="at">new_data =</span> p_high, <span class="at">type =</span> <span class="st">"conf_int"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">select</span>(<span class="sc">-</span>.pred_low, <span class="sc">-</span>.pred_lower_low, <span class="sc">-</span>.pred_upper_low) <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 121
Columns: 5
$ year             &lt;dbl&gt; 70.0, 70.1, 70.2, 70.3, 70.4, 70.5, 70.6, 70.7, 70.8,…
$ beef_1           &lt;dbl&gt; 0.008438869, 0.008438869, 0.008438869, 0.008438869, 0…
$ .pred_high       &lt;dbl&gt; 0.04733721, 0.04867270, 0.05004389, 0.05145161, 0.052…
$ .pred_lower_high &lt;dbl&gt; 0.01495325, 0.01557265, 0.01621651, 0.01688572, 0.017…
$ .pred_upper_high &lt;dbl&gt; 0.1398943, 0.1419807, 0.1440989, 0.1462495, 0.1484331…</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Here is a quick look at the head</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>p_high <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   year  beef_1 .pred_high .pred_lower_high .pred_upper_high
  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
1  70   0.00844     0.0473           0.0150            0.140
2  70.1 0.00844     0.0487           0.0156            0.142
3  70.2 0.00844     0.0500           0.0162            0.144
4  70.3 0.00844     0.0515           0.0169            0.146
5  70.4 0.00844     0.0529           0.0176            0.148
6  70.5 0.00844     0.0544           0.0183            0.151</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Can plot this relationship using the predicted probabilities</p>
<ul>
<li>plot both prediction line</li>
<li>and observed Y (with a little jitter)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> feat_val, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="fu">as.numeric</span>(mpg) <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb29-3"><a href="#cb29-3"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> p_high, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .pred_high)) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> p_high, </span>
<span id="cb29-6"><a href="#cb29-6"></a>              <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">ymin =</span> .pred_lower_high, <span class="at">ymax =</span> .pred_upper_high), </span>
<span id="cb29-7"><a href="#cb29-7"></a>              <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">70</span>,<span class="dv">82</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9"></a>  <span class="fu">ylab</span>(<span class="st">"Pr(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/u4-lr-6-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Can plot odds instead of probabilities using odds equation and coefficients from the model</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|x_1)} {1 - Pr(positive\:class|x_1)}\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">mutate</span>(<span class="at">.odds_high =</span> .pred_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_high),</span>
<span id="cb30-3"><a href="#cb30-3"></a>         <span class="at">.odds_lower_high =</span> .pred_lower_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_lower_high),</span>
<span id="cb30-4"><a href="#cb30-4"></a>         <span class="at">.odds_upper_high =</span> .pred_upper_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_upper_high))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>NOTE: Harder to also plot raw data as scatter plot when plotting odds vs.&nbsp;probabilities. Maybe use second Y axis?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>p_high <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .odds_high)) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">ymin =</span> .odds_lower_high, <span class="at">ymax =</span> .odds_upper_high), </span>
<span id="cb31-5"><a href="#cb31-5"></a>                <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">70</span>, <span class="dv">82</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>    <span class="fu">ylab</span>(<span class="st">"Odds(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/unnamed-chunk-11-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>Odds ratio for year:</p>
<ul>
<li><span class="math inline">\(Odds\:ratio = e^{c*\beta_1}\)</span><br>
<br>
</li>
</ul>
<p>Get the parameter estimate/coefficient from the model</p>
<ul>
<li>For every one year increase (holding beef constant), the odds of a car being categorized as high mpg increase by a factor of 1.3394301</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">exp</span>(<span class="fu">get_estimate</span>(fit_lr_2, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.33943</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>You can do this for other values of c as well (not really needed here because a 1 year unit makes sense)</p>
<ul>
<li><span class="math inline">\(Odds\:ratio = e^{c*\beta_1}\)</span></li>
<li>For every 10 year increase (holding beef constant), the odds of a car being categorized as high mpg increase by a factor of 18.5866278</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">exp</span>(<span class="dv">10</span> <span class="sc">*</span> <span class="fu">get_estimate</span>(fit_lr_2, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18.58663</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Testing parameter estimates</p>
<ul>
<li><code>tidy()</code> provides z-tests for the parameter estimates</li>
<li>This is NOT the recommended statistical test from 610</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>fit_lr_2 <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -23.4      5.55       -4.23 2.38e- 5
2 beef_1        -2.49     0.316      -7.87 3.49e-15
3 year           0.292    0.0718      4.07 4.71e- 5</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>The preferred test for parameter estimates from logistic regression is the likelihood ratio test</p>
<ul>
<li>You can get this using <code>Anova()</code> from the <code>car</code> package (as you learn in 610/710)</li>
<li>The glm object is returned using $fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_2<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
       LR Chisq Df Pr(&gt;Chisq)    
beef_1  239.721  1  &lt; 2.2e-16 ***
year     20.317  1  6.562e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Accuracy is a very common performance metric for classification models<br>
<br>
How accurate is our two feature model?</p>
<ul>
<li>Note the use of <code>type = "class"</code><br>
<br>
</li>
</ul>
<p>We can calculate accuracy in the training set. This may be somewhat overfit and optimistic!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_trn, <span class="at">type =</span> <span class="st">"class"</span>)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9217687</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>And in the validation set (better estimate of performance in new data. Though if we use this set multiple times to select a best configuration, it will become overfit eventually too!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_val, <span class="at">type =</span> <span class="st">"class"</span>)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<p><br>
<br>
You can see some evidence of over-fitting to the training set in that model performance is a bit lower in validation</p>
</section>
<section class="slide level2">

<p>Let’s take a look at the decision boundary for this model in the validation set<br>
<br>
We need a function to plot the decision boundary <strong>because we will use it repeatedly</strong> to compare decision boundaries across statistical models</p>
<ul>
<li>Displayed here as another example of a function that uses quoted variable names</li>
<li>This function is useful for book examples with two features.<br>
</li>
<li>Only can be used with two features, so not that useful in real life!</li>
<li>Not included in my function scripts (just here to helpy you understand the material)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>plot_decision_boundary <span class="ot">&lt;-</span> <span class="cf">function</span>(data, model, x_names, y_name, <span class="at">n_points =</span> <span class="dv">100</span>) {</span>
<span id="cb44-2"><a href="#cb44-2"></a>  </span>
<span id="cb44-3"><a href="#cb44-3"></a>  preds <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data[[x_names[<span class="dv">1</span>]]]), </span>
<span id="cb44-4"><a href="#cb44-4"></a>                                 <span class="fu">max</span>(data[[x_names[<span class="dv">1</span>]]]), </span>
<span id="cb44-5"><a href="#cb44-5"></a>                                 <span class="at">length =</span> n_points),</span>
<span id="cb44-6"><a href="#cb44-6"></a>                   <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data[[x_names[<span class="dv">2</span>]]]), </span>
<span id="cb44-7"><a href="#cb44-7"></a>                                 <span class="fu">max</span>(data[[x_names[<span class="dv">2</span>]]]), </span>
<span id="cb44-8"><a href="#cb44-8"></a>                                 <span class="at">length =</span> n_points))</span>
<span id="cb44-9"><a href="#cb44-9"></a>  <span class="fu">names</span>(preds) <span class="ot">&lt;-</span> x_names</span>
<span id="cb44-10"><a href="#cb44-10"></a>  preds[[y_name]] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, preds)<span class="sc">$</span>.pred_class</span>
<span id="cb44-11"><a href="#cb44-11"></a>  preds[[y_name]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(preds[[y_name]])<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb44-12"><a href="#cb44-12"></a>  </span>
<span id="cb44-13"><a href="#cb44-13"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, </span>
<span id="cb44-14"><a href="#cb44-14"></a>         <span class="fu">aes</span>(<span class="at">x =</span> .data[[x_names[<span class="dv">1</span>]]], </span>
<span id="cb44-15"><a href="#cb44-15"></a>             <span class="at">y =</span> .data[[x_names[<span class="dv">2</span>]]], </span>
<span id="cb44-16"><a href="#cb44-16"></a>             <span class="at">color =</span> .data[[y_name]])) <span class="sc">+</span></span>
<span id="cb44-17"><a href="#cb44-17"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb44-18"><a href="#cb44-18"></a>    <span class="fu">geom_contour</span>(<span class="at">data =</span> preds, </span>
<span id="cb44-19"><a href="#cb44-19"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> .data[[x_names[<span class="dv">1</span>]]], </span>
<span id="cb44-20"><a href="#cb44-20"></a>                     <span class="at">y =</span> .data[[x_names[<span class="dv">2</span>]]], </span>
<span id="cb44-21"><a href="#cb44-21"></a>                     <span class="at">z =</span> .data[[y_name]]), </span>
<span id="cb44-22"><a href="#cb44-22"></a>                 <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">breaks =</span> .<span class="dv">5</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb44-23"><a href="#cb44-23"></a>    <span class="fu">labs</span>(<span class="at">x =</span> x_names[<span class="dv">1</span>], <span class="at">y =</span> x_names[<span class="dv">2</span>], <span class="at">color =</span> y_name) <span class="sc">+</span></span>
<span id="cb44-24"><a href="#cb44-24"></a>    <span class="fu">coord_obs_pred</span>()</span>
<span id="cb44-25"><a href="#cb44-25"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Logistic regression produces a linear decision boundary when you consider a scatter plot of the points by the two features.</p>
<ul>
<li>Points on one side of the line are assigned to one class and points on the other side of the line are assigned to the other class.<br>
</li>
<li>This decision boundary would be a plane if there were three features Harder to visualize in higher dimensional space.</li>
<li>We will contrast this decision boundary from logistic regression with other statistical algorithms in a bit.<br>
<br>
</li>
</ul>
<p>Here is the decision boundary for this model in both train and validation sets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb45-3"><a href="#cb45-3"></a></span>
<span id="cb45-4"><a href="#cb45-4"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb45-5"><a href="#cb45-5"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb45-6"><a href="#cb45-6"></a></span>
<span id="cb45-7"><a href="#cb45-7"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/u4-lr-14-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<p>What if you wanted to try to improve our predictions?</p>
<ul>
<li>You could find the best set of covariates to test the effect of year. [Assuming the best covariates are those that account for the most variance in mpg]?</li>
<li>For either prediction or explanation, you need to find this best model<br>
<br>
</li>
</ul>
<p>We can compare model performance in validation set to find this best model</p>
<ul>
<li>We can use that one for our prediction goal</li>
<li>We can test the effect of year in that model for our explanation goal
<ul>
<li>This is a principled way to decide on the best model for our explanatory goal (vs.&nbsp;p-hacking)</li>
<li>We get to explore and we end up with the best model to provide our focal test</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<p>Let’s quickly fit another model we might have considered.</p>
<ul>
<li>This model will contain the 4 variables from our PCA but as individual features rather than one PCA component score (<code>beef</code>)</li>
<li>Make features for this model
<ul>
<li>No feature engineering needed because raw variables are all numeric already)</li>
<li>We will give the features dfs new names to retain the old features that included <code>beef_1</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>rec_raw <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) </span>
<span id="cb46-2"><a href="#cb46-2"></a></span>
<span id="cb46-3"><a href="#cb46-3"></a>rec_raw_prep <span class="ot">&lt;-</span> rec_raw <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb46-5"><a href="#cb46-5"></a></span>
<span id="cb46-6"><a href="#cb46-6"></a>feat_raw_trn <span class="ot">&lt;-</span> rec_raw_prep <span class="sc">|&gt;</span> </span>
<span id="cb46-7"><a href="#cb46-7"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb46-8"><a href="#cb46-8"></a></span>
<span id="cb46-9"><a href="#cb46-9"></a>feat_raw_val <span class="ot">&lt;-</span> rec_raw_prep <span class="sc">|&gt;</span> </span>
<span id="cb46-10"><a href="#cb46-10"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Fit PCA features individually + year</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>fit_lr_raw <span class="ot">&lt;-</span> </span>
<span id="cb47-2"><a href="#cb47-2"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> cylinders <span class="sc">+</span> displacement <span class="sc">+</span> horsepower <span class="sc">+</span> weight <span class="sc">+</span> year, </span>
<span id="cb47-5"><a href="#cb47-5"></a>      <span class="at">data =</span> feat_raw_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Which is the best prediction model?</p>
<ul>
<li>Beef PCA</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<ul>
<li>Individual raw features from PCA</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="fu">accuracy_vec</span>(feat_raw_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_raw, feat_raw_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8673469</code></pre>
</div>
</div>
<p><br>
<br>
The PCA beef model fits best. The model with individual features likely increases overfitting a bit but doesn’t yield a reduction in bias because all the other variables are so highly correlated.</p>
</section>
<section class="slide level2">

<p><code>fit_lr_2</code> is your choice for best model for prediction (at least it is descriptively better)<br>
<br>
If you had an explanatory question about <code>year</code>, how would you have chosen between these two tests of <code>year</code> in these two different but all reasonable models</p>
<ul>
<li>You might have chose the model with individual features because the effect of year is stronger.<br>
</li>
<li>That is NOT the model that comes closes to the DGP.<br>
</li>
<li>We believe the appropriate model is the beef model that has higher overall accuracy!</li>
<li>This is a start for us to start to consider the use of resampling methods to make decisions about how to best pursue explanatory goals.</li>
<li>Could you now test your <code>year</code> effect in the full sample? Let’s discuss.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_2<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
       LR Chisq Df Pr(&gt;Chisq)    
beef_1  239.721  1  &lt; 2.2e-16 ***
year     20.317  1  6.562e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_raw<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
             LR Chisq Df Pr(&gt;Chisq)    
cylinders      0.4199  1    0.51697    
displacement   1.3239  1    0.24990    
horsepower     6.4414  1    0.01115 *  
weight        15.6669  1  7.553e-05 ***
year          27.0895  1  1.942e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="k-nearest-neighbors---a-conceptual-overview" class="slide level2">
<h2>K Nearest Neighbors - A Conceptual Overview</h2>
<p>Let’s switch gears to a non-parametric method we already know - KNN.</p>
<ul>
<li><p>KNN can be used as a classifier as well as for regression problems</p></li>
<li><p>KNN tries to determine conditional class possibilities for any set of features by looking at observed classes for similar values of for these features in the training set</p></li>
</ul>
</section>
<section class="slide level2">

<p>This figure illustrates the application of 3-NN to a small sample training set (N = 12) with 2 predictors</p>
<ul>
<li>For test observation X in the left panel, we would predict class = blue because blue is the majority class (highest probability) among the 3 nearest training observations</li>
<li>If we calculated these probabilities for all possible combinations of the two predictors in the training set, it would yield the decision boundaries depicted in the right panel</li>
</ul>
<p><img data-src="figs/unit4_knn_example.png" style="height:4in"></p>
</section>
<section class="slide level2">

<p>KNN can produce complex decision boundaries</p>
<ul>
<li>This makes it flexible (can reduce bias)</li>
<li>This makes it susceptible to variance/overfitting problems</li>
</ul>
<p><br>
<br>
Remember that we can control this bias-variance trade-off with K.</p>
<ul>
<li>As K increases, variance reduces (but bias may increase).<br>
</li>
<li>As K decreases, bias may be reduced but variance increases.</li>
<li>Choose a K that produces good performance in new (validation) data</li>
</ul>
</section>
<section class="slide level2">

<p>These figures depict the KNN (and Bayes classifier) decision boundaries for the earlier simulated 2 class problem with <code>X1</code> and <code>X2</code></p>
<ul>
<li>K = 10 appears to provide the sweet spot b/c it closely approximates the Bayes decision boundary</li>
<li>Of course, you wouldn’t know the true Bayes decision boundary if the data were real (not simulated)</li>
<li>But K = 10 would also yield the lowest test error (which is how it should be chosen)
<ul>
<li>Bayes classifier test error: .1304</li>
<li>K = 10 test error: .1363</li>
<li>K = 1 test error: .1695</li>
<li>K = 100 test err: .1925</li>
</ul></li>
</ul>
<p><img data-src="figs/unit4_knn_k.png" style="height:4in"></p>
<p><img data-src="figs/unit4_knn_k_2.png" style="height:4in"></p>
</section>
<section class="slide level2">

<p>You can NOT make the decision about K based on training error<br>
<br>
This figure depicts training and test error for simulated data example as function of 1/K</p>
<ul>
<li><p>Training error decreases as 1/K increases. At 1 (K=1) training error is 0</p></li>
<li><p>Test error shows expected inverted U</p>
<ul>
<li>For high K (left side), error is high because of high variance</li>
<li>As move right (lower K), variance is reduced rapidly with little increase in bias. Error is reduced.</li>
<li>Eventually, there is diminishing return from reducing variance but bias starts to increase rapidly. Error increases again.</li>
</ul></li>
</ul>
<p><img data-src="figs/unit4_knn_error.png" style="height:4in"></p>
</section>
<section id="a-return-to-cars---now-with-knn" class="slide level2">
<h2>A Return to Cars - Now with KNN</h2>
<p>Let’s demonstrate KNN using the Cars dataset</p>
<ul>
<li>Calculate <code>beef_1</code> PCA component</li>
<li>Scale both features</li>
<li>Make train and validation feature matrices</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight,</span>
<span id="cb56-3"><a href="#cb56-3"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="cb56-4"><a href="#cb56-4"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, <span class="at">prefix =</span> <span class="st">"beef_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-5"><a href="#cb56-5"></a>  <span class="fu">step_scale</span>(year, beef_1)</span>
<span id="cb56-6"><a href="#cb56-6"></a></span>
<span id="cb56-7"><a href="#cb56-7"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb56-8"><a href="#cb56-8"></a>  <span class="fu">prep</span>(<span class="at">data =</span> data_trn)</span>
<span id="cb56-9"><a href="#cb56-9"></a></span>
<span id="cb56-10"><a href="#cb56-10"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb56-11"><a href="#cb56-11"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb56-12"><a href="#cb56-12"></a></span>
<span id="cb56-13"><a href="#cb56-13"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb56-14"><a href="#cb56-14"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Fit models with varying K.</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-41"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-41-1"><a href="#annotated-cell-41-1"></a>fit_1nn_2 <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-41-2"><a href="#annotated-cell-41-2"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-41-3"><a href="#annotated-cell-41-3"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-41" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-41-4" class="code-annotation-target"><a href="#annotated-cell-41-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-41-5"><a href="#annotated-cell-41-5"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-41" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-41" data-code-annotation="1">Notice that we now use <code>set_mode("classification")</code></span>
</dd>
</dl>
</div>
</div>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>fit_5nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb57-2"><a href="#cb57-2"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a href="#cb57-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb57-5"><a href="#cb57-5"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>K = 10</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>fit_10nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb58-2"><a href="#cb58-2"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-3"><a href="#cb58-3"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-4"><a href="#cb58-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb58-5"><a href="#cb58-5"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>fit_20nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb59-2"><a href="#cb59-2"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href="#cb59-3"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-4"><a href="#cb59-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb59-5"><a href="#cb59-5"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Of course, training accuracy goes down with decreasing flexibility as k increases</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_1nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_5nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9489796</code></pre>
</div>
</div>
<ul>
<li>K = 10</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_10nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9455782</code></pre>
</div>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_20nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9285714</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>In contrast, validation accuracy first increases and then eventually decreases as k increase.</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_1nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8163265</code></pre>
</div>
</div>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_5nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.877551</code></pre>
</div>
</div>
<ul>
<li>K = 10 (preferred based on validation accuracy)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_10nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_20nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8673469</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Let’s look at the decision boundaries for 10-NN in training and validation sets</p>
<ul>
<li>A very complex decision boundary</li>
<li>Clearly trying hard to segregate the points</li>
<li>In Ames, the relationships were non-linear and therefore KNN did much better than the linear model</li>
<li>Here, the decision boundary is pretty linear so the added flexibility of KNN doesn’t get us much.
<ul>
<li>Maybe we gain a little in bias reduction but lose a little in overfitting</li>
<li>Ends up performing comparable to logistic regression (a generalized linear model)</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_10nn_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>)</span>
<span id="cb76-3"><a href="#cb76-3"></a></span>
<span id="cb76-4"><a href="#cb76-4"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb76-5"><a href="#cb76-5"></a>  <span class="fu">plot_decision_boundary</span>(fit_10nn_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>)</span>
<span id="cb76-6"><a href="#cb76-6"></a></span>
<span id="cb76-7"><a href="#cb76-7"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/u4-knn-9-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Question: How do you think the parametric logistic regression compares to the non-parametric KNN with respect to explanatory goals? Consider our (somewhat artificial) question about the effect of <code>year</code>.</strong></p>
</div>
<div class="callout-content">
<div class="cell">
<details>
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb77-1"><a href="#cb77-1"></a>The logistic regression provides coefficients (parameter estimates) that can be </span>
<span id="cb77-2"><a href="#cb77-2"></a>used to describe changes in probability, odds and odds ratio associated with </span>
<span id="cb77-3"><a href="#cb77-3"></a>change in year.  These parameter estimates can be tested via inferential procedures.  </span>
<span id="cb77-4"><a href="#cb77-4"></a>KNN does not provide any parameter estimates.  With KNN, we can visualize decision boundary </span>
<span id="cb77-5"><a href="#cb77-5"></a>(only in 2 or three dimensions) or the predicted outcome by any feature, controlling for </span>
<span id="cb77-6"><a href="#cb77-6"></a>other features but these relationships may be complex in shape.  </span>
<span id="cb77-7"><a href="#cb77-7"></a>Of course, if the relationships are complex, we might not want to hide that.  </span>
<span id="cb77-8"><a href="#cb77-8"></a>We will learn more about feature importance for explanation in a later unit.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Plot of probability of high_mpg by year, holding <code>beef_1</code> constant at its mean based on 10-NN</p>
<ul>
<li>Get <span class="math inline">\(Pr(high|year)\)</span> holding beef constant at its mean</li>
<li><code>predict()</code> returns probabilities for high and low.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>p_high <span class="ot">&lt;-</span> </span>
<span id="cb78-2"><a href="#cb78-2"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="fu">min</span>(feat_val<span class="sc">$</span>year), <span class="fu">max</span>(feat_val<span class="sc">$</span>year), .<span class="dv">1</span>),</span>
<span id="cb78-3"><a href="#cb78-3"></a>         <span class="at">beef_1 =</span> <span class="fu">mean</span>(feat_val<span class="sc">$</span>beef_1)) </span>
<span id="cb78-4"><a href="#cb78-4"></a></span>
<span id="cb78-5"><a href="#cb78-5"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb78-6"><a href="#cb78-6"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_10nn_2, p_high, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb78-7"><a href="#cb78-7"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33
Columns: 4
$ year       &lt;dbl&gt; 18.99759, 19.09759, 19.19759, 19.29759, 19.39759, 19.49759,…
$ beef_1     &lt;dbl&gt; 0.004400185, 0.004400185, 0.004400185, 0.004400185, 0.00440…
$ .pred_low  &lt;dbl&gt; 0.96, 0.99, 0.99, 0.99, 0.97, 0.87, 0.81, 0.81, 0.81, 0.81,…
$ .pred_high &lt;dbl&gt; 0.04, 0.01, 0.01, 0.01, 0.03, 0.13, 0.19, 0.19, 0.19, 0.19,…</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Plot it</li>
<li>In a later unit, we will learn about feature ablation that we can combine with model comparisons to potentially test predictor effects in non-parametric models</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> feat_val, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="fu">as.numeric</span>(mpg) <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb80-3"><a href="#cb80-3"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb80-4"><a href="#cb80-4"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> p_high, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .pred_high)) <span class="sc">+</span></span>
<span id="cb80-5"><a href="#cb80-5"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, </span>
<span id="cb80-6"><a href="#cb80-6"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">7</span>), </span>
<span id="cb80-7"><a href="#cb80-7"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">seq</span>(<span class="dv">70</span>, <span class="dv">82</span>, <span class="at">length.out =</span> <span class="dv">7</span>))) <span class="sc">+</span></span>
<span id="cb80-8"><a href="#cb80-8"></a>  <span class="fu">ylab</span>(<span class="st">"Pr(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/u4-knn-11-1.png" width="960" class="r-stretch"></section>
<section id="linear-discriminant-analysis" class="slide level2">
<h2>Linear Discriminant Analysis</h2>
<p>LDA models the distributions of the Xs separately for each class<br>
<br>
Then uses Bayes theorem to estimate <span class="math inline">\(Pr(Y = k | X)\)</span> for each k and assigns the observation to the class with the highest probability</p>
<p><span class="math inline">\(Pr(Y = k|X) = \frac{\pi_k * f_k(X)}{\sum_{l = 1}^{K} f_l(X)}\)</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\pi_k\)</span> is the prior probability that an observation comes from class k (estimated from frequencies of k in training)</li>
<li><span class="math inline">\(f_k(X)\)</span> is the density function of X for an observation from class k
<ul>
<li><span class="math inline">\(f_k(X)\)</span> is large if there is a high probability that an observation in class k has that set of values for X and small if that probability is low</li>
<li><span class="math inline">\(f_k(X)\)</span> is difficult to estimate unless we make some simplifying assumptions (i.e., X is multivariate normal and common covariance matrix (<span class="math inline">\(\sum\)</span>) across K classes)</li>
<li>With these assumptions, we can estimate <span class="math inline">\(\pi_k\)</span>, <span class="math inline">\(\mu_k\)</span>, and <span class="math inline">\(\sigma^2\)</span> from the training set and calculate <span class="math inline">\(Pr(Y = k|X)\)</span> for each k</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<p>With a single feature, the probability of any class k, given X is:</p>
<ul>
<li><p><span class="math inline">\(Pr(Y = k|X) = \frac{\pi_k \frac{1}{\sqrt{2\pi\sigma}}\exp(-\frac{1}{2\sigma^2}(x-\mu_k)^2)}{\sum_{l=1}^{K}\pi_l\frac{1}{2\sigma^2}\exp(-\frac{1}{2\sigma^2}(x-\mu_l)^2)}\)</span></p></li>
<li><p>LDA is a parametric model, but is it interpretable?</p></li>
</ul>
</section>
<section class="slide level2">

<p>Application of LDA to Cars data set with two predictors<br>
<br>
Notice that LDA produces linear decision boundary (see <span class="citation" data-cites="ISL">James et al. (<a href="#/references" role="doc-biblioref" onclick="">2023</a>)</span> for formula for discriminant function derived from the probability function on last slide)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight, </span>
<span id="cb81-3"><a href="#cb81-3"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="cb81-4"><a href="#cb81-4"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, </span>
<span id="cb81-5"><a href="#cb81-5"></a>           <span class="at">prefix =</span> <span class="st">"beef_"</span>)</span>
<span id="cb81-6"><a href="#cb81-6"></a></span>
<span id="cb81-7"><a href="#cb81-7"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb81-8"><a href="#cb81-8"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb81-9"><a href="#cb81-9"></a></span>
<span id="cb81-10"><a href="#cb81-10"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb81-11"><a href="#cb81-11"></a>  <span class="fu">bake</span>(data_trn)</span>
<span id="cb81-12"><a href="#cb81-12"></a></span>
<span id="cb81-13"><a href="#cb81-13"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb81-14"><a href="#cb81-14"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Need to load the <code>discrm</code> package</li>
<li>Lets look at how the function is called</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">library</span>(discrim, <span class="at">exclude =</span> <span class="st">"smoothness"</span>)</span>
<span id="cb82-2"><a href="#cb82-2"></a></span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb82-4"><a href="#cb82-4"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb82-5"><a href="#cb82-5"></a>  <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Discriminant Model Specification (classification)

Computational engine: MASS 

Model fit template:
MASS::lda(formula = missing_arg(), data = missing_arg())</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Fit the LDA in train</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>fit_lda_2 <span class="ot">&lt;-</span> </span>
<span id="cb84-2"><a href="#cb84-2"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb84-3"><a href="#cb84-3"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb84-4"><a href="#cb84-4"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Accuracy and decision boundary</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lda_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8469388</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb87-2"><a href="#cb87-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb87-3"><a href="#cb87-3"></a></span>
<span id="cb87-4"><a href="#cb87-4"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb87-5"><a href="#cb87-5"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb87-6"><a href="#cb87-6"></a></span>
<span id="cb87-7"><a href="#cb87-7"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/u4-da-4-1.png" width="960" class="r-stretch"></section>
<section id="quadratic-discriminant-analysis" class="slide level2">
<h2>Quadratic Discriminant Analysis</h2>
<p>QDA relaxes one restrictive assumption of LDA</p>
<ul>
<li>Still required multivariate normal X</li>
<li><strong>But it allows each class to have its own <span class="math inline">\(\sum\)</span></strong></li>
<li>This makes it:
<ul>
<li>More flexible</li>
<li>Able to model non-linear decision boundaries (see formula for discriminant in <span class="citation" data-cites="ISL">James et al. (<a href="#/references" role="doc-biblioref" onclick="">2023</a>)</span>)</li>
<li>But requires substantial increase in parameter estimation (more potential to overfit)</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<p>Application of RDA (Regularized Discriminant Analysis) algorithm to Car data set with two features</p>
<ul>
<li>The algorithm that is available in tidymodels is actually a regularized discriminant analysis, <code>rda()</code> from the <code>klaR</code> package</li>
<li>There are two hyperparameters, <code>frac_common_cov</code> and <code>frac_identity</code>, that can each vary between 0 - 1
<ul>
<li>When <code>frac_common_cov = 1</code> and <code>frac_identity = 0</code>, this is an LDA</li>
<li>When <code>frac_common_cov = 0</code> and <code>frac_identity = 0</code>, this is a QDA</li>
<li>These hyperparameters can be tuned to different values to improve the fit dependent on the true DGP</li>
<li>More on hyperparameter tuning in unit 5</li>
<li>This is a flexible algorithm that likely replaces the need to fit separate LDA and QDA models</li>
</ul></li>
<li>see https://discrim.tidymodels.org/reference/discrim_regularized.html</li>
</ul>
</section>
<section class="slide level2">

<p>Here is a true QDA using <code>frac_common_cov = 1</code> and <code>frac_identity = 0</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb88-2"><a href="#cb88-2"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb88-3"><a href="#cb88-3"></a>  <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Regularized Discriminant Model Specification (classification)

Main Arguments:
  frac_common_cov = 0
  frac_identity = 0

Computational engine: klaR 

Model fit template:
klaR::rda(formula = missing_arg(), data = missing_arg(), lambda = 0, 
    gamma = 0)</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Now fit it</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>fit_qda_2 <span class="ot">&lt;-</span> </span>
<span id="cb90-2"><a href="#cb90-2"></a>  <span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb90-3"><a href="#cb90-3"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb90-4"><a href="#cb90-4"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Accuracy and decision boundary</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, </span>
<span id="cb91-2"><a href="#cb91-2"></a>             <span class="fu">predict</span>(fit_qda_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.877551</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb93-2"><a href="#cb93-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb93-3"><a href="#cb93-3"></a></span>
<span id="cb93-4"><a href="#cb93-4"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb93-5"><a href="#cb93-5"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb93-6"><a href="#cb93-6"></a></span>
<span id="cb93-7"><a href="#cb93-7"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/u4-da-7-1.png" width="960" class="r-stretch"></section>
<section id="comparisons-between-these-four-classifiers" class="slide level2">
<h2>Comparisons between these four classifiers</h2>
<ul>
<li><p>Both logistic and LDA are linear functions of X and therefore produce linear decision boundaries</p></li>
<li><p>LDA makes additional assumptions about X (multivariate normal and common <span class="math inline">\(\sum\)</span>) beyond logistic regression. Relative performance is based on the quality of this assumption</p></li>
<li><p>QDA relaxes the LDA assumption about common <span class="math inline">\(\sum\)</span> (and RDA can relax it partially)</p>
<ul>
<li>This also allows for nonlinear decision boundaries including 2-way interactions among features</li>
<li>QDA is therefore more flexible, which means possibly less bias but more potential for overfitting</li>
</ul></li>
<li><p>Both QDA and LDA assume multivariate normal X so <em>may</em> not accommodate categorical predictors very well. Logistic and KNN do accommodate categorical predictors</p></li>
<li><p>KNN is non-parametric and therefore the most flexible</p>
<ul>
<li>Can also handle interactions and non-linear effects natively (with feature engineering)</li>
<li>Increased overfitting, decreased bias?</li>
<li>Not very interpretable. But LDA/QDA, although parametric, aren’t as interpretable as logistic regression</li>
</ul></li>
<li><p>Logistic regression fails when classes are perfectly separated (but does that ever happen?) and is less stable when classes are well separated</p></li>
<li><p>LDA, KNN, and QDA naturally accommodate more than two classes</p>
<ul>
<li>Logistic requires additional tweak (<strong>Briefly describe: multiple one vs other classes models approach</strong>)</li>
</ul></li>
<li><p>Logistic regression requires relatively large sample sizes. LDA may perform better with smaller sample sizes if assumptions are met</p></li>
</ul>
</section>
<section id="a-quick-tour-of-many-classifiers" class="slide level2">
<h2>A quick tour of many classifiers</h2>
<p>The Cars dataset had strong predictors and a mostly linear decision boundary for the two predictors we considered</p>
<ul>
<li>This will not be true in many cases</li>
<li>Let’s consider a more complex two predictor decision boundary in the <strong>circle</strong> dataset from the <code>mlbench</code> package (lots of cool datasets for ML)</li>
<li>This will hopefully demonstrate that the key is to have a algorithm that can model the DGP</li>
<li>There is NO best algorithm</li>
<li>The best algorithm depends on
<ul>
<li>The DGP</li>
<li>The goal (prediction vs.&nbsp;explanation)</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<p>This will also demonstrate the power of tidymodels to allow us to fit many different statistical algorithms which all have their own syntax using a common syntax provided by tidymodels.</p>
<ul>
<li>This example has been adapted to tidymodels from a demonstration by <a href="https://michael.hahsler.net/SMU/EMIS7332/R/viz_classifier.html">Michael Hahsler</a></li>
<li>Simulate train and test data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="fu">library</span>(mlbench, <span class="at">include.only =</span> <span class="st">"mlbench.circle"</span>)</span>
<span id="cb94-2"><a href="#cb94-2"></a></span>
<span id="cb94-3"><a href="#cb94-3"></a><span class="fu">set.seed</span>(<span class="dv">20140102</span>)</span>
<span id="cb94-4"><a href="#cb94-4"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">mlbench.circle</span>(<span class="dv">200</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb94-5"><a href="#cb94-5"></a>  <span class="fu">rename</span>(<span class="at">x_1 =</span> x<span class="fl">.1</span>, <span class="at">x_2 =</span> x<span class="fl">.2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb94-6"><a href="#cb94-6"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 200
Columns: 3
$ x_1     &lt;dbl&gt; -0.514721263, 0.763312056, 0.312073042, 0.162981535, -0.320294…
$ x_2     &lt;dbl&gt; 0.47513532, 0.65803777, -0.89824011, 0.38680494, -0.47313964, …
$ classes &lt;fct&gt; 1, 2, 2, 1, 1, 1, 1, 2, 2, 1, 2, 2, 1, 1, 1, 2, 2, 2, 2, 2, 2,…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a>test <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">mlbench.circle</span>(<span class="dv">200</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb96-2"><a href="#cb96-2"></a>  <span class="fu">rename</span>(<span class="at">x_1 =</span> x<span class="fl">.1</span>, <span class="at">x_2 =</span> x<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Plot train data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_1, <span class="at">y =</span> x_2, <span class="at">color =</span> classes)) <span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/unnamed-chunk-28-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<h3 id="logistic-regression">Logistic Regression</h3>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a>fit_lr_bench <span class="ot">&lt;-</span> </span>
<span id="cb98-2"><a href="#cb98-2"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb98-3"><a href="#cb98-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb98-4"><a href="#cb98-4"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb99-2"><a href="#cb99-2"></a>             <span class="fu">predict</span>(fit_lr_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.62</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb101-2"><a href="#cb101-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb101-4"><a href="#cb101-4"></a></span>
<span id="cb101-5"><a href="#cb101-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb101-6"><a href="#cb101-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb101-8"><a href="#cb101-8"></a></span>
<span id="cb101-9"><a href="#cb101-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-29-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="knn-with-k-5-somewhat-arbitrary-default">KNN with K = 5 (somewhat arbitrary default)</h3>
<ul>
<li>Fit</li>
<li>Note same syntax as logistic regression (and for all others!)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>fit_knn_bench <span class="ot">&lt;-</span> </span>
<span id="cb102-2"><a href="#cb102-2"></a>  <span class="fu">nearest_neighbor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-4"><a href="#cb102-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-5"><a href="#cb102-5"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
<li>Note same syntax as logistic regression (and for all others!)</li>
<li>See what KNN can do relative to LR when the boundaries are non-linear!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb103-2"><a href="#cb103-2"></a>             <span class="fu">predict</span>(fit_knn_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb105-2"><a href="#cb105-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_knn_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb105-3"><a href="#cb105-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb105-4"><a href="#cb105-4"></a>  </span>
<span id="cb105-5"><a href="#cb105-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb105-6"><a href="#cb105-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_knn_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb105-7"><a href="#cb105-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb105-8"><a href="#cb105-8"></a>  </span>
<span id="cb105-9"><a href="#cb105-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-30-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="linear-discriminant-analysis-1">Linear Discriminant Analysis</h3>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>fit_lda_bench <span class="ot">&lt;-</span> </span>
<span id="cb106-2"><a href="#cb106-2"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb106-3"><a href="#cb106-3"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb106-4"><a href="#cb106-4"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb107-2"><a href="#cb107-2"></a>             <span class="fu">predict</span>(fit_lda_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.62</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb109-2"><a href="#cb109-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb109-3"><a href="#cb109-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb109-4"><a href="#cb109-4"></a></span>
<span id="cb109-5"><a href="#cb109-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb109-6"><a href="#cb109-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb109-7"><a href="#cb109-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb109-8"><a href="#cb109-8"></a></span>
<span id="cb109-9"><a href="#cb109-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-31-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="regularized-discriminant-analysis">Regularized Discriminant Analysis</h3>
<ul>
<li>Fit</li>
<li>Letting <code>rda()</code> select optimal hyperparameter values</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>fit_rda_bench <span class="ot">&lt;-</span> </span>
<span id="cb110-2"><a href="#cb110-2"></a>  <span class="fu">discrim_regularized</span>() <span class="sc">|&gt;</span> </span>
<span id="cb110-3"><a href="#cb110-3"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span></span>
<span id="cb110-4"><a href="#cb110-4"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
<li>Less overfitting?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb111-2"><a href="#cb111-2"></a>             <span class="fu">predict</span>(fit_rda_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb113-2"><a href="#cb113-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_rda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb113-3"><a href="#cb113-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb113-4"><a href="#cb113-4"></a></span>
<span id="cb113-5"><a href="#cb113-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb113-6"><a href="#cb113-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_rda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb113-7"><a href="#cb113-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb113-8"><a href="#cb113-8"></a></span>
<span id="cb113-9"><a href="#cb113-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-32-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="naive-bayes-classifier">Naive Bayes Classifier</h3>
<p>The Naïve Bayes classifier is a simple probabilistic classifier which is based on Bayes theorem</p>
<ul>
<li><p>But, we assume that the predictor variables are conditionally independent of one another given the response value</p></li>
<li><p>This algorithm can be fit with either <code>klaR</code> or <code>naivebayes</code> engines</p></li>
<li><p>There are many <a href="https://uc-r.github.io/naive_bayes">tutorials</a> available on this classifier</p></li>
<li><p>Fit it</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>fit_bayes_bench <span class="ot">&lt;-</span> </span>
<span id="cb114-2"><a href="#cb114-2"></a>  <span class="fu">naive_Bayes</span>() <span class="sc">|&gt;</span> </span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="fu">set_engine</span>(<span class="st">"naivebayes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb114-4"><a href="#cb114-4"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb115-2"><a href="#cb115-2"></a>             <span class="fu">predict</span>(fit_bayes_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.99</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb117-2"><a href="#cb117-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_bayes_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb117-3"><a href="#cb117-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb117-4"><a href="#cb117-4"></a></span>
<span id="cb117-5"><a href="#cb117-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb117-6"><a href="#cb117-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_bayes_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb117-7"><a href="#cb117-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb117-8"><a href="#cb117-8"></a></span>
<span id="cb117-9"><a href="#cb117-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-33-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="random-forest">Random Forest</h3>
<p>Random Forest is a variant of decision trees</p>
<ul>
<li><p>It uses <strong>bagging</strong> which involves resampling the data to produce many trees and then aggregating across trees for the final classification</p></li>
<li><p>We will discuss Random Forest in a later unit</p></li>
<li><p>Here we fit it with defaults for its hyperparameters</p></li>
<li><p>Fit it</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a>fit_rf_bench <span class="ot">&lt;-</span> </span>
<span id="cb118-2"><a href="#cb118-2"></a>  <span class="fu">rand_forest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb118-3"><a href="#cb118-3"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb118-4"><a href="#cb118-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb118-5"><a href="#cb118-5"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb119-2"><a href="#cb119-2"></a>             <span class="fu">predict</span>(fit_rf_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="#cb121-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_rf_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb121-3"><a href="#cb121-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb121-4"><a href="#cb121-4"></a></span>
<span id="cb121-5"><a href="#cb121-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb121-6"><a href="#cb121-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_rf_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb121-8"><a href="#cb121-8"></a></span>
<span id="cb121-9"><a href="#cb121-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-34-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="neural-networks">Neural networks</h3>
<p>It is easy to fit a <a href="https://parsnip.tidymodels.org/reference/mlp.html">single layer neural network</a></p>
<ul>
<li>We do this below with varying number of hidden units and all other hyperparameters set to defaults</li>
<li>We will have a unit on this later in the semester</li>
</ul>
</section>
<section class="slide level2">

<h4 id="single-layer-nn-with-1-hidden-unit">Single Layer NN with 1 hidden unit:</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a>fit_nn1_bench <span class="ot">&lt;-</span> </span>
<span id="cb122-2"><a href="#cb122-2"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb122-3"><a href="#cb122-3"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb122-4"><a href="#cb122-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb122-5"><a href="#cb122-5"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb123-2"><a href="#cb123-2"></a>             <span class="fu">predict</span>(fit_nn1_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.66</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb125-2"><a href="#cb125-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn1_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb125-3"><a href="#cb125-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb125-4"><a href="#cb125-4"></a></span>
<span id="cb125-5"><a href="#cb125-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb125-6"><a href="#cb125-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn1_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb125-7"><a href="#cb125-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb125-8"><a href="#cb125-8"></a></span>
<span id="cb125-9"><a href="#cb125-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-35-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<h4 id="single-layer-nn-with-2-hidden-units">Single Layer NN with 2 hidden units</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a>fit_nn2_bench <span class="ot">&lt;-</span> </span>
<span id="cb126-2"><a href="#cb126-2"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb126-3"><a href="#cb126-3"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb126-4"><a href="#cb126-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb126-5"><a href="#cb126-5"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb127-2"><a href="#cb127-2"></a>             <span class="fu">predict</span>(fit_nn2_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.765</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb129-2"><a href="#cb129-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn2_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb129-3"><a href="#cb129-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb129-4"><a href="#cb129-4"></a></span>
<span id="cb129-5"><a href="#cb129-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb129-6"><a href="#cb129-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn2_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb129-7"><a href="#cb129-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb129-8"><a href="#cb129-8"></a></span>
<span id="cb129-9"><a href="#cb129-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-36-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section class="slide level2">

<h4 id="single-layer-nn-with-5-hidden-units">Single Layer NN with 5 hidden units</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a>fit_nn5_bench <span class="ot">&lt;-</span> </span>
<span id="cb130-2"><a href="#cb130-2"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb130-3"><a href="#cb130-3"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb130-4"><a href="#cb130-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb130-5"><a href="#cb130-5"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb131-2"><a href="#cb131-2"></a>             <span class="fu">predict</span>(fit_nn5_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.96</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb133-2"><a href="#cb133-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn5_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb133-3"><a href="#cb133-3"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb133-4"><a href="#cb133-4"></a></span>
<span id="cb133-5"><a href="#cb133-5"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb133-6"><a href="#cb133-6"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn5_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb133-7"><a href="#cb133-7"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb133-8"><a href="#cb133-8"></a></span>
<span id="cb133-9"><a href="#cb133-9"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="004_classification_files/figure-revealjs/unnamed-chunk-37-1.png" style="height:3in" width="960"></p>
</div>
</div>
</section>
<section id="discussion" class="slide level2">
<h2>Discussion</h2>
<h3 id="anouncements">Anouncements</h3>
<ul>
<li>Quiz performance - 95%</li>
<li>Please meet with TA or me if you can’t generate predictions from your models</li>
<li>Room 121 again in two weeks</li>
<li>And the winner is…..</li>
</ul>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"lunch_004.csv"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb134-2"><a href="#cb134-2"></a>  <span class="fu">print_kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-condensed" data-quarto-postprocess="true" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">name</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">acc_test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">rf</td>
<td style="text-align: right;">0.80</td>
</tr>
<tr class="even">
<td style="text-align: right;">wang</td>
<td style="text-align: right;">0.80</td>
</tr>
<tr class="odd">
<td style="text-align: right;">Phipps</td>
<td style="text-align: right;">0.80</td>
</tr>
<tr class="even">
<td style="text-align: right;">dong</td>
<td style="text-align: right;">0.79</td>
</tr>
<tr class="odd">
<td style="text-align: right;">li</td>
<td style="text-align: right;">0.79</td>
</tr>
<tr class="even">
<td style="text-align: right;">jiang</td>
<td style="text-align: right;">0.78</td>
</tr>
<tr class="odd">
<td style="text-align: right;">Shea</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="even">
<td style="text-align: right;">simental</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="odd">
<td style="text-align: right;">cherry</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="even">
<td style="text-align: right;">crosby</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.76</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.73</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.73</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.72</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.71</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.71</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.69</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.68</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.68</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.68</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.66</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</section>
<section class="slide level2">

<h3 id="probability-odds-and-log-odds">Probability, odds, and log-odds</h3>
<ul>
<li>DGP on probability</li>
<li>what is irreducible error for classification?</li>
<li>DGP on X1 - draw it with varying degrees of error</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>DGP and error on two features</li>
</ul>
<p><img data-src="figs/unit4_two_class_decision_boundry.png" style="height:4in"></p>
</section>
<section class="slide level2">

<ul>
<li>Probability vs.&nbsp;odds vs.&nbsp;log-odds</li>
<li>How to interpret parameter estimates (effects of X)</li>
</ul>
</section>
<section class="slide level2">

<h3 id="comparisons-across-algorithms">Comparisons across algorithms</h3>
<p>Logistic regression models DGP condition probabilities using logistic function</p>
<ul>
<li>Get parameter estimates for effects of X</li>
<li>Makes strong assumptions shape of DGP - linear on log-odds(Y)</li>
<li>Yields linear decision boundary</li>
<li>Better for binary outcomes but can do more than two levels</li>
<li>Needs numeric features but can dummy code categorical variables (as with lm)</li>
<li>Problems when classes are fully separable (or even mostly separable)</li>
</ul>
</section>
<section class="slide level2">

<p>LDA uses Bayes theorem to estimate condition probability</p>
<ul>
<li>LDA models the distributions of the Xs separately for each class</li>
<li>Then uses Bayes theorem to estimate <span class="math inline">\(Pr(Y = k | X)\)</span> for each k and assigns the observation to the class with the highest probability</li>
</ul>
<p><span class="math inline">\(Pr(Y = k|X) = \frac{\pi_k * f_k(X)}{\sum_{l = 1}^{K} f_l(X)}\)</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\pi_k\)</span> is the prior probability that an observation comes from class k (estimated from frequencies of k in training)</li>
<li><span class="math inline">\(f_k(X)\)</span> is the density function of X for an observation from class k
<ul>
<li><span class="math inline">\(f_k(X)\)</span> is large if there is a high probability that an observation in class k has that set of values for X and small if that probability is low</li>
<li><span class="math inline">\(f_k(X)\)</span> is difficult to estimate unless we make some simplifying assumptions</li>
<li>X is multivariate normal</li>
<li>Common covariance matrix (<span class="math inline">\(\sum\)</span>) across K classesj</li>
<li>With these assumptions, we can estimate <span class="math inline">\(\pi_k\)</span>, <span class="math inline">\(\mu_k\)</span>, and <span class="math inline">\(\sigma^2\)</span> from the training set and calculate <span class="math inline">\(Pr(Y = k|X)\)</span> for each k</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>Parametric model but parameters not useful for interpretation of effects of X</li>
<li>Linear decision boundary<br>
</li>
<li>Assumptions about multivariate normal X and common <span class="math inline">\(\sum\)</span></li>
<li>Dummy features may not work well given assumption?</li>
<li>May require smaller sample sizes to fit than logistic regression if assumptions met</li>
<li>Can natively handle more than two level for outcome</li>
</ul>
</section>
<section class="slide level2">

<p>QDA relaxes one restrictive assumption of LDA</p>
<ul>
<li>Still required multivariate normal X</li>
<li><strong>But it allows each class to have its own <span class="math inline">\(\sum\)</span></strong></li>
<li>This makes it:
<ul>
<li>More flexible</li>
<li>Able to model non-linear decision boundaries including 2-way intearctions (see formula for discriminant in <span class="citation" data-cites="ISL">James et al. (<a href="#/references" role="doc-biblioref" onclick="">2023</a>)</span>)</li>
<li>how handle interactions by relaxing common <span class="math inline">\(\sum\)</span>?</li>
<li>But requires substantial increase in parameter estimation (more potential to overfit)</li>
</ul></li>
<li>Still problems with dummy features</li>
<li>Can natively handle more than 2 levels of outcome like LDA</li>
<li>Compare to LDA and Logisitic Regression on bias-variance trade off?<br>
<br>
RDA may be better than both LDA and QDA? More on idea of blending after elastic net</li>
</ul>
</section>
<section class="slide level2">

<p>KNN works similar to regression</p>
<ul>
<li>But now looks at percentage of observations for each class among nearest neighbours to estimate conditional probabilities</li>
<li>Doesn’t make assumptions about Xs or <span class="math inline">\(\sum\)</span> for LDA and/or QDA</li>
<li>Doesn’t not limited to linear decision boundaries like logistic and LDA</li>
<li>Very flexible - low bias but high variance?</li>
<li>K can be adjusted to impact bias-variance trade-off</li>
<li>KNN can handle more than two level outcomes natively</li>
</ul>
</section>
<section id="categorical-predictors" class="slide level2">
<h2>Categorical predictors</h2>
<ul>
<li>All algorithms so far require numeric features</li>
<li>Ordinal can be made numeric sometimes by just substituting ordered vector (i.e.&nbsp;1, 2, 3, etc)</li>
<li>Nominal needs something more</li>
<li>Our go to method is Dummy features
<ul>
<li>What is big problem with dummy features?</li>
<li>Collapsing levels?</li>
<li>Also issue of binary scores for LDA/QDA</li>
</ul></li>
<li>Target encoding example
<ul>
<li>Country of origin for car example (but maybe think of many countries?)</li>
<li>Why not data leakage?</li>
<li>Problems with step_mutate()</li>
<li>Can manually do it with our current resampling</li>
<li>See <a href="https://embed.tidymodels.org/">embed package</a></li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<h3 id="interactions-in-lda-and-qda">Interactions in LDA and QDA</h3>
<ul>
<li>Simulate multivariate normal distribution for X (<code>x1</code> and <code>x2</code>) using MASS package</li>
<li>Separately for trn and val</li>
<li>NOTE: I first did this with uniform distributions on X and the models fit more poorly. Why?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="fu">set.seed</span>(<span class="dv">5433</span>)</span>
<span id="cb135-2"><a href="#cb135-2"></a>means <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb135-3"><a href="#cb135-3"></a>sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb135-4"><a href="#cb135-4"></a>data_trn <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">300</span>, <span class="at">mu =</span> means, <span class="at">Sigma =</span> sigma) <span class="sc">|&gt;</span>  </span>
<span id="cb135-5"><a href="#cb135-5"></a>    magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">str_c</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(means))) <span class="sc">|&gt;</span>  </span>
<span id="cb135-6"><a href="#cb135-6"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb135-7"><a href="#cb135-7"></a></span>
<span id="cb135-8"><a href="#cb135-8"></a>data_val <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">mu =</span> means, <span class="at">Sigma =</span> sigma) <span class="sc">|&gt;</span>  </span>
<span id="cb135-9"><a href="#cb135-9"></a>    magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">str_c</span>(<span class="st">"x"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(means))) <span class="sc">|&gt;</span>  </span>
<span id="cb135-10"><a href="#cb135-10"></a>    <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Write function for interactive DGP based on <code>x1</code> and <code>x2</code></li>
<li>Will map this over rows of d</li>
<li>Can specify any values for b</li>
<li>b[4] will be interaction parameter estimate</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, .<span class="dv">5</span>)</span>
<span id="cb136-2"><a href="#cb136-2"></a></span>
<span id="cb136-3"><a href="#cb136-3"></a>calc_p <span class="ot">&lt;-</span> <span class="cf">function</span>(x, b){</span>
<span id="cb136-4"><a href="#cb136-4"></a>   <span class="fu">exp</span>(b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>]<span class="sc">*</span>x<span class="sc">$</span>x1 <span class="sc">+</span> b[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">$</span>x2 <span class="sc">+</span> b[<span class="dv">4</span>]<span class="sc">*</span>x<span class="sc">$</span>x1<span class="sc">*</span>x<span class="sc">$</span>x2) <span class="sc">/</span></span>
<span id="cb136-5"><a href="#cb136-5"></a>     (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(b[<span class="dv">1</span>] <span class="sc">+</span> b[<span class="dv">2</span>]<span class="sc">*</span>x<span class="sc">$</span>x1 <span class="sc">+</span> b[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">$</span>x2 <span class="sc">+</span> b[<span class="dv">4</span>]<span class="sc">*</span>x<span class="sc">$</span>x1<span class="sc">*</span>x<span class="sc">$</span>x2))</span>
<span id="cb136-6"><a href="#cb136-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Add p and then observed classes to trn and val</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>data_trn <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb137-2"><a href="#cb137-2"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">calc_p</span>(data_trn, b)) <span class="sc">|&gt;</span> </span>
<span id="cb137-3"><a href="#cb137-3"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(data_trn), <span class="dv">1</span>, p),</span>
<span id="cb137-4"><a href="#cb137-4"></a>         <span class="at">y =</span> <span class="fu">factor</span>(y, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"neg"</span>, <span class="st">"pos"</span>)))</span>
<span id="cb137-5"><a href="#cb137-5"></a></span>
<span id="cb137-6"><a href="#cb137-6"></a><span class="fu">head</span>(data_trn, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
        x1     x2        p y    
     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;
 1   9.85   -5.53 1.52e-12 neg  
 2  -2.48    5.64 9.21e- 4 neg  
 3  -4.74  -13.7  1.00e+ 0 pos  
 4  -7.02   12.6  6.09e-20 neg  
 5   0.942  -3.48 1.63e- 1 pos  
 6   0.151   2.78 5.52e- 1 neg  
 7   7.74   -6.84 3.24e-12 neg  
 8  -4.85  -10.1  1.00e+ 0 pos  
 9  -0.937   2.03 2.78e- 1 neg  
10 -16.5     6.08 1.83e-22 neg  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a>data_val <span class="ot">&lt;-</span> data_val <span class="sc">|&gt;</span> </span>
<span id="cb139-2"><a href="#cb139-2"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">calc_p</span>(data_val, b)) <span class="sc">|&gt;</span> </span>
<span id="cb139-3"><a href="#cb139-3"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(data_val), <span class="dv">1</span>, p),</span>
<span id="cb139-4"><a href="#cb139-4"></a>         <span class="at">y =</span> <span class="fu">factor</span>(y, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"neg"</span>, <span class="st">"pos"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Lets look at what an interactive DGP looks like for two features and a binary outcome</li>
<li>Parameter estimates set up a “cross-over” interaction</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb140-2"><a href="#cb140-2"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">color =</span> y)) <span class="sc">+</span></span>
<span id="cb140-3"><a href="#cb140-3"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/unnamed-chunk-42-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<ul>
<li>Fit models in trn</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a>fit_lda <span class="ot">&lt;-</span> </span>
<span id="cb141-2"><a href="#cb141-2"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb141-3"><a href="#cb141-3"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb141-4"><a href="#cb141-4"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> data_trn)</span>
<span id="cb141-5"><a href="#cb141-5"></a></span>
<span id="cb141-6"><a href="#cb141-6"></a>fit_lda_int <span class="ot">&lt;-</span> </span>
<span id="cb141-7"><a href="#cb141-7"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb141-8"><a href="#cb141-8"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb141-9"><a href="#cb141-9"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x1<span class="sc">*</span>x2, <span class="at">data =</span> data_trn)</span>
<span id="cb141-10"><a href="#cb141-10"></a></span>
<span id="cb141-11"><a href="#cb141-11"></a>fit_qda <span class="ot">&lt;-</span> </span>
<span id="cb141-12"><a href="#cb141-12"></a>  <span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb141-13"><a href="#cb141-13"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb141-14"><a href="#cb141-14"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> data_trn)</span>
<span id="cb141-15"><a href="#cb141-15"></a></span>
<span id="cb141-16"><a href="#cb141-16"></a>fit_qda_int <span class="ot">&lt;-</span> </span>
<span id="cb141-17"><a href="#cb141-17"></a>  <span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb141-18"><a href="#cb141-18"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb141-19"><a href="#cb141-19"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x1<span class="sc">*</span>x2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<ul>
<li>Additive LDA model decision boundary and performance in val</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a href="#cb142-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">y_name =</span> <span class="st">"y"</span>,</span>
<span id="cb142-3"><a href="#cb142-3"></a>                         <span class="at">n_points =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/unnamed-chunk-44-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<ul>
<li>Interactive LDA model decision boundary and performance in val</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb143-2"><a href="#cb143-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_int, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">y_name =</span> <span class="st">"y"</span>,</span>
<span id="cb143-3"><a href="#cb143-3"></a>                         <span class="at">n_points =</span> <span class="dv">400</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/unnamed-chunk-45-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<ul>
<li>Additive QDA model decision boundary</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb144-2"><a href="#cb144-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">y_name =</span> <span class="st">"y"</span>,</span>
<span id="cb144-3"><a href="#cb144-3"></a>                         <span class="at">n_points =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/unnamed-chunk-46-1.png" width="960" class="r-stretch"><ul>
<li>Interactive QDA model decision boundary</li>
</ul>
</section>
<section class="slide level2">

<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a>data_val <span class="sc">|&gt;</span> </span>
<span id="cb145-2"><a href="#cb145-2"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda_int, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">y_name =</span> <span class="st">"y"</span>,</span>
<span id="cb145-3"><a href="#cb145-3"></a>                         <span class="at">n_points =</span> <span class="dv">400</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="004_classification_files/figure-revealjs/unnamed-chunk-47-1.png" width="960" class="r-stretch"><ul>
<li>Costs for QDA vs.&nbsp;LDA intearctive in this example and more generally with more features?</li>
<li>What if you were using RDA, which can model the full range of models between linear and quadratic?</li>
</ul>
</section>
<section class="slide level2 smaller scrollable" id="references">

<p>PCA</p>
<ul>
<li>https://setosa.io/ev/principal-component-analysis/:w</li>
<li>https://www.cs.cmu.edu/~elaw/papers/pca.pdf</li>
</ul>
<div class="footer footer-default">

</div>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-ISL" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2023. <em>An <span>Introduction</span> to <span>Statistical Learning</span>: With <span>Applications</span> in <span>R</span></em>. 2nd ed. Springer <span>Texts</span> in <span>Statistics</span>. <span>New York</span>: <span>Springer-Verlag</span>.
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="004_classification_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="004_classification_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="004_classification_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="004_classification_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="004_classification_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="004_classification_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="004_classification_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="004_classification_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="004_classification_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="004_classification_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="004_classification_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>