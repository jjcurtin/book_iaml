<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Natural Language Processing: Text Processing and Feature Engineering – Introduction to Applied Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./l13_applications.html" rel="next">
<link href="./l11_explanation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-231ef2f9d4ce3268f31ef752336c15d2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="book.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./l12_nlp.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Natural Language Processing: Text Processing and Feature Engineering</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Applied Machine Learning</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jjcurtin/book_iaml" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./course_materials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Materials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l01_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l02_exploratory_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l03_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l04_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l05_resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resampling Methods for Model Selection and Evaluation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l06_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regularization and Penalized Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l07_midterm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Midterm Exam</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l08_advanced_performance_metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Performance Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l09_random_forest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Models: Decision Trees, Bagging Trees, and Random Forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l10_neural_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Models: Neural Networks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l11_explanation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Explanatory Approaches</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l12_nlp.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Natural Language Processing: Text Processing and Feature Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l13_applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Applications for Machine Learning: Synthesis and Concept Generalization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l14_ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ethical Issues in Machine Learning Research and Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l15_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Final Exams - Applications and Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./review_midterm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review Midterm Concepts Exam</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./review_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review Final Concepts Exam</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_terminology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key Terminology and Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_dummy_coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Novel Levels in Held-Out Set(s)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_resampling_with_map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Map across resamples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Principal Components Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_keras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installing Keras for Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_word2vec.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Understanding Word Embeddings and word2vec</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Test</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">12.1</span> Learning Objectives</a></li>
  <li><a href="#general-text-pre--processing" id="toc-general-text-pre--processing" class="nav-link" data-scroll-target="#general-text-pre--processing"><span class="header-section-number">12.2</span> General Text (Pre-) Processing</a>
  <ul class="collapse">
  <li><a href="#the-stringr-package" id="toc-the-stringr-package" class="nav-link" data-scroll-target="#the-stringr-package"><span class="header-section-number">12.2.1</span> The stringr package</a></li>
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions"><span class="header-section-number">12.2.2</span> Regular Expressions</a></li>
  </ul></li>
  <li><a href="#the-imdb-dataset" id="toc-the-imdb-dataset" class="nav-link" data-scroll-target="#the-imdb-dataset"><span class="header-section-number">12.3</span> The IMDB Dataset</a></li>
  <li><a href="#tokens" id="toc-tokens" class="nav-link" data-scroll-target="#tokens"><span class="header-section-number">12.4</span> Tokens</a></li>
  <li><a href="#stop-words" id="toc-stop-words" class="nav-link" data-scroll-target="#stop-words"><span class="header-section-number">12.5</span> Stop words</a></li>
  <li><a href="#stemming" id="toc-stemming" class="nav-link" data-scroll-target="#stemming"><span class="header-section-number">12.6</span> Stemming</a></li>
  <li><a href="#bag-of-words" id="toc-bag-of-words" class="nav-link" data-scroll-target="#bag-of-words"><span class="header-section-number">12.7</span> Bag of Words</a></li>
  <li><a href="#bringing-it-all-together" id="toc-bringing-it-all-together" class="nav-link" data-scroll-target="#bringing-it-all-together"><span class="header-section-number">12.8</span> Bringing it all together</a>
  <ul class="collapse">
  <li><a href="#general" id="toc-general" class="nav-link" data-scroll-target="#general"><span class="header-section-number">12.8.1</span> General</a></li>
  <li><a href="#words-unigrams" id="toc-words-unigrams" class="nav-link" data-scroll-target="#words-unigrams"><span class="header-section-number">12.8.2</span> Words (unigrams)</a></li>
  <li><a href="#words-unigrams-excluding-stop-words" id="toc-words-unigrams-excluding-stop-words" class="nav-link" data-scroll-target="#words-unigrams-excluding-stop-words"><span class="header-section-number">12.8.3</span> Words (unigrams) Excluding Stop Words</a></li>
  <li><a href="#stemmed-words-unigrams" id="toc-stemmed-words-unigrams" class="nav-link" data-scroll-target="#stemmed-words-unigrams"><span class="header-section-number">12.8.4</span> Stemmed Words (unigrams)</a></li>
  <li><a href="#ngrams-unigrams-and-bigrams" id="toc-ngrams-unigrams-and-bigrams" class="nav-link" data-scroll-target="#ngrams-unigrams-and-bigrams"><span class="header-section-number">12.8.5</span> ngrams (unigrams and bigrams)</a></li>
  <li><a href="#word-embeddings" id="toc-word-embeddings" class="nav-link" data-scroll-target="#word-embeddings"><span class="header-section-number">12.8.6</span> Word Embeddings</a></li>
  <li><a href="#best-configuration" id="toc-best-configuration" class="nav-link" data-scroll-target="#best-configuration"><span class="header-section-number">12.8.7</span> Best Configuration</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jjcurtin/book_iaml/edit/main/l12_nlp.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Natural Language Processing: Text Processing and Feature Engineering</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">12.1</span> Learning Objectives</h2>
<ul>
<li>Objective 1</li>
<li>Objective 2</li>
</ul>
<hr>
</section>
<section id="general-text-pre--processing" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="general-text-pre--processing"><span class="header-section-number">12.2</span> General Text (Pre-) Processing</h2>
<p>In order to work with text, we need to be able to manipulate text. We have two sets of tools to master:</p>
<ul>
<li>The <code>stringr</code> <a href="https://cran.r-project.org/web/packages/stringr/index.html">package</a></li>
<li>Regular expressions (regex)</li>
</ul>
<section id="the-stringr-package" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="the-stringr-package"><span class="header-section-number">12.2.1</span> The stringr package</h3>
<p>There are many functions in the <code>stringr</code> package that are very useful for searching and manipulating text.</p>
<ul>
<li><code>stringr</code> is included in tidyverse</li>
<li>I recommend keeping the <a href="pdfs/cheatsheet_strings.pdf">stringr cheatsheet</a> open whenever you are working with text until you learn these functions well.</li>
</ul>
<hr>
<p>All functions in <code>stringr</code> start with <code>str_</code> and take a vector of strings as the first argument.</p>
<p>Here is a simple vector of strings to use as an example</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"why"</span>, <span class="st">"video"</span>, <span class="st">"cross"</span>, <span class="st">"extra"</span>, <span class="st">"deal"</span>, <span class="st">"authority"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Length of each string</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 5 5 5 4 9</code></pre>
</div>
</div>
<ul>
<li>Collapse all strings in vector into one long string that is comma separated</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(x, <span class="at">collapse =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "why, video, cross, extra, deal, authority"</code></pre>
</div>
</div>
<ul>
<li>Get substring based on position (start and end position)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(x, <span class="dv">1</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "wh" "vi" "cr" "ex" "de" "au"</code></pre>
</div>
</div>
<hr>
<p>Most <code>stringr</code> functions work with regular expressions, a concise language for describing patterns of text.</p>
<p>For example, the regular expression “[aeiou]” matches any single character that is a vowel.</p>
<ul>
<li>Here we use <code>str_subset()</code> to return the strings that contain vowels (doesnt include “why”)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(x, <span class="st">"[aeiou]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "video"     "cross"     "extra"     "deal"      "authority"</code></pre>
</div>
</div>
<ul>
<li>Here we count the vowels in each string</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(x, <span class="st">"[aeiou]"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 3 1 2 2 4</code></pre>
</div>
</div>
<hr>
<p>There are eight main verbs that work with patterns:</p>
<p>1 <code>str_detect(x, pattern)</code> tells you if there is any match to the pattern in each string</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- c("why", "video", "cross", "extra", "deal", "authority")</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="st">"[aeiou]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE</code></pre>
</div>
</div>
<hr>
<p>2 <code>str_count(x, pattern)</code> counts the number of patterns</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- c("why", "video", "cross", "extra", "deal", "authority")</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(x, <span class="st">"[aeiou]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 3 1 2 2 4</code></pre>
</div>
</div>
<hr>
<p>3 <code>str_subset(x, pattern)</code> extracts the matching components</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- c("why", "video", "cross", "extra", "deal", "authority")</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(x, <span class="st">"[aeiou]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "video"     "cross"     "extra"     "deal"      "authority"</code></pre>
</div>
</div>
<hr>
<p>4 <code>str_locate(x, pattern)</code> gives the position of the match</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- c("why", "video", "cross", "extra", "deal", "authority")</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate</span>(x, <span class="st">"[aeiou]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     start end
[1,]    NA  NA
[2,]     2   2
[3,]     3   3
[4,]     1   1
[5,]     2   2
[6,]     1   1</code></pre>
</div>
</div>
<hr>
<p>5 <code>str_extract(x, pattern)</code> extracts the text of the match</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- c("why", "video", "cross", "extra", "deal", "authority")</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(x, <span class="st">"[aeiou]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA  "i" "o" "e" "e" "a"</code></pre>
</div>
</div>
<hr>
<p>6 <code>str_match(x, pattern)</code> extracts parts of the match defined by parentheses. In this case, the characters on either side of the vowel</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- c("why", "video", "cross", "extra", "deal", "authority")</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_match</span>(x, <span class="st">"(.)[aeiou](.)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2] [,3]
[1,] NA    NA   NA  
[2,] "vid" "v"  "d" 
[3,] "ros" "r"  "s" 
[4,] NA    NA   NA  
[5,] "dea" "d"  "a" 
[6,] "aut" "a"  "t" </code></pre>
</div>
</div>
<hr>
<p>7 <code>str_replace(x, pattern, replacement)</code> replaces the matches with new text</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- c("why", "video", "cross", "extra", "deal", "authority")</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(x, <span class="st">"[aeiou]"</span>, <span class="st">"?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "why"       "v?deo"     "cr?ss"     "?xtra"     "d?al"      "?uthority"</code></pre>
</div>
</div>
<hr>
<p>8 <code>str_split(x, pattern)</code> splits up a string into multiple pieces.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(<span class="fu">c</span>(<span class="st">"a,b"</span>, <span class="st">"c,d,e"</span>), <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "a" "b"

[[2]]
[1] "c" "d" "e"</code></pre>
</div>
</div>
<hr>
</section>
<section id="regular-expressions" class="level3" data-number="12.2.2">
<h3 data-number="12.2.2" class="anchored" data-anchor-id="regular-expressions"><span class="header-section-number">12.2.2</span> Regular Expressions</h3>
<p>Regular expressions are a way to specify or search for patterns of strings using a sequence of characters. By combining a selection of simple patterns, we can capture quite complicated strings.</p>
<p>The <code>stringr</code> package uses regular expressions extensively</p>
<p>The regular expressions are passed as the pattern = argument. Regular expressions can be used to detect, locate, or extract parts of a string.</p>
<hr>
<p>Julia Silge has put together a wonderful <a href="https://smltar.com/regexp.html#literal-characters">tutorial/primer on the use of regular expressions</a>. After reading it, I finally had a solid grasp on them. Rather than grab sections, I will direct you to it (and review it live in our filmed lectures). She does it much better than I could!</p>
<p>You might consider installing the <code>RegExplain</code> <a href="https://www.garrickadenbuie.com/project/regexplain/">package</a> using devtools if you want more support working with regular expressions. They are powerful but they are complicated to learn initially</p>
<p>There is also a very helpful <a href="pdfs/cheatsheert_regex.pdf">cheatsheet</a> for regular expressions</p>
<p>And finally, there is a great <span class="citation" data-cites="RDS">Wickham, Çetinkaya-Rundel, and Grolemund (<a href="#ref-RDS" role="doc-biblioref">2023</a>)</span> chapter on <a href="https://r4ds.had.co.nz/strings.html">strings</a> more generally, which covers both <code>stringr</code> and regex.</p>
<hr>
</section>
</section>
<section id="the-imdb-dataset" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="the-imdb-dataset"><span class="header-section-number">12.3</span> The IMDB Dataset</h2>
<p>Now that we have a basic understanding of how to manipulation raw text, we can get set up for NLP and introduce a guiding example for this unit</p>
<p>We can start with our normal cast of characters RE packages, source, and settings (not displayed here)</p>
<p>However, we will also install a few new ones that are specific to working with text.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textrecipes)  <span class="co">#step_- functions for NLP</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SnowballC)  </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stopwords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>The IMDB Reviews dataset is a classic NLP dataset that is used for sentiment analysis</p>
<p>It contains:</p>
<ul>
<li>25,000 movie reviews in train and test</li>
<li>Balanced on positive and negative sentiment (labeled outcome)</li>
<li>For more info, see the <a href="http://ai.stanford.edu/~amaas/data/sentiment/">website</a></li>
</ul>
<hr>
<p>Let’s start by loading the dataset and adding an identifier for each review (i.e., <strong>document</strong>, <code>doc_num</code>)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"imdb_trn.csv"</span>), </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"doc_num"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> <span class="fu">fct</span>(sentiment, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"neg"</span>, <span class="st">"pos"</span>))) </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>data_trn  <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skim_some</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data_trn</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">25000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">text</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">13704</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">24904</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sentiment</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">neg: 12500, pos: 12500</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">doc_num</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">25000</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<p>Let’s look at our outcome</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">tab</span>(sentiment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  sentiment     n  prop
  &lt;fct&gt;     &lt;int&gt; &lt;dbl&gt;
1 neg       12500   0.5
2 pos       12500   0.5</code></pre>
</div>
</div>
<hr>
<p>To get a better sense of the dataset, We can view first five negative reviews from the training set</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sentiment <span class="sc">==</span> <span class="st">"neg"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(text) <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_kbl</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Story of a man who has unnatural feelings for a pig. Starts out with a opening scene that is a terrific example of absurd comedy. A formal orchestra audience is turned into an insane, violent mob by the crazy chantings of it's singers. Unfortunately it stays absurd the WHOLE time with no general narrative eventually making it just too off putting. Even those from the era should be turned off. The cryptic dialogue would make Shakespeare seem easy to a third grader. On a technical level it's better than you might think with some good cinematography by future great Vilmos Zsigmond. Future stars Sally Kirkland and Frederic Forrest can be seen briefly.</td>
</tr>
<tr class="even">
<td style="text-align: right;">Airport '77 starts as a brand new luxury 747 plane is loaded up with valuable paintings &amp; such belonging to rich businessman Philip Stevens (James Stewart) who is flying them &amp; a bunch of VIP's to his estate in preparation of it being opened to the public as a museum, also on board is Stevens daughter Julie (Kathleen Quinlan) &amp; her son. The luxury jetliner takes off as planned but mid-air the plane is hi-jacked by the co-pilot Chambers (Robert Foxworth) &amp; his two accomplice's Banker (Monte Markham) &amp; Wilson (Michael Pataki) who knock the passengers &amp; crew out with sleeping gas, they plan to steal the valuable cargo &amp; land on a disused plane strip on an isolated island but while making his descent Chambers almost hits an oil rig in the Ocean &amp; loses control of the plane sending it crashing into the sea where it sinks to the bottom right bang in the middle of the Bermuda Triangle. With air in short supply, water leaking in &amp; having flown over 200 miles off course the problems mount for the survivor's as they await help with time fast running out...&lt;br /&gt;&lt;br /&gt;Also known under the slightly different tile Airport 1977 this second sequel to the smash-hit disaster thriller Airport (1970) was directed by Jerry Jameson &amp; while once again like it's predecessors I can't say Airport '77 is any sort of forgotten classic it is entertaining although not necessarily for the right reasons. Out of the three Airport films I have seen so far I actually liked this one the best, just. It has my favourite plot of the three with a nice mid-air hi-jacking &amp; then the crashing (didn't he see the oil rig?) &amp; sinking of the 747 (maybe the makers were trying to cross the original Airport with another popular disaster flick of the period The Poseidon Adventure (1972)) &amp; submerged is where it stays until the end with a stark dilemma facing those trapped inside, either suffocate when the air runs out or drown as the 747 floods or if any of the doors are opened &amp; it's a decent idea that could have made for a great little disaster flick but bad unsympathetic character's, dull dialogue, lethargic set-pieces &amp; a real lack of danger or suspense or tension means this is a missed opportunity. While the rather sluggish plot keeps one entertained for 108 odd minutes not that much happens after the plane sinks &amp; there's not as much urgency as I thought there should have been. Even when the Navy become involved things don't pick up that much with a few shots of huge ships &amp; helicopters flying about but there's just something lacking here. George Kennedy as the jinxed airline worker Joe Patroni is back but only gets a couple of scenes &amp; barely even says anything preferring to just look worried in the background.&lt;br /&gt;&lt;br /&gt;The home video &amp; theatrical version of Airport '77 run 108 minutes while the US TV versions add an extra hour of footage including a new opening credits sequence, many more scenes with George Kennedy as Patroni, flashbacks to flesh out character's, longer rescue scenes &amp; the discovery or another couple of dead bodies including the navigator. While I would like to see this extra footage I am not sure I could sit through a near three hour cut of Airport '77. As expected the film has dated badly with horrible fashions &amp; interior design choices, I will say no more other than the toy plane model effects aren't great either. Along with the other two Airport sequels this takes pride of place in the Razzie Award's Hall of Shame although I can think of lots of worse films than this so I reckon that's a little harsh. The action scenes are a little dull unfortunately, the pace is slow &amp; not much excitement or tension is generated which is a shame as I reckon this could have been a pretty good film if made properly.&lt;br /&gt;&lt;br /&gt;The production values are alright if nothing spectacular. The acting isn't great, two time Oscar winner Jack Lemmon has said since it was a mistake to star in this, one time Oscar winner James Stewart looks old &amp; frail, also one time Oscar winner Lee Grant looks drunk while Sir Christopher Lee is given little to do &amp; there are plenty of other familiar faces to look out for too.&lt;br /&gt;&lt;br /&gt;Airport '77 is the most disaster orientated of the three Airport films so far &amp; I liked the ideas behind it even if they were a bit silly, the production &amp; bland direction doesn't help though &amp; a film about a sunken plane just shouldn't be this boring or lethargic. Followed by The Concorde ... Airport '79 (1979).</td>
</tr>
<tr class="odd">
<td style="text-align: right;">This film lacked something I couldn't put my finger on at first: charisma on the part of the leading actress. This inevitably translated to lack of chemistry when she shared the screen with her leading man. Even the romantic scenes came across as being merely the actors at play. It could very well have been the director who miscalculated what he needed from the actors. I just don't know.&lt;br /&gt;&lt;br /&gt;But could it have been the screenplay? Just exactly who was the chef in love with? He seemed more enamored of his culinary skills and restaurant, and ultimately of himself and his youthful exploits, than of anybody or anything else. He never convinced me he was in love with the princess.&lt;br /&gt;&lt;br /&gt;I was disappointed in this movie. But, don't forget it was nominated for an Oscar, so judge for yourself.</td>
</tr>
<tr class="even">
<td style="text-align: right;">Sorry everyone,,, I know this is supposed to be an "art" film,, but wow, they should have handed out guns at the screening so people could blow their brains out and not watch. Although the scene design and photographic direction was excellent, this story is too painful to watch. The absence of a sound track was brutal. The loooonnnnng shots were too long. How long can you watch two people just sitting there and talking? Especially when the dialogue is two people complaining. I really had a hard time just getting through this film. The performances were excellent, but how much of that dark, sombre, uninspired, stuff can you take? The only thing i liked was Maureen Stapleton and her red dress and dancing scene. Otherwise this was a ripoff of Bergman. And i'm no fan f his either. I think anyone who says they enjoyed 1 1/2 hours of this is,, well, lying.</td>
</tr>
<tr class="odd">
<td style="text-align: right;">When I was little my parents took me along to the theater to see Interiors. It was one of many movies I watched with my parents, but this was the only one we walked out of. Since then I had never seen Interiors until just recently, and I could have lived out the rest of my life without it. What a pretentious, ponderous, and painfully boring piece of 70's wine and cheese tripe. Woody Allen is one of my favorite directors but Interiors is by far the worst piece of crap of his career. In the unmistakable style of Ingmar Berman, Allen gives us a dark, angular, muted, insight in to the lives of a family wrought by the psychological damage caused by divorce, estrangement, career, love, non-love, halitosis, whatever. The film, intentionally, has no comic relief, no music, and is drenched in shadowy pathos. This film style can be best defined as expressionist in nature, using an improvisational method of dialogue to illicit a "more pronounced depth of meaning and truth". But Woody Allen is no Ingmar Bergman. The film is painfully slow and dull. But beyond that, I simply had no connection with or sympathy for any of the characters. Instead I felt only contempt for this parade of shuffling, whining, nicotine stained, martyrs in a perpetual quest for identity. Amid a backdrop of cosmopolitan affluence and baked Brie intelligentsia the story looms like a fart in the room. Everyone speaks in affected platitudes and elevated language between cigarettes. Everyone is "lost" and "struggling", desperate to find direction or understanding or whatever and it just goes on and on to the point where you just want to slap all of them. It's never about resolution, it's only about interminable introspective babble. It is nothing more than a psychological drama taken to an extreme beyond the audience's ability to connect. Woody Allen chose to make characters so immersed in themselves we feel left out. And for that reason I found this movie painfully self indulgent and spiritually draining. I see what he was going for but his insistence on promoting his message through Prozac prose and distorted film techniques jettisons it past the point of relevance. I highly recommend this one if you're feeling a little too happy and need something to remind you of death. Otherwise, let's just pretend this film never happened.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<hr>
<p>and the first five positive reviews from the training set</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sentiment <span class="sc">==</span> <span class="st">"pos"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(text) <span class="sc">|&gt;</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Bromwell High is a cartoon comedy. It ran at the same time as some other programs about school life, such as "Teachers". My 35 years in the teaching profession lead me to believe that Bromwell High's satire is much closer to reality than is "Teachers". The scramble to survive financially, the insightful students who can see right through their pathetic teachers' pomp, the pettiness of the whole situation, all remind me of the schools I knew and their students. When I saw the episode in which a student repeatedly tried to burn down the school, I immediately recalled ......... at .......... High. A classic line: INSPECTOR: I'm here to sack one of your teachers. STUDENT: Welcome to Bromwell High. I expect that many adults of my age think that Bromwell High is far fetched. What a pity that it isn't!</td>
</tr>
<tr class="even">
<td style="text-align: right;">Homelessness (or Houselessness as George Carlin stated) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. Most people think of the homeless as just a lost cause while worrying about things such as racism, the war on Iraq, pressuring kids to succeed, technology, the elections, inflation, or worrying if they'll be next to end up on the streets.&lt;br /&gt;&lt;br /&gt;But what if you were given a bet to live on the streets for a month without the luxuries you once had from a home, the entertainment sets, a bathroom, pictures on the wall, a computer, and everything you once treasure to see what it's like to be homeless? That is Goddard Bolt's lesson.&lt;br /&gt;&lt;br /&gt;Mel Brooks (who directs) who stars as Bolt plays a rich man who has everything in the world until deciding to make a bet with a sissy rival (Jeffery Tambor) to see if he can live in the streets for thirty days without the luxuries; if Bolt succeeds, he can do what he wants with a future project of making more buildings. The bet's on where Bolt is thrown on the street with a bracelet on his leg to monitor his every move where he can't step off the sidewalk. He's given the nickname Pepto by a vagrant after it's written on his forehead where Bolt meets other characters including a woman by the name of Molly (Lesley Ann Warren) an ex-dancer who got divorce before losing her home, and her pals Sailor (Howard Morris) and Fumes (Teddy Wilson) who are already used to the streets. They're survivors. Bolt isn't. He's not used to reaching mutual agreements like he once did when being rich where it's fight or flight, kill or be killed.&lt;br /&gt;&lt;br /&gt;While the love connection between Molly and Bolt wasn't necessary to plot, I found "Life Stinks" to be one of Mel Brooks' observant films where prior to being a comedy, it shows a tender side compared to his slapstick work such as Blazing Saddles, Young Frankenstein, or Spaceballs for the matter, to show what it's like having something valuable before losing it the next day or on the other hand making a stupid bet like all rich people do when they don't know what to do with their money. Maybe they should give it to the homeless instead of using it like Monopoly money.&lt;br /&gt;&lt;br /&gt;Or maybe this film will inspire you to help others.</td>
</tr>
<tr class="odd">
<td style="text-align: right;">Brilliant over-acting by Lesley Ann Warren. Best dramatic hobo lady I have ever seen, and love scenes in clothes warehouse are second to none. The corn on face is a classic, as good as anything in Blazing Saddles. The take on lawyers is also superb. After being accused of being a turncoat, selling out his boss, and being dishonest the lawyer of Pepto Bolt shrugs indifferently "I'm a lawyer" he says. Three funny words. Jeffrey Tambor, a favorite from the later Larry Sanders show, is fantastic here too as a mad millionaire who wants to crush the ghetto. His character is more malevolent than usual. The hospital scene, and the scene where the homeless invade a demolition site, are all-time classics. Look for the legs scene and the two big diggers fighting (one bleeds). This movie gets better each time I see it (which is quite often).</td>
</tr>
<tr class="even">
<td style="text-align: right;">This is easily the most underrated film inn the Brooks cannon. Sure, its flawed. It does not give a realistic view of homelessness (unlike, say, how Citizen Kane gave a realistic view of lounge singers, or Titanic gave a realistic view of Italians YOU IDIOTS). Many of the jokes fall flat. But still, this film is very lovable in a way many comedies are not, and to pull that off in a story about some of the most traditionally reviled members of society is truly impressive. Its not The Fisher King, but its not crap, either. My only complaint is that Brooks should have cast someone else in the lead (I love Mel as a Director and Writer, not so much as a lead).</td>
</tr>
<tr class="odd">
<td style="text-align: right;">This is not the typical Mel Brooks film. It was much less slapstick than most of his movies and actually had a plot that was followable. Leslie Ann Warren made the movie, she is such a fantastic, under-rated actress. There were some moments that could have been fleshed out a bit more, and some scenes that could probably have been cut to make the room to do so, but all in all, this is worth the price to rent and see it. The acting was good overall, Brooks himself did a good job without his characteristic speaking to directly to the audience. Again, Warren was the best actor in the movie, but "Fume" and "Sailor" both played their parts well.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<hr>
<p>You need to spend a LOT of time reviewing the text before you begin to process it.</p>
<p>I have NOT done this yet!</p>
<p>My models will be sub-optimal!</p>
<hr>
</section>
<section id="tokens" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="tokens"><span class="header-section-number">12.4</span> Tokens</h2>
<p>Machine learning algorithms cannot work with raw text (documents) directly</p>
<p>We must feature engineer these documents to allow them to serve as input to statistical algorithms</p>
<p>The first step for most NLP feature engineering methods is to represent text (documents) as tokens (words, ngrams)</p>
<p>Given that <strong>tokenization</strong> is often one of our first steps for extracting features from text, it is important to consider carefully what happens during this step and its implications for your subsequent modeling</p>
<hr>
<p>In tokenization, we take input documents (text strings) and a token type (a meaningful unit of text, such as a word) and split the document into pieces (tokens) that correspond to the type</p>
<p>We can tokenize text into a variety of token types:</p>
<ul>
<li>characters</li>
<li>words (most common - our focus; unigrams)</li>
<li>sentences</li>
<li>lines</li>
<li>paragraphs</li>
<li>n-grams (bigrams, trigrams)</li>
</ul>
<hr>
<p>An n-gram consists of a sequence of n items from a given sequence of text. Most often, it is a group of n words (bigrams, trigrams)</p>
<p>n-grams retain word order which would otherwise be lost if we were just using words as the token type</p>
<p>“I am not happy”</p>
<p>Tokenized by word, yields:</p>
<ul>
<li>I</li>
<li>am</li>
<li>not</li>
<li>happy</li>
</ul>
<p>Tokenized by 2-gram words:</p>
<ul>
<li>I am</li>
<li>am not</li>
<li>not happy</li>
</ul>
<hr>
<p>We will be using tokenizer functions from the <code>tokenizers</code> package. Three in particular are:</p>
<ul>
<li><code>tokenize_words(x, lowercase = TRUE, stopwords = NULL, strip_punct = TRUE, strip_numeric = FALSE, simplify = FALSE)</code></li>
<li><code>tokenize_ngrams(x, lowercase = TRUE, n = 3L, n_min = n, stopwords = character(), ngram_delim = " ", simplify = FALSE)</code></li>
<li><code>tokenize_regex(x, pattern = "\\s+", simplify = FALSE)</code></li>
</ul>
<hr>
<p>However, we will be accessing these functions through wrappers:</p>
<ul>
<li><code>tidytext::unnest_tokens(tbl, output, input, token = "words", format = c("text", "man", "latex", "html", "xml"), to_lower = TRUE, drop = TRUE, collapse = NULL)</code> for tidyverse data exploration of tokens within tibbles</li>
<li><code>textrecipes::step_tokenize()</code> for tokenization in our recipes</li>
</ul>
<hr>
<p>Word-level tokenization by <code>tokenize_words()</code> is done by finding word boundaries as follows:</p>
<ul>
<li>Break at the start and end of text, unless the text is empty</li>
<li>Do not break within CRLF (new line characters)</li>
<li>Otherwise, break before and after new lines (including CR and LF)</li>
<li>Do not break between most letters</li>
<li>Do not break letters across certain punctuation</li>
<li>Do not break within sequences of digits, or digits adjacent to letters (“3a,” or “A3”)</li>
<li>Do not break within sequences, such as “3.2” or “3,456.789.”</li>
<li>Do not break between Katakana</li>
<li>Do not break from extenders</li>
<li>Do not break within emoji zwj sequences</li>
<li>Do not break within emoji flag sequences</li>
<li>Ignore Format and Extend characters, except after sot, CR, LF, and new line</li>
<li>Keep horizontal whitespace together</li>
<li>Otherwise, break everywhere (including around ideographs, e.g., @, %, &gt;)</li>
</ul>
<hr>
<p>Let’s start with using <code>tokenize_words()</code> to get a sense of how it works by default</p>
<ul>
<li>Splits on spaces</li>
<li>Converts to lowercase by default (does it matter? MAYBE!!!)</li>
<li>Retains apostrophes but drops other punctuation (<code>,</code>, <code>.</code>, <code>!</code>) and some symbols (e.g., <code>-</code> <code>\\</code>, <code>@</code>) by default. Does not drop <code>_</code> (Do you need punctuation? !!!!)</li>
<li>Retains numbers (by default) and decimals but drops <code>+</code> appended to <code>4+</code></li>
<li>Has trouble with URLs and email address (do you need this?)</li>
<li>Often, these issues may NOT matter</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Here is a sample document to tokenize.  How EXCITING (I _love_ it).  Sarah has spent 4 or 4.1 or 4P or 4+ or &gt;4 years developing her pre-processing and NLP skills.  You can learn more about tokenization here: https://smltar.com/tokenization.html or by emailing me at jjcurtin@wisc.edu"</span> <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  tokenizers<span class="sc">::</span><span class="fu">tokenize_words</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "here"              "is"                "a"                
 [4] "sample"            "document"          "to"               
 [7] "tokenize"          "how"               "exciting"         
[10] "i"                 "_love_"            "it"               
[13] "sarah"             "has"               "spent"            
[16] "4"                 "or"                "4.1"              
[19] "or"                "4p"                "or"               
[22] "4"                 "or"                "4"                
[25] "years"             "developing"        "her"              
[28] "pre"               "processing"        "and"              
[31] "nlp"               "skills"            "you"              
[34] "can"               "learn"             "more"             
[37] "about"             "tokenization"      "here"             
[40] "https"             "smltar.com"        "tokenization.html"
[43] "or"                "by"                "emailing"         
[46] "me"                "at"                "jjcurtin"         
[49] "wisc.edu"         </code></pre>
</div>
</div>
<hr>
<p>Some of these behaviors can be altered from their defaults</p>
<ul>
<li><code>lowercase = TRUE</code></li>
<li><code>strip_punc = TRUE</code></li>
<li><code>strip_numeric = FALSE</code></li>
</ul>
<hr>
<p>Some of these issues can be corrected by pre-processing the text</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(<span class="st">"jjcurtin@wisc.edu"</span>, <span class="st">"@"</span>, <span class="st">"_at_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "jjcurtin_at_wisc.edu"</code></pre>
</div>
</div>
<hr>
<p>If you need finer control, you can use <code>tokenize_regex()</code> and then do further processing with <code>stringr</code> functions and regex</p>
<p>Now it may be easier to build up from here (e.g., ):</p>
<ul>
<li><code>str_to_lower(word)</code></li>
<li><code>str_replace(word, ".$", "")</code></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Here is a sample document to tokenize.  How EXCITING (I _love_ it).  Sarah has spent 4 or 4.1 or 4P or 4+ years developing her pre-processing and NLP skills.  You can learn more about tokenization here: https://smltar.com/tokenization.html or by emailing me at jjcurtin@wisc.edu"</span> <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  tokenizers<span class="sc">::</span><span class="fu">tokenize_regex</span>(<span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "Here"                                
 [2] "is"                                  
 [3] "a"                                   
 [4] "sample"                              
 [5] "document"                            
 [6] "to"                                  
 [7] "tokenize."                           
 [8] "How"                                 
 [9] "EXCITING"                            
[10] "(I"                                  
[11] "_love_"                              
[12] "it)."                                
[13] "Sarah"                               
[14] "has"                                 
[15] "spent"                               
[16] "4"                                   
[17] "or"                                  
[18] "4.1"                                 
[19] "or"                                  
[20] "4P"                                  
[21] "or"                                  
[22] "4+"                                  
[23] "years"                               
[24] "developing"                          
[25] "her"                                 
[26] "pre-processing"                      
[27] "and"                                 
[28] "NLP"                                 
[29] "skills."                             
[30] "You"                                 
[31] "can"                                 
[32] "learn"                               
[33] "more"                                
[34] "about"                               
[35] "tokenization"                        
[36] "here:"                               
[37] "https://smltar.com/tokenization.html"
[38] "or"                                  
[39] "by"                                  
[40] "emailing"                            
[41] "me"                                  
[42] "at"                                  
[43] "jjcurtin@wisc.edu"                   </code></pre>
</div>
</div>
<hr>
<p>You can explore the tokens that will be formed using <code>unnest_tokens()</code> and basic tidyverse data wrangling using a tidied format of your documents as part of your EDA</p>
<ul>
<li>We unnest to 1 token (word) per row (tidy format)</li>
<li>We keep track of <code>doc_num</code> (added earlier)</li>
</ul>
<p>Here, we tokenize the IMDB training set.</p>
<ul>
<li>Using defaults</li>
<li>Can change other default for <code>tokenize_*()</code> by passing into function via <code>...</code></li>
<li>Can set <code>drop = TRUE</code> (default) to discard the original document column (text)</li>
<li>Its pretty fast!</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, <span class="at">token =</span> <span class="st">"words"</span>, <span class="at">to_lower =</span> <span class="cn">TRUE</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,935,723
Columns: 4
$ doc_num   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ sentiment &lt;fct&gt; neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, …
$ text      &lt;chr&gt; "Story of a man who has unnatural feelings for a pig. Starts…
$ word      &lt;chr&gt; "story", "of", "a", "man", "who", "has", "unnatural", "feeli…</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Coding sidebar:</strong> You can take a much deeper dive into tidyverse text processing in <a href="https://www.tidytextmining.com/tidytext.html">chapter 1</a> of <span class="citation" data-cites="TMR">Silge and Robinson (<a href="#ref-TMR" role="doc-biblioref">2017</a>)</span>.</p>
</div>
</div>
<hr>
<p>Let’s get oriented by reviewing the tokens from the first document</p>
<ul>
<li>Raw form</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>data_trn<span class="sc">$</span>text[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Story of a man who has unnatural feelings for a pig. Starts out with a opening scene that is a terrific example of absurd comedy. A formal orchestra audience is turned into an insane, violent mob by the crazy chantings of it's singers. Unfortunately it stays absurd the WHOLE time with no general narrative eventually making it just too off putting. Even those from the era should be turned off. The cryptic dialogue would make Shakespeare seem easy to a third grader. On a technical level it's better than you might think with some good cinematography by future great Vilmos Zsigmond. Future stars Sally Kirkland and Frederic Forrest can be seen briefly."</code></pre>
</div>
</div>
<ul>
<li>Tokenized by word and tidied</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(doc_num <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(word) <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 112 × 1
    word          
    &lt;chr&gt;         
  1 story         
  2 of            
  3 a             
  4 man           
  5 who           
  6 has           
  7 unnatural     
  8 feelings      
  9 for           
 10 a             
 11 pig           
 12 starts        
 13 out           
 14 with          
 15 a             
 16 opening       
 17 scene         
 18 that          
 19 is            
 20 a             
 21 terrific      
 22 example       
 23 of            
 24 absurd        
 25 comedy        
 26 a             
 27 formal        
 28 orchestra     
 29 audience      
 30 is            
 31 turned        
 32 into          
 33 an            
 34 insane        
 35 violent       
 36 mob           
 37 by            
 38 the           
 39 crazy         
 40 chantings     
 41 of            
 42 it's          
 43 singers       
 44 unfortunately 
 45 it            
 46 stays         
 47 absurd        
 48 the           
 49 whole         
 50 time          
 51 with          
 52 no            
 53 general       
 54 narrative     
 55 eventually    
 56 making        
 57 it            
 58 just          
 59 too           
 60 off           
 61 putting       
 62 even          
 63 those         
 64 from          
 65 the           
 66 era           
 67 should        
 68 be            
 69 turned        
 70 off           
 71 the           
 72 cryptic       
 73 dialogue      
 74 would         
 75 make          
 76 shakespeare   
 77 seem          
 78 easy          
 79 to            
 80 a             
 81 third         
 82 grader        
 83 on            
 84 a             
 85 technical     
 86 level         
 87 it's          
 88 better        
 89 than          
 90 you           
 91 might         
 92 think         
 93 with          
 94 some          
 95 good          
 96 cinematography
 97 by            
 98 future        
 99 great         
100 vilmos        
101 zsigmond      
102 future        
103 stars         
104 sally         
105 kirkland      
106 and           
107 frederic      
108 forrest       
109 can           
110 be            
111 seen          
112 briefly       </code></pre>
</div>
</div>
<hr>
<p>Considering all the tokens across all documents</p>
<ul>
<li>There are almost 6 million words</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(tokens<span class="sc">$</span>word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5935723</code></pre>
</div>
</div>
<ul>
<li>The total unique <em>vocabulary</em> is around 85 thousand words</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(tokens<span class="sc">$</span>word))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 85439</code></pre>
</div>
</div>
<hr>
<p>Word frequency is VERY skewed</p>
<ul>
<li>These are the counts for the most frequent 750 words</li>
<li>there are 84,000 additional infrequent words in the right tail not shown here!</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">750</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder</span>(word, <span class="sc">-</span>n)) <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(word, n)) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Words"</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Raw Count"</span>) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_blank</span>(), <span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l12_nlp_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Now let’s review the 100 most common words</p>
<ul>
<li>We SHOULD review MUCH deeper than this</li>
<li>Some of our feature engineering approaches (e.g., BoW) will use the first 5K - 20K tokens</li>
<li>Some of our feature engineering approaches (e.g., word embeddings) may use ALL tokens</li>
<li>Some of these are likely not very informative (the, a, of, to, is). We will return to those words in a bit when we consider <strong>stopwords</strong></li>
<li>Notice <code>br</code>. Why is it so common?</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 85,439 × 2
    word         n
    &lt;chr&gt;    &lt;int&gt;
  1 the     336199
  2 and     164061
  3 a       162742
  4 of      145849
  5 to      135695
  6 is      107322
  7 br      101871
  8 in       93921
  9 it       78877
 10 i        76511
 11 this     75815
 12 that     69794
 13 was      48189
 14 as       46904
 15 for      44321
 16 with     44116
 17 movie    43510
 18 but      42531
 19 film     39058
 20 on       34185
 21 not      30608
 22 you      29887
 23 are      29434
 24 his      29352
 25 have     27725
 26 be       26947
 27 he       26895
 28 one      26502
 29 all      23929
 30 at       23500
 31 by       22538
 32 an       21550
 33 they     21097
 34 who      20604
 35 so       20573
 36 from     20489
 37 like     20269
 38 her      18399
 39 or       17997
 40 just     17764
 41 about    17368
 42 out      17099
 43 it's     17095
 44 has      16789
 45 if       16748
 46 some     15736
 47 there    15672
 48 what     15374
 49 good     15111
 50 more     14243
 51 when     14162
 52 very     14059
 53 up       13283
 54 no       12698
 55 time     12691
 56 even     12638
 57 she      12624
 58 my       12485
 59 would    12236
 60 which    12047
 61 story    11919
 62 only     11910
 63 really   11734
 64 see      11465
 65 their    11376
 66 had      11289
 67 can      11144
 68 were     10783
 69 me       10745
 70 well     10637
 71 than      9920
 72 we        9858
 73 much      9750
 74 bad       9292
 75 been      9287
 76 get       9281
 77 will      9195
 78 do        9160
 79 also      9130
 80 into      9109
 81 people    9107
 82 other     9084
 83 first     9054
 84 because   9046
 85 great     9034
 86 how       8870
 87 him       8865
 88 most      8776
 89 don't     8446
 90 made      8351
 91 its       8157
 92 then      8097
 93 make      8018
 94 way       8005
 95 them      7955
 96 too       7820
 97 could     7745
 98 any       7653
 99 movies    7648
100 after     7617
# ℹ 85,339 more rows</code></pre>
</div>
</div>
<hr>
<p>Here is the first document that has the <code>br</code> token in it.</p>
<p>It is html code for a line break.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">==</span> <span class="st">"br"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Airport '77 starts as a brand new luxury 747 plane is loaded up with valuable paintings &amp; such belonging to rich businessman Philip Stevens (James Stewart) who is flying them &amp; a bunch of VIP's to his estate in preparation of it being opened to the public as a museum, also on board is Stevens daughter Julie (Kathleen Quinlan) &amp; her son. The luxury jetliner takes off as planned but mid-air the plane is hi-jacked by the co-pilot Chambers (Robert Foxworth) &amp; his two accomplice's Banker (Monte Markham) &amp; Wilson (Michael Pataki) who knock the passengers &amp; crew out with sleeping gas, they plan to steal the valuable cargo &amp; land on a disused plane strip on an isolated island but while making his descent Chambers almost hits an oil rig in the Ocean &amp; loses control of the plane sending it crashing into the sea where it sinks to the bottom right bang in the middle of the Bermuda Triangle. With air in short supply, water leaking in &amp; having flown over 200 miles off course the problems mount for the survivor's as they await help with time fast running out...&lt;br /&gt;&lt;br /&gt;Also known under the slightly different tile Airport 1977 this second sequel to the smash-hit disaster thriller Airport (1970) was directed by Jerry Jameson &amp; while once again like it's predecessors I can't say Airport '77 is any sort of forgotten classic it is entertaining although not necessarily for the right reasons. Out of the three Airport films I have seen so far I actually liked this one the best, just. It has my favourite plot of the three with a nice mid-air hi-jacking &amp; then the crashing (didn't he see the oil rig?) &amp; sinking of the 747 (maybe the makers were trying to cross the original Airport with another popular disaster flick of the period The Poseidon Adventure (1972)) &amp; submerged is where it stays until the end with a stark dilemma facing those trapped inside, either suffocate when the air runs out or drown as the 747 floods or if any of the doors are opened &amp; it's a decent idea that could have made for a great little disaster flick but bad unsympathetic character's, dull dialogue, lethargic set-pieces &amp; a real lack of danger or suspense or tension means this is a missed opportunity. While the rather sluggish plot keeps one entertained for 108 odd minutes not that much happens after the plane sinks &amp; there's not as much urgency as I thought there should have been. Even when the Navy become involved things don't pick up that much with a few shots of huge ships &amp; helicopters flying about but there's just something lacking here. George Kennedy as the jinxed airline worker Joe Patroni is back but only gets a couple of scenes &amp; barely even says anything preferring to just look worried in the background.&lt;br /&gt;&lt;br /&gt;The home video &amp; theatrical version of Airport '77 run 108 minutes while the US TV versions add an extra hour of footage including a new opening credits sequence, many more scenes with George Kennedy as Patroni, flashbacks to flesh out character's, longer rescue scenes &amp; the discovery or another couple of dead bodies including the navigator. While I would like to see this extra footage I am not sure I could sit through a near three hour cut of Airport '77. As expected the film has dated badly with horrible fashions &amp; interior design choices, I will say no more other than the toy plane model effects aren't great either. Along with the other two Airport sequels this takes pride of place in the Razzie Award's Hall of Shame although I can think of lots of worse films than this so I reckon that's a little harsh. The action scenes are a little dull unfortunately, the pace is slow &amp; not much excitement or tension is generated which is a shame as I reckon this could have been a pretty good film if made properly.&lt;br /&gt;&lt;br /&gt;The production values are alright if nothing spectacular. The acting isn't great, two time Oscar winner Jack Lemmon has said since it was a mistake to star in this, one time Oscar winner James Stewart looks old &amp; frail, also one time Oscar winner Lee Grant looks drunk while Sir Christopher Lee is given little to do &amp; there are plenty of other familiar faces to look out for too.&lt;br /&gt;&lt;br /&gt;Airport '77 is the most disaster orientated of the three Airport films so far &amp; I liked the ideas behind it even if they were a bit silly, the production &amp; bland direction doesn't help though &amp; a film about a sunken plane just shouldn't be this boring or lethargic. Followed by The Concorde ... Airport '79 (1979)."</code></pre>
</div>
</div>
<hr>
<p>Let’s clean it in the raw documents and re-tokenize</p>
<p>You should always check your replacements CAREFULLY before doing them for unexpected matches and side-effects</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"&lt;br /&gt;&lt;br /&gt;"</span>, <span class="st">" "</span>))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, <span class="at">drop =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We should continue to review MUCH deeper into the common tokens to detect other tokenization errors. I will not demonstrate that here.</p>
<hr>
<p>We should also review the least common tokens</p>
<ul>
<li>Worth searching to make sure they haven’t resulted from tokenization errors</li>
<li>Can use this to tune our pre-processing and tokenization</li>
<li>BUT, not as important b/c these will be dropped by some of our feature engineering approaches (BoW) and may not present too much problem to others (embeddings)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">|&gt;</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 85,439 × 2
    word                            n
    &lt;chr&gt;                       &lt;int&gt;
  1 0.10                            1
  2 0.48                            1
  3 0.7                             1
  4 0.79                            1
  5 0.89                            1
  6 00.01                           1
  7 000                             1
  8 0000000000001                   1
  9 00015                           1
 10 003830                          1
 11 006                             1
 12 0079                            1
 13 0093638                         1
 14 01pm                            1
 15 020410                          1
 16 029                             1
 17 041                             1
 18 050                             1
 19 06th                            1
 20 087                             1
 21 089                             1
 22 08th                            1
 23 0f                              1
 24 0ne                             1
 25 0r                              1
 26 0s                              1
 27 1'40                            1
 28 1,000,000,000,000               1
 29 1,000.00                        1
 30 1,000s                          1
 31 1,2,3                           1
 32 1,2,3,4,5                       1
 33 1,2,3,5                         1
 34 1,300                           1
 35 1,400                           1
 36 1,430                           1
 37 1,500,000                       1
 38 1,600                           1
 39 1,65m                           1
 40 1,700                           1
 41 1,999,999                       1
 42 1.000                           1
 43 1.19                            1
 44 1.30                            1
 45 1.30am                          1
 46 1.3516                          1
 47 1.37                            1
 48 1.47                            1
 49 1.49                            1
 50 1.4x                            1
 51 1.60                            1
 52 1.66                            1
 53 1.78                            1
 54 1.9                             1
 55 1.95                            1
 56 10,000,000                      1
 57 10.000                          1
 58 10.75                           1
 59 10.95                           1
 60 100.00                          1
 61 1000000                         1
 62 1000lb                          1
 63 100b                            1
 64 100k                            1
 65 100m                            1
 66 100mph                          1
 67 100yards                        1
 68 102nd                           1
 69 1040                            1
 70 1040a                           1
 71 1040s                           1
 72 1050                            1
 73 105lbs                          1
 74 106min                          1
 75 10am                            1
 76 10lines                         1
 77 10mil                           1
 78 10min                           1
 79 10minutes                       1
 80 10p.m                           1
 81 10star                          1
 82 10x's                           1
 83 10yr                            1
 84 11,2001                         1
 85 11.00                           1
 86 11001001                        1
 87 1100ad                          1
 88 1146                            1
 89 11f                             1
 90 11m                             1
 91 12.000.000                      1
 92 120,000.00                      1
 93 1200f                           1
 94 1201                            1
 95 1202                            1
 96 123,000,000                     1
 97 12383499143743701               1
 98 125,000                         1
 99 125m                            1
100 127                             1
101 12hr                            1
102 12mm                            1
103 12s                             1
104 13,15,16                        1
105 13.00                           1
106 1300                            1
107 1318                            1
108 135m                            1
109 137                             1
110 139                             1
111 13k                             1
112 14.00                           1
113 14.99                           1
114 140hp                           1
115 1415                            1
116 142                             1
117 1454                            1
118 1473                            1
119 1492                            1
120 14ieme                          1
121 14yr                            1
122 15,000,000                      1
123 15.00                           1
124 150,000                         1
125 1500.00                         1
126 150_worst_cases_of_nepotism     1
127 150k                            1
128 150m                            1
129 151                             1
130 152                             1
131 153                             1
132 1547                            1
133 155                             1
134 156                             1
135 1561                            1
136 1594                            1
137 15mins                          1
138 15minutes                       1
139 16,000                          1
140 16.9                            1
141 16.97                           1
142 1600s                           1
143 160lbs                          1
144 1610                            1
145 163,000                         1
146 164                             1
147 165                             1
148 166                             1
149 1660s                           1
150 16ieme                          1
151 16k                             1
152 16x9                            1
153 16éme                           1
154 17,000                          1
155 17,2003                         1
156 17.75                           1
157 1700s                           1
158 1701                            1
159 171                             1
160 175                             1
161 177                             1
162 1775                            1
163 1790s                           1
164 1794                            1
165 17million                       1
166 18,000,000                      1
167 1800mph                         1
168 1801                            1
169 1805                            1
170 1809                            1
171 180d                            1
172 1812                            1
173 18137                           1
174 1814                            1
175 1832                            1
176 1838                            1
177 1844                            1
178 1850ies                         1
179 1852                            1
180 1860s                           1
181 1870                            1
182 1871                            1
183 1874                            1
184 1875                            1
185 188                             1
186 1887                            1
187 1889                            1
188 188o                            1
189 1893                            1
190 18year                          1
191 19,000,000                      1
192 190                             1
193 1904                            1
194 1908                            1
195 192                             1
196 1920ies                         1
197 1923                            1
198 1930ies                         1
199 193o's                          1
200 194                             1
# ℹ 85,239 more rows</code></pre>
</div>
</div>
<hr>
<p>What is the deal with <code>_*_</code>?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">==</span> <span class="st">"_anything_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "I am shocked. Shocked and dismayed that the 428 of you IMDB users who voted before me have not given this film a rating of higher than 7. 7?!?? - that's a C!. If I could give FOBH a 20, I'd gladly do it. This film ranks high atop the pantheon of modern comedy, alongside Half Baked and Mallrats, as one of the most hilarious films of all time. If you know _anything_ about rap music - YOU MUST SEE THIS!! If you know nothing about rap music - learn something!, and then see this! Comparisons to 'Spinal Tap' fail to appreciate the inspired genius of this unique film. If you liked Bob Roberts, you'll love this. Watch it and vote it a 10!"</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">==</span> <span class="st">"_love_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Before I start, I _love_ Eddie Izzard. I think he's one of the funniest stand-ups around today. Possibly that means I'm going into this with too high expectations, but I just didn't find Eddie funny in this outing. I think the main problem is Eddie is trying too hard to be Eddie. Everyone knows him as a completely irrelevant comic, and we all love him for it. But in Circle, he appears to be going more for irrelevant than funny, and completely lost me in places. Many of the topics he covers he has covered before - I even think I recognised a few recycled jokes in there. If you buy the DVD you'll find a behind-the-scenes look at Eddie's tour (interesting in places, but not very funny), and a French language version of one of his shows. Die-hards will enjoy seeing Eddie in a different language, but subtitled comedy isn't very funny. If you're a fan of Eddie you've either got this already or you're going to buy it whatever I say. If you're just passing through, buy Glorious or Dressed to Kill - you won't be disappointed. With Circle, you probably will."</code></pre>
</div>
</div>
<hr>
<p>Let’s find all the tokens that start or end with <code>_</code></p>
<p>A few of these are even repeatedly used</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(word, <span class="st">"^_"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(word, <span class="st">"_$"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 130 × 2
    word                                                                   n
    &lt;chr&gt;                                                              &lt;int&gt;
  1 _the                                                                   6
  2 _a                                                                     5
  3 thing_                                                                 4
  4 ____                                                                   3
  5 _atlantis_                                                             3
  6 _is_                                                                   3
  7 ______                                                                 2
  8 _____________________________________                                  2
  9 _bounce_                                                               2
 10 _night                                                                 2
 11 _not_                                                                  2
 12 _plan                                                                  2
 13 _real_                                                                 2
 14 _waterdance_                                                           2
 15 story_                                                                 2
 16 9_                                                                     1
 17 _____                                                                  1
 18 _________                                                              1
 19 ____________________________________                                   1
 20 __________________________________________________________________     1
 21 _absolute                                                              1
 22 _am_                                                                   1
 23 _and_                                                                  1
 24 _angel_                                                                1
 25 _annie_                                                                1
 26 _any_                                                                  1
 27 _anything_                                                             1
 28 _apocalyptically                                                       1
 29 _as                                                                    1
 30 _atlantis                                                              1
 31 _attack                                                                1
 32 _before_                                                               1
 33 _blair                                                                 1
 34 _both_                                                                 1
 35 _by                                                                    1
 36 _can't_                                                                1
 37 _cannon_                                                               1
 38 _certainly_                                                            1
 39 _could                                                                 1
 40 _cruel                                                                 1
 41 _dirty                                                                 1
 42 _discuss_                                                              1
 43 _discussing_                                                           1
 44 _do_                                                                   1
 45 _dr                                                                    1
 46 _dying                                                                 1
 47 _earned_                                                               1
 48 _everything_                                                           1
 49 _ex_executives                                                         1
 50 _extremeley_                                                           1
 51 _extremely_                                                            1
 52 _film_                                                                 1
 53 _get_                                                                  1
 54 _have_                                                                 1
 55 _i_                                                                    1
 56 _innerly                                                               1
 57 _inside_                                                               1
 58 _inspire_                                                              1
 59 _les                                                                   1
 60 _love_                                                                 1
 61 _magic_                                                                1
 62 _much_                                                                 1
 63 _mystery                                                               1
 64 _napolean                                                              1
 65 _new                                                                   1
 66 _obviously_                                                            1
 67 _other_                                                                1
 68 _penetrate_                                                            1
 69 _possible_                                                             1
 70 _really_is_                                                            1
 71 _shall                                                                 1
 72 _shock                                                                 1
 73 _so_                                                                   1
 74 _so_much_                                                              1
 75 _somewhere_                                                            1
 76 _spiritited                                                            1
 77 _starstruck_                                                           1
 78 _strictly                                                              1
 79 _sung_                                                                 1
 80 _the_                                                                  1
 81 _the_lost_empire_                                                      1
 82 _there's_                                                              1
 83 _they_                                                                 1
 84 _think_                                                                1
 85 _told_                                                                 1
 86 _toy                                                                   1
 87 _tried                                                                 1
 88 _twice                                                                 1
 89 _undertow_                                                             1
 90 _very_                                                                 1
 91 _voice_                                                                1
 92 _want_                                                                 1
 93 _we've                                                                 1
 94 _well_                                                                 1
 95 _whale_                                                                1
 96 _wrong_                                                                1
 97 _x                                                                     1
 98 acteurs_                                                               1
 99 apple_                                                                 1
100 away_                                                                  1
101 ballroom_                                                              1
102 been_                                                                  1
103 beginners_                                                             1
104 brail_                                                                 1
105 casablanca_                                                            1
106 composer_                                                              1
107 dancing_                                                               1
108 dougray_scott_                                                         1
109 dozen_                                                                 1
110 dynamite_                                                              1
111 eaters_                                                                1
112 eyre_                                                                  1
113 f___                                                                   1
114 film_                                                                  1
115 hard_                                                                  1
116 men_                                                                   1
117 night_                                                                 1
118 opera_                                                                 1
119 rehearsals_                                                            1
120 shrews_                                                                1
121 space_                                                                 1
122 starts__                                                               1
123 that_                                                                  1
124 treatment_                                                             1
125 watchmen_                                                              1
126 what_the_bleep_                                                        1
127 witch_                                                                 1
128 words_                                                                 1
129 you_                                                                   1
130 zhivago_                                                               1</code></pre>
</div>
</div>
<hr>
<p>Now we can clean the raw documents again. This works but there is probably a better regex using <code>^_</code> and <code>_$</code></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">" _"</span>, <span class="st">" "</span>),</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">" _"</span>, <span class="st">" "</span>),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"^_"</span>, <span class="st">""</span>),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"_</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"</span><span class="sc">\\</span><span class="st">(_"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">("</span>),</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">":_"</span>, <span class="st">": "</span>),</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"_{3,}"</span>, <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Let’s take another look and uncommon tokens</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">|&gt;</span> </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 85,400 × 2
    word                            n
    &lt;chr&gt;                       &lt;int&gt;
  1 0.10                            1
  2 0.48                            1
  3 0.7                             1
  4 0.79                            1
  5 0.89                            1
  6 00.01                           1
  7 000                             1
  8 0000000000001                   1
  9 00015                           1
 10 003830                          1
 11 006                             1
 12 0079                            1
 13 0093638                         1
 14 01pm                            1
 15 020410                          1
 16 029                             1
 17 041                             1
 18 050                             1
 19 06th                            1
 20 087                             1
 21 089                             1
 22 08th                            1
 23 0f                              1
 24 0ne                             1
 25 0r                              1
 26 0s                              1
 27 1'40                            1
 28 1,000,000,000,000               1
 29 1,000.00                        1
 30 1,000s                          1
 31 1,2,3                           1
 32 1,2,3,4,5                       1
 33 1,2,3,5                         1
 34 1,300                           1
 35 1,400                           1
 36 1,430                           1
 37 1,500,000                       1
 38 1,600                           1
 39 1,65m                           1
 40 1,700                           1
 41 1,999,999                       1
 42 1.000                           1
 43 1.19                            1
 44 1.30                            1
 45 1.30am                          1
 46 1.3516                          1
 47 1.37                            1
 48 1.47                            1
 49 1.49                            1
 50 1.4x                            1
 51 1.60                            1
 52 1.66                            1
 53 1.78                            1
 54 1.9                             1
 55 1.95                            1
 56 10,000,000                      1
 57 10.000                          1
 58 10.75                           1
 59 10.95                           1
 60 100.00                          1
 61 1000000                         1
 62 1000lb                          1
 63 100b                            1
 64 100k                            1
 65 100m                            1
 66 100mph                          1
 67 100yards                        1
 68 102nd                           1
 69 1040                            1
 70 1040a                           1
 71 1040s                           1
 72 1050                            1
 73 105lbs                          1
 74 106min                          1
 75 10am                            1
 76 10lines                         1
 77 10mil                           1
 78 10min                           1
 79 10minutes                       1
 80 10p.m                           1
 81 10star                          1
 82 10x's                           1
 83 10yr                            1
 84 11,2001                         1
 85 11.00                           1
 86 11001001                        1
 87 1100ad                          1
 88 1146                            1
 89 11f                             1
 90 11m                             1
 91 12.000.000                      1
 92 120,000.00                      1
 93 1200f                           1
 94 1201                            1
 95 1202                            1
 96 123,000,000                     1
 97 12383499143743701               1
 98 125,000                         1
 99 125m                            1
100 127                             1
101 12hr                            1
102 12mm                            1
103 12s                             1
104 13,15,16                        1
105 13.00                           1
106 1300                            1
107 1318                            1
108 135m                            1
109 137                             1
110 139                             1
111 13k                             1
112 14.00                           1
113 14.99                           1
114 140hp                           1
115 1415                            1
116 142                             1
117 1454                            1
118 1473                            1
119 1492                            1
120 14ieme                          1
121 14yr                            1
122 15,000,000                      1
123 15.00                           1
124 150,000                         1
125 1500.00                         1
126 150_worst_cases_of_nepotism     1
127 150k                            1
128 150m                            1
129 151                             1
130 152                             1
131 153                             1
132 1547                            1
133 155                             1
134 156                             1
135 1561                            1
136 1594                            1
137 15mins                          1
138 15minutes                       1
139 16,000                          1
140 16.9                            1
141 16.97                           1
142 1600s                           1
143 160lbs                          1
144 1610                            1
145 163,000                         1
146 164                             1
147 165                             1
148 166                             1
149 1660s                           1
150 16ieme                          1
151 16k                             1
152 16x9                            1
153 16éme                           1
154 17,000                          1
155 17,2003                         1
156 17.75                           1
157 1700s                           1
158 1701                            1
159 171                             1
160 175                             1
161 177                             1
162 1775                            1
163 1790s                           1
164 1794                            1
165 17million                       1
166 18,000,000                      1
167 1800mph                         1
168 1801                            1
169 1805                            1
170 1809                            1
171 180d                            1
172 1812                            1
173 18137                           1
174 1814                            1
175 1832                            1
176 1838                            1
177 1844                            1
178 1850ies                         1
179 1852                            1
180 1860s                           1
181 1870                            1
182 1871                            1
183 1874                            1
184 1875                            1
185 188                             1
186 1887                            1
187 1889                            1
188 188o                            1
189 1893                            1
190 18year                          1
191 19,000,000                      1
192 190                             1
193 1904                            1
194 1908                            1
195 192                             1
196 1920ies                         1
197 1923                            1
198 1930ies                         1
199 193o's                          1
200 194                             1
# ℹ 85,200 more rows</code></pre>
</div>
</div>
<p>Lots of numbers. <strong>Probably?</strong> not that important for our classification problem.</p>
<p>Let’s strip them for demonstration purposes at least using <code>strip_numeric = TRUE</code></p>
<p>This is likey good for unigrams but wouldn’t be good/possible for bigrams (break sequence)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">strip_numeric =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">|&gt;</span> </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 84,258 × 2
    word                            n
    &lt;chr&gt;                       &lt;int&gt;
  1 01pm                            1
  2 06th                            1
  3 08th                            1
  4 0f                              1
  5 0ne                             1
  6 0r                              1
  7 0s                              1
  8 1,000s                          1
  9 1,65m                           1
 10 1.30am                          1
 11 1.4x                            1
 12 1000lb                          1
 13 100b                            1
 14 100k                            1
 15 100m                            1
 16 100mph                          1
 17 100yards                        1
 18 102nd                           1
 19 1040a                           1
 20 1040s                           1
 21 105lbs                          1
 22 106min                          1
 23 10am                            1
 24 10lines                         1
 25 10mil                           1
 26 10min                           1
 27 10minutes                       1
 28 10p.m                           1
 29 10star                          1
 30 10x's                           1
 31 10yr                            1
 32 1100ad                          1
 33 11f                             1
 34 11m                             1
 35 1200f                           1
 36 125m                            1
 37 12hr                            1
 38 12mm                            1
 39 12s                             1
 40 135m                            1
 41 13k                             1
 42 140hp                           1
 43 14ieme                          1
 44 14yr                            1
 45 150_worst_cases_of_nepotism     1
 46 150k                            1
 47 150m                            1
 48 15mins                          1
 49 15minutes                       1
 50 1600s                           1
 51 160lbs                          1
 52 1660s                           1
 53 16ieme                          1
 54 16k                             1
 55 16éme                           1
 56 1700s                           1
 57 1790s                           1
 58 17million                       1
 59 1800mph                         1
 60 180d                            1
 61 1850ies                         1
 62 1860s                           1
 63 188o                            1
 64 18year                          1
 65 1920ies                         1
 66 1930ies                         1
 67 193o's                          1
 68 1949er                          1
 69 1961s                           1
 70 1970ies                         1
 71 1970s.i                         1
 72 197o                            1
 73 1980ies                         1
 74 1982s                           1
 75 1983s                           1
 76 19k                             1
 77 19thc                           1
 78 1and                            1
 79 1h40m                           1
 80 1million                        1
 81 1min                            1
 82 1mln                            1
 83 1o                              1
 84 1ton                            1
 85 1tv.ru                          1
 86 1ç                              1
 87 2.00am                          1
 88 2.5hrs                          1
 89 2000ad                          1
 90 2004s                           1
 91 200ft                           1
 92 200th                           1
 93 20c                             1
 94 20ft                            1
 95 20k                             1
 96 20m                             1
 97 20mins                          1
 98 20minutes                       1
 99 20mn                            1
100 20p                             1
101 20perr                          1
102 20s.what                        1
103 20ties                          1
104 20widow                         1
105 20x                             1
106 20year                          1
107 20yrs                           1
108 225mins                         1
109 22d                             1
110 230lbs                          1
111 230mph                          1
112 23d                             1
113 24m30s                          1
114 24years                         1
115 25million                       1
116 25mins                          1
117 25s                             1
118 25yrs                           1
119 261k                            1
120 2fast                           1
121 2furious                        1
122 2h                              1
123 2hour                           1
124 2hr                             1
125 2in                             1
126 2inch                           1
127 2more                           1
128 300ad                           1
129 300c                            1
130 300lbs                          1
131 300mln                          1
132 30am                            1
133 30ish                           1
134 30k                             1
135 30lbs                           1
136 30s.like                        1
137 30something                     1
138 30ties                          1
139 32lb                            1
140 32nd                            1
141 330am                           1
142 330mins                         1
143 336th                           1
144 33m                             1
145 35c                             1
146 35mins                          1
147 35pm                            1
148 39th                            1
149 3bs                             1
150 3dvd                            1
151 3lbs                            1
152 3m                              1
153 3mins                           1
154 3pm                             1
155 3po's                           1
156 3th                             1
157 3who                            1
158 4.5hrs                          1
159 401k                            1
160 40am                            1
161 40min                           1
162 40mph                           1
163 442nd                           1
164 44c                             1
165 44yrs                           1
166 45am                            1
167 45min                           1
168 45s                             1
169 480m                            1
170 480p                            1
171 4cylinder                       1
172 4d                              1
173 4eva                            1
174 4f                              1
175 4h                              1
176 4hrs                            1
177 4o                              1
178 4pm                             1
179 4w                              1
180 4ward                           1
181 4x                              1
182 5.50usd                         1
183 500db                           1
184 500lbs                          1
185 50c                             1
186 50ft                            1
187 50ies                           1
188 50ish                           1
189 50k                             1
190 50mins                          1
191 51b                             1
192 51st                            1
193 52s                             1
194 53m                             1
195 540i                            1
196 54th                            1
197 57d                             1
198 58th                            1
199 5kph                            1
200 5min                            1
# ℹ 84,058 more rows</code></pre>
</div>
</div>
<hr>
<p>The tokenizer didn’t get rid of numbers connected to text</p>
<ul>
<li>How do we want to handle these?</li>
<li>Could add a space to make them two words?</li>
<li>We will leave them as is</li>
</ul>
<hr>
<p>Other issues?</p>
<ul>
<li>Mis-spellings</li>
<li>Repeated letters for emphasize or effect?</li>
<li>Did caps matter (default tokenization was to convert to lowercase)?</li>
<li>Domain knowledge is useful here though multiple model configurations can be considered</li>
<li>strings of words that aren’t meaningful (“Welcome to Facebook”)</li>
</ul>
<hr>
<p>In the above workflow, we:</p>
<ol type="1">
<li>tokenize</li>
<li>review tokens for issues</li>
<li>clean raw text documents</li>
<li>re-tokenize</li>
</ol>
<p>In some instances, it may be easier to clean the token and then put them back together</p>
<ol type="1">
<li>tokenize</li>
<li>review tokens for issues</li>
<li>clean tokens</li>
<li>recreate document</li>
<li>tokenize</li>
</ol>
<hr>
<p>If this latter workflow feels easier (i.e., easier to regex into a token than a document), we will need code to put the tokens back together into a document</p>
<p>Here is an example using the first three documents (`slice(1:3)1) and no cleaning</p>
<ol type="1">
<li>Tokenize</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  data_trn <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">strip_numeric =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Now we can do further cleaning with tokens</li>
</ol>
<p><code>INSERT CLEANING CHUNKS HERE</code></p>
<ol start="3" type="1">
<li>Then put back together. Could also collapse into <code>text_cln</code> to retain original text column</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>data_trn_cln <span class="ot">&lt;-</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  tokens <span class="sc">|&gt;</span>  </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_num, sentiment) <span class="sc">|&gt;</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">text =</span> <span class="fu">str_c</span>(word, <span class="at">collapse =</span> <span class="st">" "</span>),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Lets see what we have</p>
<ul>
<li>Now all lower case</li>
<li>No numbers, punctuation, etc.</li>
<li>and any other cleaning we <strong>could</strong> have done with the tokens along the way….</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>data_trn_cln <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(text) <span class="sc">|&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_kbl</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">story of a man who has unnatural feelings for a pig starts out with a opening scene that is a terrific example of absurd comedy a formal orchestra audience is turned into an insane violent mob by the crazy chantings of it's singers unfortunately it stays absurd the whole time with no general narrative eventually making it just too off putting even those from the era should be turned off the cryptic dialogue would make shakespeare seem easy to a third grader on a technical level it's better than you might think with some good cinematography by future great vilmos zsigmond future stars sally kirkland and frederic forrest can be seen briefly</td>
</tr>
<tr class="even">
<td style="text-align: right;">airport starts as a brand new luxury plane is loaded up with valuable paintings such belonging to rich businessman philip stevens james stewart who is flying them a bunch of vip's to his estate in preparation of it being opened to the public as a museum also on board is stevens daughter julie kathleen quinlan her son the luxury jetliner takes off as planned but mid air the plane is hi jacked by the co pilot chambers robert foxworth his two accomplice's banker monte markham wilson michael pataki who knock the passengers crew out with sleeping gas they plan to steal the valuable cargo land on a disused plane strip on an isolated island but while making his descent chambers almost hits an oil rig in the ocean loses control of the plane sending it crashing into the sea where it sinks to the bottom right bang in the middle of the bermuda triangle with air in short supply water leaking in having flown over miles off course the problems mount for the survivor's as they await help with time fast running out also known under the slightly different tile airport this second sequel to the smash hit disaster thriller airport was directed by jerry jameson while once again like it's predecessors i can't say airport is any sort of forgotten classic it is entertaining although not necessarily for the right reasons out of the three airport films i have seen so far i actually liked this one the best just it has my favourite plot of the three with a nice mid air hi jacking then the crashing didn't he see the oil rig sinking of the maybe the makers were trying to cross the original airport with another popular disaster flick of the period the poseidon adventure submerged is where it stays until the end with a stark dilemma facing those trapped inside either suffocate when the air runs out or drown as the floods or if any of the doors are opened it's a decent idea that could have made for a great little disaster flick but bad unsympathetic character's dull dialogue lethargic set pieces a real lack of danger or suspense or tension means this is a missed opportunity while the rather sluggish plot keeps one entertained for odd minutes not that much happens after the plane sinks there's not as much urgency as i thought there should have been even when the navy become involved things don't pick up that much with a few shots of huge ships helicopters flying about but there's just something lacking here george kennedy as the jinxed airline worker joe patroni is back but only gets a couple of scenes barely even says anything preferring to just look worried in the background the home video theatrical version of airport run minutes while the us tv versions add an extra hour of footage including a new opening credits sequence many more scenes with george kennedy as patroni flashbacks to flesh out character's longer rescue scenes the discovery or another couple of dead bodies including the navigator while i would like to see this extra footage i am not sure i could sit through a near three hour cut of airport as expected the film has dated badly with horrible fashions interior design choices i will say no more other than the toy plane model effects aren't great either along with the other two airport sequels this takes pride of place in the razzie award's hall of shame although i can think of lots of worse films than this so i reckon that's a little harsh the action scenes are a little dull unfortunately the pace is slow not much excitement or tension is generated which is a shame as i reckon this could have been a pretty good film if made properly the production values are alright if nothing spectacular the acting isn't great two time oscar winner jack lemmon has said since it was a mistake to star in this one time oscar winner james stewart looks old frail also one time oscar winner lee grant looks drunk while sir christopher lee is given little to do there are plenty of other familiar faces to look out for too airport is the most disaster orientated of the three airport films so far i liked the ideas behind it even if they were a bit silly the production bland direction doesn't help though a film about a sunken plane just shouldn't be this boring or lethargic followed by the concorde airport</td>
</tr>
<tr class="odd">
<td style="text-align: right;">this film lacked something i couldn't put my finger on at first charisma on the part of the leading actress this inevitably translated to lack of chemistry when she shared the screen with her leading man even the romantic scenes came across as being merely the actors at play it could very well have been the director who miscalculated what he needed from the actors i just don't know but could it have been the screenplay just exactly who was the chef in love with he seemed more enamored of his culinary skills and restaurant and ultimately of himself and his youthful exploits than of anybody or anything else he never convinced me he was in love with the princess i was disappointed in this movie but don't forget it was nominated for an oscar so judge for yourself</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<hr>
</section>
<section id="stop-words" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="stop-words"><span class="header-section-number">12.5</span> Stop words</h2>
<p>Not all words are equally informative or useful to our model depending on the nature of our problem</p>
<p>Very common words often may carry little or no meaningful information</p>
<p>These words are called <strong>stop words</strong></p>
<p>It is common advice and practice to remove stop words for various NLP tasks</p>
<p>Notice some of the top most frequent words among our tokens from IMDB reviews</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">strip_numeric =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 84,258 × 2
    word         n
    &lt;chr&gt;    &lt;int&gt;
  1 the     336205
  2 and     164061
  3 a       162747
  4 of      145849
  5 to      135695
  6 is      107322
  7 in       93921
  8 it       78877
  9 i        76511
 10 this     75815
 11 that     69794
 12 was      48189
 13 as       46905
 14 for      44321
 15 with     44116
 16 movie    43510
 17 but      42531
 18 film     39058
 19 on       34185
 20 not      30608
 21 you      29887
 22 are      29434
 23 his      29352
 24 have     27725
 25 be       26947
 26 he       26895
 27 one      26502
 28 all      23929
 29 at       23500
 30 by       22539
 31 an       21550
 32 they     21097
 33 who      20604
 34 so       20573
 35 from     20489
 36 like     20269
 37 her      18399
 38 or       17997
 39 just     17764
 40 about    17368
 41 out      17099
 42 it's     17095
 43 has      16789
 44 if       16748
 45 some     15736
 46 there    15672
 47 what     15374
 48 good     15111
 49 more     14243
 50 when     14162
 51 very     14059
 52 up       13283
 53 no       12698
 54 time     12691
 55 even     12638
 56 she      12624
 57 my       12485
 58 would    12236
 59 which    12047
 60 story    11920
 61 only     11910
 62 really   11734
 63 see      11465
 64 their    11376
 65 had      11289
 66 can      11144
 67 were     10783
 68 me       10745
 69 well     10637
 70 than      9920
 71 we        9858
 72 much      9750
 73 bad       9292
 74 been      9287
 75 get       9281
 76 will      9195
 77 do        9160
 78 also      9130
 79 into      9109
 80 people    9107
 81 other     9084
 82 first     9054
 83 because   9046
 84 great     9034
 85 how       8870
 86 him       8865
 87 most      8776
 88 don't     8446
 89 made      8351
 90 its       8157
 91 then      8097
 92 make      8018
 93 way       8005
 94 them      7955
 95 too       7820
 96 could     7746
 97 any       7653
 98 movies    7648
 99 after     7617
100 think     7293
# ℹ 84,158 more rows</code></pre>
</div>
</div>
<hr>
<p>Stop words can have different roles in a <strong>corpus</strong> (a set of documents)</p>
<p>For our purposes, we generally care about two different types of stop words:</p>
<ul>
<li>Global</li>
<li>Subject-specific</li>
</ul>
<p>Global stop words almost always have very little value for our modeling goals</p>
<p>These are frequent words like “the”, “of” and “and” in English.</p>
<p>It is typically pretty safe to remove these and you can find them in pre-made lists of stop words (see below)</p>
<hr>
<p>Subject-specific stop words are words that are common and uninformative given the subject or context within which your text/documents were collected and your modeling goals.</p>
<p>For example, given our goal to classify movie reviews as positive or negative, subject-specific stop words might include:</p>
<ul>
<li>movie</li>
<li>film</li>
<li>movies</li>
</ul>
<hr>
<p>We likely we see others if we expand our review of commons words a bit more (which we should!)</p>
<ul>
<li>character</li>
<li>actor</li>
<li>actress</li>
<li>director</li>
<li>cast</li>
<li>scene</li>
</ul>
<p>These are not general stop words but they will be common in this dataset and the **may* be uninformative RE our classification goal</p>
<hr>
<p>Subject-specific stop words may improve performance if you have the domain expertise to create a good list</p>
<p>HOWEVER, you should think carefully about your goals and method. For example, if you are using bigrams rather than single word (unigram) tokens, you might retain words like actor or director because them may be informative in bigrams</p>
<ul>
<li>bad actor</li>
<li>great director</li>
</ul>
<p>Though it might be sufficient to just retain <strong>bad</strong> and <strong>great</strong></p>
<hr>
<p>The <code>stopwords</code> package contains many lists of stopwords.</p>
<ul>
<li>We can access these lists using through that package</li>
<li>Those lists are also available with <code>get_stopwords()</code> in the <code>tidytext</code> package (my preference)</li>
<li><code>get_stopwords()</code> returns a tibble with two columns (see below)</li>
</ul>
<hr>
<p>Two commonly used stop word lists are:</p>
<ul>
<li>snowball (175 words)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>stop_snowball <span class="ot">&lt;-</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_stopwords</span>(<span class="at">source =</span> <span class="st">"snowball"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">50</span>)  <span class="co"># review the first 50 words</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 175 × 2
   word       lexicon 
   &lt;chr&gt;      &lt;chr&gt;   
 1 i          snowball
 2 me         snowball
 3 my         snowball
 4 myself     snowball
 5 we         snowball
 6 our        snowball
 7 ours       snowball
 8 ourselves  snowball
 9 you        snowball
10 your       snowball
11 yours      snowball
12 yourself   snowball
13 yourselves snowball
14 he         snowball
15 him        snowball
16 his        snowball
17 himself    snowball
18 she        snowball
19 her        snowball
20 hers       snowball
21 herself    snowball
22 it         snowball
23 its        snowball
24 itself     snowball
25 they       snowball
26 them       snowball
27 their      snowball
28 theirs     snowball
29 themselves snowball
30 what       snowball
31 which      snowball
32 who        snowball
33 whom       snowball
34 this       snowball
35 that       snowball
36 these      snowball
37 those      snowball
38 am         snowball
39 is         snowball
40 are        snowball
41 was        snowball
42 were       snowball
43 be         snowball
44 been       snowball
45 being      snowball
46 have       snowball
47 has        snowball
48 had        snowball
49 having     snowball
50 do         snowball
# ℹ 125 more rows</code></pre>
</div>
</div>
<hr>
<ul>
<li>smart (571 words)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>stop_smart <span class="ot">&lt;-</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_stopwords</span>(<span class="at">source =</span> <span class="st">"smart"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">50</span>)  <span class="co"># review the first 50 words</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 571 × 2
   word        lexicon
   &lt;chr&gt;       &lt;chr&gt;  
 1 a           smart  
 2 a's         smart  
 3 able        smart  
 4 about       smart  
 5 above       smart  
 6 according   smart  
 7 accordingly smart  
 8 across      smart  
 9 actually    smart  
10 after       smart  
11 afterwards  smart  
12 again       smart  
13 against     smart  
14 ain't       smart  
15 all         smart  
16 allow       smart  
17 allows      smart  
18 almost      smart  
19 alone       smart  
20 along       smart  
21 already     smart  
22 also        smart  
23 although    smart  
24 always      smart  
25 am          smart  
26 among       smart  
27 amongst     smart  
28 an          smart  
29 and         smart  
30 another     smart  
31 any         smart  
32 anybody     smart  
33 anyhow      smart  
34 anyone      smart  
35 anything    smart  
36 anyway      smart  
37 anyways     smart  
38 anywhere    smart  
39 apart       smart  
40 appear      smart  
41 appreciate  smart  
42 appropriate smart  
43 are         smart  
44 aren't      smart  
45 around      smart  
46 as          smart  
47 aside       smart  
48 ask         smart  
49 asking      smart  
50 associated  smart  
# ℹ 521 more rows</code></pre>
</div>
</div>
<hr>
<p>smart is mostly a super-set of snowball except for these words which are only in snowball</p>
<p>Stop word lists aren’t perfect. Why does smart contain <code>he's</code> but not <code>she's</code>?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="fu">pull</span>(stop_snowball, word),</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(stop_smart, word))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "she's"   "he'd"    "she'd"   "he'll"   "she'll"  "shan't"  "mustn't"
 [8] "when's"  "why's"   "how's"  </code></pre>
</div>
</div>
<hr>
<p>It is common and appropriate to start with a pre-made word list or set of lists and combine, add, and/or remove words based on your specific needs</p>
<ul>
<li>You can add global words that you feel are missed</li>
<li>You can add subject specific words</li>
<li>You can remove global words that might be relevant to your problem</li>
</ul>
<hr>
<p>In the service of simplicity, we will use the union of the two previous pre-made global lists without any additional subject specific lists</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>all_stops <span class="ot">&lt;-</span> <span class="fu">union</span>(<span class="fu">pull</span>(stop_snowball, word), <span class="fu">pull</span>(stop_smart, word))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>We can remove stop words as part of tokenization using <code>stopwords = all_stops</code></p>
<p>Let’s see our two 100 tokens now</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">strip_numeric =</span> <span class="cn">TRUE</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">stopwords =</span> all_stops) <span class="sc">|&gt;</span> </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">|&gt;</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 83,688 × 2
    word            n
    &lt;chr&gt;       &lt;int&gt;
  1 movie       43510
  2 film        39058
  3 good        15111
  4 time        12691
  5 story       11920
  6 bad          9292
  7 people       9107
  8 great        9034
  9 made         8351
 10 make         8018
 11 movies       7648
 12 characters   7142
 13 watch        6959
 14 films        6881
 15 character    6701
 16 plot         6566
 17 life         6562
 18 acting       6482
 19 love         6422
 20 show         6171
 21 end          5640
 22 man          5631
 23 scene        5356
 24 scenes       5206
 25 back         4965
 26 real         4734
 27 watching     4597
 28 years        4508
 29 thing        4499
 30 actors       4477
 31 work         4368
 32 funny        4278
 33 makes        4204
 34 director     4185
 35 find         4129
 36 part         4022
 37 lot          3965
 38 cast         3816
 39 world        3698
 40 things       3685
 41 pretty       3663
 42 young        3634
 43 horror       3579
 44 fact         3521
 45 big          3471
 46 long         3441
 47 thought      3434
 48 series       3410
 49 give         3374
 50 original     3358
 51 action       3351
 52 comedy       3230
 53 times        3223
 54 point        3218
 55 role         3175
 56 interesting  3125
 57 family       3109
 58 bit          3052
 59 music        3045
 60 script       3007
 61 guy          2962
 62 making       2961
 63 feel         2947
 64 minutes      2944
 65 performance  2888
 66 kind         2780
 67 girl         2739
 68 tv           2732
 69 worst        2730
 70 day          2711
 71 fun          2690
 72 hard         2666
 73 woman        2651
 74 played       2586
 75 found        2571
 76 screen       2474
 77 set          2452
 78 place        2403
 79 book         2395
 80 put          2379
 81 ending       2351
 82 money        2351
 83 true         2329
 84 sense        2320
 85 reason       2316
 86 actor        2313
 87 shows        2304
 88 dvd          2282
 89 worth        2274
 90 job          2270
 91 year         2268
 92 main         2264
 93 watched      2235
 94 play         2222
 95 american     2217
 96 plays        2214
 97 effects      2196
 98 takes        2192
 99 beautiful    2177
100 house        2171
# ℹ 83,588 more rows</code></pre>
</div>
</div>
<hr>
<p>What if we were doing bigrams instead?</p>
<ul>
<li>token = “ngrams”</li>
<li>n = 2,</li>
<li>n_min = 2</li>
<li>NOTE: can’t strip numeric (would break the sequence of words)</li>
<li>NOTE: There are more bigrams than unigrams (more features for BoW!)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">token =</span> <span class="st">"ngrams"</span>,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">stopwords =</span> all_stops, </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">n =</span> <span class="dv">2</span>,</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">n_min =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">|&gt;</span> </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,616,372 × 2
    word                      n
    &lt;chr&gt;                 &lt;int&gt;
  1 special effects        1110
  2 low budget              881
  3 waste time              793
  4 good movie              785
  5 watch movie             695
  6 movie made              693
  7 sci fi                  647
  8 years ago               631
  9 real life               617
 10 film made               588
 11 movie good              588
 12 movie movie             561
 13 pretty good             557
 14 bad movie               552
 15 high school             545
 16 watching movie          534
 17 movie bad               512
 18 main character          509
 19 good film               487
 20 great movie             473
 21 horror movie            468
 22 horror film             454
 23 long time               448
 24 make movie              445
 25 film making             417
 26 film good               412
 27 worth watching          406
 28 10 10                   404
 29 movie great             388
 30 bad acting              387
 31 worst movie             386
 32 black white             385
 33 main characters         381
 34 end movie               380
 35 film film               368
 36 takes place             360
 37 great film              358
 38 camera work             356
 39 make sense              348
 40 good job                347
 41 story line              347
 42 watch film              344
 43 movie watch             343
 44 character development   341
 45 supporting cast         338
 46 1 2                     334
 47 love story              334
 48 read book               332
 49 bad guys                327
 50 end film                320
 51 8 10                    318
 52 horror movies           318
 53 make film               317
 54 made movie              315
 55 good thing              307
 56 7 10                    305
 57 world war               289
 58 bad film                288
 59 horror films            285
 60 watched movie           285
 61 thing movie             284
 62 1 10                    280
 63 part movie              278
 64 watching film           277
 65 bad guy                 274
 66 4 10                    273
 67 made film               272
 68 rest cast               268
 69 tv series               268
 70 writer director         267
 71 time movie              266
 72 half hour               265
 73 production values       265
 74 film great              262
 75 highly recommend        261
 76 makes sense             256
 77 martial arts            256
 78 love movie              255
 79 science fiction         255
 80 acting bad              254
 81 tv movie                253
 82 recommend movie         251
 83 3 10                    246
 84 entire movie            245
 85 film makers             245
 86 9 10                    242
 87 movie time              242
 88 fun watch               238
 89 kung fu                 238
 90 film bad                235
 91 good acting             235
 92 true story              233
 93 movie make              232
 94 movies made             232
 95 point view              232
 96 film festival           231
 97 great job               227
 98 young woman             227
 99 good story              225
100 star wars               224
# ℹ 1,616,272 more rows</code></pre>
</div>
</div>
<p>Looks like we are starting to get some signal</p>
<hr>
</section>
<section id="stemming" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="stemming"><span class="header-section-number">12.6</span> Stemming</h2>
<p>Documents often contain different versions of one base word</p>
<p>We refer to the common base as the stem</p>
<p>Often, we may want to treat the different versions of the stem as the same token. This can reduce the total number of tokens that we need to use for features later which can lead to a better performing model</p>
<p>For example, do we need to distinguish between movie vs.&nbsp;movies or actor vs.&nbsp;actors or should we collapse those pairs into a single token?</p>
<hr>
<p>There are many different algorithms that can stem words for us (i.e., collapse multiple versions into the same base). However, we will focus on only one here as an introduction to the concept and approach for stemming</p>
<p>This is the Porter method and a current implementation of it is available in the using <code>wordStem()</code> in the <code>SnowballC</code> package</p>
<hr>
<p>The goal of stemming is to reduce the dimensionality (size) of our vocabulary</p>
<p>Whenever we can combine words that “belong” together with respect to our goal, we may improve the performance of our model</p>
<p>However, stemming is hard and it will also invariably combine words that shouldn’t be combined</p>
<p>Stemming is useful when it suceeds more than it fails or when it succees more with important words/tokens</p>
<hr>
<p>Here are examples of when it helps to reduce our vocabulary given our task</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"movie"</span>, <span class="st">"movies"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "movi" "movi"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"actor"</span>, <span class="st">"actors"</span>, <span class="st">"actress"</span>, <span class="st">"actresses"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "actor"   "actor"   "actress" "actress"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"wait"</span>, <span class="st">"waits"</span>, <span class="st">"waiting"</span>, <span class="st">"waited"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "wait" "wait" "wait" "wait"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"play"</span>, <span class="st">"plays"</span>, <span class="st">"played"</span>, <span class="st">"playing"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "plai" "plai" "plai" "plai"</code></pre>
</div>
</div>
<hr>
<p>Sometimes it works partially, likely with still some benefit</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"go"</span>, <span class="st">"gone"</span>, <span class="st">"going"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "go"   "gone" "go"  </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"send"</span>, <span class="st">"sending"</span>, <span class="st">"sent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "send" "send" "sent"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"fishing"</span>, <span class="st">"fished"</span>, <span class="st">"fisher"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "fish"   "fish"   "fisher"</code></pre>
</div>
</div>
<hr>
<p>But it clearly makes salient errors too</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"university"</span>, <span class="st">"universal"</span>, <span class="st">"universe"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "univers" "univers" "univers"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"is"</span>, <span class="st">"are"</span>, <span class="st">"was"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "i"  "ar" "wa"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"he"</span>, <span class="st">"his"</span>, <span class="st">"him"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "he"  "hi"  "him"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"like"</span>, <span class="st">"liking"</span>, <span class="st">"likely"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "like" "like" "like"</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordStem</span>(<span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"meaning"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mean" "mean"</code></pre>
</div>
</div>
<hr>
<p>Of course, the errors are more important if they are with words that contain predictive signal</p>
<p>Therefore, we should look at how it works with our text</p>
<p>To stem our tokens if we only care about unigrams:</p>
<ul>
<li>We first tokenize as before (including removal of stop words)</li>
<li>Then we stem, for now using <code>wordStem()</code></li>
<li>We are mutating the stemmed words into a new column, <code>stem</code>, so we can compare its effect</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  data_trn <span class="sc">|&gt;</span> </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text, </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">strip_numeric =</span> <span class="cn">TRUE</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">stopwords =</span> all_stops) <span class="sc">|&gt;</span> </span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stem =</span> <span class="fu">wordStem</span>(word)) <span class="sc">|&gt;</span> </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(word, stem)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Let’s compare vocabulary size</p>
<p>Stemming produced a sizable reduction in vocabulary size</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(tokens<span class="sc">$</span>word))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 83688</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(tokens<span class="sc">$</span>stem))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60678</code></pre>
</div>
</div>
<hr>
<p>Let’s compare frequencies of the top 100 words vs.&nbsp;stems</p>
<ul>
<li>Here are our normal (not stemmed words). Notice vocabulary size</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>word_tokens <span class="ot">&lt;-</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  tokens <span class="sc">|&gt;</span> </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab</span>(word) <span class="sc">|&gt;</span> </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(word, <span class="at">n_word =</span> n)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>stem_tokens <span class="ot">&lt;-</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  tokens <span class="sc">|&gt;</span> </span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab</span>(stem) <span class="sc">|&gt;</span> </span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(stem, <span class="at">n_stem =</span> n)</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>word_tokens <span class="sc">|&gt;</span> </span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(stem_tokens)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 4
   word   n_word stem    n_stem
   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;    &lt;int&gt;
 1 movie   43510 movi     51160
 2 film    39058 film     47096
 3 good    15111 time     16146
 4 time    12691 good     15328
 5 story   11920 make     15204
 6 bad      9292 watch    13920
 7 people   9107 charact  13844
 8 great    9034 stori    13105
 9 made     8351 scene    10563
10 make     8018 show      9750
# ℹ 90 more rows</code></pre>
</div>
</div>
<hr>
<p>Stemming is often routinely used as part of an NLP pipeline.</p>
<ul>
<li>Often without thought</li>
<li>We should consider carefully if it will help or hurt</li>
<li>We should likely formally evaluate it (via model configurations), sometimes without much comment about when it is helpful or not. We encourage you to think of stemming as a pre-processing step in text modeling, one that must be thought through and chosen (or not) with good judgment.</li>
</ul>
<hr>
<p>In this example, we focused on unigrams.</p>
<p>If we had wanted bigrams, we would have needed a different order of steps</p>
<ul>
<li>Extract words</li>
<li>Stem</li>
<li>Put back together</li>
<li>Extract bigrams</li>
<li>Remove stop words</li>
</ul>
<p>Think carefully about what you are doing and what your goals are!</p>
<p>You can read more about stemming and related (more complicated but possibly more precise) procedure called lemmazation in a <a href="https://smltar.com/stemming.html#how-to-stem-text-in-r">chapter</a> from <span class="citation" data-cites="SMLTAR">Hvitfeldt and Silge (<a href="#ref-SMLTAR" role="doc-biblioref">2022</a>)</span></p>
<hr>
</section>
<section id="bag-of-words" class="level2" data-number="12.7">
<h2 data-number="12.7" class="anchored" data-anchor-id="bag-of-words"><span class="header-section-number">12.7</span> Bag of Words</h2>
<p>Now that we understand how to tokenize our documents, we can begin to consider how to feature engineer using these tokens</p>
<p>The <strong>Bag-of-words (BoW)</strong> method</p>
<ul>
<li>Provides one way of representing tokens within text data when modeling text with machine learning algorithms.</li>
<li>Is simple to understand and implement</li>
<li>Works well for problems such as document classification</li>
</ul>
<hr>
<p>BoW is a representation of text that describes the occurrence of words within a document. It involves two things:</p>
<ul>
<li>A <strong>vocabulary</strong> of known “words” (I put words in quote because our tokens will sometimes be something other than a word)</li>
<li>A measure of the occurrence or frequency of these known words.</li>
</ul>
<p>It is called a “bag” of words because information about the order or structure of words in the document is discarded. BoW is only concerned with occurrence or frequency of known words in the document, not where in the document they occur.</p>
<p>BoW assumes that documents that contain the same content are similar and that we can learn something about the document by its content alone.</p>
<hr>
<p>BoW approaches vary on two primary characteristics:</p>
<ul>
<li>What the token type is
<ul>
<li>Word is most common</li>
<li>Also common to use bigrams, combinations of unigrams (words) and bigrams</li>
<li>Other options exist (e.g.,trigram)</li>
</ul></li>
<li>How occurrence frequent of the word/token is measured
<ul>
<li>Binary (presence or absence)</li>
<li>Raw count</li>
<li>Term frequency</li>
<li>Term frequency - inverse document frequency (tf-idf)</li>
<li>and other less common options</li>
</ul></li>
</ul>
<hr>
<p>Lets start with a very simple example</p>
<ul>
<li>Two documents</li>
<li>Tokenization to words</li>
<li>Lowercase, strip punctuation, did not remove any stopwords, no stemming or lemmatization</li>
<li>Binary measurement (1 = yes, 0 = no)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Document</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">i</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">loved</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">that</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">movie</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">am</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">so</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">happy</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">was</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">not</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">good</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">I loved that movie! I am so so so happy.</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">That movie was not good.</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<hr>
<p>This matrix is referred to as a <strong>Document-Term Matrix (DTM)</strong></p>
<ul>
<li>Rows are documents</li>
<li>Columns are terms (tokens)</li>
<li>Combination of all terms/tokens is called the <strong>vocabulary</strong></li>
<li>The terms columns (or a subset) will be used as features in our statistical algorithm to predict some outcome (not displayed)</li>
</ul>
<hr>
<p>You will also see the use of <strong>raw counts</strong> for measurement of the cell value for each term</p>
<div class="cell">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Document</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">i</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">loved</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">that</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">movie</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">am</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">so</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">happy</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">was</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">not</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">good</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">I loved that movie! I am so so so happy.</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">That movie was not good.</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Both binary and raw count measures are biased (increased) for longer documents</p>
<hr>
<p>The bias based on document length motivates the use of <strong>term frequency</strong></p>
<ul>
<li>Term frequency is NOT a simple frequency count (that is raw count)</li>
<li>Instead it is the raw count divided by the document length</li>
<li>This removes the bias based on document length</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="do">## echo: false</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Document, <span class="sc">~</span>i, <span class="sc">~</span>loved, <span class="sc">~</span>that, <span class="sc">~</span>movie, <span class="sc">~</span>am, <span class="sc">~</span>so, <span class="sc">~</span>happy, <span class="sc">~</span>was, <span class="sc">~</span>not, <span class="sc">~</span>good,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"I loved that movie! I am so so so happy."</span>, .<span class="dv">2</span>, .<span class="dv">1</span>, .<span class="dv">1</span>, .<span class="dv">1</span>, .<span class="dv">1</span>, .<span class="dv">3</span>, .<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"That movie was not good."</span>, <span class="dv">0</span>, <span class="dv">0</span>, .<span class="dv">2</span>, .<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, .<span class="dv">2</span>, .<span class="dv">2</span>, .<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Document</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">i</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">loved</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">that</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">movie</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">am</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">so</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">happy</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">was</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">not</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">good</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">I loved that movie! I am so so so happy.</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.3</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">That movie was not good.</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<hr>
<p>Term frequency can be dominated by frequently occurring words that may not be as important to understand the document as are rarer but more domain specific words</p>
<p>This was the motivation for removing stopwords but stopword removal may not be sufficient</p>
<p><strong>Term Frequency - Inverse Document Frequency (tf-idf)</strong> was developed to address this issue</p>
<p>TF-IDF scales the term frequency by the inverse document frequency</p>
<ul>
<li>Term frequency tells us that word is frequently used in the current document</li>
<li>IDF indexes how rare the word is across documents (higer IDF == more rare)</li>
</ul>
<p>This emphasizes words used in specific documents that are not commonly used otherwise</p>
<hr>
<p><span class="math inline">\(IDF = log(\frac{total\:number\:of\:documents}{documents\:containing\:the\:word})\)</span></p>
<p>This results in larger values for words that arent used in many documents. e.g.,</p>
<ul>
<li>for a word that appears in only 1 of 1000 documents, idf = log(1000/1) = 3</li>
<li>for a word that appears in 1000 of 1000 documents, idf = log(1000/1000) = 0</li>
</ul>
<p>Note that word that appears in no documents would result in a division by zero. Therefore it is common to add 1 to the denominator of idf</p>
<hr>
<p>We should be aware of some of the limitations of BoW:</p>
<ul>
<li>Vocabulary: The vocabulary requires careful thought
<ul>
<li>Choice of stop words (global and subject specific) can matter</li>
<li>Choice about size (number of tokens) can matter</li>
</ul></li>
<li>Sparsity:
<ul>
<li>Sparse representations (features that contain mostly zeros) are hard to model for computational reasons (space and time)</li>
<li>Sparse representations present a challenge to extract signal in a large representational space</li>
</ul></li>
<li>Meaning: Discarding word order ignores the context, and in turn meaning of words in the document (semantics).
<ul>
<li>Context and meaning can offer a lot to the model</li>
<li>“this is interesting” vs “is this interesting”</li>
<li>“old bike” vs “used bike”</li>
</ul></li>
</ul>
<hr>
</section>
<section id="bringing-it-all-together" class="level2" data-number="12.8">
<h2 data-number="12.8" class="anchored" data-anchor-id="bringing-it-all-together"><span class="header-section-number">12.8</span> Bringing it all together</h2>
<section id="general" class="level3" data-number="12.8.1">
<h3 data-number="12.8.1" class="anchored" data-anchor-id="general"><span class="header-section-number">12.8.1</span> General</h3>
<p>We will now explore a series of model configurations to predict the sentiment (positive vs negative) of IMDB.com reviews</p>
<ul>
<li>To keep things simple, all model configurations will use only one statistical algorithm - glmnet
<ul>
<li>Within algorithm, configurations will differ by <code>penatly</code> and `dials::mixture’ - see grid below</li>
</ul></li>
<li>We will consider BoW features derived by TF-IDF only</li>
<li>We will remove global stop words from some configurations</li>
<li>We will stem words from some configurations</li>
<li>These BoW configurations will also differ by token type
<ul>
<li>Word/unigram</li>
<li>A combination of uni- and bigrams</li>
<li>Prior to casting the tf-idf document-term matrix, we will filter tokens to various sizes - see grid below</li>
</ul></li>
<li>We will also train a word embedding model to demonstrate how to implement that feature engineering technique in tidymodels</li>
</ul>
<hr>
<p>We are applying these feature engineering steps blindly. YOU should not.</p>
<p>You will want to explore the impact of your feature engineering either</p>
<ul>
<li>During EDA with unnest_tokens()</li>
<li>After making your recipe by using it to make a feature matrix</li>
<li>Likely some of both</li>
</ul>
<hr>
<p>Lets start fresh with our training data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"imdb_trn.csv"</span>),</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"doc_num"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> <span class="fu">factor</span>(sentiment, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"neg"</span>, <span class="st">"pos"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 25,000
Columns: 3
$ doc_num   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…
$ sentiment &lt;fct&gt; neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, …
$ text      &lt;chr&gt; "Story of a man who has unnatural feelings for a pig. Starts…</code></pre>
</div>
</div>
<hr>
<p>And do our (very minimal) cleaning</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"&lt;br /&gt;&lt;br /&gt;"</span>, <span class="st">" "</span>),</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">" _"</span>, <span class="st">" "</span>),</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">" _"</span>, <span class="st">" "</span>),</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"^_"</span>, <span class="st">""</span>),</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"_</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>),</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"</span><span class="sc">\\</span><span class="st">(_"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">("</span>),</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">":_"</span>, <span class="st">": "</span>),</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"_{3,}"</span>, <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>We will select among model configurations using a validation split resampled accuracy to ease computational costs</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validation_split</span>(<span class="at">strata =</span> sentiment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `validation_split()` was deprecated in rsample 1.2.0.
ℹ Please use `initial_validation_split()` instead.</code></pre>
</div>
</div>
<hr>
<p>We will use a simple union of stop words for some configurations:</p>
<ul>
<li>It <strong>could</strong> help to edit the global list (or use a smaller list like snowball only)</li>
<li>It <strong>could</strong> help to have subject specific stop words too AND they might need to be different for words vs.&nbsp;bigrams</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>all_stops <span class="ot">&lt;-</span> <span class="fu">union</span>(<span class="fu">pull</span>(<span class="fu">get_stopwords</span>(<span class="at">source =</span> <span class="st">"smart"</span>), word), <span class="fu">pull</span>(<span class="fu">get_stopwords</span>(<span class="at">source =</span> <span class="st">"snowball"</span>), word))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>All of our model configurations will be tuned on <code>penalty</code>, <code>mixture</code> and <code>max_tokens</code></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>grid_tokens <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>, <span class="dv">3</span>)), </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mixture</span>(), </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">max_tokens</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">10000</span>)), </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">6</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="words-unigrams" class="level3" data-number="12.8.2">
<h3 data-number="12.8.2" class="anchored" data-anchor-id="words-unigrams"><span class="header-section-number">12.8.2</span> Words (unigrams)</h3>
<p>We will start by fitting a BoW model configuration for word tokens</p>
<p>Recipe for Word Tokens. NOTE:</p>
<ul>
<li><code>token = "words"</code> (default)</li>
<li><code>max_tokens = tune()</code> - We are now set to tune recipes!!! <code>options = list(stopwords = all_stops)</code> - Passing in options to <code>tokenizers::tokenize_words()</code></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>rec_word <span class="ot">&lt;-</span>  <span class="fu">recipe</span>(sentiment <span class="sc">~</span> text, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(text, </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">engine =</span> <span class="st">"tokenizers"</span>, <span class="at">token =</span> <span class="st">"words"</span>) <span class="sc">|&gt;</span>    </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(text, <span class="at">max_tokens =</span> tune<span class="sc">::</span><span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tfidf</span>(text)  <span class="sc">|&gt;</span> </span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Tuning hyperparameters for Word Tokens</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>fits_word <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> tune<span class="sc">::</span><span class="fu">tune</span>(), </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mixture =</span> tune<span class="sc">::</span><span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_word, </span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">resamples =</span> splits, </span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">grid =</span> grid_tokens, </span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/012/"</span>,</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_word"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Confirm that the range of hyperparameters we considered was sufficient</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># autoplot(fits_word)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Display performance of best configuration for Word Tokens.</p>
<p>Wow, pretty good!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(fits_word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in show_best(fits_word): No value of `metric` was given; "accuracy"
will be used.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 9
  penalty mixture max_tokens .metric  .estimator  mean     n std_err
    &lt;dbl&gt;   &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 0.207       0         5000 accuracy binary     0.896     1      NA
2 0.0183      0.2      10000 accuracy binary     0.896     1      NA
3 0.00546     0.4      10000 accuracy binary     0.895     1      NA
4 0.00546     0.6      10000 accuracy binary     0.895     1      NA
5 0.00546     0.4       5000 accuracy binary     0.893     1      NA
  .config               
  &lt;chr&gt;                 
1 Preprocessor1_Model013
2 Preprocessor2_Model031
3 Preprocessor2_Model050
4 Preprocessor2_Model070
5 Preprocessor1_Model050</code></pre>
</div>
</div>
<hr>
</section>
<section id="words-unigrams-excluding-stop-words" class="level3" data-number="12.8.3">
<h3 data-number="12.8.3" class="anchored" data-anchor-id="words-unigrams-excluding-stop-words"><span class="header-section-number">12.8.3</span> Words (unigrams) Excluding Stop Words</h3>
<p>Lets try a configuration that removes stop words</p>
<p>Recipe for Word Tokens excluding Stop Words. NOTE:</p>
<ul>
<li><code>options = list(stopwords = all_stops)</code> - Passing in options to <code>tokenizers::tokenize_words()</code></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>rec_word_nsw <span class="ot">&lt;-</span>  <span class="fu">recipe</span>(sentiment <span class="sc">~</span> text, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(text, </span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">engine =</span> <span class="st">"tokenizers"</span>, <span class="at">token =</span> <span class="st">"words"</span>,   <span class="co"># included for clarity</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">options =</span> <span class="fu">list</span>(<span class="at">stopwords =</span> all_stops)) <span class="sc">|&gt;</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(text, <span class="at">max_tokens =</span> tune<span class="sc">::</span><span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tfidf</span>(text)  <span class="sc">|&gt;</span> </span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Tuning hyperparameters for Word Tokens excluding Stop Words</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>fits_word_nsw <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> tune<span class="sc">::</span><span class="fu">tune</span>(), </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mixture =</span> tune<span class="sc">::</span><span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_word_nsw, </span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">resamples =</span> splits, </span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">grid =</span> grid_tokens, </span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/012/"</span>,</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_word_nws"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Confirm that the range of hyperparameters we considered was sufficient</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># autoplot(fits_word_nsw)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Display performance of best configuration for Word Tokens excluding Stop Words.</p>
<ul>
<li>Looks like our mindless use of a large list of global stop words didn’t help.<br>
</li>
<li>We might consider the more focused snowball list</li>
<li>We might consider subject specific stop words</li>
<li>For this demonstration, we will just move forward without stop words</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(fits_word_nsw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in show_best(fits_word_nsw): No value of `metric` was given; "accuracy"
will be used.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 9
  penalty mixture max_tokens .metric  .estimator  mean     n std_err
    &lt;dbl&gt;   &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 0.00546     0.6      10000 accuracy binary     0.880     1      NA
2 0.0183      0.2      10000 accuracy binary     0.879     1      NA
3 0.00546     0.4       5000 accuracy binary     0.879     1      NA
4 0.0183      0.2       5000 accuracy binary     0.878     1      NA
5 0.00162     1         5000 accuracy binary     0.877     1      NA
  .config               
  &lt;chr&gt;                 
1 Preprocessor2_Model070
2 Preprocessor2_Model031
3 Preprocessor1_Model050
4 Preprocessor1_Model031
5 Preprocessor1_Model109</code></pre>
</div>
</div>
<hr>
</section>
<section id="stemmed-words-unigrams" class="level3" data-number="12.8.4">
<h3 data-number="12.8.4" class="anchored" data-anchor-id="stemmed-words-unigrams"><span class="header-section-number">12.8.4</span> Stemmed Words (unigrams)</h3>
<p>Now we will try using stemmed words</p>
<p>Recipe for Stemmed Word Tokens. NOTE: <code>step_stem()</code></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>rec_stemmed_word <span class="ot">&lt;-</span>  <span class="fu">recipe</span>(sentiment <span class="sc">~</span> text, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(text, </span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">engine =</span> <span class="st">"tokenizers"</span>, <span class="at">token =</span> <span class="st">"words"</span>) <span class="sc">|&gt;</span>    <span class="co"># included for clarity</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_stem</span>(text) <span class="sc">|&gt;</span> </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(text, <span class="at">max_tokens =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tfidf</span>(text)  <span class="sc">|&gt;</span> </span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Tuning hyperparameters for Stemmed Word Tokens</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>fits_stemmed_word <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_stemmed_word, </span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">resamples =</span> splits, </span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">grid =</span> grid_tokens, </span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy))</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting, </span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/012/"</span>,</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_stemmed_word"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Confirm that the range of hyperparameters we considered was sufficient</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># autoplot(fits_stemmed_word)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Display performance of best configuration for Stemmed Word Tokens</p>
<p>Not much change</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(fits_stemmed_word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in show_best(fits_stemmed_word): No value of `metric` was given;
"accuracy" will be used.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 9
  penalty mixture max_tokens .metric  .estimator  mean     n std_err
    &lt;dbl&gt;   &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 0.207       0        10000 accuracy binary     0.896     1      NA
2 0.695       0        10000 accuracy binary     0.896     1      NA
3 0.0183      0.2      10000 accuracy binary     0.896     1      NA
4 0.00546     0.4      10000 accuracy binary     0.895     1      NA
5 0.00546     0.6      10000 accuracy binary     0.894     1      NA
  .config               
  &lt;chr&gt;                 
1 Preprocessor2_Model013
2 Preprocessor2_Model014
3 Preprocessor2_Model031
4 Preprocessor2_Model050
5 Preprocessor2_Model070</code></pre>
</div>
</div>
<hr>
</section>
<section id="ngrams-unigrams-and-bigrams" class="level3" data-number="12.8.5">
<h3 data-number="12.8.5" class="anchored" data-anchor-id="ngrams-unigrams-and-bigrams"><span class="header-section-number">12.8.5</span> ngrams (unigrams and bigrams)</h3>
<p>Now we try both unigrams and bigrams</p>
<p>Recipe for unigrams and bigrams. NOTES:</p>
<ul>
<li><code>token = "ngrams"</code></li>
<li><code>options = list(n = 2, n_min = 1)</code> - includes uni (1) and bi(2) grams</li>
<li>not stemmed (stemming doesn’t work by default for bigrams)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>rec_ngrams <span class="ot">&lt;-</span>  <span class="fu">recipe</span>(sentiment <span class="sc">~</span> text, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(text, </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">engine =</span> <span class="st">"tokenizers"</span>, <span class="at">token =</span> <span class="st">"ngrams"</span>,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">options =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">n_min =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(text, <span class="at">max_tokens =</span>  tune<span class="sc">::</span><span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tfidf</span>(text) <span class="sc">|&gt;</span> </span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Tuning hyperparameters for ngrams</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>fits_ngrams <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> tune<span class="sc">::</span><span class="fu">tune</span>(), <span class="at">mixture =</span> tune<span class="sc">::</span><span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_ngrams, </span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">resamples =</span> splits, </span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">grid =</span> grid_tokens, </span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">metrics =</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>accuracy))</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>},</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/012/"</span>,</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_ngrams"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Confirm that the range of hyperparameters we considered was sufficient</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># autoplot(fits_ngrams)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Display performance of best configuration</p>
<p>Our best model yet!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(fits_ngrams)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in show_best(fits_ngrams): No value of `metric` was given; "accuracy"
will be used.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 9
  penalty mixture max_tokens .metric  .estimator  mean     n std_err
    &lt;dbl&gt;   &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 0.207       0        10000 accuracy binary     0.901     1      NA
2 0.695       0        10000 accuracy binary     0.900     1      NA
3 0.0183      0.2      10000 accuracy binary     0.900     1      NA
4 0.00546     0.4      10000 accuracy binary     0.898     1      NA
5 0.00546     0.6      10000 accuracy binary     0.897     1      NA
  .config               
  &lt;chr&gt;                 
1 Preprocessor2_Model013
2 Preprocessor2_Model014
3 Preprocessor2_Model031
4 Preprocessor2_Model050
5 Preprocessor2_Model070</code></pre>
</div>
</div>
<hr>
</section>
<section id="word-embeddings" class="level3" data-number="12.8.6">
<h3 data-number="12.8.6" class="anchored" data-anchor-id="word-embeddings"><span class="header-section-number">12.8.6</span> Word Embeddings</h3>
<p>BoW is an introductory approach for feature engineering.</p>
<p>As you have read, word embeddings are a common alternative that addresses some of the limitations of BoW. Word embeddings are also well-support in the <code>tidyrecipes</code> package.</p>
<p>Let’s switch gears away from document term matrices and BoW to word embeddings</p>
<hr>
<p>You can find pre-trained word embeddings on the web</p>
<ul>
<li><a href="https://nlp.stanford.edu/projects/glove/">GloVe</a></li>
<li><a href="https://code.google.com/archive/p/word2vec/">Word2Vec</a></li>
<li><a href="https://fasttext.cc/docs/en/english-vectors.html">Fasttek</a></li>
</ul>
<p>Below, we download and open pre-trained GloVe embeddings</p>
<ul>
<li>I chose a smaller set of embeddings to ease computational cost
<ul>
<li>Wikipedia 2014 + Gigaword 5</li>
<li>6B tokens, 400K vocab, uncased, 50d</li>
</ul></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">timeout =</span> <span class="fu">max</span>(<span class="dv">300</span>, <span class="fu">getOption</span>(<span class="st">"timeout"</span>)))  <span class="co"># need more time to download big file</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://nlp.stanford.edu/data/glove.6B.zip"</span>, temp)</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(temp, <span class="at">files =</span> <span class="st">"glove.6B.50d.txt"</span>)</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>glove_embeddings <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"glove.6B.50d.txt"</span>),</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">delim =</span> <span class="st">" "</span>,</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">col_names =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8 Columns: 51
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
chr  (1): X1
dbl (50): X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14, X15, X16,...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<hr>
<p>Recipe for GloVe embedding. NOTES:</p>
<ul>
<li><code>token = "words"</code></li>
<li>No need to filter tokens</li>
<li>New step is <code>step_word_embeddings(text, embeddings = glove_embeddings)</code></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rec_glove &lt;-  recipe(sentiment ~ text, data = data_trn) |&gt;</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   step_tokenize(text, </span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                 engine = "tokenizers", token = "words",   # included for clarity</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                 options = list(stopwords = all_stops)) |&gt;</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   step_word_embeddings(text, embeddings = glove_embeddings)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Hyperparameter grid for GloVe embedding (no need for <code>max_tokens</code>)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grid_glove &lt;- grid_regular(penalty(range = c(-7, 3)), </span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                             dials::mixture(), </span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                             levels = c(20, 6))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Tuning hyperparameters for GloVe embedding</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fits_glove &lt;-</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   logistic_reg(penalty = tune(), </span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co">#              mixture = tune()) |&gt; </span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   set_engine("glmnet") |&gt; </span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   tune_grid(preprocessor = rec_glove, </span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             resamples = splits, </span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="co">#             grid = grid_glove, </span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="co">#             metrics = metric_set(accuracy))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Confirm that the range of hyperparameters we considered was sufficient</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># autoplot(fits_glove)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Display performance of best configuration for GloVe embedding</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show_best(fits_glove)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
<section id="best-configuration" class="level3" data-number="12.8.7">
<h3 data-number="12.8.7" class="anchored" data-anchor-id="best-configuration"><span class="header-section-number">12.8.7</span> Best Configuration</h3>
<ul>
<li>Fit best model configuration to training set</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>rec_final <span class="ot">&lt;-</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sentiment <span class="sc">~</span> text, <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_tokenize</span>(text, </span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">engine =</span> <span class="st">"tokenizers"</span>, <span class="at">token =</span> <span class="st">"ngrams"</span>,</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">n_min =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_tokenfilter</span>(text, <span class="at">max_tokens =</span> <span class="fu">select_best</span>(fits_ngrams)<span class="sc">$</span>max_tokens) <span class="sc">|&gt;</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_tfidf</span>(text) <span class="sc">|&gt;</span> </span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in select_best(fits_ngrams): No value of `metric` was given; "accuracy"
will be used.</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>rec_final_prep <span class="ot">&lt;-</span> rec_final <span class="sc">|&gt;</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asMethod(object): sparse-&gt;dense coercion: allocating vector of size
1.9 GiB</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_final_prep <span class="sc">|&gt;</span> </span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="cn">NULL</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>fit_final <span class="ot">&lt;-</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> <span class="fu">select_best</span>(fits_ngrams)<span class="sc">$</span>penalty, </span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">mixture =</span> <span class="fu">select_best</span>(fits_ngrams)<span class="sc">$</span>mixture) <span class="sc">|&gt;</span> </span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sentiment <span class="sc">~</span> ., <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in select_best(fits_ngrams): No value of `metric` was given; "accuracy" will be used.
No value of `metric` was given; "accuracy" will be used.
No value of `metric` was given; "accuracy" will be used.
No value of `metric` was given; "accuracy" will be used.
No value of `metric` was given; "accuracy" will be used.</code></pre>
</div>
</div>
<hr>
<ul>
<li>Open and clean test to make features</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>data_test <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"imdb_test.csv"</span>),</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"doc_num"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> <span class="fu">factor</span>(sentiment, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"neg"</span>, <span class="st">"pos"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 25,000
Columns: 3
$ doc_num   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…
$ sentiment &lt;fct&gt; neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, neg, …
$ text      &lt;chr&gt; "Once again Mr. Costner has dragged out a movie for far long…</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>data_test <span class="ot">&lt;-</span> data_test <span class="sc">|&gt;</span> </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"&lt;br /&gt;&lt;br /&gt;"</span>, <span class="st">" "</span>),</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">" _"</span>, <span class="st">" "</span>),</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">" _"</span>, <span class="st">" "</span>),</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"^_"</span>, <span class="st">""</span>),</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"_</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>),</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"</span><span class="sc">\\</span><span class="st">(_"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">("</span>),</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">":_"</span>, <span class="st">": "</span>),</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"_{3,}"</span>, <span class="st">" "</span>))</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>feat_test <span class="ot">&lt;-</span> rec_final_prep <span class="sc">|&gt;</span> </span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asMethod(object): sparse-&gt;dense coercion: allocating vector of size
1.9 GiB</code></pre>
</div>
</div>
<hr>
<ul>
<li>Predict into test</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_test<span class="sc">$</span>sentiment, <span class="fu">predict</span>(fit_final, feat_test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in select_best(fits_ngrams): No value of `metric` was given; "accuracy"
will be used.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.89264</code></pre>
</div>
</div>
<ul>
<li>Confusion matrix</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">truth =</span> feat_test<span class="sc">$</span>sentiment,</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> <span class="fu">predict</span>(fit_final, feat_test)<span class="sc">$</span>.pred_class) <span class="sc">|&gt;</span> </span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(truth, estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in select_best(fits_ngrams): No value of `metric` was given; "accuracy"
will be used.</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># autoplot(cm, type = "heatmap")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>And lets end by calculating Permutation feature importance scores in test set using DALEX</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DALEX, <span class="at">exclude=</span> <span class="st">"explain"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to DALEX (version: 2.4.3).
Find examples and detailed introduction at: http://ema.drwhy.ai/
Additional features will be available after installation of: ggpubr.
Use 'install_dependencies()' to get all suggested dependencies</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DALEXtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>We are going to sample only a subset of the test set to keep the computational costs lower for this example.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>feat_subtest <span class="ot">&lt;-</span> feat_test <span class="sc">|&gt;</span> </span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> .<span class="dv">05</span>) <span class="co"># 5% of data </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Now we can get a df for the features (without the outcome) and a separate vector for the outcome.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> feat_subtest <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>sentiment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For outcome, we need to convert to 0/1 (if classification), and then pull the vector out of the dataframe</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> feat_subtest <span class="sc">|&gt;</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> <span class="fu">if_else</span>(sentiment <span class="sc">==</span> <span class="st">"pos"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(sentiment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>We also need a specific predictor function that will work with the DALEX package</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>predict_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(model, newdata) {</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(model, newdata, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(.pred_pos)</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>We will also need an <code>explainer</code> object based on our model and data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>explain_test <span class="ot">&lt;-</span> <span class="fu">explain_tidymodels</span>(fit_final, <span class="co"># our model object </span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> x, <span class="co"># df with features without outcome</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">y =</span> y, <span class="co"># outcome vector</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="co"># our custom predictor function</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">predict_function =</span> predict_wrapper)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Preparation of a new explainer is initiated
  -&gt; model label       :  model_fit  (  default  )
  -&gt; data              :  1250  rows  10000  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  1250  values 
  -&gt; predict function  :  predict_function 
  -&gt; predicted values  :  No value for predict function target column. (  default  )</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in select_best(fits_ngrams): No value of `metric` was given; "accuracy"
will be used.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  -&gt; model_info        :  package parsnip , ver. 1.2.1 , task classification (  default  ) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in select_best(fits_ngrams): No value of `metric` was given; "accuracy"
will be used.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  -&gt; predicted values  :  numerical, min =  0.0003612298 , mean =  0.5143628 , max =  0.999901  
  -&gt; residual function :  residual_function 
  -&gt; residuals         :  numerical, min =  0 , mean =  0 , max =  0  
  A new explainer has been created!  </code></pre>
</div>
</div>
<hr>
<p>Finally, we need to define a custom function for our performance metric as well</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>accuracy_wrapper <span class="ot">&lt;-</span> <span class="cf">function</span>(observed, predicted) {</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  observed <span class="ot">&lt;-</span> <span class="fu">fct</span>(<span class="fu">if_else</span>(observed <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"pos"</span>, <span class="st">"neg"</span>),</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"pos"</span>, <span class="st">"neg"</span>))</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  predicted <span class="ot">&lt;-</span> <span class="fu">fct</span>(<span class="fu">if_else</span>(predicted <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="st">"pos"</span>, <span class="st">"neg"</span>), </span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">levels  =</span> <span class="fu">c</span>(<span class="st">"pos"</span>, <span class="st">"neg"</span>))</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy_vec</span>(observed, predicted)</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We are now ready to calculate feature importance metrics</p>
<hr>
<p>Only doing 1 permutation for each feature to keep computational costs lower for this demonstration. In real, life do more!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>imp_permute <span class="ot">&lt;-</span> <span class="fu">cache_rds</span>(</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {<span class="fu">model_parts</span>(explain_test, </span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type =</span> <span class="st">"raw"</span>, </span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">loss_function =</span> accuracy_wrapper,</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">B =</span> <span class="dv">1</span>)</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/012/"</span>,</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"imp_permute"</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Plot top 30 in an informative display</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>imp_permute <span class="sc">|&gt;</span> </span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">!=</span> <span class="st">"_full_model_"</span>,</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>         variable <span class="sc">!=</span> <span class="st">"_baseline_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">fct_reorder</span>(variable, dropout_loss)) <span class="sc">|&gt;</span> </span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">30</span>) <span class="sc">|&gt;</span> </span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                   variable permutation dropout_loss     label
1              tfidf_text_2           0        0.902 model_fit
2        tfidf_text_a great           0        0.902 model_fit
3         tfidf_text_at all           0        0.902 model_fit
4            tfidf_text_and           0        0.903 model_fit
5          tfidf_text_below           0        0.903 model_fit
6         tfidf_text_decent           0        0.903 model_fit
7     tfidf_text_especially           0        0.903 model_fit
8           tfidf_text_true           0        0.903 model_fit
9      tfidf_text_very good           0        0.903 model_fit
10        tfidf_text_actors           0        0.904 model_fit
11           tfidf_text_age           0        0.904 model_fit
12          tfidf_text_aged           0        0.904 model_fit
13        tfidf_text_always           0        0.904 model_fit
14    tfidf_text_an amazing           0        0.904 model_fit
15     tfidf_text_and while           0        0.904 model_fit
16       tfidf_text_appears           0        0.904 model_fit
17         tfidf_text_as he           0        0.904 model_fit
18         tfidf_text_avoid           0        0.904 model_fit
19        tfidf_text_beauty           0        0.904 model_fit
20           tfidf_text_bit           0        0.904 model_fit
21         tfidf_text_bored           0        0.904 model_fit
22        tfidf_text_boring           0        0.904 model_fit
23    tfidf_text_boring and           0        0.904 model_fit
24       tfidf_text_did not           0        0.904 model_fit
25 tfidf_text_disappointing           0        0.904 model_fit
26          tfidf_text_doll           0        0.904 model_fit
27          tfidf_text_door           0        0.904 model_fit
28           tfidf_text_dvd           0        0.904 model_fit
29        tfidf_text_end up           0        0.904 model_fit
30          tfidf_text_good           0        0.904 model_fit</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>imp_permute <span class="sc">|&gt;</span> </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">!=</span> <span class="st">"_full_model_"</span>,</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>         variable <span class="sc">!=</span> <span class="st">"_baseline_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">fct_reorder</span>(variable, dropout_loss, </span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.desc =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">30</span>) <span class="sc">|&gt;</span> </span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  variable permutation dropout_loss     label
1      tfidf_text_anywhere           0        0.908 model_fit
2         tfidf_text_as if           0        0.908 model_fit
3        tfidf_text_as the           0        0.908 model_fit
4          tfidf_text_best           0        0.908 model_fit
5       tfidf_text_blatant           0        0.908 model_fit
6  tfidf_text_disappointed           0        0.908 model_fit
7       tfidf_text_episode           0        0.908 model_fit
8    tfidf_text_first half           0        0.908 model_fit
9         tfidf_text_giant           0        0.908 model_fit
10       tfidf_text_got to           0        0.908 model_fit
11     tfidf_text_help the           0        0.908 model_fit
12     tfidf_text_is still           0        0.908 model_fit
13      tfidf_text_it when           0        0.908 model_fit
14         tfidf_text_jack           0        0.908 model_fit
15         tfidf_text_main           0        0.908 model_fit
16         tfidf_text_meat           0        0.908 model_fit
17           tfidf_text_ok           0        0.908 model_fit
18         tfidf_text_once           0        0.908 model_fit
19       tfidf_text_one of           0        0.908 model_fit
20        tfidf_text_other           0        0.908 model_fit
21      tfidf_text_perfect           0        0.908 model_fit
22         tfidf_text_ship           0        0.908 model_fit
23        tfidf_text_shoot           0        0.908 model_fit
24      tfidf_text_sisters           0        0.908 model_fit
25 tfidf_text_something to           0        0.908 model_fit
26    tfidf_text_the lives           0        0.908 model_fit
27        tfidf_text_tries           0        0.908 model_fit
28     tfidf_text_tries to           0        0.908 model_fit
29    tfidf_text_very well           0        0.908 model_fit
30       tfidf_text_effort           0        0.909 model_fit</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># full_model &lt;- imp_permute |&gt;  </span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    filter(variable == "_full_model_")</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="co"># imp_permute |&gt; </span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(variable != "_full_model_",</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="co">#          variable != "_baseline_") |&gt; </span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(variable = fct_reorder(variable, dropout_loss)) |&gt; </span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(desc(dropout_loss) |&gt;</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice(n = 30) |&gt; </span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(dropout_loss, variable)) +</span></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(data = full_model, aes(xintercept = dropout_loss),</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                linewidth = 1.4, lty = 2, alpha = 0.7) +</span></span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a><span class="co">#    geom_boxplot(fill = "#91CBD765", alpha = 0.4) +</span></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(legend.position = "none") +</span></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a><span class="co">#    labs(x = "accuracy", y = NULL)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-SMLTAR" class="csl-entry" role="listitem">
Hvitfeldt, Emil, and Julia Silge. 2022. <em>Supervised <span>Machine</span> <span>Learning</span> for <span>Text</span> <span>Analysis</span> in <span>R</span></em>. <a href="https://smltar.com/">https://smltar.com/</a>.
</div>
<div id="ref-TMR" class="csl-entry" role="listitem">
Silge, Julia, and David Robinson. 2017. <em>Text <span>Mining</span> with <span>R</span>: <span>A Tidy Approach</span></em>. 1rst ed. <span>Beijing; Boston</span>: <span>O’Reilly Media</span>.
</div>
<div id="ref-RDS" class="csl-entry" role="listitem">
Wickham, Hadley, Çetinkaya-Rundel Mine, and Garrett Grolemund. 2023. <em>R for Data Science: Visualize, Model, Transform, and Import Data</em>. 2nd ed. <a href="https://r4ds.hadley.nz/">https://r4ds.hadley.nz/</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/github\.io\/jjcurtin\/book_iaml");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./l11_explanation.html" class="pagination-link" aria-label="Explanatory Approaches">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Explanatory Approaches</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./l13_applications.html" class="pagination-link" aria-label="Applications for Machine Learning: Synthesis and Concept Generalization">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Applications for Machine Learning: Synthesis and Concept Generalization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jjcurtin/book_iaml/edit/main/l12_nlp.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>