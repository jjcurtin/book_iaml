<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Introduction to Classification Models – Introduction to Applied Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./l05_resampling.html" rel="next">
<link href="./l03_regression.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="book.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./l04_classification.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Applied Machine Learning</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jjcurtin/book_iaml" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./course_materials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Materials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l01_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l02_exploratory_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l03_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l04_classification.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l05_resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resampling Methods for Model Selection and Evaluation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l06_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regularization and Penalized Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l07_midterm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Midterm Exam</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l08_advanced_performance_metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Performance Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l09_random_forest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Models: Decision Trees, Bagging Trees, and Random Forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./review_midterm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Review Midterm Concepts Exam</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_terminology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key Terminology and Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_dummy_coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Novel Levels in Held-Out Set(s)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Principal Components Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_keras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installing Keras for Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_shap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix 3: Understanding Shapley Values from SHAP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_bootstrapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix 4: Bootstrapping Standard Errors &amp; Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Test</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">4.1</span> Learning Objectives</a></li>
  <li><a href="#bayes-classifier" id="toc-bayes-classifier" class="nav-link" data-scroll-target="#bayes-classifier"><span class="header-section-number">4.2</span> Bayes Classifier</a></li>
  <li><a href="#logistic-regression-a-conceptual-review" id="toc-logistic-regression-a-conceptual-review" class="nav-link" data-scroll-target="#logistic-regression-a-conceptual-review"><span class="header-section-number">4.3</span> Logistic Regression: A Conceptual Review</a></li>
  <li><a href="#the-cars-dataset" id="toc-the-cars-dataset" class="nav-link" data-scroll-target="#the-cars-dataset"><span class="header-section-number">4.4</span> The Cars Dataset</a>
  <ul class="collapse">
  <li><a href="#cleaning-eda" id="toc-cleaning-eda" class="nav-link" data-scroll-target="#cleaning-eda"><span class="header-section-number">4.4.1</span> Cleaning EDA</a></li>
  <li><a href="#modeling-eda" id="toc-modeling-eda" class="nav-link" data-scroll-target="#modeling-eda"><span class="header-section-number">4.4.2</span> Modeling EDA</a></li>
  </ul></li>
  <li><a href="#logistic-regression---model-building" id="toc-logistic-regression---model-building" class="nav-link" data-scroll-target="#logistic-regression---model-building"><span class="header-section-number">4.5</span> Logistic Regression - Model Building</a></li>
  <li><a href="#k-nearest-neighbors---a-conceptual-overview" id="toc-k-nearest-neighbors---a-conceptual-overview" class="nav-link" data-scroll-target="#k-nearest-neighbors---a-conceptual-overview"><span class="header-section-number">4.6</span> K Nearest Neighbors - A Conceptual Overview</a></li>
  <li><a href="#a-return-to-cars---now-with-knn" id="toc-a-return-to-cars---now-with-knn" class="nav-link" data-scroll-target="#a-return-to-cars---now-with-knn"><span class="header-section-number">4.7</span> A Return to Cars - Now with KNN</a></li>
  <li><a href="#linear-discriminant-analysis" id="toc-linear-discriminant-analysis" class="nav-link" data-scroll-target="#linear-discriminant-analysis"><span class="header-section-number">4.8</span> Linear Discriminant Analysis</a></li>
  <li><a href="#quadratic-discriminant-analysis" id="toc-quadratic-discriminant-analysis" class="nav-link" data-scroll-target="#quadratic-discriminant-analysis"><span class="header-section-number">4.9</span> Quadratic Discriminant Analysis</a></li>
  <li><a href="#comparisons-between-these-four-classifiers" id="toc-comparisons-between-these-four-classifiers" class="nav-link" data-scroll-target="#comparisons-between-these-four-classifiers"><span class="header-section-number">4.10</span> Comparisons between these four classifiers</a></li>
  <li><a href="#a-quick-tour-of-many-classifiers" id="toc-a-quick-tour-of-many-classifiers" class="nav-link" data-scroll-target="#a-quick-tour-of-many-classifiers"><span class="header-section-number">4.11</span> A quick tour of many classifiers</a>
  <ul class="collapse">
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">4.11.1</span> Logistic Regression</a></li>
  <li><a href="#knn-with-k-5-somewhat-arbitrary-default" id="toc-knn-with-k-5-somewhat-arbitrary-default" class="nav-link" data-scroll-target="#knn-with-k-5-somewhat-arbitrary-default"><span class="header-section-number">4.11.2</span> KNN with K = 5 (somewhat arbitrary default)</a></li>
  <li><a href="#linear-discriminant-analysis-1" id="toc-linear-discriminant-analysis-1" class="nav-link" data-scroll-target="#linear-discriminant-analysis-1"><span class="header-section-number">4.11.3</span> Linear Discriminant Analysis</a></li>
  <li><a href="#regularized-discriminant-analysis" id="toc-regularized-discriminant-analysis" class="nav-link" data-scroll-target="#regularized-discriminant-analysis"><span class="header-section-number">4.11.4</span> Regularized Discriminant Analysis</a></li>
  <li><a href="#naive-bayes-classifier" id="toc-naive-bayes-classifier" class="nav-link" data-scroll-target="#naive-bayes-classifier"><span class="header-section-number">4.11.5</span> Naive Bayes Classifier</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="header-section-number">4.11.6</span> Random Forest</a></li>
  <li><a href="#neural-networks" id="toc-neural-networks" class="nav-link" data-scroll-target="#neural-networks"><span class="header-section-number">4.11.7</span> Neural networks</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jjcurtin/book_iaml/edit/main/l04_classification.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">4.1</span> Learning Objectives</h2>
<ul>
<li>Bayes classifier</li>
<li>Logistic regression
<ul>
<li>probability, odds, and logit models</li>
<li>definitions of odds and odds ratios</li>
</ul></li>
<li>K nearest neighbors for classification</li>
<li>Linear discriminant analysis</li>
<li>Quadratic discriminant analysis</li>
<li>Regularized discriminant analysis</li>
<li>Decision boundaries in the two feature space</li>
<li>Relative costs and benefits of these different statistical algorithms</li>
</ul>
<hr>
</section>
<section id="bayes-classifier" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="bayes-classifier"><span class="header-section-number">4.2</span> Bayes Classifier</h2>
<p>First, lets introduce the Bayes classifier, which is the classifier that will have the lowest error rate of all classifiers using the same set of features.</p>
<p>The figure below displays simulated data for a classification problem for K = 2 classes as a function of <code>X1</code> and <code>X2</code></p>
<p><img src="figs/unit4_two_class_decision_boundry.png" style="height:4in"></p>
<p>The Bayes classifier assigns each observation its most likely class given its conditional probabilities for the values for <code>X1</code> and <code>X2</code></p>
<ul>
<li><span class="math inline">\(Pr(Y = k | X = x_0) for\:k = 1:K\)</span></li>
<li>For K = 2, this means assigning to the class with Pr &gt; .50</li>
<li>This decision boundary for the two class problem is displayed in the figure</li>
</ul>
<hr>
<p>The Bayes classifier provides the minimum error rate for test data</p>
<ul>
<li>Error rate for any <span class="math inline">\(x_0\)</span> will be <span class="math inline">\(1 - max (Pr( Y = k | X = x_0))\)</span></li>
<li>Overall error rate will be the average of this across all possible X</li>
<li>This is the irreducible error for classification problems</li>
<li>This is a theoretical model b/c (except for simulated data), we don’t know the conditional probabilities based on X</li>
<li>Many classification models try to estimate these conditionals</li>
</ul>
<p>Let’s talk now about some of these classification models</p>
<hr>
</section>
<section id="logistic-regression-a-conceptual-review" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="logistic-regression-a-conceptual-review"><span class="header-section-number">4.3</span> Logistic Regression: A Conceptual Review</h2>
<p>Logistic regression (a special case of the <strong>generalized</strong> linear model) estimates the conditional probability for each class given X (a specific set of values for our features)</p>
<ul>
<li>In the binary outcome case, we will often refer to the two outcomes as the positive class and the negative class</li>
<li>This makes most sense in some applied settings where we are most interested in predicting if one of the two classes is likely, e.g.,
<ul>
<li>Presence of heart disease</li>
<li>Positive for some psychiatric diagnoses</li>
<li>Lapse back to alcohol use in people with alcohol use disorder</li>
</ul></li>
</ul>
<hr>
<p>Logistic regression is used frequently for binary and multi-level outcomes because</p>
<ul>
<li>The general linear model makes predictions that are not bounded by [0, 1] and do not represent true estimates of conditional probability for each class</li>
<li>Logistic regression approaches can be modified to accommodate multi-class outcomes (i.e., more than two levels) even when they are not ordered</li>
<li>Nonetheless, the general linear model is still used at times to predict binary outcomes (see <a href="https://en.wikipedia.org/wiki/Linear_probability_model">Linear Probability Model</a>) so you should be aware of it. We won’t discuss it further here.</li>
</ul>
<p><img src="figs/unit4_lm_vs_logistic.png" style="height:4in"></p>
<hr>
<p>Logistic regression provides predicted conditional probabilities for one class (positive class) for any specific set of values for our features (X)</p>
<ul>
<li><p><span class="math inline">\(Pr(positive\:class | X) = \frac{e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}{1 + e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}\)</span></p></li>
<li><p>These conditional probabilities are bounded by [0, 1]</p></li>
<li><p>To maximize accuracy (as per Bayes classifier),</p>
<ul>
<li>we predict the positive case if <span class="math inline">\(Pr(positive class | X) &gt; .5\)</span> for any specific X</li>
<li>otherwise we predict the negative class</li>
</ul></li>
</ul>
<hr>
<p>As a simple parametric model, logistic regression is commonly used for explanatory purposes as well as prediction</p>
<p>For these reasons, it is worthwhile to fully understand how to work with the logistic function to quantify and describe the effects of your features/predictors in terms of</p>
<ul>
<li>Probability</li>
<li>Odds</li>
<li>[Log-odds or logit]</li>
<li>Odds ratio</li>
</ul>
<hr>
<p>The logistic function yields the probability of the positive class given X</p>
<ul>
<li>However, in some instances (e.g., horse racing, poker), it may make more sense to describe the odds of the positive case occurring rather than probability</li>
</ul>
<p>Odds are defined with respect to probabilities as follows:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|X)} {1 - Pr(positive\:class|X)}\)</span></li>
</ul>
<hr>
<p>For example, if the UW Badgers have a .5 probability of winning some upcoming game based on X, their odds of winning are 1 (to 1)</p>
<ul>
<li><span class="math inline">\(\frac{0.5} {1 - 0.5}\)</span></li>
</ul>
<p>If the UW Badgers have a .75 probability of winning some upcoming game based on X, their odds of winning are 3 (:1; ‘3 to 1’)</p>
<ul>
<li><span class="math inline">\(\frac{0.75} {1 - 0.75}\)</span></li>
</ul>
<hr>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the UW Badgers have a .25 probability of winning some upcoming game based on X, what are their odds of winning?</p>
</div>
</div>
<div class="fragment uwred">
<p>.25 / (1 - .25) = 0.33 or 1:3</p>
</div>
<hr>
<p>The logistic function can be modified to provide odds directly:</p>
<p><strong>Logistic function</strong>:</p>
<ul>
<li><span class="math inline">\(Pr(positive\:class | X) = \frac{e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}{1 + e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}}\)</span></li>
</ul>
<p><strong>Definition of odds</strong>:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|X)} {1 - Pr(positive\:class|X)}\)</span></li>
</ul>
<p>Substitute logistic function for <span class="math inline">\(Pr(positive\:class|X)\)</span> on top and bottom and simplify to get:</p>
<ul>
<li><span class="math inline">\(odds(positive\:class|X) = e^{\beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p}\)</span></li>
<li>Odds are bounded by [0, <span class="math inline">\(\infty\)</span>]</li>
</ul>
<hr>
<p>The logistic function can be modified further such that the outcome (log-odds/logit) is a linear function of your features</p>
<p>If we take the natural log (base e) of both sides of the odds equation, we get:</p>
<ul>
<li><span class="math inline">\(log(odds(positive\:class|X)) = \beta_0 + \beta_1*X_1 + \beta_2*X_2 + ... + \beta_p * X_p\)</span></li>
<li>Log-odds are unbounded <span class="math inline">\([-\infty, \infty]\)</span></li>
</ul>
<p>Use of logit transformation:</p>
<ul>
<li>provides the connection between the general linear model and generalized linear models (in this case with link = logit, family = binomial).<br>
</li>
<li>Notice that the logit/log-odds is a linear combination of the features (just like in the general linear model)</li>
</ul>
<hr>
<p><strong>Odds</strong> and <strong>probability</strong> are descriptive but they are not linear functions of X</p>
<ul>
<li>Therefore, parameter estimates from these models aren’t very useful to describe the effect of features</li>
<li>This is because unit change in Y per unit change in any specific feature is not the same for all values of the feature</li>
</ul>
<hr>
<p><strong>Log-odds</strong> are a linear function of X</p>
<ul>
<li>Therefore, you can say that log-odds of positive class increases by <span class="math inline">\(b_1\)</span> (our estimate of <span class="math inline">\(\beta_1\)</span>) for every one unit increase in <span class="math inline">\(x_1\)</span></li>
<li>However, log-odds are NOT very descriptive/intuitive so they are not that useful for explanatory purposes</li>
</ul>
<hr>
<p>The <strong>odds ratio</strong> addresses these problems</p>
<p>Odds are defined at a specific set of values across the features in your model. For example, with one feature:</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|x_1)} {1 - Pr(positive\:class|x_1)}\)</span></li>
</ul>
<p>The odds ratio describes the change in odds for a change of c units in your feature. With some manipulation:</p>
<ul>
<li><span class="math inline">\(Odds\:ratio  =  \frac{odds(x+c)}{odds(x)}\)</span></li>
<li><span class="math inline">\(Odds\:ratio  =  \frac{e^{\beta_0 + \beta_1*(x_1 + c)}}{e^{\beta_0 + \beta_1*x_1}}\)</span></li>
<li><span class="math inline">\(Odds\:ratio  = e^{c*\beta_1}\)</span></li>
</ul>
<hr>
<p>As an example, if we fit a logistic regression model to predict the probability of the Badgers winning a home football game given the attendance (measured in individual spectators at the game), we might find <span class="math inline">\(b_1\)</span> (our estimate of <span class="math inline">\(\beta_1\)</span>) = .000075.</p>
<p>Given this, the odds ratio associated with every increase in 10,000 spectators:</p>
<ul>
<li><span class="math inline">\(= e^{c * \b_1}\)</span></li>
<li><span class="math inline">\(= e^{10000 * .000075}\)</span></li>
<li><span class="math inline">\(= 2.1\)</span></li>
<li>For every increase of 10,000 spectators, the odds of the Badgers winning doubles</li>
</ul>
<hr>
</section>
<section id="the-cars-dataset" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="the-cars-dataset"><span class="header-section-number">4.4</span> The Cars Dataset</h2>
<p>Now, let’s put this all of this together in the Cars dataset from Carnegie Mellon’s <a href="http://lib.stat.cmu.edu/datasets/">StatLib Dataset Archive</a></p>
<p>Our goal is to build a classifier (machine learning model for a categorical outcome) that classifies cars as either high or low mpg.</p>
<hr>
<section id="cleaning-eda" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="cleaning-eda"><span class="header-section-number">4.4.1</span> Cleaning EDA</h3>
<p>Let’s start with some cleaning EDA</p>
<ul>
<li>Open and “skim” it RE variable names, classes &amp; missing data</li>
<li>Variable names are already tidy</li>
<li>no missing data</li>
<li>mins (p0) and maxes(p100) for numeric look good</li>
<li>there are two character variables (<code>mpq</code> and <code>name</code>) that will need to be re-classed</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_all.csv"</span>),</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>data_all <span class="sc">|&gt;</span> <span class="fu">skim_some</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data_all</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">392</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mpg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">name</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">301</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cylinders</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">displacement</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">455.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">horsepower</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">230.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">weight</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1613</td>
<td style="text-align: right;">5140.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acceleration</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">24.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">82.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">origin</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<ul>
<li><code>mpg</code> is ordinal, so lets set the levels to indicate the order.</li>
<li>After reviewing the <a href="data/auto_data_dictionary.pdf">data dictionary</a>, we see that <code>origin</code> is a nominal predictor that is coded numeric (where 1 = American, 2 = European, and 3 = Japanese). Let’s recode as character with meaningful labels and then class as a factor</li>
<li>and lets not forget to re-class <code>name</code> too</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-2-1"><a href="#annotated-cell-2-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-2-2"><a href="#annotated-cell-2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mpg =</span> <span class="fu">factor</span>(mpg, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"high"</span>)),</span>
<span id="annotated-cell-2-3"><a href="#annotated-cell-2-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">factor</span>(name), </span>
<span id="annotated-cell-2-4"><a href="#annotated-cell-2-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">origin =</span> <span class="fu">factor</span> (origin),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-5" class="code-annotation-target"><a href="#annotated-cell-2-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">origin =</span> <span class="fu">fct_recode</span>(<span class="fu">as.character</span>(origin),</span>
<span id="annotated-cell-2-6"><a href="#annotated-cell-2-6" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"american"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="annotated-cell-2-7"><a href="#annotated-cell-2-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"european"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="annotated-cell-2-8"><a href="#annotated-cell-2-8" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"japanese"</span> <span class="ot">=</span> <span class="st">"3"</span>)) </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5" data-code-annotation="1"><code>fct_recode()</code> works on levels stored as characters, so convert 1, 2, 3, to character first.</span>
</dd>
</dl>
</div>
</div>
<hr>
<p>Now, we can explore responses for categorical variables</p>
<ul>
<li>Other than <code>name</code>, responses for all other variables are tidy</li>
<li><code>name</code> has many different responses</li>
<li>We won’t know how to handle this until we get to later units in the class on natural language processing!</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor)) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk</span>(\(column) <span class="fu">print</span>(<span class="fu">levels</span>(column)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "low"  "high"
[1] "american" "european" "japanese"
  [1] "amc ambassador brougham"             
  [2] "amc ambassador dpl"                  
  [3] "amc ambassador sst"                  
  [4] "amc concord"                         
  [5] "amc concord d/l"                     
  [6] "amc concord dl 6"                    
  [7] "amc gremlin"                         
  [8] "amc hornet"                          
  [9] "amc hornet sportabout (sw)"          
 [10] "amc matador"                         
 [11] "amc matador (sw)"                    
 [12] "amc pacer"                           
 [13] "amc pacer d/l"                       
 [14] "amc rebel sst"                       
 [15] "amc spirit dl"                       
 [16] "audi 100 ls"                         
 [17] "audi 100ls"                          
 [18] "audi 4000"                           
 [19] "audi 5000"                           
 [20] "audi 5000s (diesel)"                 
 [21] "audi fox"                            
 [22] "bmw 2002"                            
 [23] "bmw 320i"                            
 [24] "buick century"                       
 [25] "buick century 350"                   
 [26] "buick century limited"               
 [27] "buick century luxus (sw)"            
 [28] "buick century special"               
 [29] "buick electra 225 custom"            
 [30] "buick estate wagon (sw)"             
 [31] "buick lesabre custom"                
 [32] "buick opel isuzu deluxe"             
 [33] "buick regal sport coupe (turbo)"     
 [34] "buick skyhawk"                       
 [35] "buick skylark"                       
 [36] "buick skylark 320"                   
 [37] "buick skylark limited"               
 [38] "cadillac eldorado"                   
 [39] "cadillac seville"                    
 [40] "capri ii"                            
 [41] "chevroelt chevelle malibu"           
 [42] "chevrolet bel air"                   
 [43] "chevrolet camaro"                    
 [44] "chevrolet caprice classic"           
 [45] "chevrolet cavalier"                  
 [46] "chevrolet cavalier 2-door"           
 [47] "chevrolet cavalier wagon"            
 [48] "chevrolet chevelle concours (sw)"    
 [49] "chevrolet chevelle malibu"           
 [50] "chevrolet chevelle malibu classic"   
 [51] "chevrolet chevette"                  
 [52] "chevrolet citation"                  
 [53] "chevrolet concours"                  
 [54] "chevrolet impala"                    
 [55] "chevrolet malibu"                    
 [56] "chevrolet malibu classic (sw)"       
 [57] "chevrolet monte carlo"               
 [58] "chevrolet monte carlo landau"        
 [59] "chevrolet monte carlo s"             
 [60] "chevrolet monza 2+2"                 
 [61] "chevrolet nova"                      
 [62] "chevrolet nova custom"               
 [63] "chevrolet vega"                      
 [64] "chevrolet vega (sw)"                 
 [65] "chevrolet vega 2300"                 
 [66] "chevrolet woody"                     
 [67] "chevy c10"                           
 [68] "chevy c20"                           
 [69] "chevy s-10"                          
 [70] "chrysler cordoba"                    
 [71] "chrysler lebaron medallion"          
 [72] "chrysler lebaron salon"              
 [73] "chrysler lebaron town @ country (sw)"
 [74] "chrysler new yorker brougham"        
 [75] "chrysler newport royal"              
 [76] "datsun 1200"                         
 [77] "datsun 200-sx"                       
 [78] "datsun 200sx"                        
 [79] "datsun 210"                          
 [80] "datsun 210 mpg"                      
 [81] "datsun 280-zx"                       
 [82] "datsun 310"                          
 [83] "datsun 310 gx"                       
 [84] "datsun 510"                          
 [85] "datsun 510 (sw)"                     
 [86] "datsun 510 hatchback"                
 [87] "datsun 610"                          
 [88] "datsun 710"                          
 [89] "datsun 810"                          
 [90] "datsun 810 maxima"                   
 [91] "datsun b-210"                        
 [92] "datsun b210"                         
 [93] "datsun b210 gx"                      
 [94] "datsun f-10 hatchback"               
 [95] "datsun pl510"                        
 [96] "dodge aries se"                      
 [97] "dodge aries wagon (sw)"              
 [98] "dodge aspen"                         
 [99] "dodge aspen 6"                       
[100] "dodge aspen se"                      
[101] "dodge challenger se"                 
[102] "dodge charger 2.2"                   
[103] "dodge colt"                          
[104] "dodge colt (sw)"                     
[105] "dodge colt hardtop"                  
[106] "dodge colt hatchback custom"         
[107] "dodge colt m/m"                      
[108] "dodge coronet brougham"              
[109] "dodge coronet custom"                
[110] "dodge coronet custom (sw)"           
[111] "dodge d100"                          
[112] "dodge d200"                          
[113] "dodge dart custom"                   
[114] "dodge diplomat"                      
[115] "dodge magnum xe"                     
[116] "dodge monaco (sw)"                   
[117] "dodge monaco brougham"               
[118] "dodge omni"                          
[119] "dodge rampage"                       
[120] "dodge st. regis"                     
[121] "fiat 124 sport coupe"                
[122] "fiat 124 tc"                         
[123] "fiat 124b"                           
[124] "fiat 128"                            
[125] "fiat 131"                            
[126] "fiat strada custom"                  
[127] "fiat x1.9"                           
[128] "ford country"                        
[129] "ford country squire (sw)"            
[130] "ford escort 2h"                      
[131] "ford escort 4w"                      
[132] "ford f108"                           
[133] "ford f250"                           
[134] "ford fairmont"                       
[135] "ford fairmont (auto)"                
[136] "ford fairmont (man)"                 
[137] "ford fairmont 4"                     
[138] "ford fairmont futura"                
[139] "ford fiesta"                         
[140] "ford futura"                         
[141] "ford galaxie 500"                    
[142] "ford gran torino"                    
[143] "ford gran torino (sw)"               
[144] "ford granada"                        
[145] "ford granada ghia"                   
[146] "ford granada gl"                     
[147] "ford granada l"                      
[148] "ford ltd"                            
[149] "ford ltd landau"                     
[150] "ford maverick"                       
[151] "ford mustang"                        
[152] "ford mustang gl"                     
[153] "ford mustang ii"                     
[154] "ford mustang ii 2+2"                 
[155] "ford pinto"                          
[156] "ford pinto (sw)"                     
[157] "ford pinto runabout"                 
[158] "ford ranger"                         
[159] "ford thunderbird"                    
[160] "ford torino"                         
[161] "ford torino 500"                     
[162] "hi 1200d"                            
[163] "honda accord"                        
[164] "honda accord cvcc"                   
[165] "honda accord lx"                     
[166] "honda civic"                         
[167] "honda civic (auto)"                  
[168] "honda civic 1300"                    
[169] "honda civic 1500 gl"                 
[170] "honda civic cvcc"                    
[171] "honda prelude"                       
[172] "maxda glc deluxe"                    
[173] "maxda rx3"                           
[174] "mazda 626"                           
[175] "mazda glc"                           
[176] "mazda glc 4"                         
[177] "mazda glc custom"                    
[178] "mazda glc custom l"                  
[179] "mazda glc deluxe"                    
[180] "mazda rx-4"                          
[181] "mazda rx-7 gs"                       
[182] "mazda rx2 coupe"                     
[183] "mercedes benz 300d"                  
[184] "mercedes-benz 240d"                  
[185] "mercedes-benz 280s"                  
[186] "mercury capri 2000"                  
[187] "mercury capri v6"                    
[188] "mercury cougar brougham"             
[189] "mercury grand marquis"               
[190] "mercury lynx l"                      
[191] "mercury marquis"                     
[192] "mercury marquis brougham"            
[193] "mercury monarch"                     
[194] "mercury monarch ghia"                
[195] "mercury zephyr"                      
[196] "mercury zephyr 6"                    
[197] "nissan stanza xe"                    
[198] "oldsmobile cutlass ciera (diesel)"   
[199] "oldsmobile cutlass ls"               
[200] "oldsmobile cutlass salon brougham"   
[201] "oldsmobile cutlass supreme"          
[202] "oldsmobile delta 88 royale"          
[203] "oldsmobile omega"                    
[204] "oldsmobile omega brougham"           
[205] "oldsmobile starfire sx"              
[206] "oldsmobile vista cruiser"            
[207] "opel 1900"                           
[208] "opel manta"                          
[209] "peugeot 304"                         
[210] "peugeot 504"                         
[211] "peugeot 504 (sw)"                    
[212] "peugeot 505s turbo diesel"           
[213] "peugeot 604sl"                       
[214] "plymouth 'cuda 340"                  
[215] "plymouth arrow gs"                   
[216] "plymouth champ"                      
[217] "plymouth cricket"                    
[218] "plymouth custom suburb"              
[219] "plymouth duster"                     
[220] "plymouth fury"                       
[221] "plymouth fury gran sedan"            
[222] "plymouth fury iii"                   
[223] "plymouth grand fury"                 
[224] "plymouth horizon"                    
[225] "plymouth horizon 4"                  
[226] "plymouth horizon miser"              
[227] "plymouth horizon tc3"                
[228] "plymouth reliant"                    
[229] "plymouth sapporo"                    
[230] "plymouth satellite"                  
[231] "plymouth satellite custom"           
[232] "plymouth satellite custom (sw)"      
[233] "plymouth satellite sebring"          
[234] "plymouth valiant"                    
[235] "plymouth valiant custom"             
[236] "plymouth volare"                     
[237] "plymouth volare custom"              
[238] "plymouth volare premier v8"          
[239] "pontiac astro"                       
[240] "pontiac catalina"                    
[241] "pontiac catalina brougham"           
[242] "pontiac firebird"                    
[243] "pontiac grand prix"                  
[244] "pontiac grand prix lj"               
[245] "pontiac j2000 se hatchback"          
[246] "pontiac lemans v6"                   
[247] "pontiac phoenix"                     
[248] "pontiac phoenix lj"                  
[249] "pontiac safari (sw)"                 
[250] "pontiac sunbird coupe"               
[251] "pontiac ventura sj"                  
[252] "renault 12 (sw)"                     
[253] "renault 12tl"                        
[254] "renault 5 gtl"                       
[255] "saab 99e"                            
[256] "saab 99gle"                          
[257] "saab 99le"                           
[258] "subaru"                              
[259] "subaru dl"                           
[260] "toyota carina"                       
[261] "toyota celica gt"                    
[262] "toyota celica gt liftback"           
[263] "toyota corolla"                      
[264] "toyota corolla 1200"                 
[265] "toyota corolla 1600 (sw)"            
[266] "toyota corolla liftback"             
[267] "toyota corolla tercel"               
[268] "toyota corona"                       
[269] "toyota corona hardtop"               
[270] "toyota corona liftback"              
[271] "toyota corona mark ii"               
[272] "toyota cressida"                     
[273] "toyota mark ii"                      
[274] "toyota starlet"                      
[275] "toyota tercel"                       
[276] "toyouta corona mark ii (sw)"         
[277] "triumph tr7 coupe"                   
[278] "vokswagen rabbit"                    
[279] "volkswagen 1131 deluxe sedan"        
[280] "volkswagen 411 (sw)"                 
[281] "volkswagen dasher"                   
[282] "volkswagen jetta"                    
[283] "volkswagen model 111"                
[284] "volkswagen rabbit"                   
[285] "volkswagen rabbit custom"            
[286] "volkswagen rabbit custom diesel"     
[287] "volkswagen rabbit l"                 
[288] "volkswagen scirocco"                 
[289] "volkswagen super beetle"             
[290] "volkswagen type 3"                   
[291] "volvo 144ea"                         
[292] "volvo 145e (sw)"                     
[293] "volvo 244dl"                         
[294] "volvo 245"                           
[295] "volvo 264gl"                         
[296] "volvo diesel"                        
[297] "vw dasher (diesel)"                  
[298] "vw pickup"                           
[299] "vw rabbit"                           
[300] "vw rabbit c (diesel)"                
[301] "vw rabbit custom"                    </code></pre>
</div>
</div>
<ul>
<li>Remove <code>name</code></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Finally, let’s make and save our training and validation sets. If we were doing model building for prediction we would also need a test set but we will focus this unit on just selecting the best model but not rigorously evaluating it.</p>
<ul>
<li>Let’s use a 75/25 split, stratified on <code>mpg</code></li>
<li>Don’t forget to set a seed in case you need to re-split again in the future!</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20110522</span>) </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> data_all <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initial_split</span>(<span class="at">prop =</span> .<span class="dv">75</span>, <span class="at">strata =</span> <span class="st">"mpg"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>splits <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">analysis</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_trn.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 294
Columns: 8
$ mpg          &lt;fct&gt; high, high, high, high, high, high, high, high, high, hig…
$ cylinders    &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, …
$ displacement &lt;dbl&gt; 113.0, 97.0, 97.0, 110.0, 107.0, 104.0, 121.0, 97.0, 140.…
$ horsepower   &lt;dbl&gt; 95, 88, 46, 87, 90, 95, 113, 88, 90, 95, 86, 90, 70, 76, …
$ weight       &lt;dbl&gt; 2372, 2130, 1835, 2672, 2430, 2375, 2234, 2130, 2264, 222…
$ acceleration &lt;dbl&gt; 15.0, 14.5, 20.5, 17.5, 14.5, 17.5, 12.5, 14.5, 15.5, 14.…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 7…
$ origin       &lt;fct&gt; japanese, japanese, european, european, european, europea…</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>splits <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assessment</span>() <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>() <span class="sc">|&gt;</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_val.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 98
Columns: 8
$ mpg          &lt;fct&gt; low, low, low, low, low, low, low, low, low, low, low, lo…
$ cylinders    &lt;dbl&gt; 8, 8, 8, 8, 8, 6, 6, 6, 6, 8, 8, 4, 4, 4, 8, 8, 8, 4, 8, …
$ displacement &lt;dbl&gt; 350, 304, 302, 440, 455, 198, 200, 225, 250, 400, 318, 14…
$ horsepower   &lt;dbl&gt; 165, 150, 140, 215, 225, 95, 85, 105, 100, 175, 150, 72, …
$ weight       &lt;dbl&gt; 3693, 3433, 3449, 4312, 4425, 2833, 2587, 3439, 3329, 446…
$ acceleration &lt;dbl&gt; 11.5, 12.0, 10.5, 8.5, 10.0, 15.5, 16.0, 15.5, 15.5, 11.5…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 72, 7…
$ origin       &lt;fct&gt; american, american, american, american, american, america…</code></pre>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>Any concerns about using this training-validation split?</p>
</div>
</div>
<div class="fragment uwred">
<p>These sample sizes are starting to get a little small. Fitted models will have higher variance with only 75% (N = 294) observations and performance in validation (with only N = 98 observations) may not be a very precise estimate of true validation error. We will learn more robust methods in the unit on resampling.</p>
</div>
<hr>
</section>
<section id="modeling-eda" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="modeling-eda"><span class="header-section-number">4.4.2</span> Modeling EDA</h3>
<p>Let’s do some quick modeling EDA to get a sense of the data.</p>
<ul>
<li>We will keep it quick and dirty.</li>
<li>First, we should make a function to class Cars since we may open it frequently</li>
<li>Even though its simple, still better this way (e.g., what if we decide to change how to handle classing - will only need to make that change in one place!)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>class_cars <span class="ot">&lt;-</span> <span class="cf">function</span>(d) { </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mpg =</span> <span class="fu">factor</span>(mpg, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"high"</span>)),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">origin =</span> <span class="fu">factor</span> (origin))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Open train (we don’t need validate for modeling EDA)</li>
<li>[We are pretending this is a new script….]</li>
<li>Class the predictors</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_trn.csv"</span>),</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class_cars</span>() <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 294
Columns: 8
$ mpg          &lt;fct&gt; high, high, high, high, high, high, high, high, high, hig…
$ cylinders    &lt;dbl&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, …
$ displacement &lt;dbl&gt; 113.0, 97.0, 97.0, 110.0, 107.0, 104.0, 121.0, 97.0, 140.…
$ horsepower   &lt;dbl&gt; 95, 88, 46, 87, 90, 95, 113, 88, 90, 95, 86, 90, 70, 76, …
$ weight       &lt;dbl&gt; 2372, 2130, 1835, 2672, 2430, 2375, 2234, 2130, 2264, 222…
$ acceleration &lt;dbl&gt; 15.0, 14.5, 20.5, 17.5, 14.5, 17.5, 12.5, 14.5, 15.5, 14.…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 7…
$ origin       &lt;fct&gt; japanese, japanese, european, european, european, europea…</code></pre>
</div>
</div>
<hr>
<ul>
<li>Bar plot for outcome
<ul>
<li>Outcome is balanced</li>
<li>Unbalanced outcomes can be more complicated (more on this later)</li>
</ul></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">plot_bar</span>(<span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<ul>
<li>Grouped (by <code>mpg</code>) box/violin plots for numeric predictors</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(name) <span class="fu">plot_grouped_box_violin</span>(<span class="at">df =</span> data_trn, <span class="at">x =</span> <span class="st">"mpg"</span>, <span class="at">y =</span> name)) <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> _, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<ul>
<li>Grouped barplot for origin</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grouped_barplot_percent</span>(<span class="at">x =</span> <span class="st">"origin"</span>, <span class="at">y =</span> <span class="st">"mpg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grouped_barplot_percent</span>(<span class="at">x =</span> <span class="st">"mpg"</span>, <span class="at">y =</span> <span class="st">"origin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<ul>
<li>Correlation plots for numeric</li>
<li>Can dummy code categorical predictors to examine correlations (point biserial, phi) including them</li>
<li>We will do this manually using tidyverse here.</li>
<li>Set american to be reference level (its the first level)</li>
<li><code>cylinders</code>, <code>displacement</code>, <code>horsepower</code>, and <code>weight</code> are all essentially the same construct (big, beefy car!)</li>
<li>All are strongly correlated with <code>mpg</code></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-13-2" class="code-annotation-target"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mpg_high =</span> <span class="fu">if_else</span>(mpg <span class="sc">==</span> <span class="st">"high"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="annotated-cell-13-3"><a href="#annotated-cell-13-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">origin_japan =</span> <span class="fu">if_else</span>(origin <span class="sc">==</span> <span class="st">"japanese"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="annotated-cell-13-4"><a href="#annotated-cell-13-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">origin_europe =</span> <span class="fu">if_else</span>(origin <span class="sc">==</span> <span class="st">"european"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-13-5" class="code-annotation-target"><a href="#annotated-cell-13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>origin, <span class="sc">-</span>mpg) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-13-6"><a href="#annotated-cell-13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-13-7"><a href="#annotated-cell-13-7" aria-hidden="true" tabindex="-1"></a>  corrplot<span class="sc">::</span><span class="fu">corrplot.mixed</span>() </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="2" data-code-annotation="1">If manually coding a binary outcome variable, best practice is to set the positive class to be 1</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="5" data-code-annotation="2">Remove <code>origin</code> and <code>mpg</code> after converting to dummy-coded features</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-13-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="logistic-regression---model-building" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="logistic-regression---model-building"><span class="header-section-number">4.5</span> Logistic Regression - Model Building</h2>
<p>Now that we understand our data a little better, let’s build some models</p>
<p>Let’s also try to simultaneously pretend that we:</p>
<ol type="1">
<li>Are building and selecting a best prediction model that will be evaluated with some additional held out test data (how bad would it have been to split into three sets??!!)</li>
<li>Have an explanatory question about production <code>year</code> - Are we more likely to have efficient cars more recently because of improvements in “technology”, above and beyond broad car characteristics (e.g., the easy stuff like <code>weight</code>, <code>displacement</code>, etc.)</li>
</ol>
<p>To be clear, prediction and explanation goals are often separate (though prediction is an important foundation explanation)</p>
<hr>
<p>Either way, we need a validation set</p>
<ul>
<li>Open it and class variables</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data_val <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(path_data, <span class="st">"auto_val.csv"</span>),</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_type =</span> <span class="fu">cols</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class_cars</span>() <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 98
Columns: 8
$ mpg          &lt;fct&gt; low, low, low, low, low, low, low, low, low, low, low, lo…
$ cylinders    &lt;dbl&gt; 8, 8, 8, 8, 8, 6, 6, 6, 6, 8, 8, 4, 4, 4, 8, 8, 8, 4, 8, …
$ displacement &lt;dbl&gt; 350, 304, 302, 440, 455, 198, 200, 225, 250, 400, 318, 14…
$ horsepower   &lt;dbl&gt; 165, 150, 140, 215, 225, 95, 85, 105, 100, 175, 150, 72, …
$ weight       &lt;dbl&gt; 3693, 3433, 3449, 4312, 4425, 2833, 2587, 3439, 3329, 446…
$ acceleration &lt;dbl&gt; 11.5, 12.0, 10.5, 8.5, 10.0, 15.5, 16.0, 15.5, 15.5, 11.5…
$ year         &lt;dbl&gt; 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 72, 7…
$ origin       &lt;fct&gt; american, american, american, american, american, america…</code></pre>
</div>
</div>
<hr>
<p>Let’s predict high <code>mpg</code> from car beefiness and <code>year</code></p>
<p>We likely want to combine the beefy variables into one construct/factor (<code>beef</code>)</p>
<ul>
<li>We can use PCA to extract one factor</li>
<li>Input variables should be centered and scaled for PCA. Easy peasy</li>
<li>PCA will be calculated with <code>data_trn</code> during <code>prep()</code>. These statistics from <code>data_trn</code> will be used to <code>bake()</code></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-1" class="code-annotation-target"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-15-2"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight, </span>
<span id="annotated-cell-15-3"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="annotated-cell-15-4"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-15-5" class="code-annotation-target"><a href="#annotated-cell-15-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prefix =</span> <span class="st">"beef_"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="1" data-code-annotation="1">Using <code>.</code> now in the recipe to leave all variables in the feature matrix. We can later select the ones we want use for prediction</span>
</dd>
<dt data-target-cell="annotated-cell-15" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="5" data-code-annotation="2">We will have one PCA component, it will be called <code>beef_1</code></span>
</dd>
</dl>
</div>
</div>
<hr>
<p>Now, <code>prep()</code> the recipe and <code>bake()</code> some feature for training and validation sets</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="cn">NULL</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Lets skim our training features</li>
<li>We can see there are features in there we won’t use</li>
<li><code>mpg</code>, <code>year</code>, and <code>beef_1</code> look good</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="sc">|&gt;</span> <span class="fu">skim_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">feat_trn</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">294</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">origin</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">ame: 187, jap: 56, eur: 51</td>
</tr>
<tr class="even">
<td style="text-align: left;">mpg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">low: 147, hig: 147</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: right;">skew</th>
<th style="text-align: right;">kurtosis</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">acceleration</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15.54</td>
<td style="text-align: right;">2.64</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">14.00</td>
<td style="text-align: right;">15.50</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: right;">24.80</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.58</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">75.94</td>
<td style="text-align: right;">3.68</td>
<td style="text-align: right;">70.00</td>
<td style="text-align: right;">73.00</td>
<td style="text-align: right;">76.00</td>
<td style="text-align: right;">79.0</td>
<td style="text-align: right;">82.00</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">-1.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beef_1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.92</td>
<td style="text-align: right;">-2.36</td>
<td style="text-align: right;">-1.64</td>
<td style="text-align: right;">-0.85</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">4.36</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">-0.96</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<ul>
<li>Fit the model configuration in train</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-18"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-18-1"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a>fit_lr_2 <span class="ot">&lt;-</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-18-2" class="code-annotation-target"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-18-3" class="code-annotation-target"><a href="#annotated-cell-18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-18" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-18-4" class="code-annotation-target"><a href="#annotated-cell-18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="2" data-code-annotation="1">category of algorithm is logistic regression</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="3" data-code-annotation="2">Set engine to be generalized linear model. No need to `set_mode(“classification”) because logistic regression glm is only used for classification</span>
</dd>
<dt data-target-cell="annotated-cell-18" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="4" data-code-annotation="3">Notice that we explicitly indicate which features to use because our feature matrix has more than just these two in it because we used <code>.</code> in our recipe and our datasets have more columns.</span>
</dd>
</dl>
</div>
</div>
<hr>
<p>Let’s look at the logistic model and its parameter estimates from train</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fit_lr_2 <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -23.4      5.55       -4.23 2.38e- 5
2 beef_1        -2.49     0.316      -7.87 3.49e-15
3 year           0.292    0.0718      4.07 4.71e- 5</code></pre>
</div>
</div>
<p><span class="math inline">\(Pr(high|(beef, year)) = \frac{e^{b0 + b1*beef + b2*year}}{1 + e^{b0 + b1*beef  + b2*year}}\)</span></p>
<hr>
<p>Use <code>predict()</code> to get <span class="math inline">\(Pr(high|year)\)</span> (<strong>or predicted class</strong>, more on that later) directly from the model for any data</p>
<ul>
<li>First make a dataframe for feature values for prediction</li>
<li>We will use this for a plot</li>
<li>Get probabilities for a range of years (incrementing by .1 year)</li>
<li>Hold beef constant at its mean</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="fu">min</span>(feat_val<span class="sc">$</span>year), <span class="fu">max</span>(feat_val<span class="sc">$</span>year), .<span class="dv">1</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">beef_1 =</span> <span class="fu">mean</span>(feat_val<span class="sc">$</span>beef_1)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p><code>predict()</code> will:</p>
<ul>
<li>Give us probabilities for high and low (<code>type = "prob"</code>). We will select out the low columns</li>
<li>Also provides the 95% conf int around these probabilities (<code>type = "conf_int"</code>)</li>
<li>Ambiguity is removed by their choice to label by the actual outcome labels (Nice!)</li>
<li>We will bind these predictions to the dataframe we made above</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lr_2, <span class="at">new_data =</span> p_high, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lr_2, <span class="at">new_data =</span> p_high, <span class="at">type =</span> <span class="st">"conf_int"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.pred_low, <span class="sc">-</span>.pred_lower_low, <span class="sc">-</span>.pred_upper_low) <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 121
Columns: 5
$ year             &lt;dbl&gt; 70.0, 70.1, 70.2, 70.3, 70.4, 70.5, 70.6, 70.7, 70.8,…
$ beef_1           &lt;dbl&gt; 0.008438869, 0.008438869, 0.008438869, 0.008438869, 0…
$ .pred_high       &lt;dbl&gt; 0.04733721, 0.04867270, 0.05004389, 0.05145161, 0.052…
$ .pred_lower_high &lt;dbl&gt; 0.01495325, 0.01557265, 0.01621651, 0.01688572, 0.017…
$ .pred_upper_high &lt;dbl&gt; 0.1398943, 0.1419807, 0.1440989, 0.1462495, 0.1484331…</code></pre>
</div>
</div>
<hr>
<p>Here is a quick look at the head</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   year  beef_1 .pred_high .pred_lower_high .pred_upper_high
  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
1  70   0.00844     0.0473           0.0150            0.140
2  70.1 0.00844     0.0487           0.0156            0.142
3  70.2 0.00844     0.0500           0.0162            0.144
4  70.3 0.00844     0.0515           0.0169            0.146
5  70.4 0.00844     0.0529           0.0176            0.148
6  70.5 0.00844     0.0544           0.0183            0.151</code></pre>
</div>
</div>
<hr>
<p>Can plot this relationship using the predicted probabilities</p>
<ul>
<li>plot both prediction line</li>
<li>and observed Y (with a little jitter)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> feat_val, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="fu">as.numeric</span>(mpg) <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> p_high, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .pred_high)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> p_high, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">ymin =</span> .pred_lower_high, <span class="at">ymax =</span> .pred_upper_high), </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">70</span>,<span class="dv">82</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pr(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Can plot odds instead of probabilities using odds equation and coefficients from the model</p>
<ul>
<li><span class="math inline">\(odds = \frac{Pr(positive\:class|x_1)} {1 - Pr(positive\:class|x_1)}\)</span></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.odds_high =</span> .pred_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_high),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">.odds_lower_high =</span> .pred_lower_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_lower_high),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.odds_upper_high =</span> .pred_upper_high <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .pred_upper_high))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>NOTE: Harder to also plot raw data as scatter plot when plotting odds vs.&nbsp;probabilities. Maybe use second Y axis?</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .odds_high)) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">ymin =</span> .odds_lower_high, <span class="at">ymax =</span> .odds_upper_high), </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">70</span>, <span class="dv">82</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Odds(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Odds ratio for year:</p>
<ul>
<li><span class="math inline">\(Odds\:ratio  = e^{c*\beta_1}\)</span></li>
</ul>
<p>Get the parameter estimate/coefficient from the model</p>
<ul>
<li>For every one year increase (holding beef constant), the odds of a car being categorized as high mpg increase by a factor of 1.3394301</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">get_estimate</span>(fit_lr_2, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.33943</code></pre>
</div>
</div>
<hr>
<p>You can do this for other values of c as well (not really needed here because a 1 year unit makes sense)</p>
<ul>
<li><span class="math inline">\(Odds\:ratio  = e^{c*\beta_1}\)</span></li>
<li>For every 10 year increase (holding beef constant), the odds of a car being categorized as high mpg increase by a factor of 18.5866278</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">10</span> <span class="sc">*</span> <span class="fu">get_estimate</span>(fit_lr_2, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18.58663</code></pre>
</div>
</div>
<hr>
<p>Testing parameter estimates</p>
<ul>
<li><code>tidy()</code> provides z-tests for the parameter estimates</li>
<li>This is NOT the recommended statistical test from 610</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit_lr_2 <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -23.4      5.55       -4.23 2.38e- 5
2 beef_1        -2.49     0.316      -7.87 3.49e-15
3 year           0.292    0.0718      4.07 4.71e- 5</code></pre>
</div>
</div>
<hr>
<p>The preferred test for parameter estimates from logistic regression is the likelihood ratio test</p>
<ul>
<li>You can get this using <code>Anova()</code> from the <code>car</code> package (as you learn in 610/710)</li>
<li>The glm object is returned using $fit</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_2<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
       LR Chisq Df Pr(&gt;Chisq)    
beef_1  239.721  1  &lt; 2.2e-16 ***
year     20.317  1  6.562e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<hr>
<p>Accuracy is a very common performance metric for classification models</p>
<p>How accurate is our two feature model?</p>
<ul>
<li>Note the use of <code>type = "class"</code></li>
</ul>
<p>We can calculate accuracy in the training set. This may be somewhat overfit and optimistic!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_trn, <span class="at">type =</span> <span class="st">"class"</span>)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9217687</code></pre>
</div>
</div>
<hr>
<p>And in the validation set (better estimate of performance in new data. Though if we use this set multiple times to select a best configuration, it will become overfit eventually too!)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_val, <span class="at">type =</span> <span class="st">"class"</span>)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<p>You can see some evidence of over-fitting to the training set in that model performance is a bit lower in validation</p>
<hr>
<p>Let’s take a look at the decision boundary for this model in the validation set</p>
<p>We need a function to plot the decision boundary <strong>because we will use it repeatedly</strong> to compare decision boundaries across statistical models</p>
<ul>
<li>Displayed here as another example of a function that uses quoted variable names</li>
<li>This function is useful for book examples with two features.<br>
</li>
<li>Only can be used with two features, so not that useful in real life!</li>
<li>Not included in my function scripts (just here to help you understand the material)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plot_decision_boundary <span class="ot">&lt;-</span> <span class="cf">function</span>(data, model, x_names, y_name, <span class="at">n_points =</span> <span class="dv">100</span>) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  preds <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data[[x_names[<span class="dv">1</span>]]]), </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">max</span>(data[[x_names[<span class="dv">1</span>]]]), </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">length =</span> n_points),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data[[x_names[<span class="dv">2</span>]]]), </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">max</span>(data[[x_names[<span class="dv">2</span>]]]), </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">length =</span> n_points))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(preds) <span class="ot">&lt;-</span> x_names</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  preds[[y_name]] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, preds)<span class="sc">$</span>.pred_class</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  preds[[y_name]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(preds[[y_name]])<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> .data[[x_names[<span class="dv">1</span>]]], </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> .data[[x_names[<span class="dv">2</span>]]], </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> .data[[y_name]])) <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_contour</span>(<span class="at">data =</span> preds, </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> .data[[x_names[<span class="dv">1</span>]]], </span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> .data[[x_names[<span class="dv">2</span>]]], </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">z =</span> .data[[y_name]]), </span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">breaks =</span> .<span class="dv">5</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> x_names[<span class="dv">1</span>], <span class="at">y =</span> x_names[<span class="dv">2</span>], <span class="at">color =</span> y_name) </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Logistic regression produces a linear decision boundary when you consider a scatter plot of the points by the two features.</p>
<ul>
<li>Points on one side of the line are assigned to one class and points on the other side of the line are assigned to the other class.<br>
</li>
<li>This decision boundary would be a plane if there were three features Harder to visualize in higher dimensional space.</li>
<li>We will contrast this decision boundary from logistic regression with other statistical algorithms in a bit.</li>
</ul>
<p>Here is the decision boundary for this model in both train and validation sets</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-34-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>What if you wanted to try to improve our predictions?</p>
<ul>
<li>You could find the best set of covariates to test the effect of year. [Assuming the best covariates are those that account for the most variance in mpg]?</li>
<li>For either prediction or explanation, you need to find this best model</li>
</ul>
<p>We can compare model performance in validation set to find this best model</p>
<ul>
<li>We can use that one for our prediction goal</li>
<li>We can test the effect of year in that model for our explanation goal
<ul>
<li>This is a principled way to decide on the best model for our explanatory goal (vs.&nbsp;p-hacking)</li>
<li>We get to explore and we end up with the best model to provide our focal test</li>
</ul></li>
</ul>
<hr>
<p>Let’s quickly fit another model we might have considered.</p>
<ul>
<li>This model will contain the 4 variables from our PCA but as individual features rather than one PCA component score (<code>beef</code>)</li>
<li>Make features for this model
<ul>
<li>No feature engineering needed because raw variables are all numeric already)</li>
<li>We will give the features dfs new names to retain the old features that included <code>beef_1</code></li>
</ul></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>rec_raw <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>rec_raw_prep <span class="ot">&lt;-</span> rec_raw <span class="sc">|&gt;</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>feat_raw_trn <span class="ot">&lt;-</span> rec_raw_prep <span class="sc">|&gt;</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="cn">NULL</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>feat_raw_val <span class="ot">&lt;-</span> rec_raw_prep <span class="sc">|&gt;</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Fit PCA features individually + year</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fit_lr_raw <span class="ot">&lt;-</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> cylinders <span class="sc">+</span> displacement <span class="sc">+</span> horsepower <span class="sc">+</span> weight <span class="sc">+</span> year, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> feat_raw_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Which is the best prediction model?</p>
<ul>
<li>Beef PCA</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<ul>
<li>Individual raw features from PCA</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_raw_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lr_raw, feat_raw_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8673469</code></pre>
</div>
</div>
<p>The PCA beef model fits best. The model with individual features likely increases overfitting a bit but doesn’t yield a reduction in bias because all the other variables are so highly correlated.</p>
<hr>
<p><code>fit_lr_2</code> is your choice for best model for prediction (at least it is descriptively better)</p>
<p>If you had an explanatory question about <code>year</code>, how would you have chosen between these two tests of <code>year</code> in these two different but all reasonable models</p>
<ul>
<li>You might have chose the model with individual features because the effect of year is stronger.<br>
</li>
<li>That is NOT the model that comes closes to the DGP.<br>
</li>
<li>We believe the appropriate model is the beef model that has higher overall accuracy!</li>
<li>This is a start for us to start to consider the use of resampling methods to make decisions about how to best pursue explanatory goals.</li>
<li>Could you now test your <code>year</code> effect in the full sample? Let’s discuss.</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_2<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
       LR Chisq Df Pr(&gt;Chisq)    
beef_1  239.721  1  &lt; 2.2e-16 ***
year     20.317  1  6.562e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fit_lr_raw<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type III tests)

Response: mpg
             LR Chisq Df Pr(&gt;Chisq)    
cylinders      0.4199  1    0.51697    
displacement   1.3239  1    0.24990    
horsepower     6.4414  1    0.01115 *  
weight        15.6669  1  7.553e-05 ***
year          27.0895  1  1.942e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<hr>
</section>
<section id="k-nearest-neighbors---a-conceptual-overview" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="k-nearest-neighbors---a-conceptual-overview"><span class="header-section-number">4.6</span> K Nearest Neighbors - A Conceptual Overview</h2>
<p>Let’s switch gears to a non-parametric method we already know - KNN.</p>
<ul>
<li><p>KNN can be used as a classifier as well as for regression problems</p></li>
<li><p>KNN tries to determine conditional class possibilities for any set of features by looking at observed classes for similar values of for these features in the training set</p></li>
</ul>
<hr>
<p>This figure illustrates the application of 3-NN to a small sample training set (N = 12) with 2 predictors</p>
<ul>
<li>For test observation X in the left panel, we would predict class = blue because blue is the majority class (highest probability) among the 3 nearest training observations</li>
<li>If we calculated these probabilities for all possible combinations of the two predictors in the training set, it would yield the decision boundaries depicted in the right panel</li>
</ul>
<p><img src="figs/unit4_knn_example.png" style="height:4in"></p>
<hr>
<p>KNN can produce complex decision boundaries</p>
<ul>
<li>This makes it flexible (can reduce bias)</li>
<li>This makes it susceptible to variance/overfitting problems</li>
</ul>
<p>Remember that we can control this bias-variance trade-off with K.</p>
<ul>
<li>As K increases, variance reduces (but bias may increase).<br>
</li>
<li>As K decreases, bias may be reduced but variance increases.</li>
<li>Choose a K that produces good performance in new (validation) data</li>
</ul>
<hr>
<p>These figures depict the KNN (and Bayes classifier) decision boundaries for the earlier simulated 2 class problem with <code>X1</code> and <code>X2</code></p>
<ul>
<li>K = 10 appears to provide the sweet spot b/c it closely approximates the Bayes decision boundary</li>
<li>Of course, you wouldn’t know the true Bayes decision boundary if the data were real (not simulated)</li>
<li>But K = 10 would also yield the lowest test error (which is how it should be chosen)
<ul>
<li>Bayes classifier test error: .1304</li>
<li>K = 10 test error: .1363</li>
<li>K = 1 test error: .1695</li>
<li>K = 100 test err: .1925</li>
</ul></li>
</ul>
<p><img src="figs/unit4_knn_k.png" style="height:4in"></p>
<p><img src="figs/unit4_knn_k_2.png" style="height:4in"></p>
<hr>
<p>You can NOT make the decision about K based on training error</p>
<p>This figure depicts training and test error for simulated data example as function of 1/K</p>
<ul>
<li><p>Training error decreases as 1/K increases. At 1 (K=1) training error is 0</p></li>
<li><p>Test error shows expected inverted U</p>
<ul>
<li>For high K (left side), error is high because of high variance</li>
<li>As move right (lower K), variance is reduced rapidly with little increase in bias. Error is reduced.</li>
<li>Eventually, there is diminishing return from reducing variance but bias starts to increase rapidly. Error increases again.</li>
</ul></li>
</ul>
<p><img src="figs/unit4_knn_error.png" style="height:4in"></p>
<hr>
</section>
<section id="a-return-to-cars---now-with-knn" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="a-return-to-cars---now-with-knn"><span class="header-section-number">4.7</span> A Return to Cars - Now with KNN</h2>
<p>Let’s demonstrate KNN using the Cars dataset</p>
<ul>
<li>Calculate <code>beef_1</code> PCA component</li>
<li>Scale both features</li>
<li>Make train and validation feature matrices</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, <span class="at">prefix =</span> <span class="st">"beef_"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(year, beef_1)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(<span class="at">data =</span> data_trn)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="cn">NULL</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Fit models with varying K.</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-41"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-41-1"><a href="#annotated-cell-41-1" aria-hidden="true" tabindex="-1"></a>fit_1nn_2 <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-41-2"><a href="#annotated-cell-41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-41-3"><a href="#annotated-cell-41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-41" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-41-4" class="code-annotation-target"><a href="#annotated-cell-41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-41-5"><a href="#annotated-cell-41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-41" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-41" data-code-lines="4" data-code-annotation="1">Notice that we now use <code>set_mode("classification")</code></span>
</dd>
</dl>
</div>
</div>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fit_5nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>K = 10</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fit_10nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fit_20nn_2 <span class="ot">&lt;-</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Of course, training accuracy goes down with decreasing flexibility as k increases</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_1nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_5nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9489796</code></pre>
</div>
</div>
<ul>
<li>K = 10</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_10nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9455782</code></pre>
</div>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_trn<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_20nn_2, feat_trn)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9285714</code></pre>
</div>
</div>
<hr>
<p>In contrast, validation accuracy first increases and then eventually decreases as k increase.</p>
<ul>
<li>K = 1</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_1nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8163265</code></pre>
</div>
</div>
<ul>
<li>K = 5</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_5nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.877551</code></pre>
</div>
</div>
<ul>
<li>K = 10 (preferred based on validation accuracy)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_10nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8877551</code></pre>
</div>
</div>
<ul>
<li>K = 20</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_20nn_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8673469</code></pre>
</div>
</div>
<hr>
<p>Let’s look at the decision boundaries for 10-NN in training and validation sets</p>
<ul>
<li>A very complex decision boundary</li>
<li>Clearly trying hard to segregate the points</li>
<li>In Ames, the relationships were non-linear and therefore KNN did much better than the linear model</li>
<li>Here, the decision boundary is pretty linear so the added flexibility of KNN doesn’t get us much.
<ul>
<li>Maybe we gain a little in bias reduction but lose a little in overfitting</li>
<li>Ends up performing comparable to logistic regression (a generalized linear model)</li>
</ul></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_10nn_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_10nn_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-53-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>How do you think the parametric logistic regression compares to the non-parametric KNN with respect to explanatory goals? Consider our (somewhat artificial) question about the effect of <code>year</code>.</p>
</div>
</div>
<div class="fragment uwred">
<p>The logistic regression provides coefficients (parameter estimates) that can be used to describe changes in probability, odds and odds ratio associated with change in year. These parameter estimates can be tested via inferential procedures.<br>
KNN does not provide any parameter estimates. With KNN, we can visualize decision boundary (only in 2 or three dimensions) or the predicted outcome by any feature, controlling for other features but these relationships may be complex in shape.<br>
Of course, if the relationships are complex, we might not want to hide that.<br>
We will learn more about feature importance for explanation in a later unit.</p>
</div>
<hr>
<p>Plot of probability of high_mpg by year, holding <code>beef_1</code> constant at its mean based on 10-NN</p>
<ul>
<li>Get <span class="math inline">\(Pr(high|year)\)</span> holding beef constant at its mean</li>
<li><code>predict()</code> returns probabilities for high and low.</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="fu">min</span>(feat_val<span class="sc">$</span>year), <span class="fu">max</span>(feat_val<span class="sc">$</span>year), .<span class="dv">1</span>),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">beef_1 =</span> <span class="fu">mean</span>(feat_val<span class="sc">$</span>beef_1)) </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>p_high <span class="ot">&lt;-</span> p_high <span class="sc">|&gt;</span> </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_10nn_2, p_high, <span class="at">type =</span> <span class="st">"prob"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33
Columns: 4
$ year       &lt;dbl&gt; 18.99759, 19.09759, 19.19759, 19.29759, 19.39759, 19.49759,…
$ beef_1     &lt;dbl&gt; 0.004400185, 0.004400185, 0.004400185, 0.004400185, 0.00440…
$ .pred_low  &lt;dbl&gt; 0.96, 0.99, 0.99, 0.99, 0.97, 0.87, 0.81, 0.81, 0.81, 0.81,…
$ .pred_high &lt;dbl&gt; 0.04, 0.01, 0.01, 0.01, 0.03, 0.13, 0.19, 0.19, 0.19, 0.19,…</code></pre>
</div>
</div>
<hr>
<ul>
<li>Plot it</li>
<li>In a later unit, we will learn about feature ablation that we can combine with model comparisons to potentially test predictor effects in non-parametric models</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> feat_val, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="fu">as.numeric</span>(mpg) <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> p_high, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> .pred_high)) <span class="sc">+</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Production Year (19XX)"</span>, </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">7</span>), </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">as.character</span>(<span class="fu">seq</span>(<span class="dv">70</span>, <span class="dv">82</span>, <span class="at">length.out =</span> <span class="dv">7</span>))) <span class="sc">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Pr(High MPG)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="linear-discriminant-analysis" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="linear-discriminant-analysis"><span class="header-section-number">4.8</span> Linear Discriminant Analysis</h2>
<p>LDA models the distributions of the Xs separately for each class</p>
<p>Then uses Bayes theorem to estimate <span class="math inline">\(Pr(Y = k | X)\)</span> for each k and assigns the observation to the class with the highest probability</p>
<p><span class="math inline">\(Pr(Y = k|X) = \frac{\pi_k * f_k(X)}{\sum_{l = 1}^{K} f_l(X)}\)</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\pi_k\)</span> is the prior probability that an observation comes from class k (estimated from frequencies of k in training)</li>
<li><span class="math inline">\(f_k(X)\)</span> is the density function of X for an observation from class k
<ul>
<li><span class="math inline">\(f_k(X)\)</span> is large if there is a high probability that an observation in class k has that set of values for X and small if that probability is low</li>
<li><span class="math inline">\(f_k(X)\)</span> is difficult to estimate unless we make some simplifying assumptions (i.e., X is multivariate normal and common covariance matrix (<span class="math inline">\(\sum\)</span>) across K classes)</li>
<li>With these assumptions, we can estimate <span class="math inline">\(\pi_k\)</span>, <span class="math inline">\(\mu_k\)</span>, and <span class="math inline">\(\sigma^2\)</span> from the training set and calculate <span class="math inline">\(Pr(Y = k|X)\)</span> for each k</li>
</ul></li>
</ul>
<hr>
<p>With a single feature, the probability of any class k, given X is:</p>
<ul>
<li><p><span class="math inline">\(Pr(Y = k|X) = \frac{\pi_k \frac{1}{\sqrt{2\pi\sigma}}\exp(-\frac{1}{2\sigma^2}(x-\mu_k)^2)}{\sum_{l=1}^{K}\pi_l\frac{1}{2\sigma^2}\exp(-\frac{1}{2\sigma^2}(x-\mu_l)^2)}\)</span></p></li>
<li><p>LDA is a parametric model, but is it interpretable?</p></li>
</ul>
<hr>
<p>Application of LDA to Cars data set with two predictors</p>
<p>Notice that LDA produces linear decision boundary (see <span class="citation" data-cites="ISL">James et al. (<a href="#ref-ISL" role="doc-biblioref">2023</a>)</span> for formula for discriminant function derived from the probability function on last slide)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> data_trn) <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(cylinders, displacement, horsepower, weight, </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>), </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">num_comp =</span> <span class="dv">1</span>, </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prefix =</span> <span class="st">"beef_"</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>rec_prep <span class="ot">&lt;-</span> rec <span class="sc">|&gt;</span> </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>feat_trn <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="cn">NULL</span>)</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>feat_val <span class="ot">&lt;-</span> rec_prep <span class="sc">|&gt;</span> </span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Need to load the <code>discrm</code> package</li>
<li>Lets look at how the function is called</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discrim, <span class="at">exclude =</span> <span class="st">"smoothness"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Discriminant Model Specification (classification)

Computational engine: MASS 

Model fit template:
MASS::lda(formula = missing_arg(), data = missing_arg())</code></pre>
</div>
</div>
<hr>
<p>Fit the LDA in train</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>fit_lda_2 <span class="ot">&lt;-</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Accuracy and decision boundary</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, <span class="fu">predict</span>(fit_lda_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8469388</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="quadratic-discriminant-analysis" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="quadratic-discriminant-analysis"><span class="header-section-number">4.9</span> Quadratic Discriminant Analysis</h2>
<p>QDA relaxes one restrictive assumption of LDA</p>
<ul>
<li>Still required multivariate normal X</li>
<li><strong>But it allows each class to have its own <span class="math inline">\(\sum\)</span></strong></li>
<li>This makes it:
<ul>
<li>More flexible</li>
<li>Able to model non-linear decision boundaries (see formula for discriminant in <span class="citation" data-cites="ISL">James et al. (<a href="#ref-ISL" role="doc-biblioref">2023</a>)</span>)</li>
<li>But requires substantial increase in parameter estimation (more potential to overfit)</li>
</ul></li>
</ul>
<hr>
<p>Application of RDA (Regularized Discriminant Analysis) algorithm to Car data set with two features</p>
<ul>
<li>The algorithm that is available in tidymodels is actually a regularized discriminant analysis, <code>rda()</code> from the <code>klaR</code> package</li>
<li>There are two hyperparameters, <code>frac_common_cov</code> and <code>frac_identity</code>, that can each vary between 0 - 1
<ul>
<li>When <code>frac_common_cov = 1</code> and <code>frac_identity = 0</code>, this is an LDA</li>
<li>When <code>frac_common_cov = 0</code> and <code>frac_identity = 0</code>, this is a QDA</li>
<li>These hyperparameters can be tuned to different values to improve the fit dependent on the true DGP</li>
<li>More on hyperparameter tuning in unit 5</li>
<li>This is a flexible algorithm that likely replaces the need to fit separate LDA and QDA models</li>
</ul></li>
<li>see https://discrim.tidymodels.org/reference/discrim_regularized.html</li>
</ul>
<hr>
<p>Here is a true QDA using <code>frac_common_cov = 1</code> and <code>frac_identity = 0</code></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Regularized Discriminant Model Specification (classification)

Main Arguments:
  frac_common_cov = 0
  frac_identity = 0

Computational engine: klaR 

Model fit template:
klaR::rda(formula = missing_arg(), data = missing_arg(), lambda = 0, 
    gamma = 0)</code></pre>
</div>
</div>
<hr>
<ul>
<li>Now fit it</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>fit_qda_2 <span class="ot">&lt;-</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_regularized</span>(<span class="at">frac_common_cov =</span> <span class="dv">0</span>, <span class="at">frac_identity =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(mpg <span class="sc">~</span> beef_1 <span class="sc">+</span> year, <span class="at">data =</span> feat_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>Accuracy and decision boundary</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(feat_val<span class="sc">$</span>mpg, </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_qda_2, feat_val)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.877551</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> feat_trn <span class="sc">|&gt;</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>p_val <span class="ot">&lt;-</span> feat_val <span class="sc">|&gt;</span> </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_qda_2, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"beef_1"</span>), <span class="at">y_name =</span> <span class="st">"mpg"</span>, <span class="at">n_points =</span> <span class="dv">400</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_val, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Validation"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="comparisons-between-these-four-classifiers" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="comparisons-between-these-four-classifiers"><span class="header-section-number">4.10</span> Comparisons between these four classifiers</h2>
<ul>
<li><p>Both logistic and LDA are linear functions of X and therefore produce linear decision boundaries</p></li>
<li><p>LDA makes additional assumptions about X (multivariate normal and common <span class="math inline">\(\sum\)</span>) beyond logistic regression. Relative performance is based on the quality of this assumption</p></li>
<li><p>QDA relaxes the LDA assumption about common <span class="math inline">\(\sum\)</span> (and RDA can relax it partially)</p>
<ul>
<li>This also allows for nonlinear decision boundaries including 2-way interactions among features</li>
<li>QDA is therefore more flexible, which means possibly less bias but more potential for overfitting</li>
</ul></li>
<li><p>Both QDA and LDA assume multivariate normal X so <em>may</em> not accommodate categorical predictors very well. Logistic and KNN do accommodate categorical predictors</p></li>
<li><p>KNN is non-parametric and therefore the most flexible</p>
<ul>
<li>Can also handle interactions and non-linear effects natively (with feature engineering)</li>
<li>Increased overfitting, decreased bias?</li>
<li>Not very interpretable. But LDA/QDA, although parametric, aren’t as interpretable as logistic regression</li>
</ul></li>
<li><p>Logistic regression fails when classes are perfectly separated (but does that ever happen?) and is less stable when classes are well separated</p></li>
<li><p>LDA, KNN, and QDA naturally accommodate more than two classes</p>
<ul>
<li>Logistic requires additional tweak (<strong>Briefly describe: multiple one vs other classes models approach</strong>)</li>
</ul></li>
<li><p>Logistic regression requires relatively large sample sizes. LDA may perform better with smaller sample sizes if assumptions are met. KNN can be computationally very costly with large sample sizes (and large number of X) but could always downsample training set.</p></li>
</ul>
<hr>
</section>
<section id="a-quick-tour-of-many-classifiers" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="a-quick-tour-of-many-classifiers"><span class="header-section-number">4.11</span> A quick tour of many classifiers</h2>
<p>The Cars dataset had strong predictors and a mostly linear decision boundary for the two predictors we considered</p>
<ul>
<li>This will not be true in many cases</li>
<li>Let’s consider a more complex two predictor decision boundary in the <strong>circle</strong> dataset from the <code>mlbench</code> package (lots of cool datasets for ML)</li>
<li>This will hopefully demonstrate that the key is to have a algorithm that can model the DGP</li>
<li>There is NO best algorithm</li>
<li>The best algorithm depends on
<ul>
<li>The DGP</li>
<li>The goal (prediction vs.&nbsp;explanation)</li>
</ul></li>
</ul>
<hr>
<p>This will also demonstrate the power of tidymodels to allow us to fit many different statistical algorithms which all have their own syntax using a common syntax provided by tidymodels.</p>
<ul>
<li>This example has been adapted to tidymodels from a demonstration by <a href="https://michael.hahsler.net/SMU/EMIS7332/R/viz_classifier.html">Michael Hahsler</a></li>
<li>Simulate train and test data</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlbench, <span class="at">include.only =</span> <span class="st">"mlbench.circle"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20140102</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>data_trn <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">mlbench.circle</span>(<span class="dv">200</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x_1 =</span> x<span class="fl">.1</span>, <span class="at">x_2 =</span> x<span class="fl">.2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 200
Columns: 3
$ x_1     &lt;dbl&gt; -0.514721263, 0.763312056, 0.312073042, 0.162981535, -0.320294…
$ x_2     &lt;dbl&gt; 0.47513532, 0.65803777, -0.89824011, 0.38680494, -0.47313964, …
$ classes &lt;fct&gt; 1, 2, 2, 1, 1, 1, 1, 2, 2, 1, 2, 2, 1, 1, 1, 2, 2, 2, 2, 2, 2,…</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">mlbench.circle</span>(<span class="dv">200</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">x_1 =</span> x<span class="fl">.1</span>, <span class="at">x_2 =</span> x<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Plot train data</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>data_trn <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_1, <span class="at">y =</span> x_2, <span class="at">color =</span> classes)) <span class="sc">+</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<section id="logistic-regression" class="level3" data-number="4.11.1">
<h3 data-number="4.11.1" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">4.11.1</span> Logistic Regression</h3>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>fit_lr_bench <span class="ot">&lt;-</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_lr_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.62</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lr_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-69-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="knn-with-k-5-somewhat-arbitrary-default" class="level3" data-number="4.11.2">
<h3 data-number="4.11.2" class="anchored" data-anchor-id="knn-with-k-5-somewhat-arbitrary-default"><span class="header-section-number">4.11.2</span> KNN with K = 5 (somewhat arbitrary default)</h3>
<ul>
<li>Fit</li>
<li>Note same syntax as logistic regression (and for all others!)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>fit_knn_bench <span class="ot">&lt;-</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
<li>Note same syntax as logistic regression (and for all others!)</li>
<li>See what KNN can do relative to LR when the boundaries are non-linear!</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_knn_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_knn_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_knn_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-72-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="linear-discriminant-analysis-1" class="level3" data-number="4.11.3">
<h3 data-number="4.11.3" class="anchored" data-anchor-id="linear-discriminant-analysis-1"><span class="header-section-number">4.11.3</span> Linear Discriminant Analysis</h3>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>fit_lda_bench <span class="ot">&lt;-</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_linear</span>() <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"MASS"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_lda_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.62</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_lda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-75-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="regularized-discriminant-analysis" class="level3" data-number="4.11.4">
<h3 data-number="4.11.4" class="anchored" data-anchor-id="regularized-discriminant-analysis"><span class="header-section-number">4.11.4</span> Regularized Discriminant Analysis</h3>
<ul>
<li>Fit</li>
<li>Letting <code>rda()</code> select optimal hyperparameter values</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fit_rda_bench <span class="ot">&lt;-</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discrim_regularized</span>() <span class="sc">|&gt;</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"klaR"</span>) <span class="sc">|&gt;</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
<li>Less overfitting?</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_rda_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_rda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_rda_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-78-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="naive-bayes-classifier" class="level3" data-number="4.11.5">
<h3 data-number="4.11.5" class="anchored" data-anchor-id="naive-bayes-classifier"><span class="header-section-number">4.11.5</span> Naive Bayes Classifier</h3>
<p>The Naïve Bayes classifier is a simple probabilistic classifier which is based on Bayes theorem</p>
<ul>
<li><p>But, we assume that the predictor variables are conditionally independent of one another given the response value</p></li>
<li><p>This algorithm can be fit with either <code>klaR</code> or <code>naivebayes</code> engines</p></li>
<li><p>There are many <a href="https://uc-r.github.io/naive_bayes">tutorials</a> available on this classifier</p></li>
<li><p>Fit it</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>fit_bayes_bench <span class="ot">&lt;-</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">naive_Bayes</span>() <span class="sc">|&gt;</span> </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"naivebayes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_bayes_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.99</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_bayes_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_bayes_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-81-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="random-forest" class="level3" data-number="4.11.6">
<h3 data-number="4.11.6" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">4.11.6</span> Random Forest</h3>
<p>Random Forest is a variant of decision trees</p>
<ul>
<li><p>It uses <strong>bagging</strong> which involves resampling the data to produce many trees and then aggregating across trees for the final classification</p></li>
<li><p>We will discuss Random Forest in a later unit</p></li>
<li><p>Here we fit it with defaults for its hyperparameters</p></li>
<li><p>Fit it</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>fit_rf_bench <span class="ot">&lt;-</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_rf_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.985</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_rf_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_rf_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-84-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="neural-networks" class="level3" data-number="4.11.7">
<h3 data-number="4.11.7" class="anchored" data-anchor-id="neural-networks"><span class="header-section-number">4.11.7</span> Neural networks</h3>
<p>It is easy to fit a <a href="https://parsnip.tidymodels.org/reference/mlp.html">single layer neural network</a></p>
<ul>
<li>We do this below with varying number of hidden units and all other hyperparameters set to defaults</li>
<li>We will have a unit on this later in the semester</li>
</ul>
<hr>
<section id="single-layer-nn-with-1-hidden-unit" class="level4" data-number="4.11.7.1">
<h4 data-number="4.11.7.1" class="anchored" data-anchor-id="single-layer-nn-with-1-hidden-unit"><span class="header-section-number">4.11.7.1</span> Single Layer NN with 1 hidden unit:</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>fit_nn1_bench <span class="ot">&lt;-</span> </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_nn1_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.66</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn1_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn1_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-87-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="single-layer-nn-with-2-hidden-units" class="level4" data-number="4.11.7.2">
<h4 data-number="4.11.7.2" class="anchored" data-anchor-id="single-layer-nn-with-2-hidden-units"><span class="header-section-number">4.11.7.2</span> Single Layer NN with 2 hidden units</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>fit_nn2_bench <span class="ot">&lt;-</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_nn2_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.765</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn2_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span> </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn2_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-90-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="single-layer-nn-with-5-hidden-units" class="level4" data-number="4.11.7.3">
<h4 data-number="4.11.7.3" class="anchored" data-anchor-id="single-layer-nn-with-5-hidden-units"><span class="header-section-number">4.11.7.3</span> Single Layer NN with 5 hidden units</h4>
<ul>
<li>Fit</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>fit_nn5_bench <span class="ot">&lt;-</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"nnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(classes <span class="sc">~</span> x_1 <span class="sc">+</span> x_2, <span class="at">data =</span> data_trn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<ul>
<li>Accuracy and Decision Boundary</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy_vec</span>(test<span class="sc">$</span>classes, </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">predict</span>(fit_nn5_bench, test)<span class="sc">$</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.96</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>p_train <span class="ot">&lt;-</span> data_trn <span class="sc">|&gt;</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn5_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_boundary</span>(fit_nn5_bench, <span class="at">x_names =</span> <span class="fu">c</span>(<span class="st">"x_1"</span>, <span class="st">"x_2"</span>), <span class="at">y_name =</span> <span class="st">"classes"</span>, <span class="at">n_points =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p_train, p_test, <span class="at">labels =</span> <span class="fu">list</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="l04_classification_files/figure-html/unnamed-chunk-93-1.png" style="height:3in" width="672" class="figure-img"></p>
</figure>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-ISL" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2023. <em>An <span>Introduction</span> to <span>Statistical Learning</span>: With <span>Applications</span> in <span>R</span></em>. 2nd ed. Springer <span>Texts</span> in <span>Statistics</span>. <span>New York</span>: <span>Springer-Verlag</span>.
</div>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/github\.io\/jjcurtin\/book_iaml");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./l03_regression.html" class="pagination-link" aria-label="Introduction to Regression Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./l05_resampling.html" class="pagination-link" aria-label="Resampling Methods for Model Selection and Evaluation">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resampling Methods for Model Selection and Evaluation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jjcurtin/book_iaml/edit/main/l04_classification.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>