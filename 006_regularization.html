<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Applied Machine Learning - 6&nbsp; Regularization and Penalized Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./007_midterm.html" rel="next">
<link href="./005_resampling.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="book.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./006_regularization.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regularization and Penalized Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Applied Machine Learning</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/jjcurtin/book_iaml" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./001_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview of Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002_exploratory_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./003_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Regression Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./004_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Classification Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005_resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resampling Methods for Model Selection and Evaluation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_regularization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regularization and Penalized Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./007_midterm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Midterm Exam</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./008_advanced_performance_metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Advanced Performance Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./009_random_forest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Models: Decision Trees, Bagging Trees, and Random Forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010_neural_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Models: Neural Networks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011_explanation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Explanatory Approaches</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./012_nlp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Natural Language Processing: Text Processing and Feature Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./013_applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Applications for Machine Learning: Synthesis and Concept Generalization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./014_ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Ethical Issues in Machine Learning Research and Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./015_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Final Exam and Project</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_terminology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Key Terminology and Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_dummy_coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Novel Levels in Held-Out Set(s)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_keras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Installing Keras for Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_model_performance_simulations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Appendix 2: Simulations of Model Performance Bias and Variance by Resampling Techniques</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_shap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Appendix 3: Understanding Shapley Values from SHAP</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_bootstrapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Appendix 4: Bootstrapping Standard Errors &amp; Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Test</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview-of-unit" id="toc-overview-of-unit" class="nav-link active" data-scroll-target="#overview-of-unit"><span class="header-section-number">6.1</span> Overview of Unit</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">6.1.1</span> Learning Objectives</a></li>
  <li><a href="#readings" id="toc-readings" class="nav-link" data-scroll-target="#readings"><span class="header-section-number">6.1.2</span> Readings</a></li>
  <li><a href="#lecture-videos" id="toc-lecture-videos" class="nav-link" data-scroll-target="#lecture-videos"><span class="header-section-number">6.1.3</span> Lecture Videos</a></li>
  <li><a href="#application-assignment-and-quiz" id="toc-application-assignment-and-quiz" class="nav-link" data-scroll-target="#application-assignment-and-quiz"><span class="header-section-number">6.1.4</span> Application Assignment and Quiz</a></li>
  </ul></li>
  <li><a href="#introduction-to-penalizedregularized-statistical-algorithms" id="toc-introduction-to-penalizedregularized-statistical-algorithms" class="nav-link" data-scroll-target="#introduction-to-penalizedregularized-statistical-algorithms"><span class="header-section-number">6.2</span> Introduction to Penalized/Regularized Statistical Algorithms</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">6.2.1</span> Overview</a></li>
  <li><a href="#cost-functions" id="toc-cost-functions" class="nav-link" data-scroll-target="#cost-functions"><span class="header-section-number">6.2.2</span> Cost functions</a></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">6.3</span> <img src="figs/unit5_log_loss.png" style="height:5in"></a></li>
  <li><a href="#intuitions-about-penalized-cost-functions-and-regularization" id="toc-intuitions-about-penalized-cost-functions-and-regularization" class="nav-link" data-scroll-target="#intuitions-about-penalized-cost-functions-and-regularization"><span class="header-section-number">6.4</span> Intuitions about Penalized Cost Functions and Regularization</a></li>
  <li><a href="#ridge-regression" id="toc-ridge-regression" class="nav-link" data-scroll-target="#ridge-regression"><span class="header-section-number">6.5</span> Ridge Regression</a></li>
  <li><a href="#lasso-regression" id="toc-lasso-regression" class="nav-link" data-scroll-target="#lasso-regression"><span class="header-section-number">6.6</span> LASSO Regression</a>
  <ul class="collapse">
  <li><a href="#lasso-vs.-ridge-comparison" id="toc-lasso-vs.-ridge-comparison" class="nav-link" data-scroll-target="#lasso-vs.-ridge-comparison"><span class="header-section-number">6.6.1</span> LASSO vs.&nbsp;Ridge Comparison</a></li>
  <li><a href="#advantages-of-lasso" id="toc-advantages-of-lasso" class="nav-link" data-scroll-target="#advantages-of-lasso"><span class="header-section-number">6.6.2</span> Advantages of LASSO</a></li>
  <li><a href="#advantages-of-ridge" id="toc-advantages-of-ridge" class="nav-link" data-scroll-target="#advantages-of-ridge"><span class="header-section-number">6.6.3</span> Advantages of Ridge</a></li>
  </ul></li>
  <li><a href="#elastic-net-regression" id="toc-elastic-net-regression" class="nav-link" data-scroll-target="#elastic-net-regression"><span class="header-section-number">6.7</span> Elastic Net Regression</a></li>
  <li><a href="#empirical-example-1-many-good-but-correlated-predictors" id="toc-empirical-example-1-many-good-but-correlated-predictors" class="nav-link" data-scroll-target="#empirical-example-1-many-good-but-correlated-predictors"><span class="header-section-number">6.8</span> Empirical Example 1: Many “good” but correlated predictors</a>
  <ul class="collapse">
  <li><a href="#fit-a-standard-ols-linear-regression" id="toc-fit-a-standard-ols-linear-regression" class="nav-link" data-scroll-target="#fit-a-standard-ols-linear-regression"><span class="header-section-number">6.8.1</span> Fit a standard (OLS) linear regression</a></li>
  <li><a href="#fit-lasso" id="toc-fit-lasso" class="nav-link" data-scroll-target="#fit-lasso"><span class="header-section-number">6.8.2</span> Fit LASSO</a></li>
  <li><a href="#fit-ridge" id="toc-fit-ridge" class="nav-link" data-scroll-target="#fit-ridge"><span class="header-section-number">6.8.3</span> Fit Ridge</a></li>
  <li><a href="#fit-glmnet" id="toc-fit-glmnet" class="nav-link" data-scroll-target="#fit-glmnet"><span class="header-section-number">6.8.4</span> Fit glmnet</a></li>
  </ul></li>
  <li><a href="#empirical-example-2-good-and-zero-predictors" id="toc-empirical-example-2-good-and-zero-predictors" class="nav-link" data-scroll-target="#empirical-example-2-good-and-zero-predictors"><span class="header-section-number">6.9</span> Empirical Example 2: Good and Zero Predictors</a>
  <ul class="collapse">
  <li><a href="#fit-a-standard-ols-linear-regression-1" id="toc-fit-a-standard-ols-linear-regression-1" class="nav-link" data-scroll-target="#fit-a-standard-ols-linear-regression-1"><span class="header-section-number">6.9.1</span> Fit a standard (OLS) linear regression</a></li>
  <li><a href="#fit-lasso-1" id="toc-fit-lasso-1" class="nav-link" data-scroll-target="#fit-lasso-1"><span class="header-section-number">6.9.2</span> Fit LASSO</a></li>
  <li><a href="#fit-ridge-1" id="toc-fit-ridge-1" class="nav-link" data-scroll-target="#fit-ridge-1"><span class="header-section-number">6.9.3</span> Fit Ridge</a></li>
  <li><a href="#fit-complete-glmnet" id="toc-fit-complete-glmnet" class="nav-link" data-scroll-target="#fit-complete-glmnet"><span class="header-section-number">6.9.4</span> Fit Complete glmnet</a></li>
  </ul></li>
  <li><a href="#lasso-for-feature-e.g.-covariate-selection" id="toc-lasso-for-feature-e.g.-covariate-selection" class="nav-link" data-scroll-target="#lasso-for-feature-e.g.-covariate-selection"><span class="header-section-number">6.10</span> LASSO for Feature (e.g., Covariate) Selection?</a></li>
  <li><a href="#ridge-lasso-and-elastic-net-models-for-other-y-distributions" id="toc-ridge-lasso-and-elastic-net-models-for-other-y-distributions" class="nav-link" data-scroll-target="#ridge-lasso-and-elastic-net-models-for-other-y-distributions"><span class="header-section-number">6.11</span> Ridge, LASSO, and Elastic net models for other Y distributions</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">6.12</span> Discussion</a>
  <ul class="collapse">
  <li><a href="#announcements" id="toc-announcements" class="nav-link" data-scroll-target="#announcements"><span class="header-section-number">6.12.1</span> Announcements</a></li>
  <li><a href="#feature-matrix-vs.-raw-predictors" id="toc-feature-matrix-vs.-raw-predictors" class="nav-link" data-scroll-target="#feature-matrix-vs.-raw-predictors"><span class="header-section-number">6.12.2</span> feature matrix vs.&nbsp;raw predictors</a></li>
  <li><a href="#cost-functions-1" id="toc-cost-functions-1" class="nav-link" data-scroll-target="#cost-functions-1"><span class="header-section-number">6.12.3</span> Cost functions</a></li>
  <li><a href="#lasso-ridge-and-elastic-net-questions" id="toc-lasso-ridge-and-elastic-net-questions" class="nav-link" data-scroll-target="#lasso-ridge-and-elastic-net-questions"><span class="header-section-number">6.12.4</span> LASSO, Ridge, and elastic net questions</a></li>
  <li><a href="#stepwise-questions" id="toc-stepwise-questions" class="nav-link" data-scroll-target="#stepwise-questions"><span class="header-section-number">6.12.5</span> Stepwise questions</a></li>
  <li><a href="#explanatory-goals" id="toc-explanatory-goals" class="nav-link" data-scroll-target="#explanatory-goals"><span class="header-section-number">6.12.6</span> Explanatory goals</a></li>
  <li><a href="#pca" id="toc-pca" class="nav-link" data-scroll-target="#pca"><span class="header-section-number">6.12.7</span> PCA</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jjcurtin/book_iaml/edit/main/006_regularization.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regularization and Penalized Models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview-of-unit" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="overview-of-unit"><span class="header-section-number">6.1</span> Overview of Unit</h2>
<section id="learning-objectives" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">6.1.1</span> Learning Objectives</h3>
<ul>
<li>Subsetting approaches: Forward, Backward, Best Subset (covered in reading only)</li>
<li>Cost and Loss functions
<ul>
<li>What are they and how are they used</li>
<li>What are the specific formulas for linear model, logistic regression, and variants of glmnet (ridge, LASSO, full elasticnet)</li>
</ul></li>
<li>What is regularization
<ul>
<li>What are its benefits?</li>
<li>What are its costs?</li>
</ul></li>
<li>How does lambda affect bias-variance trade-off in glmnet</li>
<li>What does alpha do?</li>
<li>Feature engineering approaches for dimensionality reduction: PCA (covered in reading only)</li>
<li>Other algorithms that do feature selection/dimensionality reduction: PCR and PLS (covered in reading only)</li>
<li>Contrasts of PCA, PCR, PLS, and glmnet/LASSO for dimensionality reduction (covered in reading only)</li>
</ul>
<hr>
</section>
<section id="readings" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="readings"><span class="header-section-number">6.1.2</span> Readings</h3>
<ul>
<li><span class="citation" data-cites="ISL">James et al. (<a href="#ref-ISL" role="doc-biblioref">2023</a>)</span> <a href="pdfs/isl_2.pdf">Chapter 6, pp 225 - 267</a></li>
</ul>
<p>Post questions to the readings channel in Slack</p>
</section>
<section id="lecture-videos" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="lecture-videos"><span class="header-section-number">6.1.3</span> Lecture Videos</h3>
<ul>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+6-1/1_dqafjta6">Lecture 1: An Introduction to Penalized/Regularized Algorithms</a> ~ 15 mins</li>
<li>[Lecture 2: <a href="https://mediaspace.wisc.edu/media/iaml+unit+6-2/1_uxp8w6am">Intuitions about Penalized Cost Functions and Regularization</a> ~ 11 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+6-3/1_hcghfpo3">Lecture 3: Ridge Regression</a> ~ 9 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+6-4/1_803c42m3">Lecture 4: LASSO</a> ~ 8 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+6-5/1_r4xy5dws">Lecture 5: The Elastic net</a> ~ 4 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+6-6/1_2608sidm">Lecture 6: Emprical Example - Many good predictors</a> ~ 23 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+6-7/1_xmgkkr8t">Lecture 7: Emprical Example - Good and zero predictors</a> ~ 9 mins</li>
<li><a href="https://mediaspace.wisc.edu/media/iaml+unit+6-8/1_hlknwl7m">Lecture 8: Emprical Example - LASSO for covariate selection</a> ~ 8 mins</li>
</ul>
<p>Post questions to the video-lectures channel in Slack</p>
<hr>
</section>
<section id="application-assignment-and-quiz" class="level3" data-number="6.1.4">
<h3 data-number="6.1.4" class="anchored" data-anchor-id="application-assignment-and-quiz"><span class="header-section-number">6.1.4</span> Application Assignment and Quiz</h3>
<ul>
<li><a href="application_assignments/unit_06/ames_full_cln.csv">data</a></li>
<li><a href="application_assignments/unit_06/ames_data_dictionary.pdf">data dictionary</a></li>
<li><a href="https://raw.githubusercontent.com/jjcurtin/book_iaml/main/application_assignments/unit_06/hw_unit_06_regularization.qmd">qmd shell</a></li>
<li><a href="https://dionysus.psych.wisc.edu/iaml/key_unit_06_regularization.html">solution</a></li>
</ul>
<p>Submit the application assignment <a href="https://canvas.wisc.edu/courses/395546/assignments/2187691">here</a> and complete the <a href="https://canvas.wisc.edu/courses/395546/quizzes/514047">unit quiz</a> by 8 pm on Wednesday, February 28th</p>
<hr>
</section>
</section>
<section id="introduction-to-penalizedregularized-statistical-algorithms" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="introduction-to-penalizedregularized-statistical-algorithms"><span class="header-section-number">6.2</span> Introduction to Penalized/Regularized Statistical Algorithms</h2>
<section id="overview" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">6.2.1</span> Overview</h3>
<p>Complex (e.g., flexible) models increase the chance of overfitting to the training set. This leads to:</p>
<ul>
<li>Poor prediction</li>
<li>Burdensome prediction models for implementation (need to measure lots of predictors)</li>
<li>Low power to test hypothesis about predictor effects<br>
<br>
</li>
</ul>
<p>Complex models are difficult to interpret</p>
<hr>
<p>Regularization is technique that:</p>
<ul>
<li>Reduces overfitting</li>
<li>Allows for p &gt;&gt; n (!!!)</li>
<li>May yield more interpretable models (LASSO, Elastic Net)</li>
<li>May reduce implementation burden (LASSO, Elastic Net)</li>
</ul>
<hr>
<p>Regularization does this by applying a penalty to the parametric model coefficients (parameter estimates)</p>
<ul>
<li>This constrains/shrinks these coefficients to yield a simpler/less overfit model</li>
<li>Some types of penalties shrink the coefficients to zero (feature selection)<br>
<br>
</li>
</ul>
<p>We will consider three approaches to regularization</p>
<ul>
<li>L2 (Ridge)</li>
<li>L1 (LASSO)</li>
<li>Elastic net<br>
<br>
</li>
</ul>
<p>These approaches are available for both regression and classification problems and for a variety of parametric statistical algorithms</p>
<hr>
</section>
<section id="cost-functions" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="cost-functions"><span class="header-section-number">6.2.2</span> Cost functions</h3>
<p>To understand regularization, we need to first explicitly consider <strong>loss/cost functions</strong> for the parametric statistical models we have been using.</p>
<ul>
<li><p>A <strong>loss function</strong> quantifies the error between a single predicted and observed outcome within some statistical model.</p></li>
<li><p>A <strong>cost function</strong> is simply the aggregate of the loss across all observations in the training sample.<br>
<br>
</p></li>
</ul>
<p>Optimization procedures (least squares, maximum likelihood, gradient descent) seek to determine a set of parameter estimates that minimize some specific cost function for the training sample.</p>
<hr>
<p>The cost function for the linear model is the mean squared error (squared loss):</p>
<ul>
<li><p><span class="math inline">\(\frac{1}{n}\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}\)</span></p></li>
<li><p>No constraints or penalties are placed on the parameter estimates (<span class="math inline">\(\beta_k\)</span>)</p></li>
<li><p>They can take on any values with the only goal to minimize the MSE in the training sample</p></li>
</ul>
<hr>
<p>The cost function for logistic regression is log loss:</p>
<ul>
<li><p><span class="math inline">\(\frac{1}{n}\sum_{i = 1}^{n} -Y_ilog(\hat{Y_i}) - (1-Y_i)log(1-\hat{Y_i})\)</span></p></li>
<li><p>where <span class="math inline">\(Y_i\)</span> is coded 0,1 and <span class="math inline">\(\hat{Y_i}\)</span> is the predicted probability that Y = 1</p></li>
<li><p>Again, no constraints or penalties are placed on the parameter estimates (<span class="math inline">\(\beta_k\)</span>)</p></li>
<li><p>They can take on any values with the only goal to minimize the sum of the log loss in the training sample<br>
<br>
</p></li>
</ul>
</section>
</section>
<section id="section" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="section"><span class="header-section-number">6.3</span> <img src="figs/unit5_log_loss.png" style="height:5in"></h2>
</section>
<section id="intuitions-about-penalized-cost-functions-and-regularization" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="intuitions-about-penalized-cost-functions-and-regularization"><span class="header-section-number">6.4</span> Intuitions about Penalized Cost Functions and Regularization</h2>
<p>This is an example from a series of wonderfully clear lectures in a <a href="https://www.youtube.com/watch?v=PPLop4L2eGk&amp;list=PLLssT5z_DsK-h9vYZkQkYNWcItqhlRJLN">machine learning course</a> by Andrew Ng in Coursera.</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=u73PU6Qwl1I">Regularization: The Problem Of Overfitting</a></li>
<li><a href="https://www.youtube.com/watch?v=KvtGD37Rm5I">Regularization: Cost Functions</a></li>
</ul>
<hr>
<p>Lets imagine a training set:</p>
<ul>
<li>House sale price predicted by house size</li>
<li>True DGP is quadratic. Diminishing increase in sale price as size increases</li>
<li>N = 5 in training set</li>
</ul>
<p><br>
<br>
</p>
<p><img src="figs/unit5_ng1.png" style="height:5in"></p>
<hr>
<p>If we fit a linear model with size as the only feature…</p>
<ul>
<li><p><span class="math inline">\(\hat{sale\_price_i} = \beta_0 + \beta_1 * size\)</span></p></li>
<li><p>In this training set, we might get the model below (in blue)</p></li>
<li><p>This is a biased model (predicts too high for low and high house sizes; predicts too low for moderate size houses)</p></li>
<li><p>If we took this model to new data from the same quadratic DGP, it would clearly not predict very well</p></li>
</ul>
<p><img src="figs/unit5_ng2.png" style="height:5in"></p>
<hr>
<p>Lets consider the other extreme</p>
<ul>
<li>If we fit a 4th order polynomial model using size…</li>
<li><span class="math inline">\(\hat{sale\_price_i} = \beta_0 + \beta_1 * size + \beta_2 * size^2 + \beta_3 * size^3 + \beta_4 * size^4\)</span></li>
<li>In this training set, we would get the model below (in blue)</li>
<li>This is model is overfit to this training set. It would not predict well in new data from the same quadratic DGP</li>
<li>Also, the model would have high variance (if we estimated the parameters in another N = 5 training set, they would be very different)</li>
</ul>
<p><img src="figs/unit5_ng3.png" style="height:5in"></p>
<hr>
<p>This problem with overfitting and variance isn’t limited to polynomial regression.</p>
<ul>
<li><p>We would have the same problem (perfect fit in training with poor fit in new val data) if we predicted housing prices with many features when the training N = 5. e.g.,</p></li>
<li><p><span class="math inline">\(\hat{sale\_price_i} = \beta_0 + \beta_1 * size + \beta_2 * year\_built + \beta_3 * num\_garages + \beta_4 * quality\)</span></p></li>
</ul>
<hr>
<p>Obviously, the correct model to fit is a second order polynomial model with size</p>
<ul>
<li><span class="math inline">\(\hat{sale\_price_i} = \beta_0 + \beta_1 * size + \beta_2 * size^2\)</span></li>
<li>But we couldn’t know this with real data because we wouldn’t know the underlying DGP</li>
<li>When we don’t know the underlying DGP, we need to be able to consider potentially complex models with many features in some way that diminishes the potential problem with overfitting/model variance</li>
</ul>
<p><img src="figs/unit5_ng4.png" style="height:5in"></p>
<hr>
<p>What if we still fit a fourth order polynomial but changed the cost function to penalize the absolute value of <span class="math inline">\(\beta_3\)</span> and <span class="math inline">\(\beta_4\)</span> parameter estimates?<br>
<br>
<strong>Typical cost based on MSE/squared loss:</strong></p>
<ul>
<li><span class="math inline">\(\frac{1}{n}\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}\)</span><br>
<br>
</li>
</ul>
<p><strong>Our new cost function:</strong></p>
<ul>
<li><span class="math inline">\([\frac{1}{n}\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] +  [1000 * \beta_3 + 1000 * \beta_4]\)</span></li>
</ul>
<hr>
<p><span class="math inline">\([\frac{1}{n}\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [1000 * \beta_3 + 1000 * \beta_4]\)</span></p>
<ul>
<li><p>The only way to make the value of this new cost function small is to make <span class="math inline">\(\beta_3\)</span> and <span class="math inline">\(\beta_4\)</span> small</p></li>
<li><p>If we made the penalty applied to <span class="math inline">\(\beta_3\)</span> and <span class="math inline">\(\beta_4\)</span> large (e.g., 1000 as above), we will end up with the parameter estimates for these two features at approximately 0.</p></li>
<li><p>With a sufficient penalty applied, their parameter estimates will only change from zero to the degree that these changes accounted for a large enough drop in MSE to offset this penalty in the overall aggregate cost function.</p></li>
</ul>
<hr>
<p><span class="math inline">\([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + 1000 * \beta_3 + 1000 * \beta_4\)</span></p>
<ul>
<li>With this penalty in place, our final model might shift from the blue model to the pink model below. The pink model is mostly quadratic but with a few extra “wiggles” if <span class="math inline">\(\beta_3\)</span> and <span class="math inline">\(\beta_4\)</span> are not exactly 0.</li>
</ul>
<p><img src="figs/unit5_ng5.png" style="height:5in"></p>
<hr>
<p>Of course, we don’t typically know in advance which parameter estimates to penalize.</p>
<ul>
<li>Instead, we apply some penalty to all the parameter estimates (except <span class="math inline">\(\beta_0\)</span>)</li>
<li>This shrinks the parameter estimates for all the features to some degree</li>
<li>However, features that do reduce MSE meaningfully will be “worth” including with non-zero parameter estimates</li>
<li>You can also control the shrinkage by controlling the size of the penalty</li>
</ul>
<hr>
<p>In general, regularization produces models that:</p>
<ul>
<li>Are simpler (e.g.&nbsp;smoother, smaller coefficients/parameter estimates)</li>
<li>Are less prone to overfitting</li>
<li>Allow for models with p &gt;&gt; n</li>
<li>Are sometimes more interpretable (LASSO, Elastic Net)<br>
<br>
</li>
</ul>
<p>These benefits are provided by the introduction of some bias into the parameter estimates<br>
<br>
This allows for a bias-variance trade-off where some bias is introduced for a big reduction in variance of model fit</p>
<hr>
<p>We will now consider three regularization approaches that introduce different types of penalties to shrink the parameter estimates</p>
<ul>
<li>L2 (Ridge)</li>
<li>L1 (LASSO)</li>
<li>Elastic net<br>
<br>
</li>
</ul>
<p>These approaches are available for both regression and classification problems and for a variety of parametric statistical algorithms<br>
<br>
A fourth common regularized classification model (also sometimes used for regression) is the support vector machine (not covered in class but commonly used as well and easy to understand with this foundation)<br>
<br>
Each of these approaches uses a different specific penalty, which has implications for how the model performs in different settings</p>
<hr>
</section>
<section id="ridge-regression" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="ridge-regression"><span class="header-section-number">6.5</span> Ridge Regression</h2>
<p>The cost function for Ridge Regression is:</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda\sum_{j = 1}^{p} \beta_j^{2}\:])\)</span><br>
<br>
</li>
</ul>
<p>It has two components:</p>
<ul>
<li>Inside the left brackets is the SSE from linear regression</li>
<li>Inside the right brackets is the <strong>Ridge penalty</strong>.<br>
<br>
<br>
</li>
</ul>
<p>This penalty:</p>
<ul>
<li>Includes the sum of the squared parameter estimates (excluding <span class="math inline">\(\beta_0\)</span>). Squaring removes the sign of these parameter estimates.</li>
<li>This sum is multiplied by <span class="math inline">\(\lambda\)</span>, a hyperparameter in Ridge regression. Lambda allows us to tune the size of the penalty.</li>
<li>This is an application of the L2 norm (matrix algebra) to the vector of parameter estimates</li>
</ul>
<hr>
<p><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda\sum_{j = 1}^{p} \beta_j^{2}\:])\)</span><br>
<br>
</p>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question: What will happen to a Ridge regression model’s parameter estimates and its performance (i.e., its bias &amp; variance) as lambda increases/decreases?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="cell">
<details class="code-fold">
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>As lambda increases, the model becomes less flexible b/c its parameter estimates </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>become constrained/shrunk.  This will increase bias but decrease variance for model </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>performance.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<hr>
<p><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda\sum_{j = 1}^{p} \beta_j^{2}\:])\)</span><br>
<br>
</p>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question: What is the special case of Ridge regression when lambda = 0?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="cell">
<details class="code-fold">
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>The OLS regression is a special case where lambda = 0 (i.e., no penalty is applied).  </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>This is the most flexible. It is unbiased but with higher variance than for </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>non-zero values of lambda</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<hr>
<p>Lets compare Ridge regression to OLS (ordinary least squares with squared loss cost function) linear regression</p>
<ul>
<li><p>Ridge parameter estimates are biased but have lower variance (smaller SE) than OLS</p></li>
<li><p>Ridge may predict better in new data</p>
<ul>
<li>This depends on the value of <span class="math inline">\(\lambda\)</span> selected and its impact on bias-variance trade-off in Ridge regression vs.&nbsp;OLS</li>
<li>There does exist a value of <span class="math inline">\(\lambda\)</span> for which Ridge predicts better than OLS in new data</li>
</ul></li>
<li><p>Ridge regression (but not OLS) allows for p &gt; (or even &gt;&gt;) than n</p></li>
<li><p>Ridge regression (but not OLS) accommodates highly correlated (or even perfectly multi-collinear) features</p></li>
<li><p>OLS (but not Ridge regression) is scale invariant</p>
<ul>
<li>You should scale (mean and standard deviation correct) features for use with Ridge regression</li>
</ul></li>
</ul>
<hr>
<p><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda\sum_{j = 1}^{p} \beta_j^{2}\:])\)</span><br>
<br>
</p>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question: Why does the scale of the features matter for Ridge regression?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="cell">
<details class="code-fold">
<summary>Show Answer</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Features with bigger SDs will have smaller parameter estimates.  Therefore they </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>will be less affected by the penalty.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p><br>
<br>
Unless the features are on the same scale to start, you should standardize them for all applications (regression and classification) of Ridge (and also LASSO and elastic net). You can handle this during feature engineering in the recipe.</p>
<hr>
</section>
<section id="lasso-regression" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="lasso-regression"><span class="header-section-number">6.6</span> LASSO Regression</h2>
<p>LASSO is an acronym for Least Absolute Shrinkage and Selection Operator<br>
<br>
The cost function for LASSO Regression is:</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda\sum_{j = 1}^{p} |\beta_j|\:])\)</span><br>
<br>
</li>
</ul>
<p>It has two components:</p>
<ul>
<li>Inside the left brackets is the SSE from linear regression</li>
<li>Inside the right brackets is the <strong>LASSO penalty</strong>.<br>
<br>
<br>
</li>
</ul>
<p>This penalty:</p>
<ul>
<li>Includes the sum of the absolute value of the parameter estimates (excluding <span class="math inline">\(\beta_0\)</span>). The absolute value removes the sign of these parameter estimates.</li>
<li>This sum is multiplied by <span class="math inline">\(\lambda\)</span>, a hyperparameter in LASSO regression. Lambda allows us to tune the size of the penalty.</li>
<li>This is an application of the L1 norm to the vector of parameter estimates</li>
</ul>
<hr>
<section id="lasso-vs.-ridge-comparison" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="lasso-vs.-ridge-comparison"><span class="header-section-number">6.6.1</span> LASSO vs.&nbsp;Ridge Comparison</h3>
<p>With respect to the parameter estimates:</p>
<ul>
<li><p>LASSO yields sparse solution (some parameter estimates set to <strong>exactly zero</strong>)</p></li>
<li><p>Ridge tends to retain all features (parameter estimates don’t get set to exactly zero)</p></li>
<li><p>LASSO selects one feature among correlated group and sets others to zero</p></li>
<li><p>Ridge shrinks all parameter estimates for correlated features<br>
<br>
</p></li>
</ul>
<p>Ridge tends to outperform LASSO wrt prediction in new data. There are cases where LASSO can predict better (most features have zero effect and only a few are non-zero) but even in those cases, Ridge is competitive.</p>
<hr>
</section>
<section id="advantages-of-lasso" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2" class="anchored" data-anchor-id="advantages-of-lasso"><span class="header-section-number">6.6.2</span> Advantages of LASSO</h3>
<ul>
<li><p>Does feature selection (sets parameter estimates to exactly 0)</p>
<ul>
<li>Yields a sparse solution</li>
<li>Sparse model is more interpretable?</li>
<li>Sparse model is easier to implement? (fewer features included so don’t need to measure as many predictors)</li>
</ul></li>
<li><p>More robust to outliers (similar to LAD vs.&nbsp;OLS)</p></li>
<li><p>Tends to do better when there are a small number of robust features and the others are close to zero or zero</p></li>
</ul>
<hr>
</section>
<section id="advantages-of-ridge" class="level3" data-number="6.6.3">
<h3 data-number="6.6.3" class="anchored" data-anchor-id="advantages-of-ridge"><span class="header-section-number">6.6.3</span> Advantages of Ridge</h3>
<ul>
<li>Computationally superior (closed form solution vs.&nbsp;iterative; Only one solution to minimize the cost function)</li>
<li>More robust to measurement error in features (remember no measurement error is an assumption for unbiased estimates in OLS regression)</li>
<li>Tends to do better when there are many features with large (and comparable) effects (i.e., most features are related to the outcome)</li>
</ul>
<hr>
</section>
</section>
<section id="elastic-net-regression" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="elastic-net-regression"><span class="header-section-number">6.7</span> Elastic Net Regression</h2>
<p>The Elastic Net blends the L1 and L2 penalties to obtain the benefits of each of those approaches.<br>
<br>
We will use the implementation of the Elastic Net in <a href="https://cran.r-project.org/web/packages/glmnet/glmnet.pdf">glmnet</a> in R.<br>
<br>
<br>
You can also read additional <a href="https://cran.r-project.org/web/packages/glmnet/vignettes/glmnet.pdf">introductory documentation</a> for this package</p>
<hr>
<p>In the Gaussian regression context, the Elastic Net cost function is:</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda (\alpha\sum_{j = 1}^{p} |\beta_j| + (1-\alpha)\sum_{j = 1}^{p} \beta_j^{2})\:])\)</span><br>
<br>
</li>
</ul>
<p>This model has two hyper-parameters</p>
<ul>
<li><span class="math inline">\(\lambda\)</span> controls the degree of regularization as before</li>
<li><span class="math inline">\(\alpha\)</span> is a “mixing” parameter that blends the degree of L1 and L2 contributions to the aggregate penalty. (Proportion of LASSO penalty)
<ul>
<li><span class="math inline">\(\alpha\)</span> = 1 results in the LASSO model</li>
<li><span class="math inline">\(\alpha\)</span> = 0 results in the Ridge model</li>
<li>Intermediate values for <span class="math inline">\(\alpha\)</span> blend these penalties together proportionally to include more or less LASSO penalty</li>
</ul></li>
</ul>
<hr>
<p>As before (e.g., KNN), best values of <span class="math inline">\(\lambda\)</span> (and <span class="math inline">\(\alpha\)</span>) can be selected using resampling using <code>tune_grid()</code><br>
<br>
The grid needs to have crossed values of both <code>penalty</code> (<span class="math inline">\(lambda\)</span>) and <code>mixture</code> (<span class="math inline">\(alpha\)</span>) for glmnet</p>
<ul>
<li>Can use <code>expand_grid()</code></li>
<li>Only penalty is needed in grid if fitting a Ridge or LASSO model.</li>
</ul>
<hr>
</section>
<section id="empirical-example-1-many-good-but-correlated-predictors" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="empirical-example-1-many-good-but-correlated-predictors"><span class="header-section-number">6.8</span> Empirical Example 1: Many “good” but correlated predictors</h2>
<p>For the first example, we will simulate data with:</p>
<ul>
<li>Many correlated predictors</li>
<li>All related to outcome</li>
<li>Get a small training sample</li>
<li>Get a big test sample (for more precise estimate of model performance)</li>
</ul>
<hr>
<p>First we set the predictors for our simulation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>n_cases_trn <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>n_cases_test <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>n_x <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>covs_x <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>vars_x <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>b_x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_x) <span class="co"># one unit change in y for 1 unit change in x</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>y_error <span class="ot">&lt;-</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Then we draw samples from population</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_x)  <span class="co"># means for all variables = 0</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(covs_x, <span class="at">nrow =</span> n_x, <span class="at">ncol =</span> n_x)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(sigma) <span class="ot">&lt;-</span> vars_x  </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>sigma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
 [1,]  100   50   50   50   50   50   50   50   50    50    50    50    50
 [2,]   50  100   50   50   50   50   50   50   50    50    50    50    50
 [3,]   50   50  100   50   50   50   50   50   50    50    50    50    50
 [4,]   50   50   50  100   50   50   50   50   50    50    50    50    50
 [5,]   50   50   50   50  100   50   50   50   50    50    50    50    50
 [6,]   50   50   50   50   50  100   50   50   50    50    50    50    50
 [7,]   50   50   50   50   50   50  100   50   50    50    50    50    50
 [8,]   50   50   50   50   50   50   50  100   50    50    50    50    50
 [9,]   50   50   50   50   50   50   50   50  100    50    50    50    50
[10,]   50   50   50   50   50   50   50   50   50   100    50    50    50
[11,]   50   50   50   50   50   50   50   50   50    50   100    50    50
[12,]   50   50   50   50   50   50   50   50   50    50    50   100    50
[13,]   50   50   50   50   50   50   50   50   50    50    50    50   100
[14,]   50   50   50   50   50   50   50   50   50    50    50    50    50
[15,]   50   50   50   50   50   50   50   50   50    50    50    50    50
[16,]   50   50   50   50   50   50   50   50   50    50    50    50    50
[17,]   50   50   50   50   50   50   50   50   50    50    50    50    50
[18,]   50   50   50   50   50   50   50   50   50    50    50    50    50
[19,]   50   50   50   50   50   50   50   50   50    50    50    50    50
[20,]   50   50   50   50   50   50   50   50   50    50    50    50    50
      [,14] [,15] [,16] [,17] [,18] [,19] [,20]
 [1,]    50    50    50    50    50    50    50
 [2,]    50    50    50    50    50    50    50
 [3,]    50    50    50    50    50    50    50
 [4,]    50    50    50    50    50    50    50
 [5,]    50    50    50    50    50    50    50
 [6,]    50    50    50    50    50    50    50
 [7,]    50    50    50    50    50    50    50
 [8,]    50    50    50    50    50    50    50
 [9,]    50    50    50    50    50    50    50
[10,]    50    50    50    50    50    50    50
[11,]    50    50    50    50    50    50    50
[12,]    50    50    50    50    50    50    50
[13,]    50    50    50    50    50    50    50
[14,]   100    50    50    50    50    50    50
[15,]    50   100    50    50    50    50    50
[16,]    50    50   100    50    50    50    50
[17,]    50    50    50   100    50    50    50
[18,]    50    50    50    50   100    50    50
[19,]    50    50    50    50    50   100    50
[20,]    50    50    50    50    50    50   100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_cases_trn, mu, sigma) <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">str_c</span>(<span class="st">"x_"</span>, <span class="dv">1</span><span class="sc">:</span>n_x)) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>data_trn_1 <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rowSums</span>(<span class="fu">t</span>(<span class="fu">t</span>(x)<span class="sc">*</span>b_x)) <span class="sc">+</span> <span class="fu">rnorm</span>(n_cases_trn, <span class="dv">0</span>, y_error)) <span class="sc">|&gt;</span>  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 100
Columns: 21
$ x_1  &lt;dbl&gt; 0.9961431, 14.6304657, 4.7113834, 5.4731915, 2.2835857, -16.15454…
$ x_2  &lt;dbl&gt; 8.6957591, 0.8347032, -0.5353713, -12.5511722, -1.0787145, -16.42…
$ x_3  &lt;dbl&gt; 10.6129264, 20.4883323, -8.6503901, -1.5413989, -17.7641062, -14.…
$ x_4  &lt;dbl&gt; 11.80601585, 11.29743568, 4.46220219, 0.79397084, -3.78878523, -2…
$ x_5  &lt;dbl&gt; 18.835971, 6.095917, -3.272026, -1.839770, -1.610545, -6.040994, …
$ x_6  &lt;dbl&gt; 2.223292893, 11.500104110, -0.457979676, -8.496314755, 7.87014122…
$ x_7  &lt;dbl&gt; 10.5129546, 6.4060743, 12.0210560, -13.7151243, 11.1422588, -14.2…
$ x_8  &lt;dbl&gt; 8.8124570, 9.6462680, 2.4037228, -0.2015028, 6.3737654, -3.064850…
$ x_9  &lt;dbl&gt; -3.67513802, 3.26579725, -7.25050948, -12.31704216, -1.69613573, …
$ x_10 &lt;dbl&gt; -2.38262537, -6.46882639, 1.83840881, 2.57893960, 6.40948837, -27…
$ x_11 &lt;dbl&gt; 14.9730316, 15.6370590, -1.1323317, 6.5593694, 5.1039078, -7.5830…
$ x_12 &lt;dbl&gt; -4.47755314, 0.04826209, 2.59168486, -4.26699855, 16.49056393, -1…
$ x_13 &lt;dbl&gt; 8.5928287, -4.0292190, -14.4559758, 6.0387060, 2.3659570, -13.319…
$ x_14 &lt;dbl&gt; -10.54664618, 3.85439473, -7.14415536, 5.64697664, 2.86171243, -1…
$ x_15 &lt;dbl&gt; -5.9948683, 0.6097567, 4.8671687, 0.7012719, 14.8754506, 3.478677…
$ x_16 &lt;dbl&gt; 7.9805572, 12.1442098, -2.2095452, -9.1514837, 10.0124739, -2.676…
$ x_17 &lt;dbl&gt; -2.4674864, -13.6498178, 1.0131614, 3.7409088, 5.9397242, -10.243…
$ x_18 &lt;dbl&gt; 9.9571661, 5.7690926, 5.3204675, -13.9289436, 14.6130884, -19.710…
$ x_19 &lt;dbl&gt; -3.37220750, 1.23419418, -6.67125147, -4.95630437, 8.94440082, -5…
$ x_20 &lt;dbl&gt; 3.7686080, 3.4971897, -3.2892748, -14.2852637, -1.5467975, -28.72…
$ y    &lt;dbl&gt; 24.067076, 210.433707, -73.482134, 44.144652, 228.535603, -259.78…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_cases_test, mu, sigma) <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">str_c</span>(<span class="st">"x_"</span>, <span class="dv">1</span><span class="sc">:</span>n_x)) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>data_test_1 <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rowSums</span>(<span class="fu">t</span>(<span class="fu">t</span>(x)<span class="sc">*</span>b_x)) <span class="sc">+</span> <span class="fu">rnorm</span>(n_cases_test, <span class="dv">0</span>, y_error))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Set up a tibble to track model performance in train and test sets</p>
<ul>
<li>We are using test to repeatedly to get rigorous held-out performance separate from model selection process.<br>
</li>
<li>Just for our understanding</li>
<li>We would not choose a model configuration based on test set error</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>error_ex1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">character</span>(), </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">rmse_trn =</span> <span class="fu">numeric</span>(), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">rmse_test =</span> <span class="fu">numeric</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 0
Columns: 3
$ model     &lt;chr&gt; 
$ rmse_trn  &lt;dbl&gt; 
$ rmse_test &lt;dbl&gt; </code></pre>
</div>
</div>
<hr>
<section id="fit-a-standard-ols-linear-regression" class="level3" data-number="6.8.1">
<h3 data-number="6.8.1" class="anchored" data-anchor-id="fit-a-standard-ols-linear-regression"><span class="header-section-number">6.8.1</span> Fit a standard (OLS) linear regression</h3>
<p>Fit the linear model</p>
<ul>
<li>No feature engineering needed. Can use raw predictors as features</li>
<li>No resampling needed b/c there are no hyperparameters</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fit_lm_1 <span class="ot">&lt;-</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data =</span> data_trn_1)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>fit_lm_1 <span class="sc">|&gt;</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 5
   term        estimate std.error statistic p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)   -5.22      12.0    -0.436   0.664 
 2 x_1            1.22       1.40    0.869   0.388 
 3 x_2           -1.42       1.62   -0.874   0.385 
 4 x_3           -0.679      1.59   -0.427   0.671 
 5 x_4            0.392      1.49    0.263   0.793 
 6 x_5            4.20       1.81    2.33    0.0226
 7 x_6            0.804      1.58    0.510   0.612 
 8 x_7            0.953      1.50    0.634   0.528 
 9 x_8            2.30       1.53    1.50    0.137 
10 x_9            2.37       1.53    1.55    0.126 
11 x_10           0.758      1.67    0.454   0.651 
12 x_11           0.530      1.87    0.283   0.778 
13 x_12           1.44       1.78    0.813   0.419 
14 x_13           2.40       1.65    1.45    0.150 
15 x_14           3.26       1.89    1.72    0.0889
16 x_15           0.110      1.53    0.0719  0.943 
17 x_16          -1.28       1.68   -0.761   0.449 
18 x_17          -0.144      1.55   -0.0926  0.926 
19 x_18           2.74       1.66    1.65    0.102 
20 x_19           1.36       1.61    0.843   0.402 
21 x_20          -1.49       1.67   -0.893   0.375 </code></pre>
</div>
</div>
<hr>
<p>Irreducible error was set by <code>y_error</code> (100)</p>
<ul>
<li>Overfit to train</li>
<li>Much worse in test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(<span class="at">truth =</span> data_trn_1<span class="sc">$</span>y, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_1, data_trn_1)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 91.86214</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse_vec</span>(<span class="at">truth =</span> data_test_1<span class="sc">$</span>y, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_1, data_test_1)<span class="sc">$</span>.pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 112.3208</code></pre>
</div>
</div>
<hr>
</section>
<section id="fit-lasso" class="level3" data-number="6.8.2">
<h3 data-number="6.8.2" class="anchored" data-anchor-id="fit-lasso"><span class="header-section-number">6.8.2</span> Fit LASSO</h3>
<p>LASSO, Ridge, and glmnet all need features on same scale to apply penalty consistently</p>
<ul>
<li>Use <code>step_normalize()</code>. This sets mean = 0, sd = 1 (NOTE: Bad name as it does NOT change shape of distribution!)</li>
<li>Can use same recipe for LASSO, Ridge, and glmnet</li>
<li>Can use same train and test feature matrices as well</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rec_1 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(y <span class="sc">~</span> ., <span class="at">data =</span> data_trn_1) <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>rec_prep_1 <span class="ot">&lt;-</span> rec_1 <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn_1)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>feat_trn_1 <span class="ot">&lt;-</span> rec_prep_1 <span class="sc">|&gt;</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="cn">NULL</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>feat_test_1 <span class="ot">&lt;-</span> rec_prep_1 <span class="sc">|&gt;</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_test_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Set up splits for resampling for tuning hyperparameters</p>
<ul>
<li>Use bootstrap for more precise estimation (even if more biased). Good for selection</li>
<li>Can use same bootstrap splits for LASSO, Ridge, and glmnet</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20140102</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>splits_boot_1 <span class="ot">&lt;-</span> data_trn_1 <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">bootstraps</span>(<span class="at">times =</span> <span class="dv">100</span>, <span class="at">strata =</span> <span class="st">"y"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Now onto the LASSO….</p>
<p>We need to tune <span class="math inline">\(\lambda\)</span> (tidymodels calls this <code>penalty</code>)</p>
<ul>
<li><span class="math inline">\(\alpha\)</span> = 1 (tidymodels calls this <code>mixture</code>)</li>
<li>Set up grid with exponential values for <code>penalty</code></li>
<li><code>glmnet</code> uses warm starts so can fit lots of values for <span class="math inline">\(\lambda\)</span> quickly</li>
<li>Could also use <code>cv.glmnet()</code> directly in <code>glmnet</code> package to find good values. See <code>get_lamdas()</code> in fun_modeling.R</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>grid_lasso <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">penalty =</span> <span class="fu">exp</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">500</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fits_lasso_1 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_1, </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">resamples =</span> splits_boot_1, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">grid =</span> grid_lasso, </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>   },</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>   <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>   <span class="at">dir =</span> <span class="st">"cache/006/"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>   <span class="at">file =</span> <span class="st">"fits_lasso_1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Evaluate model performance in validation sets (OOB)</p>
<p>Make sure that you have hit a clear minimum (bottom of U or at least an asymptote)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hyperparameters</span>(fits_lasso_1, <span class="at">hp1 =</span> <span class="st">"penalty"</span>, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="006_regularization_files/figure-html/u6-examples-1-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Fit best configuration (i.e., best lambda) to full train set</p>
<ul>
<li>Use <code>select_best()</code></li>
<li>Don’t forget to indicate which column (<span class="math inline">\(penalty\)</span>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fit_lasso_1 <span class="ot">&lt;-</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">select_best</span>(fits_lasso_1)<span class="sc">$</span>penalty, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>We can now use <code>tidy()</code> to look at the LASSO parameter estimates</p>
<ul>
<li><code>tidy()</code> uses <code>Matrix</code> package, which has conflicts with <code>tidyr</code>. Load the package without those conflicting functions</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix, <span class="at">exclude =</span> <span class="fu">c</span>(<span class="st">"expand"</span>, <span class="st">"pack"</span>, <span class="st">"unpack"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Now call <code>tidy()</code></p>
<ul>
<li>Notice that LASSO sets some <span class="math inline">\(\beta\)</span> to 0 even though none are 0 in DGP</li>
<li>LASSO is not great at reproducing the DGP!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fit_lasso_1 <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   term        estimate penalty
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)    29.9     11.3
 2 x_1             7.26    11.3
 3 x_2             0       11.3
 4 x_3             0       11.3
 5 x_4             0       11.3
 6 x_5            34.2     11.3
 7 x_6             8.00    11.3
 8 x_7             1.56    11.3
 9 x_8            17.4     11.3
10 x_9            20.9     11.3
11 x_10            7.95    11.3
12 x_11            3.49    11.3
13 x_12            7.01    11.3
14 x_13           20.8     11.3
15 x_14           25.8     11.3
16 x_15            4.85    11.3
17 x_16            0       11.3
18 x_17            0       11.3
19 x_18           23.5     11.3
20 x_19            9.56    11.3
21 x_20            0       11.3</code></pre>
</div>
</div>
<hr>
<p>Irreducible error was set by <code>y_error</code> (100)</p>
<ul>
<li>Somewhat overfit to train</li>
<li>Somewhat better in test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(error_ex1 <span class="ot">&lt;-</span> error_ex1 <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"LASSO model"</span>,                       </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_trn =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_trn_1<span class="sc">$</span>y, </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lasso_1,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                                                          feat_trn_1)<span class="sc">$</span>.pred),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_test =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_test_1<span class="sc">$</span>y, </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lasso_1,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                                                           feat_test_1)<span class="sc">$</span>.pred))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  model        rmse_trn rmse_test
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 linear model     91.9      112.
2 LASSO model      94.7      107.</code></pre>
</div>
</div>
<hr>
</section>
<section id="fit-ridge" class="level3" data-number="6.8.3">
<h3 data-number="6.8.3" class="anchored" data-anchor-id="fit-ridge"><span class="header-section-number">6.8.3</span> Fit Ridge</h3>
<p>Fit Ridge algorithm</p>
<ul>
<li>Tune <span class="math inline">\(\lambda\)</span> (<code>penalty</code>)</li>
<li>May need to experiment to get right range of values for lambda</li>
<li><span class="math inline">\(\alpha\)</span> = 0 (<code>mixture</code>)</li>
<li>Evaluate model configurations in OOB validation sets &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>grid_ridge <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">penalty =</span> <span class="fu">exp</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">7</span>, <span class="at">length.out =</span> <span class="dv">500</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>grid_ridge <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">penalty =</span> <span class="fu">exp</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">7</span>, <span class="at">length.out =</span> <span class="dv">500</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fits_ridge_1 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_1, </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">resamples =</span> splits_boot_1, </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">grid =</span> grid_ridge, </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/006/"</span>,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_ridge_1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Review hyperparameter plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hyperparameters</span>(fits_ridge_1, <span class="at">hp1 =</span> <span class="st">"penalty"</span>, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="006_regularization_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Fit best model configuration (i.e., best lambda) in full train set</p>
<ul>
<li>Notice that no <span class="math inline">\(\beta\)</span> are exactly 0</li>
<li><span class="red">Why are parameter estimates not near 1 for LASSO and Ridge?</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit_ridge_1 <span class="ot">&lt;-</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">select_best</span>(fits_ridge_1)<span class="sc">$</span>penalty, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_1)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>fit_ridge_1 <span class="sc">|&gt;</span> </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   term        estimate penalty
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)    29.9     281.
 2 x_1            10.0     281.
 3 x_2             5.53    281.
 4 x_3             5.84    281.
 5 x_4             6.38    281.
 6 x_5            14.4     281.
 7 x_6             9.78    281.
 8 x_7             5.80    281.
 9 x_8            12.2     281.
10 x_9            13.2     281.
11 x_10           10.5     281.
12 x_11           10.3     281.
13 x_12            8.43    281.
14 x_13           12.8     281.
15 x_14           12.3     281.
16 x_15           10.2     281.
17 x_16            3.93    281.
18 x_17            7.67    281.
19 x_18           12.3     281.
20 x_19           11.2     281.
21 x_20            5.91    281.</code></pre>
</div>
</div>
<hr>
<p>Irreducible error was set by <code>y_error</code> (100)</p>
<ul>
<li>Much less overfit to train</li>
<li>Still not bad in test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(error_ex1 <span class="ot">&lt;-</span> error_ex1 <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"Ridge model"</span>,   </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_trn =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_trn_1<span class="sc">$</span>y, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">estimate =</span> <span class="fu">predict</span>(fit_ridge_1,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                                                          feat_trn_1)<span class="sc">$</span>.pred),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_test =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_test_1<span class="sc">$</span>y, </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">estimate =</span> <span class="fu">predict</span>(fit_ridge_1,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                                                           feat_test_1)<span class="sc">$</span>.pred))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  model        rmse_trn rmse_test
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 linear model     91.9      112.
2 LASSO model      94.7      107.
3 Ridge model      98.6      103.</code></pre>
</div>
</div>
<hr>
</section>
<section id="fit-glmnet" class="level3" data-number="6.8.4">
<h3 data-number="6.8.4" class="anchored" data-anchor-id="fit-glmnet"><span class="header-section-number">6.8.4</span> Fit glmnet</h3>
<p>Now we need to tune both</p>
<ul>
<li><span class="math inline">\(\lambda\)</span> (<code>penalty</code>)</li>
<li><span class="math inline">\(\alpha\)</span> (<code>mixture</code>)</li>
<li>Typical to only evaluate a small number of <span class="math inline">\(alpha\)</span></li>
<li>Warm starts across <span class="math inline">\(\lambda\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>grid_glmnet <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">penalty =</span> <span class="fu">exp</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">7</span>, <span class="at">length.out =</span> <span class="dv">500</span>)),</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mixture =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fits_glmnet_1 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">mixture =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_1, </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">resamples =</span> splits_boot_1, </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">grid =</span> grid_glmnet, </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/006/"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_glmnet_1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hyperparameters</span>(fits_glmnet_1, <span class="at">hp1 =</span> <span class="st">"penalty"</span>, <span class="at">hp2 =</span> <span class="st">"mixture"</span>, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="006_regularization_files/figure-html/u6-examples-1-15a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Fit best configuration in full train set</p>
<ul>
<li>Can use <code>select_best()</code> for both hyperparameters, separately</li>
<li>Ridge was best (but cool that glmnet could determine that empirically!)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select_best</span>(fits_glmnet_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  penalty mixture .config                
    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;                  
1    281.       0 Preprocessor1_Model0415</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fit_glmnet_1 <span class="ot">&lt;-</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">select_best</span>(fits_glmnet_1)<span class="sc">$</span>penalty, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">mixture =</span> <span class="fu">select_best</span>(fits_glmnet_1)<span class="sc">$</span>mixture) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fit_glmnet_1 <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   term        estimate penalty
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)    29.9     281.
 2 x_1            10.0     281.
 3 x_2             5.53    281.
 4 x_3             5.84    281.
 5 x_4             6.38    281.
 6 x_5            14.4     281.
 7 x_6             9.78    281.
 8 x_7             5.80    281.
 9 x_8            12.2     281.
10 x_9            13.2     281.
11 x_10           10.5     281.
12 x_11           10.3     281.
13 x_12            8.43    281.
14 x_13           12.8     281.
15 x_14           12.3     281.
16 x_15           10.2     281.
17 x_16            3.93    281.
18 x_17            7.67    281.
19 x_18           12.3     281.
20 x_19           11.2     281.
21 x_20            5.91    281.</code></pre>
</div>
</div>
<hr>
<p>A final comparison of training and test error for the four statistical algorithms</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(error_ex1 <span class="ot">&lt;-</span> error_ex1 <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"glmnet model"</span>,   </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_trn =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_trn_1<span class="sc">$</span>y, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">estimate =</span> <span class="fu">predict</span>(fit_glmnet_1,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                                                          feat_trn_1)<span class="sc">$</span>.pred),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_test =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_test_1<span class="sc">$</span>y, </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">estimate =</span> <span class="fu">predict</span>(fit_glmnet_1,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                                                           feat_test_1)<span class="sc">$</span>.pred))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  model        rmse_trn rmse_test
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 linear model     91.9      112.
2 LASSO model      94.7      107.
3 Ridge model      98.6      103.
4 glmnet model     98.6      103.</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="empirical-example-2-good-and-zero-predictors" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="empirical-example-2-good-and-zero-predictors"><span class="header-section-number">6.9</span> Empirical Example 2: Good and Zero Predictors</h2>
<p>For the second example, we will simulate data with:</p>
<ul>
<li>Two sets of correlated predictors</li>
<li>First set related to outcome</li>
<li>Second set unrelated to outcome</li>
<li>Get a small training sample</li>
<li>Get a big test sample (for more precise estimates of performance of our model configurations)</li>
</ul>
<hr>
<p>Set up simulation parameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>n_cases_trn <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>n_cases_test <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>n_x <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>covs_x <span class="ot">&lt;-</span> <span class="dv">50</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>vars_x <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>b_x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">each =</span> n_x <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>y_error <span class="ot">&lt;-</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_x)  </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_x, <span class="at">ncol =</span> n_x)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_x<span class="sc">/</span><span class="dv">2</span>)){</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_x<span class="sc">/</span><span class="dv">2</span>)){</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    sigma[i, j] <span class="ot">&lt;-</span> covs_x</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (n_x<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n_x){</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> (n_x<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n_x){</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    sigma[i, j] <span class="ot">&lt;-</span> covs_x</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(sigma) <span class="ot">&lt;-</span> vars_x  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Simulate predictors and Y</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2468</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_cases_trn, mu, sigma) <span class="sc">|&gt;</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">str_c</span>(<span class="st">"x_"</span>, <span class="dv">1</span><span class="sc">:</span>n_x)) <span class="sc">|&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>data_trn_2 <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rowSums</span>(<span class="fu">t</span>(<span class="fu">t</span>(x)<span class="sc">*</span>b_x)) <span class="sc">+</span> <span class="fu">rnorm</span>(n_cases_trn, <span class="dv">0</span>, y_error)) <span class="sc">|&gt;</span>  </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 100
Columns: 21
$ x_1  &lt;dbl&gt; -1.4627996, -1.8160400, 2.9068102, -6.5569418, -8.0480270, 9.2138…
$ x_2  &lt;dbl&gt; 17.7272165, 0.6310498, 9.7749301, -9.7193778, -4.3778964, 6.72976…
$ x_3  &lt;dbl&gt; -0.5051625, -17.7689516, 6.3105699, -10.5572604, -3.9617496, 3.90…
$ x_4  &lt;dbl&gt; 3.281062, 8.955012, 3.352868, -11.268461, -4.286181, 13.815268, -…
$ x_5  &lt;dbl&gt; 8.35180401, 6.81665987, 0.06645588, -9.66213146, -8.85459170, 16.…
$ x_6  &lt;dbl&gt; -5.9821809, 18.5962999, -0.8264266, 1.4451062, -9.3772084, 14.342…
$ x_7  &lt;dbl&gt; -12.40624948, 4.28231426, 1.53437679, 5.47908047, -4.77878760, 15…
$ x_8  &lt;dbl&gt; 3.479352, -7.562426, 16.716015, -4.841876, 1.927100, 27.236838, 1…
$ x_9  &lt;dbl&gt; 1.102297, 1.638666, 10.573017, 5.936702, 2.084463, 11.768179, 5.7…
$ x_10 &lt;dbl&gt; -6.6174049, 9.8993606, 5.6307484, 5.7061525, -12.3675238, 0.64541…
$ x_11 &lt;dbl&gt; -0.797748528, -18.721814405, -3.992559581, -21.480685628, -4.0253…
$ x_12 &lt;dbl&gt; 6.7928298, -7.3322948, -5.8933992, -13.0153958, 2.4618048, -12.34…
$ x_13 &lt;dbl&gt; -5.68712456, -1.01785876, 7.86559179, -18.79422479, -3.31514615, …
$ x_14 &lt;dbl&gt; -9.99575229, -16.35133901, -18.02068048, -26.14924286, 1.46020815…
$ x_15 &lt;dbl&gt; -4.2672643, -4.4350928, -13.6207539, -15.1147495, -5.5577594, -13…
$ x_16 &lt;dbl&gt; 8.5520238, -2.5639516, 5.5768023, -19.1732900, -4.1939131, 0.7558…
$ x_17 &lt;dbl&gt; 4.93829278, -14.17190979, -10.23808120, -8.90013599, -9.33297489,…
$ x_18 &lt;dbl&gt; -1.987745, -9.259699, -13.225873, -28.090077, -13.168306, -1.3565…
$ x_19 &lt;dbl&gt; 1.5085562, -13.9721276, -5.6622726, -10.9398210, -22.5233973, -8.…
$ x_20 &lt;dbl&gt; 1.2541564, -19.0101170, -1.6780834, -16.9207862, -7.2618287, 1.13…
$ y    &lt;dbl&gt; -94.94590, 69.75956, 88.46711, 15.72162, 145.49463, 101.30513, 10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_cases_test, mu, sigma) <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">str_c</span>(<span class="st">"x_"</span>, <span class="dv">1</span><span class="sc">:</span>n_x)) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>data_test_2 <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rowSums</span>(<span class="fu">t</span>(<span class="fu">t</span>(x)<span class="sc">*</span>b_x)) <span class="sc">+</span> <span class="fu">rnorm</span>(n_cases_test, <span class="dv">0</span>, y_error)) <span class="sc">|&gt;</span>  </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 21
$ x_1  &lt;dbl&gt; -11.082333, 10.623468, -7.962704, -4.360526, 4.170808, -8.056227,…
$ x_2  &lt;dbl&gt; 4.4892149, 6.5181854, 7.4099931, 5.1254868, 12.7502461, -9.275426…
$ x_3  &lt;dbl&gt; -3.94113759, 2.65646872, -0.10913588, 13.39114437, 12.99616116, 3…
$ x_4  &lt;dbl&gt; -17.3732360, 2.6196690, -6.8545899, 3.6877167, 9.5982646, 7.09623…
$ x_5  &lt;dbl&gt; 2.1853683, 25.4130435, 0.2749666, 3.9995128, 16.5471387, 9.649271…
$ x_6  &lt;dbl&gt; -13.8387545, -7.7514735, -1.0824170, -10.3723020, 13.3474819, -4.…
$ x_7  &lt;dbl&gt; -8.1371882, 14.0102608, 2.6593081, 5.2537524, 0.2673897, -5.48200…
$ x_8  &lt;dbl&gt; -22.8820028, 0.8089559, -2.8108121, 10.4672192, 10.9376332, 1.937…
$ x_9  &lt;dbl&gt; -20.8906202, 13.3578359, 19.4734781, 0.7248788, 7.3258207, 14.565…
$ x_10 &lt;dbl&gt; -18.2918851, 3.0034874, 5.3284673, -1.6321880, 5.1493291, 4.60337…
$ x_11 &lt;dbl&gt; 18.672349, 11.091231, 14.868589, 9.865558, 4.726164, 14.227183, 1…
$ x_12 &lt;dbl&gt; 5.5770933, 0.5463577, -9.0256983, 3.8787265, 9.8113720, -3.925492…
$ x_13 &lt;dbl&gt; -6.996611892, 19.551699340, 15.284866989, -2.964783803, 3.1004588…
$ x_14 &lt;dbl&gt; 21.031040, 13.320671, 18.770094, 10.911134, -0.382450, 18.983760,…
$ x_15 &lt;dbl&gt; -1.06370853, 14.64546199, -2.46018710, 3.09542088, -0.52366758, 8…
$ x_16 &lt;dbl&gt; -0.8450554, 17.3738247, 4.3254573, 12.7759481, 13.7785211, 13.078…
$ x_17 &lt;dbl&gt; 4.6867098, -1.5470071, 2.1471326, -9.5172721, 11.7413577, 6.54228…
$ x_18 &lt;dbl&gt; 6.3226155, 9.0624381, 0.5223122, 6.1315901, 5.0103132, 7.2802472,…
$ x_19 &lt;dbl&gt; 7.6803428, -2.6084423, 4.2716484, 22.0685295, 0.4731131, 8.255899…
$ x_20 &lt;dbl&gt; -5.4343168, -4.9070165, 13.5187641, 14.4286786, 8.4636535, 8.9575…
$ y    &lt;dbl&gt; -83.529025, 83.571326, 86.073513, -95.654257, 79.326001, 114.5172…</code></pre>
</div>
</div>
<hr>
<p>Set up a tibble to track model performance in train and test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>error_ex2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">character</span>(), <span class="at">rmse_trn =</span> <span class="fu">numeric</span>(), <span class="at">rmse_test =</span> <span class="fu">numeric</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 0
Columns: 3
$ model     &lt;chr&gt; 
$ rmse_trn  &lt;dbl&gt; 
$ rmse_test &lt;dbl&gt; </code></pre>
</div>
</div>
<hr>
<section id="fit-a-standard-ols-linear-regression-1" class="level3" data-number="6.9.1">
<h3 data-number="6.9.1" class="anchored" data-anchor-id="fit-a-standard-ols-linear-regression-1"><span class="header-section-number">6.9.1</span> Fit a standard (OLS) linear regression</h3>
<p>Fit and evaluate the linear model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fit_lm_2 <span class="ot">&lt;-</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data =</span> data_trn_2)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>fit_lm_2 <span class="sc">|&gt;</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 5
   term        estimate std.error statistic p.value
   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept) -14.0        10.8    -1.30    0.198 
 2 x_1          -0.372       1.45   -0.256   0.798 
 3 x_2           3.54        1.39    2.55    0.0126
 4 x_3           1.54        1.53    1.01    0.317 
 5 x_4           2.90        1.42    2.05    0.0441
 6 x_5           2.98        1.50    1.98    0.0509
 7 x_6          -1.28        1.34   -0.956   0.342 
 8 x_7           0.821       1.48    0.553   0.582 
 9 x_8           1.38        1.26    1.10    0.276 
10 x_9           0.280       1.25    0.225   0.823 
11 x_10          0.0247      1.33    0.0186  0.985 
12 x_11         -2.09        1.56   -1.34    0.185 
13 x_12          1.71        1.47    1.16    0.248 
14 x_13          1.33        1.42    0.936   0.352 
15 x_14         -0.927       1.24   -0.747   0.457 
16 x_15          2.99        1.53    1.96    0.0536
17 x_16         -0.602       1.40   -0.431   0.668 
18 x_17          1.78        1.28    1.39    0.168 
19 x_18         -1.73        1.73   -1.00    0.321 
20 x_19         -1.28        1.37   -0.938   0.351 
21 x_20         -2.83        1.24   -2.28    0.0253</code></pre>
</div>
</div>
<hr>
<p>Irreducible error was set by <code>y_error</code> (100)</p>
<ul>
<li>Very overfit to train</li>
<li>Very poor performance in test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>(error_ex2 <span class="ot">&lt;-</span> error_ex2 <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"linear model"</span>,                       </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_trn =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> data_trn_2<span class="sc">$</span>y, </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_2,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                                                          data_trn_2)<span class="sc">$</span>.pred),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_test =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> data_test_2<span class="sc">$</span>y, </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lm_2,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                                                           data_test_2)<span class="sc">$</span>.pred))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  model        rmse_trn rmse_test
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 linear model     83.4      117.</code></pre>
</div>
</div>
<hr>
</section>
<section id="fit-lasso-1" class="level3" data-number="6.9.2">
<h3 data-number="6.9.2" class="anchored" data-anchor-id="fit-lasso-1"><span class="header-section-number">6.9.2</span> Fit LASSO</h3>
<p>For all glmnet algorithms, set up:</p>
<ul>
<li>Recipe</li>
<li>Feature matrices</li>
<li>Bootstraps for model configuration selection (tuning)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>rec_2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(y <span class="sc">~</span> ., <span class="at">data =</span> data_trn_2) <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>rec_prep_2 <span class="ot">&lt;-</span> rec_2 <span class="sc">|&gt;</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(data_trn_2)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>feat_trn_2 <span class="ot">&lt;-</span> rec_prep_2 <span class="sc">|&gt;</span> </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="cn">NULL</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>feat_test_2 <span class="ot">&lt;-</span> rec_prep_2 <span class="sc">|&gt;</span> </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(data_test_2)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20140102</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>splits_boot_2 <span class="ot">&lt;-</span> data_trn_2 <span class="sc">|&gt;</span> </span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">bootstraps</span>(<span class="at">times =</span> <span class="dv">100</span>, <span class="at">strata =</span> <span class="st">"y"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Tune <span class="math inline">\(\lambda\)</span> for LASSO</p>
<ul>
<li>We can use sample penalty grids from earlier example because sample size and number of features hasnt changed so likely still good</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fits_lasso_2 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_2, </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">resamples =</span> splits_boot_2, </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">grid =</span> grid_lasso, </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/006/"</span>,</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_lasso_2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Plot hyperparameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hyperparameters</span>(fits_lasso_2, <span class="at">hp1 =</span> <span class="st">"penalty"</span>, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="006_regularization_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Fit best LASSO to full training set</p>
<ul>
<li>Notice the many <span class="math inline">\(\beta\)</span> = 0</li>
<li>It did set some of the “good” features to 0 as well</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fit_lasso_2 <span class="ot">&lt;-</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">select_best</span>(fits_lasso_2)<span class="sc">$</span>penalty, </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_2)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>fit_lasso_2 <span class="sc">|&gt;</span> </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   term        estimate penalty
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)    5.52     12.7
 2 x_1            1.02     12.7
 3 x_2           21.4      12.7
 4 x_3            8.60     12.7
 5 x_4           23.3      12.7
 6 x_5           19.9      12.7
 7 x_6            0        12.7
 8 x_7            0        12.7
 9 x_8           10.8      12.7
10 x_9            0.589    12.7
11 x_10           0        12.7
12 x_11          -0.632    12.7
13 x_12           0        12.7
14 x_13           0        12.7
15 x_14           0        12.7
16 x_15           0        12.7
17 x_16           0        12.7
18 x_17           0        12.7
19 x_18           0        12.7
20 x_19           0        12.7
21 x_20          -6.93     12.7</code></pre>
</div>
</div>
<hr>
<p>Irreducible error was set by <code>y_error</code> (100)</p>
<ul>
<li>Somewhat overfit to train</li>
<li>Good in val</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>(error_ex2 <span class="ot">&lt;-</span> error_ex2 <span class="sc">|&gt;</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"LASSO model"</span>,                       </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_trn =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_trn_2<span class="sc">$</span>y, </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lasso_2,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>                                                          feat_trn_2)<span class="sc">$</span>.pred),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_test =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_test_2<span class="sc">$</span>y, </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">estimate =</span> <span class="fu">predict</span>(fit_lasso_2,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>                                                           feat_test_2)<span class="sc">$</span>.pred))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  model        rmse_trn rmse_test
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 linear model     83.4      117.
2 LASSO model      92.9      103.</code></pre>
</div>
</div>
<hr>
</section>
<section id="fit-ridge-1" class="level3" data-number="6.9.3">
<h3 data-number="6.9.3" class="anchored" data-anchor-id="fit-ridge-1"><span class="header-section-number">6.9.3</span> Fit Ridge</h3>
<p>Tune <span class="math inline">\(\lambda\)</span> for Ridge</p>
<ul>
<li>can use ridge penalty grid from example 1</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>fits_ridge_2 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_2, </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">resamples =</span> splits_boot_2, </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">grid =</span> grid_ridge, </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/006/"</span>,</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_ridge_2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Plot hyperparameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hyperparameters</span>(fits_ridge_2, <span class="at">hp1 =</span> <span class="st">"penalty"</span>, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="006_regularization_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hyperparameters</span>(fits_ridge_2, <span class="at">hp1 =</span> <span class="st">"penalty"</span>, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="006_regularization_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Fit best Ridge to full training set</p>
<ul>
<li>Notice no <span class="math inline">\(\beta\)</span> = 0</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>fit_ridge_2 <span class="ot">&lt;-</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">select_best</span>(fits_ridge_2)<span class="sc">$</span>penalty, </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_2)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>fit_ridge_2 <span class="sc">|&gt;</span> </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   term        estimate penalty
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)     5.52    132.
 2 x_1             7.19    132.
 3 x_2            14.7     132.
 4 x_3             9.23    132.
 5 x_4            14.6     132.
 6 x_5            12.7     132.
 7 x_6             4.12    132.
 8 x_7             6.27    132.
 9 x_8             9.75    132.
10 x_9             5.83    132.
11 x_10            5.18    132.
12 x_11           -6.65    132.
13 x_12            4.21    132.
14 x_13            3.84    132.
15 x_14           -2.49    132.
16 x_15            5.80    132.
17 x_16           -1.39    132.
18 x_17            4.19    132.
19 x_18           -5.07    132.
20 x_19           -5.88    132.
21 x_20           -8.57    132.</code></pre>
</div>
</div>
<hr>
<p>Irreducible error was set by <code>y_error</code> (100)</p>
<ul>
<li>Somewhat overfit to train</li>
<li>Still slightly better than LASSO in test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>(error_ex2 <span class="ot">&lt;-</span> error_ex2 <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"Ridge model"</span>,                       </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_trn =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_trn_2<span class="sc">$</span>y, </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">estimate =</span> <span class="fu">predict</span>(fit_ridge_2,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                                                          feat_trn_2)<span class="sc">$</span>.pred),</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_test =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_test_2<span class="sc">$</span>y, </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">estimate =</span> <span class="fu">predict</span>(fit_ridge_2,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                                                           feat_test_2)<span class="sc">$</span>.pred))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  model        rmse_trn rmse_test
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 linear model     83.4      117.
2 LASSO model      92.9      103.
3 Ridge model      90.6      102.</code></pre>
</div>
</div>
<hr>
</section>
<section id="fit-complete-glmnet" class="level3" data-number="6.9.4">
<h3 data-number="6.9.4" class="anchored" data-anchor-id="fit-complete-glmnet"><span class="header-section-number">6.9.4</span> Fit Complete glmnet</h3>
<p>Tune <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\alpha\)</span> for glmnet</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>fits_glmnet_2 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">mixture =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tune_grid</span>(<span class="at">preprocessor =</span> rec_2, </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">resamples =</span> splits_boot_2, </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">grid =</span> grid_glmnet, </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rerun =</span> rerun_setting,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="st">"cache/006/"</span>,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"fits_glmnet_2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Plot hyperparameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_hyperparameters</span>(fits_glmnet_2, <span class="at">hp1 =</span> <span class="st">"penalty"</span>, <span class="at">hp2 =</span> <span class="st">"mixture"</span>, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="006_regularization_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Fit Best glmnet in full train set</p>
<ul>
<li>Still Ridge (but won’t always be)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select_best</span>(fits_glmnet_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  penalty mixture .config                
    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;                  
1    132.       0 Preprocessor1_Model0368</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fit_glmnet_2 <span class="ot">&lt;-</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">select_best</span>(fits_glmnet_2)<span class="sc">$</span>penalty, </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">mixture =</span> <span class="fu">select_best</span>(fits_glmnet_2)<span class="sc">$</span>mixture) <span class="sc">|&gt;</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data =</span> feat_trn_2)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>fit_glmnet_2 <span class="sc">|&gt;</span> </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   term        estimate penalty
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)     5.52    132.
 2 x_1             7.19    132.
 3 x_2            14.7     132.
 4 x_3             9.23    132.
 5 x_4            14.6     132.
 6 x_5            12.7     132.
 7 x_6             4.12    132.
 8 x_7             6.27    132.
 9 x_8             9.75    132.
10 x_9             5.83    132.
11 x_10            5.18    132.
12 x_11           -6.65    132.
13 x_12            4.21    132.
14 x_13            3.84    132.
15 x_14           -2.49    132.
16 x_15            5.80    132.
17 x_16           -1.39    132.
18 x_17            4.19    132.
19 x_18           -5.07    132.
20 x_19           -5.88    132.
21 x_20           -8.57    132.</code></pre>
</div>
</div>
<hr>
<p>Irreducible error was set by <code>y_error</code> (100)</p>
<ul>
<li>Somewhat overfit to train</li>
<li>Still not bad in validate</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>(error_ex2 <span class="ot">&lt;-</span> error_ex2 <span class="sc">|&gt;</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"glmnet model"</span>,   </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_trn =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_trn_2<span class="sc">$</span>y, </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">estimate =</span> <span class="fu">predict</span>(fit_glmnet_2,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                                                          feat_trn_2)<span class="sc">$</span>.pred),</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rmse_test =</span> <span class="fu">rmse_vec</span>(<span class="at">truth =</span> feat_test_2<span class="sc">$</span>y, </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">estimate =</span> <span class="fu">predict</span>(fit_glmnet_2,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>                                                           feat_test_2)<span class="sc">$</span>.pred))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  model        rmse_trn rmse_test
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
1 linear model     83.4      117.
2 LASSO model      92.9      103.
3 Ridge model      90.6      102.
4 glmnet model     90.6      102.</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="lasso-for-feature-e.g.-covariate-selection" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="lasso-for-feature-e.g.-covariate-selection"><span class="header-section-number">6.10</span> LASSO for Feature (e.g., Covariate) Selection?</h2>
<p>Lets consider a typical explanatory setting in Psychology</p>
<ul>
<li>A focal dichotomous IV (your experimental manipulation)</li>
<li>A number of covariates (some good, some bad)</li>
<li>A quantitative outcome (y)</li>
<li>Covariates are uncorrelated with IV b/c IV is manipulated</li>
</ul>
<p>Let’s pretend the previous 20 <code>x</code>s were your covariates</p>
<hr>
<p>What are your options to test <code>iv</code> prior to this course?</p>
<ul>
<li><p>You want to use covariates to increase power</p></li>
<li><p>BUT you don’t know which covariates to use</p>
<ul>
<li><p>You might use all of them</p></li>
<li><p>Or you might use none of them (a clear lost opportunity)</p></li>
<li><p>Or you might hack it by using those increase your focal IV effect (very bad!)</p></li>
</ul></li>
</ul>
<hr>
<p>NOW, We might use the feature selection characteristics for LASSO to select which covariates are included<br>
<br>
There are two possibilities that occur to me</p>
<hr>
<ol type="1">
<li>Use LASSO to build best DGP for a covariates only model<br>
<br>
</li>
</ol>
<ul>
<li>Could be more conservative (fewer covariates) by using within 1 SE of best performance but less flexible (i.e., will set more parameter estimates to 0)</li>
<li>Follow up with a linear model (using <span class="math inline">\(lm\)</span>), regressing y on <span class="math inline">\(iv\)</span> and covariates from LASSO that are non-zero</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>fit_lasso_2 <span class="sc">|&gt;</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   term        estimate penalty
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)    5.52     12.7
 2 x_1            1.02     12.7
 3 x_2           21.4      12.7
 4 x_3            8.60     12.7
 5 x_4           23.3      12.7
 6 x_5           19.9      12.7
 7 x_6            0        12.7
 8 x_7            0        12.7
 9 x_8           10.8      12.7
10 x_9            0.589    12.7
11 x_10           0        12.7
12 x_11          -0.632    12.7
13 x_12           0        12.7
14 x_13           0        12.7
15 x_14           0        12.7
16 x_15           0        12.7
17 x_16           0        12.7
18 x_17           0        12.7
19 x_18           0        12.7
20 x_19           0        12.7
21 x_20          -6.93     12.7</code></pre>
</div>
</div>
<ul>
<li>You clearly improved your best guess on covariates to include</li>
<li>You will regress y on <code>iv</code> and the 11 covariates with non-zero effects</li>
</ul>
<hr>
<ol start="2" type="1">
<li>Use LASSO to build best DGP including <code>iv</code> and covariates but don’t penalize <code>iv</code><br>
<br>
</li>
</ol>
<ul>
<li>Look at <code>penalty.factor = rep(1, nvars)</code> argument in <code>glmnet()</code></li>
<li>Can fit LASSO with unbiased? estimate of <code>iv</code></li>
<li>Need to bootstrap for SE for <code>iv</code> (next unit)</li>
<li>Only appropriate if IV is manipulated<br>
<br>
</li>
</ul>
<p>Should really conduct simulation study of both of these options (vs.&nbsp;all and no covariates).</p>
<ul>
<li>I want to</li>
<li>Want to do the study with me?</li>
</ul>
<hr>
</section>
<section id="ridge-lasso-and-elastic-net-models-for-other-y-distributions" class="level2" data-number="6.11">
<h2 data-number="6.11" class="anchored" data-anchor-id="ridge-lasso-and-elastic-net-models-for-other-y-distributions"><span class="header-section-number">6.11</span> Ridge, LASSO, and Elastic net models for other Y distributions</h2>
<p>These penalties can be added to the cost functions of other generalized linear models to yield regularized/penalized versions of those models as well. For example<br>
<br>
L1 penalized (LASSO) logistic regression (w/ labels coded 0,1):</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}([\:\sum_{i = 1}^{n} -Y_ilog(\hat{Y_i}) - (1-Y_i)log(1-\hat{Y_i})\:]\:+\:[\:\lambda\sum_{j = 1}^{p} |\beta_j|\:]\)</span><br>
<br>
</li>
</ul>
<p>For L2 penalized (Ridge) logistic regression (w/ labels coded 0,1)</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}([\:\sum_{i = 1}^{n} -Y_ilog(\hat{Y_i}) - (1-Y_i)log(1-\hat{Y_i})\:]\:+\:[\:\lambda\sum_{j = 1}^{p} \beta_j^{2}\:]\)</span><br>
<br>
</li>
</ul>
<p><code>glmnet</code> implements:</p>
<ul>
<li><code>family = c("gaussian", "binomial", "poisson", "multinomial", "cox", "mgaussian")</code></li>
<li>Full range of <span class="math inline">\(\alpha\)</span> to mix two types of penalties</li>
</ul>
<hr>
</section>
<section id="discussion" class="level2" data-number="6.12">
<h2 data-number="6.12" class="anchored" data-anchor-id="discussion"><span class="header-section-number">6.12</span> Discussion</h2>
<section id="announcements" class="level3" data-number="6.12.1">
<h3 data-number="6.12.1" class="anchored" data-anchor-id="announcements"><span class="header-section-number">6.12.1</span> Announcements</h3>
<ul>
<li>Midterm - application and conceptual parts</li>
<li>Can we have a midterm review session?</li>
</ul>
<hr>
</section>
<section id="feature-matrix-vs.-raw-predictors" class="level3" data-number="6.12.2">
<h3 data-number="6.12.2" class="anchored" data-anchor-id="feature-matrix-vs.-raw-predictors"><span class="header-section-number">6.12.2</span> feature matrix vs.&nbsp;raw predictors</h3>
<p>When to use which and why could I use raw predictors in simulated data example from lectures</p>
<hr>
</section>
<section id="cost-functions-1" class="level3" data-number="6.12.3">
<h3 data-number="6.12.3" class="anchored" data-anchor-id="cost-functions-1"><span class="header-section-number">6.12.3</span> Cost functions</h3>
<p>What is Cost function?<br>
<br>
Linear model</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}\)</span><br>
<br>
</li>
</ul>
<p>Ridge (L2)</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda\sum_{j = 1}^{p} \beta_j^{2}\:])\)</span><br>
<br>
</li>
</ul>
<p>LASSO (L1)</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda\sum_{j = 1}^{p} |\beta_j|\:])\)</span><br>
<br>
</li>
</ul>
<p>Elastic Net</p>
<ul>
<li><span class="math inline">\(\frac{1}{n}([\sum_{i = 1}^{n} (Y_i - \hat{Y_i})^{2}] + [\:\lambda (\alpha\sum_{j = 1}^{p} |\beta_j| + (1-\alpha)\sum_{j = 1}^{p} \beta_j^{2})\:])\)</span></li>
</ul>
<hr>
</section>
<section id="lasso-ridge-and-elastic-net-questions" class="level3" data-number="6.12.4">
<h3 data-number="6.12.4" class="anchored" data-anchor-id="lasso-ridge-and-elastic-net-questions"><span class="header-section-number">6.12.4</span> LASSO, Ridge, and elastic net questions</h3>
<ul>
<li><p>The pros and cons of Lasso and Ridge vs.&nbsp;Elastic Net</p></li>
<li><p>I’m still a little confused as to why you would ever use Ridge or LASSO separately when you can just selectively use one or the other through elastic net. Wouldn’t it make sense to just always use elastic net and then change the penalty accordingly for when you wanted to use a Ridge or LASSO regression approach?</p>
<ul>
<li>Pure LASSO</li>
<li>model variance</li>
<li>two self-report measure scales vs.&nbsp;items</li>
</ul></li>
<li><p>Some explanation why Lasso is more robust to outliers and ridge is more robust to measurement error would be appreciated.</p></li>
<li><p>I’m not very clear why LASSO could limit some parameters to be zero but ridge regression cannot. Can we go through this a bit?</p></li>
<li><p>How do you know what numbers to start at for tuning lamba (like in the code below)? I think John mentioned he has a function to find these, but I’m wondering if there are any rules of thumb.</p></li>
<li><p>How do we know how “strong” of a penalty we need to be applying to our cost function? Does the reduction in variance increase as we increase the strength of the penalty?</p></li>
<li><p>Is a decreased number of features always good or bad, or does it depend on the model/recipe</p></li>
<li><p>Can you talk more about how to interpret the scale of the parameter estimates? In the lecture you said the following and I’m not quite sure what that means:</p></li>
<li><p>I might be totally wrong but I wonder if we have to care about the multi-collinearity or high dimension on classification as well. Or this is only limited to regression and so we are solving with regularising only regression model?</p></li>
</ul>
<hr>
</section>
<section id="stepwise-questions" class="level3" data-number="6.12.5">
<h3 data-number="6.12.5" class="anchored" data-anchor-id="stepwise-questions"><span class="header-section-number">6.12.5</span> Stepwise questions</h3>
<ul>
<li><p>Could you go over Forward, Backward, and Best Subset subsetting? I think I understand the algorithm they use, but I do not understand the penalty function they use for picking the “best” model. In the book, it looks like it uses R-squared to pick the best model, but wouldn’t the full model always have the greatest R-squared?</p></li>
<li><p>Is there a reason why we do not discuss variable selection using subset methods?</p></li>
<li><p>Is there specific cases when you would pick backwards or forwards selection, or is it up to the researcher?</p></li>
<li><p>Training vs.&nbsp;val/val error in stepwise approaches.</p></li>
<li><p>Use of AIC, BIC, Cp, and adjusted R2 vs.&nbsp;cross-validation</p></li>
</ul>
<hr>
</section>
<section id="explanatory-goals" class="level3" data-number="6.12.6">
<h3 data-number="6.12.6" class="anchored" data-anchor-id="explanatory-goals"><span class="header-section-number">6.12.6</span> Explanatory goals</h3>
<ul>
<li><p>Can LASSO be used for variable selection when engaging in cross sectional data analysis to identify which variables in a large set of Xs are important for a particular outcome?</p></li>
<li><p>In practice, what elements should be considered before selecting IVs and covariates?</p></li>
</ul>
<hr>
</section>
<section id="pca" class="level3" data-number="6.12.7">
<h3 data-number="6.12.7" class="anchored" data-anchor-id="pca"><span class="header-section-number">6.12.7</span> PCA</h3>
<ul>
<li>https://setosa.io/ev/principal-component-analysis/</li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-ISL" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2023. <em>An <span>Introduction</span> to <span>Statistical Learning</span>: With <span>Applications</span> in <span>R</span></em>. 2nd ed. Springer <span>Texts</span> in <span>Statistics</span>. <span>New York</span>: <span>Springer-Verlag</span>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./005_resampling.html" class="pagination-link" aria-label="Resampling Methods for Model Selection and Evaluation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Resampling Methods for Model Selection and Evaluation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./007_midterm.html" class="pagination-link" aria-label="Midterm Exam">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Midterm Exam</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jjcurtin/book_iaml/edit/main/006_regularization.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>